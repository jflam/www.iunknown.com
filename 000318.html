<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

<title>iunknown.com: Multiple user roles and trusted SQL Server Connections</title>

<link rel="stylesheet" href="http://www.iunknown.com/styles-site.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.iunknown.com/index.rdf" />

<link rel="start" href="http://www.iunknown.com/" title="Home" />
<link rel="prev" href="http://www.iunknown.com/000317.html" title="Visual Studio .NET Tip of the Day" />

<link rel="next" href="http://www.iunknown.com/000319.html" title="Securing ASP.NET using Enterprise Services" />


<script type="text/javascript" language="javascript">
<!--

function OpenTrackback (c) {
    window.open(c,
                    'trackback',
                    'width=480,height=480,scrollbars=yes,status=yes');
}

var HOST = 'www.iunknown.com';

// Copyright (c) 1996-1997 Athenia Associates.
// http://www.webreference.com/js/
// License is granted if and only if this entire
// copyright notice is included. By Tomer Shiran.

function setCookie (name, value, expires, path, domain, secure) {
    var curCookie = name + "=" + escape(value) + ((expires) ? "; expires=" + expires.toGMTString() : "") + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + ((secure) ? "; secure" : "");
    document.cookie = curCookie;
}

function getCookie (name) {
    var prefix = name + '=';
    var c = document.cookie;
    var nullstring = '';
    var cookieStartIndex = c.indexOf(prefix);
    if (cookieStartIndex == -1)
        return nullstring;
    var cookieEndIndex = c.indexOf(";", cookieStartIndex + prefix.length);
    if (cookieEndIndex == -1)
        cookieEndIndex = c.length;
    return unescape(c.substring(cookieStartIndex + prefix.length, cookieEndIndex));
}

function deleteCookie (name, path, domain) {
    if (getCookie(name))
        document.cookie = name + "=" + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + "; expires=Thu, 01-Jan-70 00:00:01 GMT";
}

function fixDate (date) {
    var base = new Date(0);
    var skew = base.getTime();
    if (skew > 0)
        date.setTime(date.getTime() - skew);
}

function rememberMe (f) {
    var now = new Date();
    fixDate(now);
    now.setTime(now.getTime() + 365 * 24 * 60 * 60 * 1000);
    setCookie('mtcmtauth', f.author.value, now, '', HOST, '');
    setCookie('mtcmtmail', f.email.value, now, '', HOST, '');
    setCookie('mtcmthome', f.url.value, now, '', HOST, '');
}

function forgetMe (f) {
    deleteCookie('mtcmtmail', '', HOST);
    deleteCookie('mtcmthome', '', HOST);
    deleteCookie('mtcmtauth', '', HOST);
    f.email.value = '';
    f.author.value = '';
    f.url.value = '';
}

//-->
</script>

<!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="http://www.iunknown.com/000318.html"
    trackback:ping="http://www.iunknown.com/cgi-bin/mt-tb.cgi/62"
    dc:title="Multiple user roles and trusted SQL Server Connections"
    dc:identifier="http://www.iunknown.com/000318.html"
    dc:subject=""
    dc:description="One of the most common questions that I get from advanced students in my ASP.NET class is: &quot;How do I map users to different roles and still use Windows authentication in SQL Server?&quot; This is actually a pretty difficult problem..."
    dc:creator="John"
    dc:date="2003-09-02T20:07:02-05:00" />
</rdf:RDF>
-->




</head>

<body>

<div id="banner">
<h1><a href="http://www.iunknown.com/" accesskey="1"><img src="/mt-static/images/iunknown.png" width="350" height="60" border="0"></a></h1>
<span class="description">.NET Training and Consulting in Toronto with John Lam</span>
</div>

<div id="container">

<div class="blog">

<div id="menu">
<a href="http://www.iunknown.com/000317.html">&laquo; Visual Studio .NET Tip of the Day</a> |

<a href="http://www.iunknown.com/">Main</a>
| <a href="http://www.iunknown.com/000319.html">Securing ASP.NET using Enterprise Services &raquo;</a>

</div>

</div>


<div class="blog">

<h2 class="date">September 02, 2003</h2>

<div class="blogbody">

<h3 class="title">Multiple user roles and trusted SQL Server Connections</h3>

<div class="midAds">
<script type="text/javascript"><!--
google_ad_client = "pub-8264790134546506";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_channel ="6417806153";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

<p>One of the most common questions that I get from advanced students in my <span class="caps">ASP.NET</span> class is: "How do I map users to different roles and still use Windows authentication in <span class="caps">SQL </span>Server?"</p>

<p>This is actually a pretty difficult problem to solve. In the simplest case, you have two different groups of users. Let's call them Users and Administrators. You want to restrict access to stored procedures in your <span class="caps">SQL </span>Server database by setting the appropriate access control lists (ACL's) in <span class="caps">SQL </span>Enterprise Manager.</p>

<p>Here's a very rough outline of the process. First, your <span class="caps">ASP.NET</span> application needs to map users to the appropriate roles. This in its own right is a fairly complicated topic, so I'll cover this later. Let's assume for the time being that you have determined whether the caller is a User or an Administrator. </p>

<p>Next, you need to partition your data access code into two different assemblies; one for Users and the other for Administrators. Your data access code must live in Serviced Components, which are registered as <span class="caps">COM</span>+ applications. Finally, you must set the Identity of your <span class="caps">COM</span>+ application is. Your User data access assembly will run under one account, and your Administrator data access assembly will run under a different account.</p>

<p>Finally, you set the appropriate <span class="caps">ACL</span>'s in <span class="caps">SQL </span>Enterprise Manager to allow your User account and your Administrator account in.</p>

<p>There are a whole raft of nasty deployment issues that arise to support this rather innocent looking scenario. I'll cover the blood and guts of this scenario over the next few days as I build a sample application that solves this problem.&Acirc;&nbsp;</p>

<a name="more"></a>


<span class="posted">Posted by John at September  2, 2003 08:07 PM
| <a href="http://www.iunknown.com/cgi-bin/mt-tb.cgi?__mode=view&amp;entry_id=318" onclick="OpenTrackback(this.href); return false">TrackBack</a>

<br /></span>

</div>

<div class="comments-head"><a name="mailthisentry"></a>Mail this entry</div>

<form method="post" action="http://www.iunknown.com/cgi-bin/mt-send-entry.cgi">
<input type="hidden" name="entry_id" value="318" />
<input type="hidden" name="_redirect" value="http://www.iunknown.com/000318.html" />
Email this entry to:<br />
<input name="to" size="20" /><br /><br />
Your email address:<br />
<input name="from" size="20" /><br /><br />
Message (optional):<br />
<textarea name="message" rows="5" cols="20" wrap="virtual"></textarea><br /><br />
<input type="submit" value="Send" />
</form>


<div class="comments-head"><a name="comments"></a>Comments</div>




<div class="comments-head">Post a comment</div>

<div class="comments-body">
<form method="post" action="http://www.iunknown.com/cgi-bin/mt-comments.cgi" name="comments_form" onsubmit="if (this.bakecookie[0].checked) rememberMe(this)">
<input type="hidden" name="static" value="1" />
<input type="hidden" name="entry_id" value="318" />

<div style="width:180px; padding-right:15px; margin-right:15px; float:left; text-align:left; border-right:1px dotted #bbb;">
	<label for="author">Name:</label><br />
	<input tabindex="1" id="author" name="author" /><br /><br />

	<label for="email">Email Address:</label><br />
	<input tabindex="2" id="email" name="email" /><br /><br />

	<label for="url">URL:</label><br />
	<input tabindex="3" id="url" name="url" /><br /><br />
</div>

Remember personal info?<br />
<input type="radio" id="bakecookie" name="bakecookie" /><label for="bakecookie">Yes</label><input type="radio" id="forget" name="bakecookie" onclick="forgetMe(this.form)" value="Forget Info" style="margin-left: 15px;" /><label for="forget">No</label><br style="clear: both;" />

<label for="text">Comments:</label><br />
<textarea tabindex="4" id="text" name="text" rows="10" cols="50"></textarea><br /><br />

<input type="submit" name="preview" value="&nbsp;Preview&nbsp;" />
<input style="font-weight: bold;" type="submit" name="post" value="&nbsp;Post&nbsp;" /><br /><br />

</form>

<script type="text/javascript" language="javascript">
<!--
document.comments_form.email.value = getCookie("mtcmtmail");
document.comments_form.author.value = getCookie("mtcmtauth");
document.comments_form.url.value = getCookie("mtcmthome");
if (getCookie("mtcmtauth")) {
    document.comments_form.bakecookie[0].checked = true;
} else {
    document.comments_form.bakecookie[1].checked = true;
}
//-->
</script>
</div>


</div>
</div>
</body>
</html>
