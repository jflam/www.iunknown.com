<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Less is better</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  
  <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.iunknown.com/xml/rsd" />
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/LessIsBetter" />
  <script src="/javascripts/cookies.js?1156231406" type="text/javascript"></script>
  <script src="/javascripts/prototype.js?1156231406" type="text/javascript"></script>
  <script src="/javascripts/effects.js?1156231406" type="text/javascript"></script>
  <script src="/javascripts/typo.js?1156231406" type="text/javascript"></script>
  
  <script type="text/javascript"></script>
  <link href="/stylesheets/theme/application.css?1164503575" media="all" rel="Stylesheet" type="text/css" />
  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
  <script type="text/javascript">
    _uacct="UA-133590-1";
    urchinTracker();
  </script>
</head>

<body>
<div id="container">
  <div id="header">
    <h1><span><a href="/">Less is better</a></span></h1>
    <h2>John Lam on software</h2>
  </div>

  <div id="page">
    <div id="content">
      <div class="atomentry" id="article-137">
  <h2 class="title">
    <a href="/articles/2006/05/17/rubyclr-on-developer-night-in-canada">RubyCLR on Developer Night in Canada</a> 
    
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-17T11:09:00-07:00"><span class="typo_date" title="Wed, 17 May 2006 18:09:00 GMT">Wed, 17 May 2006 18:09:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p><a href="http://blogs.msdn.com/jbristowe/default.aspx">John Bristowe</a> interviewed me a few weeks ago about RubyCLR. He just posted the <a href="http://dnic.ca/blogs/dnic/archive/2006/05/16/37.aspx">podcast here</a> on <a href="http://www.dnic.ca">Developer Night in Canada</a> (he really needs to figure out a way to get the &#8216;real&#8217; music for the show!).</p>


	<p>We talked about a whole range of topics from why should you learn Ruby? to how the <span class="caps">CLR</span> can be more friendly to dynamic languages.</p>


	<p>I don&#8217;t think John knew this, but I did the whole interview from the back seat of my car because that was the only quiet place that I could find at that time!</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/personal" rel="tag">Life</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/17/rubyclr-on-developer-night-in-canada#comments">no comments</a>,
      <a href="/articles/2006/05/17/rubyclr-on-developer-night-in-canada" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/137/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/137/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/17/rubyclr-on-developer-night-in-canada">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/17/rubyclr-on-developer-night-in-canada;title=RubyCLR on Developer Night in Canada">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-136">
  <h2 class="title">
    <a href="/articles/2006/05/17/andrew-tannenbaum-on-less-software">Andrew Tannenbaum on Less Software</a> 
    <span class="comment_count">2</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-17T10:42:50-07:00"><span class="typo_date" title="Wed, 17 May 2006 17:42:50 GMT">Wed, 17 May 2006 17:42:50 GMT</span></abbr>
  </p>

  <div class="content">
    <p>A nice quote from <a href="http://www.cs.vu.nl/~ast/brown/">Andrew Tannenbaum on less software</a></p>


	<blockquote>
		<p>As I did 20 years ago, I still fervently believe that the only way to make software secure, reliable, and fast is to make it small. Fight Features.</p>
	</blockquote>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/links" rel="tag">Props</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/17/andrew-tannenbaum-on-less-software#comments">2 comments</a>,
      <a href="/articles/2006/05/17/andrew-tannenbaum-on-less-software" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/136/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/136/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/17/andrew-tannenbaum-on-less-software">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/17/andrew-tannenbaum-on-less-software;title=Andrew Tannenbaum on Less Software">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-135">
  <h2 class="title">
    <a href="/articles/2006/05/14/activerecord-as-a-facade-over-a-datatable">ActiveRecord as a facade over a DataTable?</a> 
    
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-14T13:48:00-07:00"><span class="typo_date" title="Sun, 14 May 2006 20:48:00 GMT">Sun, 14 May 2006 20:48:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I just realized that rather than marshaling all of the data <strong>to</strong> <code>ActiveRecord</code> objects, I could just read everything into a <code>DataSet</code>, and then marshal only the fields that you&#8217;re reading across the interop boundary. In this way an array of <code>ActiveRecord</code> object acts as a facade over a <a href="http://msdn2.microsoft.com/en-us/library/system.data.datatable.aspx">DataTable</a>.</p>


	<p>This could conceivably be used as a general technique for <code>ActiveRecord</code> communicating with other databases as well &#8211; the result set is stored in a C data structure to avoid the hit of creating an array of hashtables first.</p>


	<p>I&#8217;ll have to hack out an implementation to see how effective this technique is.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/14/activerecord-as-a-facade-over-a-datatable#comments">no comments</a>,
      <a href="/articles/2006/05/14/activerecord-as-a-facade-over-a-datatable" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/135/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/135/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/14/activerecord-as-a-facade-over-a-datatable">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/14/activerecord-as-a-facade-over-a-datatable;title=ActiveRecord as a facade over a DataTable?">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-134">
  <h2 class="title">
    <a href="/articles/2006/05/12/safari-vs-firefox">Safari vs. Firefox</a> 
    <span class="comment_count">11</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-12T10:21:00-07:00"><span class="typo_date" title="Fri, 12 May 2006 17:21:00 GMT">Fri, 12 May 2006 17:21:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I find that I&#8217;m using Safari more and more on my <span class="caps">MBP</span>. The main reason? It&#8217;s much less of a <span class="caps">CPU</span> + memory hog than Firefox is. I often find my computer running really hot, and it&#8217;s almost <strong>always</strong> due to Firefox chewing up <span class="caps">CPU</span> cycles.</p>


	<p>Do other folks see this?</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/personal" rel="tag">Life</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/12/safari-vs-firefox#comments">11 comments</a>,
      <a href="/articles/2006/05/12/safari-vs-firefox" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/134/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/134/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/12/safari-vs-firefox">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/12/safari-vs-firefox;title=Safari vs. Firefox">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-133">
  <h2 class="title">
    <a href="/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed">ActiveRecord and RubyCLR: with new and improved speed!</a> 
    
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-11T23:40:00-07:00"><span class="typo_date" title="Fri, 12 May 2006 06:40:00 GMT">Fri, 12 May 2006 06:40:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I just rewrote the guts of the <a href="http://www.iunknown.com/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster"><span class="caps">ADO</span>.NET to Ruby array of hashes</a> code in C++/CLI for fun. It now runs 6.5X faster than the original <span class="caps">ADO</span> / <code>ActiveRecord</code> implementation and just 3X slower than reading the same data into a <code>DataSet</code>.</p>


	<p>I think this narrows the performance gap to the point where it&#8217;s very usable.
Now I just have to figure out the <span class="caps">DBI</span> interfaces, and rewrite the guts of the <span class="caps">SQL</span> Server driver in C++/CLI.</p>


	<p>However, I&#8217;m not sure I&#8217;ll get a chance to write that code until after I ship the next drop of RubyCLR.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed#comments">no comments</a>,
      <a href="/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/133/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/133/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed;title=ActiveRecord and RubyCLR: with new and improved speed!">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-132">
  <h2 class="title">
    <a href="/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster">RubyCLR can make ActiveRecord much, much faster</a> 
    <span class="comment_count">5</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-11T20:35:00-07:00"><span class="typo_date" title="Fri, 12 May 2006 03:35:00 GMT">Fri, 12 May 2006 03:35:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I spent some time writing some <a href="http://rubyforge.org/projects/activerecord/">ActiveRecord</a> code yesterday that used the <code>Person.Contact</code> table from the <a href="http://msdn2.microsoft.com/en-us/library//ms124438.aspx">AdventureWorks</a> sample database. This is a rather large table (~20,000 rows), so I decided to see how quickly <code>ActiveRecord</code> could load that table.</p>


	<p>I was disappointed &#8211; it took nearly 11s on my MacBookPro to read 20,000 records from <span class="caps">SQL</span> Server. If I read the same number of records into a <a href="http://msdn2.microsoft.com/en-us/library/bwy42y0e(VS.80).aspx">DataSet</a>, it takes about 0.5s.</p>


	<p>I was wondering if RubyCLR could improve on the performance of the <span class="caps">SQL</span> Server database adapter which relies on <span class="caps">ADO</span> to do the data access. After all, I should be faster at marshaling data than the <a href="http://homepage1.nifty.com/markey/ruby/win32ole/index_e.html">win32ole</a> library.</p>


	<p>I wrote this bit of test code just now. It runs 2.5X faster than the <code>ActiveRecord</code> code. It&#8217;s not exactly a fair comparison since I&#8217;m not creating <code>ActiveRecord</code> objects. I&#8217;ll see what I can do later to rewrite the <span class="caps">SQL</span> Server adapter for <code>ActiveRecord</code> to use RubyCLR + <span class="caps">ADO</span>.NET.</p>


<pre><code>
auto_dispose(SqlConnection.new(CS)) do |conn|
  conn.open
  command = SqlCommand.new('select * from Person.Contact', conn)
  reader = command.execute_reader

  column_names = []
  0.upto(reader.field_count - 1) do |index|
    column_names &lt;&lt; reader.get_name(index)
  end

  records = []  
  while reader.read
    attributes = {}
    0.upto(reader.field_count - 1) do |index|
      attributes[column_names[index]] = reader.get_value(index)
    end
    records &lt;&lt; attributes
  end
  puts records.length
end
</code></pre>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster#comments">5 comments</a>,
      <a href="/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/132/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/132/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster;title=RubyCLR can make ActiveRecord much, much faster">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-131">
  <h2 class="title">
    <a href="/articles/2006/05/10/internal-dsls">Internal DSLs</a> 
    <span class="comment_count">2</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-10T00:53:00-07:00"><span class="typo_date" title="Wed, 10 May 2006 07:53:00 GMT">Wed, 10 May 2006 07:53:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I&#8217;ve been bothered for a while with the overuse of the term &#8220;Domain Specific Languages&#8221;. While I really like the stuff that I do via metaprogramming in Ruby, what I do isn&#8217;t a true domain specific language.</p>


	<p>Just now, I see that Martin Fowler had coined the term <a href="http://martinfowler.com/articles/languageWorkbench.html#InternalDsl">Internal <span class="caps">DSL</span></a> to describe what I tend to do. I like it more than DSLs since it makes it clear that the <span class="caps">DSL</span> is embedded within the host language. It&#8217;s well worth reading the entire article if you&#8217;re interested in this area.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/10/internal-dsls#comments">2 comments</a>,
      <a href="/articles/2006/05/10/internal-dsls" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/131/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/131/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/10/internal-dsls">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/10/internal-dsls;title=Internal DSLs">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-130">
  <h2 class="title">
    <a href="/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer">Do you have a spare 20 minutes to become a better programmer?</a> 
    <span class="comment_count">3</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-09T23:54:00-07:00"><span class="typo_date" title="Wed, 10 May 2006 06:54:00 GMT">Wed, 10 May 2006 06:54:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>If you, then you should head on over and <a href="http://defmacro.org/ramblings/lisp.html">read this article on how to become a better programmer.</a></p>


	<p>Seriously. This is by far the most approachable article that I&#8217;ve read to motivate <strong>why</strong> Lisp is still the gold standard of language design. It does so in a very non-threatening way by way of <span class="caps">XML</span> and <a href="http://ant.apache.org/">Ant</a>, as well as the C preprocessor and <a href="http://www.codegeneration.net">code generation</a>. He even mentions data access layers, C# and <span class="caps">LINQ</span> to prove that he&#8217;s not living in a shack in the wilds of Montana.</p>


	<p>Perhaps the most insightful part of this article is the realization of <em>why</em> XML enabled Ant to become so popular. <span class="caps">XML</span> is enormously flexible (at the cost of being enormously verbose), and it permitted the injection of new <em>semantics</em> into the build language, that would not be as approachable using Java alone.</p>


	<p>Once you&#8217;ve read (and understood) this article, you&#8217;ll be well on your way to understanding why metaprogramming and domain specific languages are so powerful. This will make you a far better programmer even if you use a relatively pedestrian language like Ruby :)</p>


	<p>If you want to read more about Lisp, you can begin by <a href="http://www.gigamonkeys.com/book/">reading this wonderful online book.</a></p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/links" rel="tag">Props</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer#comments">2 comments</a>,
      <a href="/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/130/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/130/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer;title=Do you have a spare 20 minutes to become a better programmer?">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-129">
  <h2 class="title">
    <a href="/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms">I'm not smart enough to figure out data binding in Windows Forms</a> 
    <span class="comment_count">4</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-09T16:43:00-07:00"><span class="typo_date" title="Tue, 09 May 2006 23:43:00 GMT">Tue, 09 May 2006 23:43:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I interrupt the regularly scheduled Ruby lovefest on this blog to rant a little bit.</p>


	<p>I&#8217;ve been spending a lot of time getting data binding against <code>ActiveRecord</code> to work. Is it just me, or are these the most over-engineered, non-intuitive set of interfaces ever designed?</p>


	<p>For example, why is it that the <code>ICancelAddNew.CancelNew</code> method gets called when I abandon <strong>editing</strong> a field in a <code>DataGridView</code>?</p>


	<p>There are a lot of other nasty gotchas like this waiting to pounce on the poor souls who are trying to write custom business entity objects, yet want the users of those business entity objects to experience the goodness of data binding.</p>


	<p>Now back to our regularly scheduled Ruby lovefest &#8230; :)</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms#comments">4 comments</a>,
      <a href="/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/129/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/129/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms;title=I'm not smart enough to figure out data binding in Windows Forms">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-128">
  <h2 class="title">
    <a href="/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr">Hi-fidelity two-way binding in RubyCLR</a> 
    
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-08T21:56:00-07:00"><span class="typo_date" title="Tue, 09 May 2006 04:56:00 GMT">Tue, 09 May 2006 04:56:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>It feels like I&#8217;ve just implemented another RubyCLR this weekend. And in a way, I did. In earlier versions of RubyCLR, binding was one way &#8211; Ruby objects would hold onto references to <span class="caps">CLR</span> objects. <span class="caps">CLR</span> objects could interact with Ruby objects only via delegates that call Ruby blocks.</p>


	<p>Now binding is two-way.</p>


	<p>Ruby objects can be marshaled to the <span class="caps">CLR</span>, and the <span class="caps">CLR</span> can directly invoke methods on those objects. Furthermore, Ruby objects can fire events via delegates in <span class="caps">CLR</span> code. This means that I can now do data binding notifications.</p>


	<p>Here&#8217;s a simple example:</p>


	<p>I use <code>ActiveRecord</code> to read the first record from the <code>People</code> table:</p>


<code>@john = Person.find_first</code>

	<p>Next I create a <a href="http://msdn2.microsoft.com/en-US/library/system.windows.forms.bindingsource.aspx">BindingSource</a> to act as a broker between <code>ActiveRecord</code> and the data-aware controls in Windows Forms:</p>


<code>binding_source = @john.as_binding_source</code>

	<p>The calls to <code>create_textbox</code> simply bind the <code>Text</code> property of <code>TextBox</code> controls to <code>ActiveRecord</code> fields:</p>


<pre><code>
create_textbox(form, 30, 10, binding_source, 'name')
create_textbox(form, 60, 10, binding_source, 'age')    
create_textbox(form, 60, 120, binding_source, 'age')
</code></pre>

	<p>Finally, I have a <code>Button</code> that triggers a Ruby block that increments the <code>age</code> property of the <code>ActiveRecord</code>:</p>


<pre><code>
change_button.click do |sender, args|
  # Notice that I'm changing the ActiveRecord object here!
  @john.age += 1
end
</code></pre>

	<p><a href="http://rubyforge.org/plugins/scmsvn/viewcvs.php/trunk/Samples/DataBinding/bind_textboxes.rb?root=rubyclr&#38;view=markup">Click here</a> to see the entire sample.</p>


	<p>Behind the scenes, there is property change notification happening. <code>ActiveRecord</code> objects in RubyCLR also implement the new <a href="http://msdn2.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged.aspx">INotifyPropertyChanged</a>. interface. This interface fires an event whenever a property in the <code>ActiveRecord</code> object has changed.</p>


	<p>Once I got the two-way plumbing working, implementing <code>INotifyPropertyChanged</code> was ridiculously easy:</p>


<pre><code>
implements INotifyPropertyChanged

alias activerecord_method_missing method_missing

def method_missing(symbol, *params)
  symbol_name   = symbol.to_s
  equals_offset = symbol_name =~ /=$/

  return activerecord_method_missing(symbol, *params) unless equals_offset

  attribute_name = symbol_name[0..equals_offset - 1]

  if !self.attributes.include?(attribute_name) or params.length != 1
    return activerecord_method_missing(symbol, *params) 
  end

  write_attribute(attribute_name, params.first)
  if defined?(@clr_shadow_object)
    if @clr_shadow_object.property_changed != nil
      @clr_shadow_object.property_changed.invoke(@clr_shadow_object,
        PropertyChangedEventArgs.new(attribute_name))
    end
  end
end
</code></pre>

	<p>If you squint just a little bit, you&#8217;ll see that this code looks for a call to methods with the signature <code>zzz=</code> where <code>zzz</code> is a member of the <code>attributes</code> collection of the <code>ActiveRecord</code> object. I override the default <code>ActiveRecord</code> implementation (which is also accomplished via <code>method_missing</code>) of those methods to set the property <strong>and</strong> fire the <code>PropertyChanged</code> event.</p>


	<p>So this means that changes to <code>ActiveRecord</code> objects <em>done in Ruby</em> cause things to happen transparently in the <span class="caps">CLR</span>. And with very few lines of meta-programming code required to make it happen.</p>


	<p>The sound you hear right now is that of thousands of code generation folks slapping their foreheads in unison. Believe me, if you were coding up business entity objects in C#, you&#8217;d be reaching for <a href="http://www.codesmithtools.com/">CodeSmith</a> right about now.</p>


	<p>But with Ruby you don&#8217;t have to. And that&#8217;s a good thing.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr#comments">no comments</a>,
      <a href="/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/128/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/128/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr;title=Hi-fidelity two-way binding in RubyCLR">reddit</a>
    </li>
  </ul>
</div>


<p class="pagination">Older posts: <a href="/articles/2006/05/page/1">1</a> <a href="/articles/2006/05/page/2">2</a> 3 <a href="/articles/2006/05/page/4">4</a> </p>

      <script type="text/javascript">
//<![CDATA[
show_dates_as_local_time()
//]]>
</script>
    </div>

    <div id="sidebar">
      <!-- search -->
      <div id="search" class="search">
	<form action="/articles/search" id="sform" method="get">
	  <p><input type="text" id="q" name="q" value="" /></p>
	</form>
	
	<div id="loading" class="loading" style="display:none;">Searching...</div>
	<div id="results" class="results"></div>
  <script type="text/javascript">
//<![CDATA[
new Form.Element.Observer('q', 1, function(element, value) {new Ajax.Updater('results', '/live/search', {asynchronous:true, evalScripts:true, onComplete:function(request){Element.hide('loading')}, onLoading:function(request){Element.show('loading')}, parameters:'q=' + escape($F('q'))})})
//]]>
</script>
</div>


      <!-- sidebar components -->
      
      
<div class="sidebar-node">
  <h3>John Lam</h3>
<a href="/pages/about_me"><img src="http://static.flickr.com/90/222479189_d4e19a202c_t.jpg" width="67" height="100" alt="Self portrait" /></a>

<p>I am a software developer living in Toronto, Canada. I write .NET and Ruby code on a Mac. I'm the creator of <a href="http://www.rubyclr.com">RubyCLR</a>, a high performance bridge between Ruby and .NET. I'm a Partner at <a href="http://www.objectsharp.com"><b>Object</b>Sharp</a>, and am available to help you with your Ruby or .NET projects. <a href="/pages/about_me">More ...</a>

<table>
<tr>
  <td>email:</td>
  <td>jlam@iunknown.com</td>
</tr>
<tr>
  <td>phone:</td>
  <td>647 836 3718</td>
</tr>
<tr>
  <td>msn:</td>
  <td>drjflam@hotmail.com</td>
</tr>
<tr>
  <td>gtalk:</td>
  <td>drjflam@gmail.com</td>
</tr>
</table>
<br>
<h3>Syndicate</h3>

<p><a href="http://feeds.feedburner.com/LessIsBetter"><img src="/images/rss.png"/></a>&nbsp;
<a href="http://feeds.feedburner.com/LessIsBetter"><img src="http://feeds.feedburner.com/~fc/LessIsBetter?bg=FF9900&amp;fg=000000&amp;anim=0" height="26" width="88" style="border:0" alt="" /></a>
<br>
<form style="padding:3px;text-align:left;" action="http://www.feedburner.com/fb/a/emailverify" method="post" target="popupwindow" onsubmit="window.open('http://www.feedburner.com', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true"><p>Subscribe by email:</p><p><input type="text" style="width:140px" name="email"/></p><input type="hidden" value="http://feeds.feedburner.com/~e?ffid=180551" name="url"/><input type="hidden" value="Less is better" name="title"/><input type="submit" value="Subscribe" /><p>Delivered by <a href="http://www.feedburner.com/" target="_blank">FeedBurner</a></p></form>

</div>


      
<div class="sidebar-node">
    <div id="delicious">
    <h3><a href="http://del.icio.us/drjflam">del.icio.us/drjflam</a></h3>
            <ul>
      
      <li>
        <a href="http://www.people.iup.edu/pnwm/comparison.gif" title="Fun comparison of fictional starships from different SF shows.">Starship size comparison chart</a>
              </li>
      
      <li>
        <a href="http://www.teach12.com/" title="Bill Gates listens to the lectures from this company - available as downloads as well.">The Teaching Company</a>
              </li>
      
      <li>
        <a href="http://www.speedtest.net/" title="Found this via StumbleUpon">Speedtest.net - The Global Broadband Speed Test</a>
              </li>
      
      <li>
        <a href="http://wvs.topleftpixel.com/flash/cntower_timelapse.swf" title="Move your mouse around this picture and see it change.">Downtown Toronto Photo</a>
              </li>
      
      <li>
        <a href="ftp://gatekeeper.dec.com/pub/DEC/WRL/research-reports/WRL-TR-95.7.pdf" title="">Shared Memory Consistency Models</a>
              </li>
      
      <li>
        <a href="http://discuss.develop.com/archives/wa.exe?A2=ind0203B&amp;L=DOTNET&amp;P=R375" title="An excellent discussion on the motivation for and implementation of the CLR memory model.">Vance Morrison on CLR Memory Model</a>
              </li>
      
      <li>
        <a href="http://slideshare.net/" title="A YouTube like service for sharing slides from talks.">SlideShare</a>
              </li>
      
      <li>
        <a href="http://research.microsoft.com/manuvir/papers/instruction_level_tracing_VEE06.pdf" title="This is MSR's Nirvana framework for dynamically injecting tracing code into x86 binaries at runtime. It lets them travel forwards and backwards in execution flow ('time travel debugging').">Framework for Instruction-level Tracing and Analysis of Program Executions</a>
              </li>
      
      <li>
        <a href="http://www.macgeekery.com/hacks/software/video/how_to_view_tivo_recordings_on_your_mac_or_ipod" title="Looking forward to setting this up ...">How to View TiVo Recordings on Your Mac or iPod</a>
              </li>
      
      <li>
        <a href="http://uneasysilence.com/archive/2006/12/8602/" title="Wow - this is really nice seamless integration - Windows apps appearing to run as 'top-level' windows on Mac OS X desktop.">Parallels running IE7 &amp; Firefox on Mac OS X desktop!</a>
              </li>
      
      <li>
        <a href="http://www.ldc.upenn.edu/Catalog/CatalogEntry.jsp?catalogId=LDC2006T13" title="Google recently released their collection of 1-grams (single word frequency) to 5-grams (5 word frequency) as a 24GB compressed gzip'd file.">Google's collection of 1-5 grams</a>
              </li>
          </ul>
      </div>

</div>


      
<div class="sidebar-node">
  <h3>My Photos</h3>
<style type="text/css">
.zg_div {margin:0px 5px 5px 0px; width:117px;}
.zg_div_inner {background-color:#ffffff;  color:#666666; text-align:center; font-family:arial, helvetica; font-size:11px;}
.zg_div a, .zg_div a:hover, .zg_div a:visited {color:#3993ff; background:inherit !important; text-decoration:none !important;}
</style>
<script type="text/javascript">
zg_insert_badge = function() {
var zg_bg_color = 'ffffff';
var zgi_url = 'http://www.flickr.com/apps/badge/badge_iframe.gne?zg_bg_color='+zg_bg_color+'&zg_person_id=23649168%40N00';
document.write('<iframe style="background-color:#'+zg_bg_color+'; border-color:#'+zg_bg_color+'; border:none;" width="113" height="151" frameborder="0" scrolling="no" src="'+zgi_url+'" title="Flickr Badge"><\/iframe>');
if (document.getElementById) document.write('<div id="zg_whatlink"><a href="http://www.flickr.com/badge_new.gne"	style="color:#3993ff;" onclick="zg_toggleWhat(); return false;">what is this?<\/a><\/div>');
}
zg_toggleWhat = function() {
document.getElementById('zg_whatdiv').style.display = (document.getElementById('zg_whatdiv').style.display != 'none') ? 'none' : 'block';
document.getElementById('zg_whatlink').style.display = (document.getElementById('zg_whatdiv').style.display != 'none') ? 'none' : 'block';
return false;
}
</script>
<div class="zg_div"><div class="zg_div_inner"><a href="http://www.flickr.com">www.<strong style="color:#3993ff">flick<span style="color:#ff1c92">r</span></strong>.com</a><br>
<script type="text/javascript">zg_insert_badge();</script>
<div id="zg_whatdiv">This is a Flickr badge showing public photos from <a href="http://www.flickr.com/photos/23649168@N00">John Lam</a>. Make your own badge <a href="http://www.flickr.com/badge_new.gne">here</a>.</div>
<script type="text/javascript">if (document.getElementById) document.getElementById('zg_whatdiv').style.display = 'none';</script>
</div>
</div>

</div>


      
<div class="sidebar-node">
  
<h3>Archives</h3>
<ul id="archives">
  
    <li>
      <a href="/articles/2006/12">December 2006</a>
      <em>(2)</em>
    </li>
  
    <li>
      <a href="/articles/2006/11">November 2006</a>
      <em>(2)</em>
    </li>
  
    <li>
      <a href="/articles/2006/10">October 2006</a>
      <em>(8)</em>
    </li>
  
    <li>
      <a href="/articles/2006/9">September 2006</a>
      <em>(12)</em>
    </li>
  
    <li>
      <a href="/articles/2006/8">August 2006</a>
      <em>(39)</em>
    </li>
  
    <li>
      <a href="/articles/2006/7">July 2006</a>
      <em>(29)</em>
    </li>
  
    <li>
      <a href="/articles/2006/6">June 2006</a>
      <em>(23)</em>
    </li>
  
    <li>
      <a href="/articles/2006/5">May 2006</a>
      <em>(34)</em>
    </li>
  
    <li>
      <a href="/articles/2006/4">April 2006</a>
      <em>(13)</em>
    </li>
  
    <li>
      <a href="/articles/2006/3">March 2006</a>
      <em>(21)</em>
    </li>
  
    <li>
      <a href="/articles/2006/2">February 2006</a>
      <em>(25)</em>
    </li>
  
    <li>
      <a href="/articles/2006/1">January 2006</a>
      <em>(9)</em>
    </li>
  
    <li>
      <a href="/articles/2005/12">December 2005</a>
      <em>(22)</em>
    </li>
  
    <li>
      <a href="/articles/2005/11">November 2005</a>
      <em>(17)</em>
    </li>
  
    <li>
      <a href="/articles/2005/10">October 2005</a>
      <em>(6)</em>
    </li>
  
</ul>


</div>


      
<div class="sidebar-node">
  <h3>Tags</h3>
<p style="overflow:hidden">
<span style="font-size:66.6666666666667%"><a href="/articles/tag/barcampearthtoronto">BarCampEarthToronto</a></span>
<span style="font-size:135.135135135135%"><a href="/articles/tag/dynamiclanguages">DynamicLanguages</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/ironpython">IronPython</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/life">Life</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/mac">Mac</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/marketing">Marketing</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/microsoft">Microsoft</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/parenting">Parenting</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/photography">Photography</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/platforms">Platforms</a></span>
<span style="font-size:200%"><a href="/articles/tag/props">Props</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/python">Python</a></span>
<span style="font-size:200%"><a href="/articles/tag/ruby">Ruby</a></span>
<span style="font-size:200%"><a href="/articles/tag/rubyclr">RubyCLR</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/rubyconf">RubyConf</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/secondlife">SecondLife</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/simplicity">simplicity</a></span>
<span style="font-size:200%"><a href="/articles/tag/thoughts">Thoughts</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/vim">Vim</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/workspaces">workspaces</a></span>
</p>


</div>


      
<div class="sidebar-node">
  <h3>Categories</h3>
<ul id="categories">
  
  <li><a href="/articles/category/personal">Life</a> <em>(18)</em></li>
  
  
  <li><a href="/articles/category/links">Props</a> <em>(58)</em></li>
  
  
  <li><a href="/articles/category/thoughts">Thoughts</a> <em>(148)</em></li>
  
</ul>


</div>


  


    </div>
    <br style="clear:both;" />
  </div>

  <div id="footer">
    <hr />
    <p><a href="/">Less is better</a></p>
    <ul>
      <li>powered by <a href="http://typosphere.org">typo</a> /
          styled with <a href="http://quotedprintable.com/pages/scribbish">scribbish</a></li>
    </ul>
  </div>
</div>
</body>
</html>
