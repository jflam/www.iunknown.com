<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Less is better</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  
  <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.iunknown.com/xml/rsd" />
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/LessIsBetter" />
  <script src="/javascripts/cookies.js?1156231406" type="text/javascript"></script>
  <script src="/javascripts/prototype.js?1156231406" type="text/javascript"></script>
  <script src="/javascripts/effects.js?1156231406" type="text/javascript"></script>
  <script src="/javascripts/typo.js?1156231406" type="text/javascript"></script>
  
  <script type="text/javascript"></script>
  <link href="/stylesheets/theme/application.css?1164503575" media="all" rel="Stylesheet" type="text/css" />
  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
  <script type="text/javascript">
    _uacct="UA-133590-1";
    urchinTracker();
  </script>
</head>

<body>
<div id="container">
  <div id="header">
    <h1><span><a href="/">Less is better</a></span></h1>
    <h2>John Lam on software</h2>
  </div>

  <div id="page">
    <div id="content">
      <div class="atomentry" id="article-133">
  <h2 class="title">
    <a href="/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed">ActiveRecord and RubyCLR: with new and improved speed!</a> 
    
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-11T23:40:00-07:00"><span class="typo_date" title="Fri, 12 May 2006 06:40:00 GMT">Fri, 12 May 2006 06:40:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I just rewrote the guts of the <a href="http://www.iunknown.com/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster"><span class="caps">ADO</span>.NET to Ruby array of hashes</a> code in C++/CLI for fun. It now runs 6.5X faster than the original <span class="caps">ADO</span> / <code>ActiveRecord</code> implementation and just 3X slower than reading the same data into a <code>DataSet</code>.</p>


	<p>I think this narrows the performance gap to the point where it&#8217;s very usable.
Now I just have to figure out the <span class="caps">DBI</span> interfaces, and rewrite the guts of the <span class="caps">SQL</span> Server driver in C++/CLI.</p>


	<p>However, I&#8217;m not sure I&#8217;ll get a chance to write that code until after I ship the next drop of RubyCLR.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed#comments">no comments</a>,
      <a href="/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/133/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/133/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/11/activerecord-and-rubyclr-with-new-and-improved-speed;title=ActiveRecord and RubyCLR: with new and improved speed!">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-132">
  <h2 class="title">
    <a href="/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster">RubyCLR can make ActiveRecord much, much faster</a> 
    <span class="comment_count">5</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-11T20:35:00-07:00"><span class="typo_date" title="Fri, 12 May 2006 03:35:00 GMT">Fri, 12 May 2006 03:35:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I spent some time writing some <a href="http://rubyforge.org/projects/activerecord/">ActiveRecord</a> code yesterday that used the <code>Person.Contact</code> table from the <a href="http://msdn2.microsoft.com/en-us/library//ms124438.aspx">AdventureWorks</a> sample database. This is a rather large table (~20,000 rows), so I decided to see how quickly <code>ActiveRecord</code> could load that table.</p>


	<p>I was disappointed &#8211; it took nearly 11s on my MacBookPro to read 20,000 records from <span class="caps">SQL</span> Server. If I read the same number of records into a <a href="http://msdn2.microsoft.com/en-us/library/bwy42y0e(VS.80).aspx">DataSet</a>, it takes about 0.5s.</p>


	<p>I was wondering if RubyCLR could improve on the performance of the <span class="caps">SQL</span> Server database adapter which relies on <span class="caps">ADO</span> to do the data access. After all, I should be faster at marshaling data than the <a href="http://homepage1.nifty.com/markey/ruby/win32ole/index_e.html">win32ole</a> library.</p>


	<p>I wrote this bit of test code just now. It runs 2.5X faster than the <code>ActiveRecord</code> code. It&#8217;s not exactly a fair comparison since I&#8217;m not creating <code>ActiveRecord</code> objects. I&#8217;ll see what I can do later to rewrite the <span class="caps">SQL</span> Server adapter for <code>ActiveRecord</code> to use RubyCLR + <span class="caps">ADO</span>.NET.</p>


<pre><code>
auto_dispose(SqlConnection.new(CS)) do |conn|
  conn.open
  command = SqlCommand.new('select * from Person.Contact', conn)
  reader = command.execute_reader

  column_names = []
  0.upto(reader.field_count - 1) do |index|
    column_names &lt;&lt; reader.get_name(index)
  end

  records = []  
  while reader.read
    attributes = {}
    0.upto(reader.field_count - 1) do |index|
      attributes[column_names[index]] = reader.get_value(index)
    end
    records &lt;&lt; attributes
  end
  puts records.length
end
</code></pre>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster#comments">5 comments</a>,
      <a href="/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/132/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/132/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/11/rubyclr-can-make-activerecord-much-much-faster;title=RubyCLR can make ActiveRecord much, much faster">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-131">
  <h2 class="title">
    <a href="/articles/2006/05/10/internal-dsls">Internal DSLs</a> 
    <span class="comment_count">2</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-10T00:53:00-07:00"><span class="typo_date" title="Wed, 10 May 2006 07:53:00 GMT">Wed, 10 May 2006 07:53:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I&#8217;ve been bothered for a while with the overuse of the term &#8220;Domain Specific Languages&#8221;. While I really like the stuff that I do via metaprogramming in Ruby, what I do isn&#8217;t a true domain specific language.</p>


	<p>Just now, I see that Martin Fowler had coined the term <a href="http://martinfowler.com/articles/languageWorkbench.html#InternalDsl">Internal <span class="caps">DSL</span></a> to describe what I tend to do. I like it more than DSLs since it makes it clear that the <span class="caps">DSL</span> is embedded within the host language. It&#8217;s well worth reading the entire article if you&#8217;re interested in this area.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/10/internal-dsls#comments">2 comments</a>,
      <a href="/articles/2006/05/10/internal-dsls" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/131/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/131/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/10/internal-dsls">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/10/internal-dsls;title=Internal DSLs">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-130">
  <h2 class="title">
    <a href="/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer">Do you have a spare 20 minutes to become a better programmer?</a> 
    <span class="comment_count">2</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-09T23:54:00-07:00"><span class="typo_date" title="Wed, 10 May 2006 06:54:00 GMT">Wed, 10 May 2006 06:54:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>If you, then you should head on over and <a href="http://defmacro.org/ramblings/lisp.html">read this article on how to become a better programmer.</a></p>


	<p>Seriously. This is by far the most approachable article that I&#8217;ve read to motivate <strong>why</strong> Lisp is still the gold standard of language design. It does so in a very non-threatening way by way of <span class="caps">XML</span> and <a href="http://ant.apache.org/">Ant</a>, as well as the C preprocessor and <a href="http://www.codegeneration.net">code generation</a>. He even mentions data access layers, C# and <span class="caps">LINQ</span> to prove that he&#8217;s not living in a shack in the wilds of Montana.</p>


	<p>Perhaps the most insightful part of this article is the realization of <em>why</em> XML enabled Ant to become so popular. <span class="caps">XML</span> is enormously flexible (at the cost of being enormously verbose), and it permitted the injection of new <em>semantics</em> into the build language, that would not be as approachable using Java alone.</p>


	<p>Once you&#8217;ve read (and understood) this article, you&#8217;ll be well on your way to understanding why metaprogramming and domain specific languages are so powerful. This will make you a far better programmer even if you use a relatively pedestrian language like Ruby :)</p>


	<p>If you want to read more about Lisp, you can begin by <a href="http://www.gigamonkeys.com/book/">reading this wonderful online book.</a></p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/links" rel="tag">Props</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer#comments">2 comments</a>,
      <a href="/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/130/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/130/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/09/do-you-have-a-spare-20-minutes-to-become-a-better-programmer;title=Do you have a spare 20 minutes to become a better programmer?">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-129">
  <h2 class="title">
    <a href="/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms">I'm not smart enough to figure out data binding in Windows Forms</a> 
    <span class="comment_count">4</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-09T16:43:00-07:00"><span class="typo_date" title="Tue, 09 May 2006 23:43:00 GMT">Tue, 09 May 2006 23:43:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I interrupt the regularly scheduled Ruby lovefest on this blog to rant a little bit.</p>


	<p>I&#8217;ve been spending a lot of time getting data binding against <code>ActiveRecord</code> to work. Is it just me, or are these the most over-engineered, non-intuitive set of interfaces ever designed?</p>


	<p>For example, why is it that the <code>ICancelAddNew.CancelNew</code> method gets called when I abandon <strong>editing</strong> a field in a <code>DataGridView</code>?</p>


	<p>There are a lot of other nasty gotchas like this waiting to pounce on the poor souls who are trying to write custom business entity objects, yet want the users of those business entity objects to experience the goodness of data binding.</p>


	<p>Now back to our regularly scheduled Ruby lovefest &#8230; :)</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms#comments">4 comments</a>,
      <a href="/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/129/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/129/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/09/im-not-smart-enough-to-figure-out-data-binding-in-windows-forms;title=I'm not smart enough to figure out data binding in Windows Forms">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-128">
  <h2 class="title">
    <a href="/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr">Hi-fidelity two-way binding in RubyCLR</a> 
    
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-08T21:56:00-07:00"><span class="typo_date" title="Tue, 09 May 2006 04:56:00 GMT">Tue, 09 May 2006 04:56:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>It feels like I&#8217;ve just implemented another RubyCLR this weekend. And in a way, I did. In earlier versions of RubyCLR, binding was one way &#8211; Ruby objects would hold onto references to <span class="caps">CLR</span> objects. <span class="caps">CLR</span> objects could interact with Ruby objects only via delegates that call Ruby blocks.</p>


	<p>Now binding is two-way.</p>


	<p>Ruby objects can be marshaled to the <span class="caps">CLR</span>, and the <span class="caps">CLR</span> can directly invoke methods on those objects. Furthermore, Ruby objects can fire events via delegates in <span class="caps">CLR</span> code. This means that I can now do data binding notifications.</p>


	<p>Here&#8217;s a simple example:</p>


	<p>I use <code>ActiveRecord</code> to read the first record from the <code>People</code> table:</p>


<code>@john = Person.find_first</code>

	<p>Next I create a <a href="http://msdn2.microsoft.com/en-US/library/system.windows.forms.bindingsource.aspx">BindingSource</a> to act as a broker between <code>ActiveRecord</code> and the data-aware controls in Windows Forms:</p>


<code>binding_source = @john.as_binding_source</code>

	<p>The calls to <code>create_textbox</code> simply bind the <code>Text</code> property of <code>TextBox</code> controls to <code>ActiveRecord</code> fields:</p>


<pre><code>
create_textbox(form, 30, 10, binding_source, 'name')
create_textbox(form, 60, 10, binding_source, 'age')    
create_textbox(form, 60, 120, binding_source, 'age')
</code></pre>

	<p>Finally, I have a <code>Button</code> that triggers a Ruby block that increments the <code>age</code> property of the <code>ActiveRecord</code>:</p>


<pre><code>
change_button.click do |sender, args|
  # Notice that I'm changing the ActiveRecord object here!
  @john.age += 1
end
</code></pre>

	<p><a href="http://rubyforge.org/plugins/scmsvn/viewcvs.php/trunk/Samples/DataBinding/bind_textboxes.rb?root=rubyclr&#38;view=markup">Click here</a> to see the entire sample.</p>


	<p>Behind the scenes, there is property change notification happening. <code>ActiveRecord</code> objects in RubyCLR also implement the new <a href="http://msdn2.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged.aspx">INotifyPropertyChanged</a>. interface. This interface fires an event whenever a property in the <code>ActiveRecord</code> object has changed.</p>


	<p>Once I got the two-way plumbing working, implementing <code>INotifyPropertyChanged</code> was ridiculously easy:</p>


<pre><code>
implements INotifyPropertyChanged

alias activerecord_method_missing method_missing

def method_missing(symbol, *params)
  symbol_name   = symbol.to_s
  equals_offset = symbol_name =~ /=$/

  return activerecord_method_missing(symbol, *params) unless equals_offset

  attribute_name = symbol_name[0..equals_offset - 1]

  if !self.attributes.include?(attribute_name) or params.length != 1
    return activerecord_method_missing(symbol, *params) 
  end

  write_attribute(attribute_name, params.first)
  if defined?(@clr_shadow_object)
    if @clr_shadow_object.property_changed != nil
      @clr_shadow_object.property_changed.invoke(@clr_shadow_object,
        PropertyChangedEventArgs.new(attribute_name))
    end
  end
end
</code></pre>

	<p>If you squint just a little bit, you&#8217;ll see that this code looks for a call to methods with the signature <code>zzz=</code> where <code>zzz</code> is a member of the <code>attributes</code> collection of the <code>ActiveRecord</code> object. I override the default <code>ActiveRecord</code> implementation (which is also accomplished via <code>method_missing</code>) of those methods to set the property <strong>and</strong> fire the <code>PropertyChanged</code> event.</p>


	<p>So this means that changes to <code>ActiveRecord</code> objects <em>done in Ruby</em> cause things to happen transparently in the <span class="caps">CLR</span>. And with very few lines of meta-programming code required to make it happen.</p>


	<p>The sound you hear right now is that of thousands of code generation folks slapping their foreheads in unison. Believe me, if you were coding up business entity objects in C#, you&#8217;d be reaching for <a href="http://www.codesmithtools.com/">CodeSmith</a> right about now.</p>


	<p>But with Ruby you don&#8217;t have to. And that&#8217;s a good thing.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr#comments">no comments</a>,
      <a href="/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/128/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/128/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/08/hi-fidelity-two-way-binding-in-rubyclr;title=Hi-fidelity two-way binding in RubyCLR">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-127">
  <h2 class="title">
    <a href="/articles/2006/05/04/activerecord-databinding-is-now-two-way">ActiveRecord databinding is now two-way</a> 
    <span class="comment_count">4</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-04T23:32:00-07:00"><span class="typo_date" title="Fri, 05 May 2006 06:32:00 GMT">Fri, 05 May 2006 06:32:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>I removed the hard-coded dependency on <code>ActiveRecord</code> from my marshaling code. I&#8217;m now using this marker module to flag that an object supports data binding:</p>


<pre><code>
module RubyClr
  module Bindable
    def get_binding_context
      raise NotImplementedError("...")
    end
  end
end
</code></pre>

	<p>To make a class data bindable you just have to mix in this module and implement <code>get_binding_context</code>. Here&#8217;s how I patch <code>ActiveRecord</code>:</p>


<pre><code>
class ActiveRecord::Base
  include RubyClr::Bindable

  def get_binding_context
    @attributes
  end
end
</code></pre>

	<p>I also massively refactored the <span class="caps">CLR</span> shadow class generation code in RubyCLR to support two-way data binding. I also checked some unit tests to verify this behavior into the trunk.</p>


	<p>Next up is implementing the data binding notification interfaces required to get a real editing experience in data bound controls.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/04/activerecord-databinding-is-now-two-way#comments">4 comments</a>,
      <a href="/articles/2006/05/04/activerecord-databinding-is-now-two-way" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/127/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/127/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/04/activerecord-databinding-is-now-two-way">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/04/activerecord-databinding-is-now-two-way;title=ActiveRecord databinding is now two-way">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-124">
  <h2 class="title">
    <a href="/articles/2006/05/03/activerecord-and-windows-forms">ActiveRecord and Windows Forms</a> 
    <span class="comment_count">14</span>
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-03T20:26:00-07:00"><span class="typo_date" title="Thu, 04 May 2006 03:26:00 GMT">Thu, 04 May 2006 03:26:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>This is a really exciting development in RubyCLR. I&#8217;ve taken the first steps in integrating Rails&#8217; most excellent <a href="http://rubyforge.org/projects/activerecord">ActiveRecord</a> object-relational mapping layer with Windows Forms data binding.</p>


	<p>Here&#8217;s a screenshot of the result:</p>


	<p><img src="http://static.flickr.com/55/140020351_6a1828085b_o.png" alt="" /></p>


	<p>And here&#8217;s the code:</p>


<pre><code>
require 'winforms'

include ActiveRecord

Base.establish_connection(:adapter =&gt; 'sqlserver',
                          :host =&gt; '.\SQLEXPRESS',
                          :database =&gt; 'rubyclr_tests')

class Person &lt; Base
end

class MainForm
  def initialize
    form      = Form.new
    form.Text = 'ActiveRecord and Windows Forms'

    grid             = DataGridView.new
    grid.dock        = DockStyle::Fill
    grid.data_source = Person.find_all
    form.controls.add(grid)

    @form = form
  end
end

WinFormsApp.run(MainForm)
</code></pre>

	<p>There&#8217;s a lot of heavy lifting going on behind the scenes. The call to <code>Person.find_all</code> returns a Ruby Array object which I marshal to the <span class="caps">CLR</span>. However, my Ruby Array object isn&#8217;t any ordinary Ruby Array object. RubyCLR can <a href="http://www.iunknown.com/articles/2006/04/18/rubyclr-now-lets-you-implement-clr-interfaces-in-ruby">implement <span class="caps">CLR</span> interfaces in Ruby</a>, so my Array object also happens to implement <code>IBindingList</code>.</p>


	<p>The Array contains <code>Person</code> objects, which all derive from <code>ActiveRecord::Base</code>. RubyCLR knows how to marshal <code>ActiveRecord::Base</code> objects so that I transparently create a <span class="caps">CLR</span> &#8216;anonymous&#8217; type that exposes all of the Ruby ActiveRecord fields as <span class="caps">CLR</span> properties. I marshal by reference, so that changes in the <code>ActiveRecord</code> object will be propagated via <code>IBindingList</code> notifications to the <code>DataGridView</code> control.</p>


	<p>This is an extremely important scenario to cover since a primary goal of RubyCLR is to enable the creation of rich client business applications. This is a major step towards enabling this scenario.</p>


	<p>I just checked in the code for this feature <a href="http://rubyforge.org/projects/rubyclr">into the rubyclr trunk</a>. So you can play with it if you want. Keep in mind that this is all prototype code, but at least this sample works and all of the existing unit tests still pass (182 tests, 365 assertions).</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/thoughts" rel="tag">Thoughts</a></li>
    
    <li>Meta 
      
      
      <a href="/articles/2006/05/03/activerecord-and-windows-forms" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/124/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/124/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/03/activerecord-and-windows-forms">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/03/activerecord-and-windows-forms;title=ActiveRecord and Windows Forms">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-123">
  <h2 class="title">
    <a href="/articles/2006/05/01/teeth-and-typing">Teeth and typing</a> 
    
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-01T21:51:00-07:00"><span class="typo_date" title="Tue, 02 May 2006 04:51:00 GMT">Tue, 02 May 2006 04:51:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>It looks like Ben&#8217;s about to get his first teeth. I forgot just how tough that is on them and us(!) His cradle cap (aka stinky head) is now gone and he can almost sit up on his own. He&#8217;s a really happy baby &#8211; lots of smiles these days.</p>


	<p>Fortunately Matthew&#8217;s got all of his teeth and is well past that stage of his life. He&#8217;s progressing remarkably fast. He&#8217;s just past 2 and a half years, and he can type his own name (he can spell quite a few words as well, but he hasn&#8217;t really exercised his knowledge of spelling on the computer).</p>


	<p>He can count to 20 in English, French, Cantonese and Spanish now. He can count over 100 in English, and it appears that he figured that out through the analysis of patterns (Cantonese is very pattern-oriented around numbers as well).</p>


	<p>He appears to have a rudimentary &#8216;knowledge&#8217; of phonics. He can do a really good job at guessing the pronounication of words that he&#8217;s never seen before. A favorite game of his is to say a word without the first letter like &#8216;atthew&#8217; or &#8216;addy&#8217;. Sometimes he says entire sentences like that &#8220;addy and atthew ent o the ark.&#8221;.</p>


	<p>I can&#8217;t wait until I can teach him his first Ruby program :)</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/personal" rel="tag">Life</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/01/teeth-and-typing#comments">no comments</a>,
      <a href="/articles/2006/05/01/teeth-and-typing" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/123/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/123/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/01/teeth-and-typing">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/01/teeth-and-typing;title=Teeth and typing">reddit</a>
    </li>
  </ul>
</div>
<div class="atomentry" id="article-122">
  <h2 class="title">
    <a href="/articles/2006/05/01/parallels-beta-6-with-new-and-improved-speed">Parallels Beta 6 with new and improved speed!</a> 
    
  </h2>

  <p class="author">
    Posted by <cite><a href="mailto:jlam@iunknown.com">John Lam</a></cite>
    <abbr class="published" title="2006-05-01T10:11:00-07:00"><span class="typo_date" title="Mon, 01 May 2006 17:11:00 GMT">Mon, 01 May 2006 17:11:00 GMT</span></abbr>
  </p>

  <div class="content">
    <p>The <a href="http://www.parallels.com">Parallels</a> folks have been burning the midnight oil. Beta 6 now eliminates the very annoying &#8216;pause&#8217; at the Start screen for Windows XP during reboots. I tend not to reboot often, but that &#8216;pause&#8217; was well over a minute in Beta 5. The Start screen just flashes for a fraction of a second now and I drop straight into my desktop. Yay!</p>


	<p><strong>Update:</strong> Make sure that you update your Parallels Tools install in your VM. I&#8217;m not sure if this was the case, but my VM was running at extremely high <span class="caps">CPU</span> load in Mac OS but XP was reporting 0% <span class="caps">CPU</span> load. Updating the tools and rebooting fixed this.</p>

      
  </div>

  <ul class="meta">
    <li class="categories">Posted in <a href="/articles/category/links" rel="tag">Props</a></li>
    
    <li>Meta 
      
      <a href="/articles/2006/05/01/parallels-beta-6-with-new-and-improved-speed#comments">no comments</a>,
      <a href="/articles/2006/05/01/parallels-beta-6-with-new-and-improved-speed" rel="bookmark">permalink</a>,
      <a href="http://www.iunknown.com/xml/rss/article/122/feed.xml">rss</a>,    
      <a href="http://www.iunknown.com/xml/atom/article/122/feed.xml">atom</a>, 
      <a title='digg this' href="http://digg.com/submit?phase=2&url=/articles/2006/05/01/parallels-beta-6-with-new-and-improved-speed">digg this</a>, 
      <a title='reddit' href="http://reddit.com/submit?url=/articles/2006/05/01/parallels-beta-6-with-new-and-improved-speed;title=Parallels Beta 6 with new and improved speed!">reddit</a>
    </li>
  </ul>
</div>


<p class="pagination">Older posts: <a href="/articles/page/1">1</a> ...  <a href="/articles/page/14">14</a> <a href="/articles/page/15">15</a> 16 <a href="/articles/page/17">17</a> <a href="/articles/page/18">18</a>  ... <a href="/articles/page/28">28</a></p>

      <script type="text/javascript">
//<![CDATA[
show_dates_as_local_time()
//]]>
</script>
    </div>

    <div id="sidebar">
      <!-- search -->
      <div id="search" class="search">
	<form action="/articles/search" id="sform" method="get">
	  <p><input type="text" id="q" name="q" value="" /></p>
	</form>
	
	<div id="loading" class="loading" style="display:none;">Searching...</div>
	<div id="results" class="results"></div>
  <script type="text/javascript">
//<![CDATA[
new Form.Element.Observer('q', 1, function(element, value) {new Ajax.Updater('results', '/live/search', {asynchronous:true, evalScripts:true, onComplete:function(request){Element.hide('loading')}, onLoading:function(request){Element.show('loading')}, parameters:'q=' + escape($F('q'))})})
//]]>
</script>
</div>


      <!-- sidebar components -->
      
      
<div class="sidebar-node">
  <h3>John Lam</h3>
<a href="/pages/about_me"><img src="http://static.flickr.com/90/222479189_d4e19a202c_t.jpg" width="67" height="100" alt="Self portrait" /></a>

<p>I am a Program Manager on the Common Language Runtime team at Microsoft. I write .NET and Ruby code on a Mac. I'm the creator of <a href="http://www.rubyclr.com">RubyCLR</a>, a high performance bridge between Ruby and .NET. <a href="/pages/about_me">More ...</a>

<table>
<tr>
  <td>email:</td>
  <td>jlam@iunknown.com</td>
</tr>
<tr>
  <td>phone:</td>
  <td>425 698 9332</td>
</tr>
<tr>
  <td>msn:</td>
  <td>drjflam@hotmail.com</td>
</tr>
<tr>
  <td>gtalk:</td>
  <td>drjflam@gmail.com</td>
</tr>
</table>
<br>
<h3>Syndicate</h3>

<p><a href="http://feeds.feedburner.com/LessIsBetter"><img src="/images/rss.png"/></a>&nbsp;
<a href="http://feeds.feedburner.com/LessIsBetter"><img src="http://feeds.feedburner.com/~fc/LessIsBetter?bg=FF9900&amp;fg=000000&amp;anim=0" height="26" width="88" style="border:0" alt="" /></a>
<br>
<form style="padding:3px;text-align:left;" action="http://www.feedburner.com/fb/a/emailverify" method="post" target="popupwindow" onsubmit="window.open('http://www.feedburner.com', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true"><p>Subscribe by email:</p><p><input type="text" style="width:140px" name="email"/></p><input type="hidden" value="http://feeds.feedburner.com/~e?ffid=180551" name="url"/><input type="hidden" value="Less is better" name="title"/><input type="submit" value="Subscribe" /><p>Delivered by <a href="http://www.feedburner.com/" target="_blank">FeedBurner</a></p></form>

</div>


      
<div class="sidebar-node">
    <div id="delicious">
    <h3><a href="http://del.icio.us/drjflam">del.icio.us/drjflam</a></h3>
            <ul>
      
      <li>
        <a href="http://www.washingtonpost.com/wp-dyn/content/article/2007/04/04/AR2007040401721.html?referrer=digg" title="The story about Joshua Bell performing as a busker in Washington DC - $32.17 for 43 minutes worth of work. A very well written article about the importance of context in beauty (my conclusion - not necessarily the article's).">Pearls Before Breakfast - washingtonpost.com</a>
              </li>
      
      <li>
        <a href="http://bargiel.home.pl/iGTD/" title="A Getting Things Done organizer for the Mac as a desktop application">iGTD</a>
              </li>
      
      <li>
        <a href="http://blogs.smugmug.com/onethumb/files/ETech-SmugMug-Amazon-2007.pdf" title="">Don MacAskill on how S3 saved SmugMug 692K last year</a>
              </li>
      
      <li>
        <a href="http://www.people.iup.edu/pnwm/comparison.gif" title="Fun comparison of fictional starships from different SF shows.">Starship size comparison chart</a>
              </li>
      
      <li>
        <a href="http://www.teach12.com/" title="Bill Gates listens to the lectures from this company - available as downloads as well.">The Teaching Company</a>
              </li>
      
      <li>
        <a href="http://www.speedtest.net/" title="Found this via StumbleUpon">Speedtest.net - The Global Broadband Speed Test</a>
              </li>
      
      <li>
        <a href="http://wvs.topleftpixel.com/flash/cntower_timelapse.swf" title="Move your mouse around this picture and see it change.">Downtown Toronto Photo</a>
              </li>
      
      <li>
        <a href="ftp://gatekeeper.dec.com/pub/DEC/WRL/research-reports/WRL-TR-95.7.pdf" title="">Shared Memory Consistency Models</a>
              </li>
      
      <li>
        <a href="http://discuss.develop.com/archives/wa.exe?A2=ind0203B&amp;L=DOTNET&amp;P=R375" title="An excellent discussion on the motivation for and implementation of the CLR memory model.">Vance Morrison on CLR Memory Model</a>
              </li>
      
      <li>
        <a href="http://slideshare.net/" title="A YouTube like service for sharing slides from talks.">SlideShare</a>
              </li>
      
      <li>
        <a href="http://research.microsoft.com/manuvir/papers/instruction_level_tracing_VEE06.pdf" title="This is MSR's Nirvana framework for dynamically injecting tracing code into x86 binaries at runtime. It lets them travel forwards and backwards in execution flow ('time travel debugging').">Framework for Instruction-level Tracing and Analysis of Program Executions</a>
              </li>
          </ul>
      </div>

</div>


      
<div class="sidebar-node">
  <h3>My Photos</h3>
<style type="text/css">
.zg_div {margin:0px 5px 5px 0px; width:117px;}
.zg_div_inner {background-color:#ffffff;  color:#666666; text-align:center; font-family:arial, helvetica; font-size:11px;}
.zg_div a, .zg_div a:hover, .zg_div a:visited {color:#3993ff; background:inherit !important; text-decoration:none !important;}
</style>
<script type="text/javascript">
zg_insert_badge = function() {
var zg_bg_color = 'ffffff';
var zgi_url = 'http://www.flickr.com/apps/badge/badge_iframe.gne?zg_bg_color='+zg_bg_color+'&zg_person_id=23649168%40N00';
document.write('<iframe style="background-color:#'+zg_bg_color+'; border-color:#'+zg_bg_color+'; border:none;" width="113" height="151" frameborder="0" scrolling="no" src="'+zgi_url+'" title="Flickr Badge"><\/iframe>');
if (document.getElementById) document.write('<div id="zg_whatlink"><a href="http://www.flickr.com/badge_new.gne"	style="color:#3993ff;" onclick="zg_toggleWhat(); return false;">what is this?<\/a><\/div>');
}
zg_toggleWhat = function() {
document.getElementById('zg_whatdiv').style.display = (document.getElementById('zg_whatdiv').style.display != 'none') ? 'none' : 'block';
document.getElementById('zg_whatlink').style.display = (document.getElementById('zg_whatdiv').style.display != 'none') ? 'none' : 'block';
return false;
}
</script>
<div class="zg_div"><div class="zg_div_inner"><a href="http://www.flickr.com">www.<strong style="color:#3993ff">flick<span style="color:#ff1c92">r</span></strong>.com</a><br>
<script type="text/javascript">zg_insert_badge();</script>
<div id="zg_whatdiv">This is a Flickr badge showing public photos from <a href="http://www.flickr.com/photos/23649168@N00">John Lam</a>. Make your own badge <a href="http://www.flickr.com/badge_new.gne">here</a>.</div>
<script type="text/javascript">if (document.getElementById) document.getElementById('zg_whatdiv').style.display = 'none';</script>
</div>
</div>

</div>


      
<div class="sidebar-node">
  
<h3>Archives</h3>
<ul id="archives">
  
    <li>
      <a href="/articles/2007/3">March 2007</a>
      <em>(4)</em>
    </li>
  
    <li>
      <a href="/articles/2007/2">February 2007</a>
      <em>(3)</em>
    </li>
  
    <li>
      <a href="/articles/2007/1">January 2007</a>
      <em>(4)</em>
    </li>
  
    <li>
      <a href="/articles/2006/12">December 2006</a>
      <em>(2)</em>
    </li>
  
    <li>
      <a href="/articles/2006/11">November 2006</a>
      <em>(2)</em>
    </li>
  
    <li>
      <a href="/articles/2006/10">October 2006</a>
      <em>(8)</em>
    </li>
  
    <li>
      <a href="/articles/2006/9">September 2006</a>
      <em>(12)</em>
    </li>
  
    <li>
      <a href="/articles/2006/8">August 2006</a>
      <em>(39)</em>
    </li>
  
    <li>
      <a href="/articles/2006/7">July 2006</a>
      <em>(29)</em>
    </li>
  
    <li>
      <a href="/articles/2006/6">June 2006</a>
      <em>(23)</em>
    </li>
  
    <li>
      <a href="/articles/2006/5">May 2006</a>
      <em>(34)</em>
    </li>
  
    <li>
      <a href="/articles/2006/4">April 2006</a>
      <em>(13)</em>
    </li>
  
    <li>
      <a href="/articles/2006/3">March 2006</a>
      <em>(21)</em>
    </li>
  
    <li>
      <a href="/articles/2006/2">February 2006</a>
      <em>(25)</em>
    </li>
  
    <li>
      <a href="/articles/2006/1">January 2006</a>
      <em>(9)</em>
    </li>
  
    <li>
      <a href="/articles/2005/12">December 2005</a>
      <em>(22)</em>
    </li>
  
    <li>
      <a href="/articles/2005/11">November 2005</a>
      <em>(17)</em>
    </li>
  
    <li>
      <a href="/articles/2005/10">October 2005</a>
      <em>(6)</em>
    </li>
  
</ul>


</div>


      
<div class="sidebar-node">
  <h3>Tags</h3>
<p style="overflow:hidden">
<span style="font-size:66.6666666666667%"><a href="/articles/tag/barcampearthtoronto">BarCampEarthToronto</a></span>
<span style="font-size:128.205128205128%"><a href="/articles/tag/dynamiclanguages">DynamicLanguages</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/ironpython">IronPython</a></span>
<span style="font-size:128.205128205128%"><a href="/articles/tag/life">Life</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/mac">Mac</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/marketing">Marketing</a></span>
<span style="font-size:76.9230769230769%"><a href="/articles/tag/microsoft">Microsoft</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/parenting">Parenting</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/photography">Photography</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/platforms">Platforms</a></span>
<span style="font-size:200%"><a href="/articles/tag/props">Props</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/python">Python</a></span>
<span style="font-size:200%"><a href="/articles/tag/ruby">Ruby</a></span>
<span style="font-size:200%"><a href="/articles/tag/rubyclr">RubyCLR</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/rubyconf">RubyConf</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/secondlife">SecondLife</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/simplicity">simplicity</a></span>
<span style="font-size:200%"><a href="/articles/tag/thoughts">Thoughts</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/vim">Vim</a></span>
<span style="font-size:66.6666666666667%"><a href="/articles/tag/workspaces">workspaces</a></span>
</p>


</div>


      
<div class="sidebar-node">
  <h3>Categories</h3>
<ul id="categories">
  
  <li><a href="/articles/category/personal">Life</a> <em>(20)</em></li>
  
  
  <li><a href="/articles/category/links">Props</a> <em>(58)</em></li>
  
  
  <li><a href="/articles/category/thoughts">Thoughts</a> <em>(149)</em></li>
  
</ul>


</div>


  


    </div>
    <br style="clear:both;" />
  </div>

  <div id="footer">
    <hr />
    <p><a href="/">Less is better</a></p>
    <ul>
      <li>powered by <a href="http://typosphere.org">typo</a> /
          styled with <a href="http://quotedprintable.com/pages/scribbish">scribbish</a></li>
    </ul>
  </div>
</div>
</body>
</html>
