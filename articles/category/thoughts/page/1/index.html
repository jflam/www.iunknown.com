<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Less is better</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  
  <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.iunknown.com/xml/rsd/feed.xml" />
  <link href="http://feeds.feedburner.com/LessIsBetter" rel="alternate" title="RSS" type="application/rss+xml"/>
  <link href="/stylesheets/theme/azure.css" media="screen" rel="Stylesheet" type="text/css" />
  <link href="/stylesheets/theme/local.css" media="screen" rel="Stylesheet" type="text/css" />
  <script src="/javascripts/cookies.js" type="text/javascript"></script>
  <script src="/javascripts/prototype.js" type="text/javascript"></script>
  <script src="/javascripts/effects.js" type="text/javascript"></script>
  <script src="/javascripts/typo.js" type="text/javascript"></script>
  <script type="text/javascript"></script>
  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
  <script type="text/javascript">
    _uacct="UA-133590-1";
    urchinTracker();
  </script>
</head>
<body>
  <div id="container" class="clearfix">
     <div id="header">
        <div id="logo">
          <h1 id="sitename"><a href="/">Less is better</a></h1>
          <h2 id="subtitle">John Lam on software</h2>
        </div>
      </div>
      
      <div id="content" class="clearfix">
        <div id="main">
          <img id="photo" src='http://static.flickr.com/26/55383834_e4b27af640.jpg?v=0' alt='Self Portrait'/>
           <div class="post">
  <h2><a href="/articles/2006/03/16/third-drop-of-rubyclr">Third Drop of RubyCLR</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Fri, 17 Mar 2006 01:27:00 GMT">Fri, 17 Mar 2006 01:27:00 GMT</span></p>
<p>This is the biggest release of RubyCLR yet. You can <a href="http://www.iunknown.com/images/RubyCLR.zip">download it here</a>. Here&#8217;s a brief summary of RubyCLR as of this drop:</p>


	<ul>
	<li>Reference .NET assemblies by assembly name or by filename </li>
		<li>Create and manipulate .NET reference and value types</li>
		<li>Automatically marshal .NET reference and value types to / from Ruby</li>
		<li>Dynamic generation of interop code using <span class="caps">CIL</span> instructions</li>
		<li>Create and manipulate generic .NET reference types</li>
		<li>Discover and consume .NET interfaces on a .NET object</li>
		<li>Implement .NET event handlers using Ruby blocks</li>
		<li>Map .NET member names to Ruby names (e.g. WordCount becomes word_count)</li>
		<li>Mix in Ruby Enumerable support for .NET IEnumerable types</li>
		<li>Dynamically access .NET <span class="caps">XML</span> documentation from irb (requires text/format &#8211; to
  make it work uncomment require in rubyclr.rb)</li>
	</ul>


	<p>There are several sample applications to show you what&#8217;s possible:</p>


	<ul>
	<li><strong>GoogleCalc</strong> lets you access Google&#8217;s calculator from a rich client application</li>
		<li><strong>RssReader</strong> is a Windows Forms 2.0 <span class="caps">RSS</span> reader</li>
		<li><strong>Math</strong> is a Windows Presentation Foundation (aka Avalon) application that <a href="http://www.iunknown.com/articles/2006/03/15/rubyclr-and-avalon">renders math equations</a> using a domain specific language</li>
	</ul>


	<p>The source code has been massively reorganized from the last drop. If you&#8217;re using <a href="http://www.activestate.com/komodo/">Komodo</a> you&#8217;ll find Komodo project files in this drop to make it easier to navigate the non C++ source code.</p>


	<p>I&#8217;m going to be pretty busy for the next three weeks <a href="http://www.objectsharp.com">doing work to pay the bills around here</a>, so work is going to slow down quite a bit on the bridge. I hope this release is of sufficient quality to sustain y&#8217;all for the next month or so. Let me know by email (jlam at this domain) if you have any reproducible showstopper bugs and I&#8217;ll see what I can do to get a patch out the door.</p>


	<p>Enjoy!</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/03/16/third-drop-of-rubyclr#comments">4 comments</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/03/15/rubyclr-and-avalon">RubyCLR and Avalon</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Wed, 15 Mar 2006 21:49:00 GMT">Wed, 15 Mar 2006 21:49:00 GMT</span></p>
<p>Here&#8217;s a teaser screenshot:</p>


	<p><img src="http://static.flickr.com/56/113024723_7bb322ce42_o.png" alt="" /></p>


	<p>The integral was defined by this Ruby code:</p>


	<p><code>integral('a', 'b', 'f(x) dx')</code></p>


	<p>The image that you see was rendered using the technology formerly known as Avalon. This is a part of the new sample application that will ship in the 3rd drop of RubyCLR (probably sometime tonight, or whenever I get enough time to type up a set of release notes). It will let you interactively create mathematical expressions in an Avalon application.</p>


	<p>I used <a href="http://www.valil.com/winfx/math.html">Valentin Iliescu&#8217;s</a> most excellent <code>Math.Equations</code> library to do the heavy lifting. Most of the equations that you see are really custom layout panels. Valentin graciously agreed over lunch to let me ship his assembly (only 45K) along with RubyCLR so that you can see this stuff in action.</p>


	<p>The domain specific language that I created for this sample is far from ideal; I gave myself a 1 day time window to create this sample, and I&#8217;ve run out of time. If anyone out there is interested in improving the <span class="caps">DSL</span>, go for it (and please share!).</p>


	<p>Here&#8217;s an excerpt of the <span class="caps">DSL</span> that defines the paragraph in the screenshot:</p>


<pre><code>
text 'The first fundamental theorem of calculus states that, if ', expr('f')
text 'is continuous on the closed interval', expr('[a,b]'), 'and', expr('F')
text 'is the is the antiderivative (indefinite integral) of ', expr('f')
text 'on', expr('[a,b]'), ', then ', integral('a', 'b', 'f(x) dx = F(b) - F(a)'), '.'
</code></pre>

	<p>You&#8217;ll need to have the February 2006 WinFX <span class="caps">CTP</span> to run the <span class="caps">WPF</span> sample (but you won&#8217;t need it to use any of the other code in the bridge).</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/03/15/rubyclr-and-avalon#comments">4 comments</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/03/13/rubyclr-makes-net-feel-more-like-ruby">RubyCLR makes .NET feel more like Ruby</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Tue, 14 Mar 2006 01:37:00 GMT">Tue, 14 Mar 2006 01:37:00 GMT</span></p>
<p>As I was implementing my <a href="http://www.iunknown.com/articles/2006/03/10/new-rubyclr-reflection-features">dynamic help</a> feature, I was constantly annoyed by the code that I had to write to manipulate <span class="caps">CLR</span> arrays. That code looked something like this:</p>


<pre><code>
array = get_an_array_from_somewhere

holder_for_a_bunch_of_things = []
0.upto(array.length - 1) do |i|
  # gather up a bunch of things
end

# use holder_for_a_bunch_of_things
</code></pre>

	<p>Now, most Ruby programmers would rather use the <a href="http://www.ruby-doc.org/core/classes/Enumerable.html#M002099">collect</a> method from the <code>Enumerable</code> module:</p>


<pre><code>
array = get_an_array_from_somewhere
holder = array.collect do |item|
  # expression for transforming an item
end
</code></pre>

	<p>I&#8217;m happy to say that RubyCLR now automatically mixes in the <a href="http://www.ruby-doc.org/core/classes/Enumerable.html">Enumerable</a> module for any <span class="caps">CLR</span> type that implements the <code>IEnumerable</code> interface. This means that your Ruby programs will <em>feel</em> much more like a Ruby program.</p>


	<p>RubyCLR now also automatically defines the <code>&lt;=&gt;</code> method for any object that implements the <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref/html/frlrfsystemicomparableclasstopic.asp">IComparable</a> interface. It prefers <code>IComparable&lt;T&gt;</code>, but will bind as well to <code>IComparable</code>. This means that you can now use the <code>Enumerable#sort</code> method to sort a .NET array, or list (if that&#8217;s what you want to do).</p>


	<p>Here&#8217;s a simple unit test that validates this behavior:</p>


<pre><code>
def test_object_sort
  john  = Person.new('John')
  steve = Person.new('Steve')
  mike  = Person.new('Mike')

  a = ArrayList.new
  a.add(john)
  a.add(steve)
  a.add(mike)

  b = a.sort
  assert_equal Array, b.class
  assert_equal 'John', b[0].name
  assert_equal 'Mike', b[1].name
  assert_equal 'Steve', b[2].name
end
</code></pre>

	<p>The <code>Person</code> object implements the <code>IComparable</code> interface. Notice as well that the <code>Enumerable#sort</code> method returns a Ruby array, not a <span class="caps">CLR</span> array.</p>


	<p>I have a lot more ideas about how to further blur the boundary between Ruby and the <span class="caps">CLR </span>(such as letting Ruby objects implement arbitrary <span class="caps">CLR</span> interfaces), but those features will have to wait for a while.</p>


	<p>I&#8217;m now in app-writing mode for the next release. There will be a really nice Avalon aka Windows Presentation Foundation sample app, so make sure you go and download the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=F51C4D96-9AEA-474F-86D3-172BFA3B828B&#38;displaylang=en">February WinFX <span class="caps">CTP</span></a> now!</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/03/13/rubyclr-makes-net-feel-more-like-ruby#comments">2 comments</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/03/10/new-rubyclr-reflection-features">New RubyCLR Reflection Features</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Sat, 11 Mar 2006 01:30:00 GMT">Sat, 11 Mar 2006 01:30:00 GMT</span></p>
<p>Here&#8217;s a screenshot that illustrates some of the new reflection features of RubyCLR. Notice how you can now invoke the <code>help</code> method on a type to get help on the type or for one of its members. You&#8217;ll also notice how I&#8217;m using the new color features of <code>System.Console</code> to improve the readability of the data.</p>


	<p>The new reflection code was implemented entirely in Ruby. So it&#8217;s a very good performance stress test since I&#8217;m parsing <span class="caps">XML</span> doc files to retrieve the help that you see. The <code>mscorlib.xml</code> help file is > 7MB, and can be parsed using <code>XmlTextReader</code> driven from Ruby in about 2s. That&#8217;s excellent performance considering the number of times I&#8217;m crossing the interop boundary for a 7MB <span class="caps">XML</span> doc!</p>


	<p>Is this a useful feature? I really built it for myself so that I can get help form within an irb session, which I find myself in quite often while writing Ruby code.</p>


	<p><img src="http://static.flickr.com/44/110674297_303908d4cd_o.png" alt="" /></p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/03/10/new-rubyclr-reflection-features#comments">1 comment</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/03/08/windows-presentation-foundation-and-rubyclr">Windows Presentation Foundation and RubyCLR</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Wed, 08 Mar 2006 22:05:00 GMT">Wed, 08 Mar 2006 22:05:00 GMT</span></p>
<p>I&#8217;ve forgotten most of what little I knew about Avalon aka Windows Presentation Foundation. So I spent a bit of time today trying to remember &#8230; here&#8217;s what I was able to accomplish:</p>


	<p><img src="http://static.flickr.com/49/109809504_3cb96cef07_o.png" alt="" /></p>


	<p>OK, so that&#8217;s not really all that spectacular. What <strong>is</strong> spectacular, however, is how I can create this thing without having to define any <span class="caps">CLR</span> classes myself (which is impossible using my bridge). Here&#8217;s the <span class="caps">XAML</span> file:</p>


<pre><code>
&lt;Window
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"&gt;
  &lt;StackPanel&gt;
    &lt;Button Name="button1"&gt;Click me&lt;/Button&gt;
  &lt;/StackPanel&gt;
&lt;/Window&gt;
</code></pre>

Note that this technique isn&#8217;t documented very well at all, but a bit of experimentation yielded this:
<pre><code>
require 'wpf'

window = XamlReader.load(System::IO::File.open_read('app.xaml'))
button = window.find_name('button1')
button.click do |sender, args|
  puts 'clicked me!'
end
Application.new.run(window)
</code></pre>

	<p>The wicked-cool feature of this code is how <code>XamlReader.load</code> generates a <code>Window</code> object for me from the <span class="caps">XAML</span>. Now it&#8217;s a simple matter for me to find the button and hook up its <code>Click</code> event handler.</p>


	<p>Now I&#8217;m not all that happy with the Ruby code. I really want it to look like this:</p>


<pre><code>
window = XamlReader.load(System::IO::File.open_read('app.xaml'))
window.button1.click do |sender, args|
  puts 'clicked me!'
end
Application.new.run(window)
</code></pre>

	<p>The <code>window.button1</code> construct is much more Ruby-esque and requires that I hook <code>method_missing</code> in any class that derives from <a href="http://windowssdk.msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref28/html/T_System_Windows_FrameworkElement.asp">FrameworkElement</a> to first try to call <a href="http://windowssdk.msdn.microsoft.com/library/default.asp?url=/library/en-us/cpref28/html/M_System_Windows_FrameworkElement_FindName_1_16219e3a.asp">FindName</a> after any other dynamic name resolution.</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/03/08/windows-presentation-foundation-and-rubyclr#comments">2 comments</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/03/06/method-overloading-and-class-inheritance">Method overloading and class inheritance</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Mon, 06 Mar 2006 16:15:00 GMT">Mon, 06 Mar 2006 16:15:00 GMT</span></p>
<p>I need some feedback on a design problem in RubyCLR.</p>


	<p>Here&#8217;s the problem in a nutshell: Ruby doesn&#8217;t support method overloading. RubyCLR fakes it out by generating a shim that lets you call the union of all overloaded methods defined by the current class and all ancestor classes.</p>


	<p>Now, the biggest feature that I&#8217;m adding to this next drop of the bridge is class-based inheritance of shims. I want to define a shim on the class that it was defined by (via <code>MemberInfo.DeclaringType</code> property). The goal of this is to let folks (who want to) replace the definition of the method where it was defined, and to let all derived classes automatically inherit that method definition. This, of course, doesn&#8217;t work if that method is ever overloaded in derived classes.</p>


	<p>For the next drop, I&#8217;m going to take a hybrid approach: define the shim on the declaring Ruby class object if that method is never overloaded in derived classes. If it is overloaded in derived classes, I&#8217;m going to define the shim on the Ruby class that triggered the <code>const_missing</code> event.</p>


	<p>I&#8217;d <strong>really</strong> like some second opinions about this, as this is largely stream of consciousness thinking right now. I&#8217;m worried about breaking things in lots of other corner cases that I haven&#8217;t considered yet.</p>


	<p>Do I really need to go to a full-blown method name mangling approach to implement this feature correctly?</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/03/06/method-overloading-and-class-inheritance#comments">3 comments</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/03/06/dull-cubicles-or-dull-people">Dull cubicles or dull people?</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Mon, 06 Mar 2006 15:35:00 GMT">Mon, 06 Mar 2006 15:35:00 GMT</span></p>
<p>Kathy Sierra posted about <a href="http://headrush.typepad.com/creating_passionate_users/2006/02/brain_death_by_.html#comments">how cubicles can cause brain damage</a>. Folks, we&#8217;re mixing up cause and effect.</p>


	<p>Nobody likes cubicles. That&#8217;s fine. But simply changing your organization to have beautiful offices with doors that look out over panoramic vistas will <strong>not</strong> let you create wonderful products <em>if you keep the same people</em>.</p>


	<p>It&#8217;s the people in your organization that make it dull and lifeless. Let&#8217;s face it, the typical graduate student office is about as institutional and ugly as any cube farm, yet remarkable work gets done every day there. Why? It&#8217;s the people.</p>


	<p>Look around you. Would you rather have a door to keep the bozos out, or would you rather get rid of the bozos?</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/03/06/dull-cubicles-or-dull-people#comments">3 comments</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/03/03/converging-on-a-correct-design">Converging on a correct design</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Fri, 03 Mar 2006 16:06:00 GMT">Fri, 03 Mar 2006 16:06:00 GMT</span></p>
<p>Special cases in code that are workarounds for a seemingly innocuous problem are almost always a symptom of something wrong in your design.</p>


	<p>Here&#8217;s an example from some work that I&#8217;ve been doing for the past couple of days: identifying layering violations in <a href="http://www.iunknown.com/articles/2006/02/20/second-drop-of-rubyclr">RubyCLR</a>. This work led me to look at how I was caching <code>Type</code> objects in the bridge.</p>


	<p>I currently hold onto a reference to a <span class="caps">CLR </span><code>Type</code> object in each Ruby shadow class object that I create. So you could think of the Ruby type system as a cache for all <code>Type</code> objects that are currently in use by your program.</p>


	<p>The problem is this: I cache <code>Type</code> objects elsewhere as well, particularly in the lower levels of the bridge that use my <a href="http://www.iunknown.com/articles/2005/12/13/third-drop-of-rbdynamicmethod">RbDynamicMethod</a> library. Now, it just doesn&#8217;t <em>feel</em> right to have duplicate caches, so I set about redesigning my Reflection engine to use a unified cache.</p>


	<p>While looking at the C++ code that I had to refactor, I decided to postpone this work to work on something more important: leveraging inheritance in my Ruby shadow class objects. Right now, if you had a <code>System.Windows.Forms.TextBox</code> and a <code>System.Windows.Forms.Button</code> you will have duplicate accessor <code>Name</code> accessor methods; my shadow classes were completely ignorant of inheritance in the <span class="caps">CLR</span> class libraries. The correct solution is to attach the <code>Name</code> accessor method shim to the class where it was defined: the common <code>System.Windows.Forms.Control</code> class.</p>


	<p>Postponing the work seemed like the right thing &#8211; after all, I was just being inefficient, right?</p>


	<p>So I started to implement ruby shadow class inheritance. But then I ran smack into a what was now a clear layering violation: the reference to the <code>Type</code> object that I was holding in my shadow class objects. There was even (surprise!) some special case code to treat <code>Type</code> objects differently.</p>


	<p>I need to move that reference out of the Ruby shadow class object and into the unified <code>Type</code> cache that I wanted to implement earlier, but postponed!</p>


	<p>So the moral of the story is this: several seemingly unrelated problems were all symptoms of the same incorrect design. I&#8217;m continually amazed at how refactoring code almost always leads me to a (more) correct design.</p>


	<p>As an aside, this is also why programming languages that let you write fewer lines of code are almost always superior: it&#8217;s just easier to <em>see</em> the incorrect design when you&#8217;re staring at fewer lines of code to begin with. And they also have the side-effect of making it much easier to do complex refactoring because there&#8217;s less language-related bookkeeping to do &#8230;. hmmm I wonder what languages I&#8217;m comparing here? :)</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/03/03/converging-on-a-correct-design#comments">no comments</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/02/28/generics-stabilizing">Generics stabilizing</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Wed, 01 Mar 2006 04:34:00 GMT">Wed, 01 Mar 2006 04:34:00 GMT</span></p>
<p>RubyCLR now supports multi-type generic types such as <code>Dictionary&lt;T, U&gt;</code>. I also changed the nasty <code>cons</code> method to the infinitely cleaner <code>of</code> method. Here&#8217;s some tests to show the progress:</p>


<pre><code>
def test_create_two_parameter_generic_type
  dict = Dictionary.of(Int32, Int32).new
  dict.add(1, 1)
  dict.add(2, 2)
  assert_equal 1, dict[1]
  assert_equal 2, dict[2]
end

def test_dictionary_with_string_key
  dict = Dictionary.of(System::String, Int32).new
  dict['John'] = 42
  dict['Ruby'] = 2
  assert_equal 42, dict['John']
  assert_equal 2, dict['Ruby']
end
</code></pre>

	<p>The one thing that I&#8217;m not happy with right now is being forced to fully qualify the <code>System::String</code> type. I might add some code to special-case that type name in the <code>of</code> method and alias to the <span class="caps">CLR </span><code>String</code> type from the Ruby <code>String</code> type.</p>


	<p>You might be wondering how I implement the generic types. I generate a Ruby shadow class that has a mangled name. For example, <code>Dictionary.of(Int32,Int32)</code>, maps to a Ruby class called <code>Dictionary_generic_Int32_Int32</code>, which is generated the first time <code>of</code> is called. On all subsequent calls, I just look up the Ruby shadow class name. This is also how I handle arrays (you can really think of arrays as a special case of generics).</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/02/28/generics-stabilizing#comments">2 comments</a></p> 
  </div>
 <div class="post">
  <h2><a href="/articles/2006/02/28/generics-in-rubyclr">Generics in RubyCLR</a></h2>
<p class="auth">Posted by <a href="mailto:jlam@iunknown.com">John Lam</a>
<span class="typo_date" title="Tue, 28 Feb 2006 22:21:00 GMT">Tue, 28 Feb 2006 22:21:00 GMT</span></p>
<p>I got a crude implementation of generics up and running in RubyCLR today. It does what these tests say it does, and nothing more :)</p>


<pre><code>
class GenericsTests &lt; TestCase
  include System::Collections::Generic

  def test_make_generic_type
    c = List.cons(Int32)
    assert_equal 'System::Collections::Generic::List_generic_Int32', c.name
    assert_equal 'System.Collections.Generic.List`1[[System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]]', c.clr_type.full_name
  end

  def test_create_generic_type
    list = List.cons(Int32).new
    assert_equal 'List`1', list.clr_type.name
  end

  def test_call_generic_type
    list = List.cons(Int32).new
    list.add(42)
    assert_equal 42, list[0]
  end

  def test_type_conversion_error
    assert_raises TypeError do
      list = List.cons(Int32).new
      list.add('42')
    end
  end
end
</code></pre>

	<p>As for feedback, I&#8217;m not all that happy with the name <code>cons</code> for the method that creates a generic type. Suggestions would be welcome (but they have to be easy to type, since I&#8217;m competing with <code>List&lt;Int32&gt;</code> :)</p>


	<p>I also ran some crude performance benchmarks for adding 1M integers to each data structure:</p>


	<ul>
	<li><code>ArrayList</code>   = 1.15s</li>
		<li><code>List&lt;Int32&gt;</code> = 1.00s</li>
		<li>Ruby <code>Array</code>  = 0.66s</li>
	</ul>


	<p>I just wanted to get some order of magnitude estimates of performance. So far I&#8217;m quite happy with the performance of the bridge. 1M method calls / second is nothing to sneeze at.</p>

    
  <p class="meta">Posted in <a href="/articles/category/thoughts" rel="category tag">Thoughts</a>&nbsp;<strong>|</strong>&nbsp;<a href="/articles/2006/02/28/generics-in-rubyclr#comments">4 comments</a></p> 
  </div>


  <p id="pagination">Older posts: 1 <a href="/articles/category/thoughts/page/2">2</a> <a href="/articles/category/thoughts/page/3">3</a>  ... <a href="/articles/category/thoughts/page/7">7</a></p>

          <script type="text/javascript">show_dates_as_local_time()</script>
        </div>
        <div id="sidebar">
          <form action="/articles/search" id="sform" method="get">
 <h3><label for="q">Search: </label></h3><input type="text" id="q" name="q" value="" size="15" />
<img alt="Spinner-blue" id="search_spinner" src="/images/spinner-blue.gif" style="display:none;" />
</form>

          <div id="search-results"></div>
          <script type="text/javascript">new Form.Element.Observer('q', 1, function(element, value) {new Ajax.Updater('search-results', '/live/search', {asynchronous:true, evalScripts:true, onComplete:function(request){Element.hide('search_spinner')}, onLoading:function(request){Element.show('search_spinner')}, parameters:value})})</script>          
            <h3>Syndicate</h3>
<ul>
    <li><a href="http://feeds.feedburner.com/LessIsBetter" title="RSS 2.0 feed">Articles</a></li>
  
    <li><a href="http://feeds.feedburner.com/LessIsBetterComments" title="Comments RSS 2.0 feed">Comments</a></li>
  
  
</ul>

    <div id="delicious">
    <h3><a href='http://del.icio.us/drjflam'>My recent del.icio.us links</a></h3>
    <ul>
              <li><a href="http://www.iunknown.com/articles/2006/03/16/third-drop-of-rubyclr" title="For the archives">Third Drop of RubyCLR </a></li>
              <li><a href="http://www.winxponmac.com/" title="Wahoo! Once Apple ships a 12" MacBook Pro with 1400 x 1050 and a Merom CPU I'm all over it.">Windows XP now boots on an Intel Duo Core Mac </a></li>
              <li><a href="http://video.google.com/videoplay?docid=-199899523054020719&amp;q=linux" title="Wow. This video of vista-esque effects in Linux is seriously impressive.">Novell Linux 10 xgl Technology Demonstration </a></li>
              <li><a href="http://www.pro-networks.org/forum/about71695-0-asc-10.html&amp;sid=f821da51db26b693a7066fc7fa8644eb" title="This is the thing that's been blocking me installing Vista 5308 on my Opteron desktop. Apparently you have to install XP first to a partition and then upgrade.">Installing Vista 5308 on NVIDIA SATA RAID </a></li>
              <li><a href="http://video.google.com/videoplay?docid=-6909078385965257294" title="Wow. Wow. Wow. One of the most insightful talks that I've seen this year.">"All Marketers are Liars" - Seth Godin speaks at Google </a></li>
              <li><a href="http://home.allegiance.tv/~joem298/" title="How to reinstall your Windows XP image on a Toshiba M200 using a PXE server">PXE Booting your M200 to DOS </a></li>
              <li><a href="http://sports.espn.go.com/espn/page2/story?page=simmons/060302" title="A couple of great writers that I admire interview each other.">Bill Simmons interviews Malcolm Gladwell on ESPN </a></li>
              <li><a href="http://www.pbenz.com/switch/archives/2005/03/changing_key_bi.html" title="One of the things that really frustrated me is the inconsistency of some keybindings between OS X and Windows. This is a cool script that maps them back to something I'm more used to.">Windows - friendly Key Bindings on Mac OS X </a></li>
              <li><a href="http://weblog.rubyonrails.com/articles/2006/03/01/new-for-rails-1-1-integration-tests" title="Is this just me, or are these integration tests just a model of clarity?">Integration Tests in Rails 1.1 </a></li>
              <li><a href="http://www.engadget.com/2006/02/27/wwjd-3-results/" title="Today's Mac mini announcements were pretty lame. Now these are some products that I want!">WWJD 3 - Results (What Would Jobs Do?) </a></li>
              <li><a href="http://webcast.berkeley.edu/courses/feeds.php" title="I'm listening to lots of podcasts as I walk around carrying Ben in the evenings. Lots of good material here.">UC Berkeley courses as webcasts </a></li>
          </ul>
  </div>

  <div id="flickr">
<h3>John Lam's Photos (<a href="http://www.flickr.com/photos/23649168@N00/">flickr</a>)</h3>
  <div class="flickrsquare"><a href="http://www.flickr.com/photos/23649168@N00/102310404/"><img alt="Ruby RSS Reader" src="http://static.flickr.com/36/102310404_c16b55d745_s.jpg" /></a>
</div>
    <div class="flickrsquare"><a href="http://www.flickr.com/photos/23649168@N00/84578490/"><img alt="Groovin'" src="http://static.flickr.com/39/84578490_119d64f19d_s.jpg" /></a>
</div>
    <div class="flickrsquare"><a href="http://www.flickr.com/photos/23649168@N00/110674297/"><img alt="RubyCLR irb session" src="http://static.flickr.com/44/110674297_303908d4cd_s.jpg" /></a>
</div>
    <div class="flickrsquare"><a href="http://www.flickr.com/photos/23649168@N00/102353551/"><img alt="RSS Reader in Ruby" src="http://static.flickr.com/43/102353551_a14d82507d_s.jpg" /></a>
</div>
  </div>

  
<h3>Archives</h3>
<ul id="archives">
  
    <li>
      <a href="/articles/2006/03/page/1">March 2006</a>
      <em>(10)</em>
    </li>
  
    <li>
      <a href="/articles/2006/02/page/1">February 2006</a>
      <em>(25)</em>
    </li>
  
    <li>
      <a href="/articles/2006/01/page/1">January 2006</a>
      <em>(9)</em>
    </li>
  
    <li>
      <a href="/articles/2005/12/page/1">December 2005</a>
      <em>(22)</em>
    </li>
  
    <li>
      <a href="/articles/2005/11/page/1">November 2005</a>
      <em>(18)</em>
    </li>
  
    <li>
      <a href="/articles/2005/10/page/1">October 2005</a>
      <em>(7)</em>
    </li>
  
</ul>


  <h3>Categories</h3>
<ul id="categories">
  
  <li><a href="/articles/category/personal">Life</a> <em>(8)</em></li>
  
  
  <li><a href="/articles/category/links">Props</a> <em>(17)</em></li>
  
  
  <li><a href="/articles/category/thoughts">Thoughts</a> <em>(66)</em></li>
  
</ul>


  <h3>Links</h3>
<ul>
  <li><a href="/pages/about_me">About me</a></li>
  <li><a href="http://www.objectsharp.com">My company</a></li>
  <li><a href="http://www.rubyonrails.com">Rails</a></li>
</ul>

Posts that contain <a href="http://technorati.com/search/RubyCLR">RubyCLR</a> per day for the last 30 days.<br /><a href="http://technorati.com/search/RubyCLR"><img src="http://technorati.com/chartimg/%28RubyCLR%29?totalHits=38&size=s&days=30" style="border:0" alt="Technorati Chart" /></a>



          <a class="powered" href="http://typo.leetsoft.com/"><img alt="Powered" src="/images/powered.gif" /></a>
        </div>
        <br clear="all" />
      </div>
      <div id="footer">
        <ul>
          <li><a href="http://validator.w3.org/check?uri=referer">Valid XHTML 1.0</a></li>
          <li><a href="http://jigsaw.w3.org/css-validator/validator?uri=http://www.iunknown.com/">Valid CSS</a></li>
        </ul>
      </div>
  </div>
</body>
</html>
