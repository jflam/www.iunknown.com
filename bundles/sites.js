function trace(a){try{console.log(a)}catch(b){}}function prefillClearer(a,b){a=$(a);var c=function(){a.value=b,a.addClassName(PREFILL_CLASSNAME)},d=function(){a.value="",a.removeClassName(PREFILL_CLASSNAME)};a.observe("focus",function(){(a.value==b||a.value=="Untitled")&&d(),a.removeClassName(PREFILL_CLASSNAME)}),a.observe("blur",function(){a.value.blank()&&c()}),$(a.form).observe("reset",c),a.value.blank()&&c(),(a.value!=b||a.value=="Untitled")&&a.removeClassName(PREFILL_CLASSNAME)}function rand(a){return Math.floor(Math.random()*a+1)}function doTouchMove(a){document.ontouchmove=function(b){return a}}function noTouchMove(){document.ontouchmove=function(a){a.preventDefault()}}(function(a){var b={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowerUpper:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g},c=function(a,b,c){var d=b||window,e=a?a.split(/\./):[],f,g=0;for(;g<e.length-1&&d;g++)d=d[e[g]]||c&&(d[e[g]]={});return e.length==0?b:(f=d[e[g]]||c&&(d[e[g]]={}),c===!1&&delete d[e[g]],f)},d=a.String={getObject:c,strip:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},capitalize:function(a,b){return a.charAt(0).toUpperCase()+a.substr(1)},endsWith:function(a,b){var c=a.length-b.length;return c>=0&&a.lastIndexOf(b)===c},camelize:function(a){var c=a.split(b.undHash),e=1;c[0]=c[0].charAt(0).toLowerCase()+c[0].substr(1);for(;e<c.length;e++)c[e]=d.capitalize(c[e]);return c.join("")},classize:function(a){var c=a.split(b.undHash),e=0;for(;e<c.length;e++)c[e]=d.capitalize(c[e]);return c.join("")},niceName:function(a){var c=a.split(b.undHash),e=0;for(;e<c.length;e++)c[e]=d.capitalize(c[e]);return c.join(" ")},underscore:function(a){return a.replace(b.colons,"/").replace(b.words,"$1_$2").replace(b.lowerUpper,"$1_$2").replace(b.dash,"_").toLowerCase()},sub:function(a,d,e){var f=[];return f.push(a.replace(b.replacer,function(a,b){var g=c(b,d,!e),h=typeof g;return h!=="object"&&h!=="function"||h===null?""+g:(f.push(g),"")})),f.length<=1?f[0]:f}}})(jQuery),function(a){var b=!1,c=a.makeArray,d=a.isFunction,e=a.isArray,f=function(a,b){return a.concat(c(b))},g=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,h=function(a,b,c){c=c||a;for(var e in a)c[e]=d(a[e])&&d(b[e])&&g.test(a[e])?function(a,c){return function(){var d=this._super,e;return this._super=b[a],e=c.apply(this,arguments),this._super=d,e}}(e,a[e]):a[e]},i=a.Class=function(){arguments.length&&i.extend.apply(i,arguments)};a.extend(i,{callback:function(a){var b=c(arguments),d;return a=b.shift(),e(a)||(a=[a]),d=this,function(){var g=f(b,arguments),h,i=a.length,j=0,k;for(;j<i;j++){k=a[j];if(!k)continue;h=typeof k=="string",h&&d._set_called&&(d.called=k),g=(h?d[k]:k).apply(d,g||[]),j<i-1&&(g=!e(g)||g._use_call?[g]:g)}return g}},getObject:a.String.getObject,newInstance:function(){var a=this.rawInstance(),b;return a.setup&&(b=a.setup.apply(a,arguments)),a.init&&a.init.apply(a,e(b)?b:arguments),a},setup:function(b,c){return this.defaults=a.extend(!0,{},b.defaults,this.defaults),arguments},rawInstance:function(){b=!0;var a=new this;return b=!1,a},extend:function(c,d,e){function o(){if(b)return;return this.constructor!==o&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}typeof c!="string"&&(e=d,d=c,c=null),e||(e=d,d=null),e=e||{};var g=this,j=this.prototype,k,l,m,n;b=!0,n=new this,b=!1,h(e,j,n);for(k in this)this.hasOwnProperty(k)&&a.inArray(k,["prototype","defaults","getObject"])==-1&&(o[k]=this[k]);h(d,this,o);if(c){var p=c.split(/\./),l=p.pop(),q=i.getObject(p.join("."),window,!0),m=q;q[l]=o}a.extend(o,{prototype:n,namespace:m,shortName:l,constructor:o,fullName:c}),o.prototype.Class=o.prototype.constructor=o;var r=o.setup.apply(o,f([g],arguments));return o.init&&o.init.apply(o,r||[]),o}}),i.prototype.callback=i.callback}(jQuery),LowPro={},LowPro.Version="0.5",LowPro.CompatibleWithPrototype="1.6",Prototype.Version.indexOf(LowPro.CompatibleWithPrototype)!=0&&window.console&&window.console.warn&&console.warn("This version of Low Pro is tested with Prototype "+LowPro.CompatibleWithPrototype+" it may not work as expected with this version ("+Prototype.Version+")"),Element.addMethods||(Element.addMethods=function(a){Object.extend(Element.Methods,a)}),DOM={},DOM.Builder={tagFunc:function(a){return function(){var b,c;return arguments.length>0&&(arguments[0].constructor==Object?(b=arguments[0],c=Array.prototype.slice.call(arguments,1)):c=arguments,c=$A(c).flatten()),DOM.Builder.create(a,b,c)}},create:function(a,b,c){b=b||{},c=c||[],a=a.toLowerCase();var d=new Element(a,b);for(var e=0;e<c.length;e++)typeof c[e]=="string"&&(c[e]=document.createTextNode(c[e])),d.appendChild(c[e]);return $(d)}},function(){var a="p|div|span|strong|em|img|table|tr|td|th|thead|tbody|tfoot|pre|code|h1|h2|h3|h4|h5|h6|ul|ol|li|form|input|textarea|legend|fieldset|select|option|blockquote|cite|br|hr|dd|dl|dt|address|a|button|abbr|acronym|script|link|style|bdo|ins|del|object|param|col|colgroup|optgroup|caption|label|dfn|kbd|samp|var".split("|"),b,c=0;while(b=a[c++])window["$"+b]=DOM.Builder.tagFunc(b)}(),DOM.Builder.fromHTML=function(a){var b;return(b=arguments.callee._root)||(b=arguments.callee._root=document.createElement("div")),b.innerHTML=a,b.childNodes[0]},Object.extend(Event,{onReady:function(a){document.body?a():document.observe("dom:loaded",a)}}),Event.addBehavior=function(a){var b=this.addBehavior;Object.extend(b.rules,a),b.responderApplied||(Ajax.Responders.register({onComplete:function(){Event.addBehavior.reassignAfterAjax&&setTimeout(function(){b.reload()},10)}}),b.responderApplied=!0),b.autoTrigger&&this.onReady(b.load.bind(b,a))},Event.delegate=function(a){return function(b){for(var c in a)if(b.findElement(c))return a[c].apply(this,$A(arguments))}},Object.extend(Event.addBehavior,{rules:{},cache:[],reassignAfterAjax:!1,autoTrigger:!0,load:function(a){for(var b in a){var c=a[b],d=b.split(",");d.each(function(a){var b=a.split(/:(?=[a-z]+$)/),d=b[0],e=b[1];$$(d).each(function(a){if(e){var b=Event.addBehavior._wrapObserver(c);$(a).observe(e,b),Event.addBehavior.cache.push([a,e,b])}else if(!a.$$assigned||!a.$$assigned.include(c))c.attach?c.attach(a):c.call($(a)),a.$$assigned=a.$$assigned||[],a.$$assigned.push(c)})})}},unload:function(){this.cache.each(function(a){Event.stopObserving.apply(Event,a)}),this.cache=[]},reload:function(){var a=Event.addBehavior;a.unload(),a.load(a.rules)},_wrapObserver:function(a){return function(b){a.call(this,b)===!1&&b.stop()}}}),Event.observe(window,"unload",Event.addBehavior.unload.bind(Event.addBehavior)),$$$=Event.addBehavior.bind(Event);var Behavior={create:function(){var a=null,b=$A(arguments);Object.isFunction(b[0])&&(a=b.shift());var c=function(){if(!this.initialize){var a=$A(arguments);return function(){var b=[this].concat(a);c.attach.apply(c,b)}}var a=arguments.length==2&&arguments[1]instanceof Array?arguments[1]:Array.prototype.slice.call(arguments,1);this.element=$(arguments[0]),this.initialize.apply(this,a),c._bindEvents(this),c.instances.push(this)};Object.extend(c,Class.Methods),Object.extend(c,Behavior.Methods),c.superclass=a,c.subclasses=[],c.instances=[];if(a){var d=function(){};d.prototype=a.prototype,c.prototype=new d,a.subclasses.push(c)}for(var e=0;e<b.length;e++)c.addMethods(b[e]);return c.prototype.initialize||(c.prototype.initialize=Prototype.emptyFunction),c.prototype.constructor=c,c},Methods:{attach:function(a){return new this(a,Array.prototype.slice.call(arguments,1))},_bindEvents:function(a){for(var b in a){var c=b.match(/^on(.+)/);c&&typeof a[b]=="function"&&a.element.observe(c[1],Event.addBehavior._wrapObserver(a[b].bindAsEventListener(a)))}}}};Remote=Behavior.create({initialize:function(a){this.element.nodeName=="FORM"?new Remote.Form(this.element,a):new Remote.Link(this.element,a)}}),Remote.Base={initialize:function(a){this.options=Object.extend({evaluateScripts:!0},a||{}),this._bindCallbacks()},_makeRequest:function(a){return a.update?new Ajax.Updater(a.update,a.url,a):new Ajax.Request(a.url,a),!1},_bindCallbacks:function(){$w("onCreate onComplete onException onFailure onInteractive onLoading onLoaded onSuccess").each(function(a){Object.isFunction(this.options[a])&&(this.options[a]=this.options[a].bind(this))}.bind(this))}},Remote.Link=Behavior.create(Remote.Base,{onclick:function(){var a=Object.extend({url:this.element.href,method:"get"},this.options);return this._makeRequest(a)}}),Remote.Form=Behavior.create(Remote.Base,{onclick:function(a){var b=a.element();["input","button"].include(b.nodeName.toLowerCase())&&["submit","image"].include(b.type)&&(this._submitButton=b)},onsubmit:function(){var a=Object.extend({url:this.element.action,method:this.element.method||"get",parameters:this.element.serialize({submit:this._submitButton.name})},this.options);return this._submitButton=null,this._makeRequest(a)}}),Observed=Behavior.create({initialize:function(a,b){this.callback=a.bind(this),this.options=b||{},this.observer=this.element.nodeName=="FORM"?this._observeForm():this._observeField()},stop:function(){this.observer.stop()},_observeForm:function(){return this.options.frequency?new Form.Observer(this.element,this.options.frequency,this.callback):new Form.EventObserver(this.element,this.callback)},_observeField:function(){return this.options.frequency?new Form.Element.Observer(this.element,this.options.frequency,this.callback):new Form.Element.EventObserver(this.element,this.callback)}}),Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction,this.transport.abort(),Ajax.activeRequestCount--},typeof console=="undefined"&&(console={log:function(){}});var PChangedEvent=Class.create({initialize:function(a,b){this.changedObject=a,this.attribute=null,this.type="change",Object.extend(this,b)}}),PBaseModel=Class.create({initialize:function(a){this.changeListeners=new Array,this.destroyed=!1,Object.extend(this,a),this.attribute_names=new Array,$H(a).each(function(a){this.attribute_names.push(a.key)}.bind(this))},getModelName:function(){return"PBaseModel"},serializeAttr:function(a,b){return b.get(a)},serialize:function(){var a=$H(this),b=new Hash;return this.attribute_names.each(function(c){b.set(c,this.serializeAttr(c,a))}.bind(this)),b},destroy:function(){trace("destroy called!"),this.destroyed=!0,this.fireChange({type:"destroy"})},addChangeListener:function(a){this.changeListeners.push(a)},removeChangeListener:function(a){this.changeListeners=this.changeListeners.without(a)},fireChange:function(a){var b=new PChangedEvent(this,a);this.changeListeners.each(function(a){a(b)})},getId:function(){return this.id}});document.observe("dom:loaded",function(){$("feedback_anchor")&&new PModal("feedback_anchor","/main/feedback",{},{}),$$(".CodeRay").each(function(a){a.observe("click",function(b){a.toggleClassName("hide_numbers")})})});var PModal=Class.create({initialize:function(a,b,c,d){this.options=Object.extend({opacity:.5,position:"absolute",width:500,height:570,identifier:null,modalTitle:null,padContents:!0,onComplete:function(){},onSuccess:function(){},onFailure:function(){}},d||{}),this.options.beforeOpen=this.openHandler.bindAsEventListener(this),this.options.beforeClose=this.closeHandler.bindAsEventListener(this),this.action_id=$(a),this.identifier=this.action_id?this.action_id.getAttribute("id"):this.options.identifier,this.target_callback=b,this.parameters=c||{},this.action_id&&this.action_id.observe("click",this.click.bindAsEventListener(this)),this.action_id&&this.action_id.getAttribute("href")&&this.action_id.setAttribute("href","#")},openHandler:function(){$$("object, embed").each(function(a){a.hide()})},closeHandler:function(){$$("object, embed").each(function(a){a.show()})},click:function(a){a&&a.stop(),this.modal=Control.Modal.open('<div id="modal_'+this.identifier+'" style="padding: 5px;"><img src="/images/loading.gif"></div>',this.options),this.modalDiv=$("modal_"+this.identifier),new Ajax.Request(this.target_callback,{method:"get",parameters:this.parameters,onSuccess:function(a){var b=a.responseText||"Something went wrong. Email us at <a href='mailto:help@posterous.com'>help@posterous.com.</a>";this.response=b,this.modalDiv.update(this.response),this.modalDiv.select(".close_modal_button").each(function(a){a.observe("click",function(a){Event.stop(a),Control.Modal.close()})}),this.options.onSuccess()}.bindAsEventListener(this),onFailure:function(){this.options.onFailure(),alert("Something went wrong. Email us at help@posterous.com and we'll get back to you ASAP.")}.bindAsEventListener(this)})},getContainerNode:function(){return $("modal_"+this.identifier)},finishLazyLoad:function(){this.modalDiv.update(this.response)}});PModal2=Class.create(PModal,{click:function(a){a&&a.stop(),PModal2.currentModal=this,this.modal=Control.Modal.open('<div id="modal_'+this.identifier+'"></div>',this.options);var b=this.assembleModal(),c=this.getContainerNode();c.appendChild(b),this.modalDiv=c.down(".main_area"),this.modalDiv.update('<img src="/images/loading.gif" width="16" height="16" />'),this.options.modalTitle&&c.down(".modal_title").update(this.options.modalTitle),new Ajax.Request(this.target_callback,{method:"get",parameters:this.parameters,onComplete:function(a){Event.addBehavior.reload(),FB&&FB.XFBML&&FB.XFBML.parse(),this.options.onComplete()}.bindAsEventListener(this),onSuccess:function(a){var b=a.responseText||"Something went wrong. Email us at <a href='mailto:help@posterous.com'>help@posterous.com.</a>";this.response=b,this.modalDiv.update(this.response),this.modalDiv.select(".close_modal_button").each(function(a){a.observe("click",function(a){Event.stop(a),Control.Modal.close()})}),this.options.padContents||this.modalDiv.removeClassName("padded_content"),this.options.onSuccess()}.bindAsEventListener(this),onFailure:function(){this.options.onFailure(),alert("Something went wrong. Email us at help@posterous.com and we'll get back to you ASAP.")}.bindAsEventListener(this)})},assembleModal:function(){return $div({"class":"posterous_modal_skeleton1"},$div({"class":"header"},$h3({"class":"modal_title"})),$div({"class":"sidebar"}),$div({"class":"main_area padded_content"}),$div({"class":"commands"},$div({"class":"right"},$div({"class":"ok_cmd button",onclick:"Control.Modal.close(); return false;"}))))}}),document.observe("dom:loaded",function(){$("feedback_anchor")&&new PModal("feedback_anchor","/main/feedback",{},{}),$$(".CodeRay").each(function(a){a.observe("click",function(b){a.toggleClassName("hide_numbers")})}),$$(".slide-out").each(function(a){a.select(".slide-out-toggler").each(function(b){b.observe("click",function(){a.toggleClassName("slide-out-opened")})})})});var PREFILL_CLASSNAME="prefilled";typeof Control=="undefined"&&(Control={}),Control.Modal=Class.create(),Object.extend(Control.Modal,{loaded:!1,loading:!1,loadingTimeout:!1,overlay:!1,container:!1,current:!1,ie:!1,effects:{containerFade:!1,containerAppear:!1,overlayFade:!1,overlayAppear:!1},targetRegexp:/#(.+)$/,imgRegexp:/\.(jpe?g|gif|png|tiff?)($|\?.+)/i,overlayStyles:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:9998},overlayIEStyles:{position:"absolute",top:0,left:0,zIndex:9998},disableHoverClose:!1,load:function(){if(!Control.Modal.loaded){Control.Modal.loaded=!0,Control.Modal.ie=typeof document.body.style.maxHeight=="undefined",Control.Modal.overlay=$(document.createElement("div")),Control.Modal.overlay.id="modal_overlay",Object.extend(Control.Modal.overlay.style,Control.Modal["overlay"+(Control.Modal.ie?"IE":"")+"Styles"]),Control.Modal.overlay.hide(),Control.Modal.container_holder=$(document.createElement("div")),Control.Modal.container_holder.id="modal_container_holder",Control.Modal.container=$(document.createElement("div")),Control.Modal.container.id="modal_container",Control.Modal.container_holder.hide(),Control.Modal.loading=$(document.createElement("div")),Control.Modal.loading.id="modal_loading",Control.Modal.loading.hide();var a=document.getElementsByTagName("body")[0];a.appendChild(Control.Modal.overlay),Control.Modal.container_holder.appendChild(Control.Modal.container),a.appendChild(Control.Modal.container_holder),a.appendChild(Control.Modal.loading),Control.Modal.container_holder.observe("mouseout",function(a){!Control.Modal.disableHoverClose&&Control.Modal.current&&Control.Modal.current.options.hover&&!Position.within(Control.Modal.container_holder,Event.pointerX(a),Event.pointerY(a))&&Control.Modal.close()})}},open:function(a,b){b=b||{},b.contents||(b.contents=a);var c=new Control.Modal(!1,b);return c.open(),c},close:function(a){typeof a!="boolean"&&(a=!1),Control.Modal.current&&Control.Modal.current.close(a)},attachEvents:function(){Event.observe(window,"load",Control.Modal.load)},center:function(a){a._absolutized||(a.setStyle({position:"absolute"}),a._absolutized=!0);var b=a.getDimensions();if(b.width==0||b.height==0)b=Control.Modal.recursiveGetDimensions(a);Position.prepare();var c=Position.deltaX+Math.floor((Control.Modal.getWindowWidth()-b.width)/2),d=Position.deltaY+(Control.Modal.getWindowHeight()>b.height?Math.floor((Control.Modal.getWindowHeight()-b.height)/2):0),e=a.cumulativeScrollOffset(),f=e[0],g=e[1];a.down(1)!=undefined&&a.down(1).hasClassName("subscription_form")?a.setStyle({margin:(g!=null&&g>0?g:"0")+"px "+"0px "+"0px "+"0px ",left:b.width<=Control.Modal.getWindowWidth()?(c!=null&&c>0?c:"0")+"px":0}):a.setStyle({top:(d!=null&&d>0?d:"0")+"px",left:b.width<=Control.Modal.getWindowWidth()?(c!=null&&c>0?c:"0")+"px":0})},recursiveGetDimensions:function(a){var b=a.select("*");return{width:b.clone().map(function(a){return a.getWidth()}).max(),height:b.clone().map(function(a){return a.getHeight()}).max()}},getWindowWidth:function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0},getWindowHeight:function(){return self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0},getDocumentWidth:function(){return Math.min(document.body.scrollWidth,Control.Modal.getWindowWidth())},getDocumentHeight:function(){return Math.max(document.body.scrollHeight,Control.Modal.getWindowHeight())},onKeyDown:function(a){a.keyCode==Event.KEY_ESC&&Control.Modal.close()}}),Object.extend(Control.Modal.prototype,{mode:"",html:!1,href:"",element:!1,src:!1,imageLoaded:!1,ajaxRequest:!1,initialize:function(a,b){this.element=$(a),this.options={beforeOpen:Prototype.emptyFunction,afterOpen:Prototype.emptyFunction,beforeClose:Prototype.emptyFunction,afterClose:Prototype.emptyFunction,onSuccess:Prototype.emptyFunction,onFailure:Prototype.emptyFunction,onException:Prototype.emptyFunction,beforeImageLoad:Prototype.emptyFunction,afterImageLoad:Prototype.emptyFunction,autoOpenIfLinked:!0,contents:!1,loading:!1,fade:!1,fadeDuration:.75,image:!1,target:!1,imageCloseOnClick:!0,hover:!1,iframe:!1,iframeTemplate:new Template('<iframe src="#{href}" width="100%" height="100%" frameborder="0" id="#{id}"></iframe>'),evalScripts:!0,requestOptions:{},overlayDisplay:!0,overlayClassName:"",overlayCloseOnClick:!0,containerClassName:"",opacity:.3,zIndex:9998,width:null,height:null,offsetLeft:0,offsetTop:0,position:"absolute",borderRadius:10,padding:0},Object.extend(this.options,b||{});var c=!1,d=!1;this.element&&(c=Control.Modal.targetRegexp.exec(this.element.href),d=Control.Modal.imgRegexp.exec(this.element.href)),this.options.position=="mouse"&&(this.options.hover=!0);if(this.options.contents)this.mode="contents";else if(this.options.image||d)this.mode="image",this.src=this.element.href;else if(this.options.target||c){this.mode="named";var e=this.options.target||c[1],f=$(e);this.html=f.innerHTML,f.remove(),this.href=e}else this.mode=this.options.iframe?"iframe":"ajax",this.href=this.element.href;this.element&&(this.options.hover?(this.element.observe("mouseover",this.open.bind(this)),this.element.observe("mouseout",function(a){Position.within(Control.Modal.container_holder,Event.pointerX(a),Event.pointerY(a))||this.close()}.bindAsEventListener(this))):this.element.onclick=function(a){return this.open(),Event.stop(a),!1}.bindAsEventListener(this));var g=Control.Modal.targetRegexp.exec(window.location);this.position=function(a){if(this.options.position=="absolute")Control.Modal.center(Control.Modal.container_holder);else{var b=a&&this.options.position=="mouse"?[Event.pointerX(a),Event.pointerY(a)]:Position.cumulativeOffset(this.element);Control.Modal.container_holder.setStyle({position:"absolute",top:b[1]+(typeof this.options.offsetTop=="function"?this.options.offsetTop():this.options.offsetTop)+"px",left:b[0]+(typeof this.options.offsetLeft=="function"?this.options.offsetLeft():this.options.offsetLeft)+"px"})}Control.Modal.ie&&Control.Modal.overlay.setStyle({height:Control.Modal.getDocumentHeight()+"px",width:Control.Modal.getDocumentWidth()+"px"})}.bind(this),this.mode=="named"&&this.options.autoOpenIfLinked&&g&&g[1]&&g[1]==this.href&&this.open()},showLoadingIndicator:function(){this.options.loading&&(Control.Modal.loadingTimeout=window.setTimeout(function(){var a=$("modal_image");a&&a.hide(),Control.Modal.loading.style.zIndex=this.options.zIndex+1,Control.Modal.loading.update('<img id="modal_loading" src="'+this.options.loading+'"/>'),Control.Modal.loading.show(),Control.Modal.center(Control.Modal.loading)}.bind(this),250))},hideLoadingIndicator:function(){if(this.options.loading){Control.Modal.loadingTimeout&&window.clearTimeout(Control.Modal.loadingTimeout);var a=$("modal_image");a&&a.show(),Control.Modal.loading.hide()}},open:function(a){if(!a&&this.notify("beforeOpen")===!1)return;Control.Modal.loaded||Control.Modal.load(),Control.Modal.close(),this.options.hover||Event.observe($(document.getElementsByTagName("body")[0]),"keydown",Control.Modal.onKeyDown),Control.Modal.current=this,this.options.hover||Control.Modal.overlay.setStyle({zIndex:this.options.zIndex,opacity:this.options.opacity});var b=this.options.borderRadius+"px";Control.Modal.container.setStyle({zIndex:this.options.zIndex+2,position:"absolute",backgroundColor:"#fff",top:b,left:b,right:b,bottom:b}),Control.Modal.container_holder.setStyle({zIndex:this.options.zIndex+1,padding:this.options.padding+"px",backgroundColor:Prototype.Browser.IE?"#999999":"rgba(44, 44, 44, 0.4)",width:this.options.width?(typeof this.options.width=="function"?this.options.width():this.options.width)+this.options.borderRadius*2+this.options.padding+"px":null,height:this.options.height?(typeof this.options.height=="function"?this.options.height():this.options.height)+this.options.borderRadius*2+this.options.padding+"px":null}),Control.Modal.ie&&!this.options.hover&&$A(document.getElementsByTagName("select")).each(function(a){a.style.visibility="hidden"}),Control.Modal.overlay.addClassName(this.options.overlayClassName),Control.Modal.container.addClassName(this.options.containerClassName);switch(this.mode){case"image":this.imageLoaded=!1,this.notify("beforeImageLoad"),this.showLoadingIndicator();var c=document.createElement("img");c.onload=function(a){this.hideLoadingIndicator(),this.update([a]),this.options.imageCloseOnClick&&$(a).observe("click",Control.Modal.close),this.position(),this.notify("afterImageLoad"),a.onload=null}.bind(this,c),c.src=this.src,c.id="modal_image";break;case"ajax":this.notify("beforeLoad");var d={method:"post",onSuccess:function(a){this.hideLoadingIndicator(),this.update(a.responseText),this.notify("onSuccess",a),this.ajaxRequest=!1}.bind(this),onFailure:function(){this.notify("onFailure")}.bind(this),onException:function(){this.notify("onException")}.bind(this)};Object.extend(d,this.options.requestOptions),this.showLoadingIndicator(),this.ajaxRequest=new Ajax.Request(this.href,d);break;case"iframe":this.update(this.options.iframeTemplate.evaluate({href:this.href,id:"modal_iframe"}));break;case"contents":this.update(typeof this.options.contents=="function"?this.options.contents():this.options.contents);break;case"named":this.update(this.html)}this.options.hover||(this.options.overlayCloseOnClick&&this.options.overlayDisplay&&Control.Modal.overlay.observe("click",Control.Modal.close),this.options.overlayDisplay&&(this.options.fade?(Control.Modal.effects.overlayFade&&Control.Modal.effects.overlayFade.cancel(),Control.Modal.effects.overlayAppear=new Effect.Appear(Control.Modal.overlay,{queue:{position:"front",scope:"Control.Modal"},to:this.options.opacity,duration:this.options.fadeDuration/2})):Control.Modal.overlay.show())),this.options.position=="mouse"&&(this.mouseHoverListener=this.position.bindAsEventListener(this),this.element.observe("mousemove",this.mouseHoverListener)),this.notify("afterOpen")},update:function(a){typeof a=="string"?Control.Modal.container.update(a):(Control.Modal.container.update(""),a.each?a.each(function(a){Control.Modal.container.appendChild(a)}):Control.Modal.container.appendChild(a)),this.options.fade?(Control.Modal.effects.containerFade&&Control.Modal.effects.containerFade.cancel(),Control.Modal.effects.containerAppear=new Effect.Appear(Control.Modal.container_holder,{queue:{position:"end",scope:"Control.Modal"},to:1,duration:this.options.fadeDuration/2})):Control.Modal.container_holder.show(),this.position(),Event.observe(window,"resize",this.position,!1)},close:function(a){if(!a&&this.notify("beforeClose")===!1)return;this.ajaxRequest&&this.ajaxRequest.transport.abort(),this.hideLoadingIndicator();if(this.mode=="image"){var b=$("modal_image");this.options.imageCloseOnClick&&b&&b.stopObserving("click",Control.Modal.close)}Control.Modal.ie&&!this.options.hover&&$A(document.getElementsByTagName("select")).each(function(a){a.style.visibility="visible"}),this.options.hover||Event.stopObserving(window,"keyup",Control.Modal.onKeyDown),Control.Modal.current=!1,Event.stopObserving(window,"resize",this.position,!1),Event.stopObserving(window,"scroll",this.position,!1),this.options.hover||(this.options.overlayCloseOnClick&&this.options.overlayDisplay&&Control.Modal.overlay.stopObserving("click",Control.Modal.close),this.options.overlayDisplay&&(this.options.fade?(Control.Modal.effects.overlayAppear&&Control.Modal.effects.overlayAppear.cancel(),Control.Modal.effects.overlayFade=new Effect.Fade(Control.Modal.overlay,{queue:{position:"end",scope:"Control.Modal"},from:this.options.opacity,to:0,duration:this.options.fadeDuration/2})):Control.Modal.overlay.hide())),this.options.fade?(Control.Modal.effects.containerAppear&&Control.Modal.effects.containerAppear.cancel(),Control.Modal.effects.containerFade=new Effect.Fade(Control.Modal.container,{queue:{position:"front",scope:"Control.Modal"},from:1,to:0,duration:this.options.fadeDuration/2,afterFinish:function(){Control.Modal.container.update(""),this.resetClassNameAndStyles()}.bind(this)})):(Control.Modal.container_holder.hide(),Control.Modal.container.update(""),this.resetClassNameAndStyles()),this.options.position=="mouse"&&this.element.stopObserving("mousemove",this.mouseHoverListener),this.notify("afterClose")},resetClassNameAndStyles:function(){Control.Modal.overlay.removeClassName(this.options.overlayClassName),Control.Modal.container_holder.removeClassName(this.options.containerClassName),Control.Modal.container_holder.setStyle({height:null,width:null,top:null,left:null})},notify:function(a){try{if(this.options[a])return[this.options[a].apply(this.options[a],$A(arguments).slice(1))]}catch(b){if(b!=$break)throw b;return!1}}}),typeof Object.Event!="undefined"&&Object.Event.extend(Control.Modal),Control.Modal.attachEvents(),Object.extend(Control.Modal,{dynamicResize:function(a,b,c){b||(b="control_modal_resize"),c||(c="front"),new_height=a.height,new_width=a.width,win_height=this.getWindowHeight(),win_width=this.getWindowWidth(),new_left=Math.floor((win_width-new_width)/2),new_top=Math.floor((win_height-new_height)/2),new Effect.Morph(this.container_holder.id,{style:{height:new_height+"px",width:new_width+"px",left:new_left+"px",top:new_top+"px"},duration:.2,scope:b,queue:c})},hideInternalElement:function(a,b){modal_height=$("modal_container_holder").getHeight(),elem_height=this.getElemHeight(a),b?b(a,{queue:"front",scope:"control_modal_resize",duration:.4}):a.hide(),this.waitForResize(function(){this.dynamicResize({height:modal_height-elem_height},"control_modal_resize","end")}.bind(this))},showInternalElement:function(a,b){modal_height=$("modal_container_holder").getHeight(),elem_height=this.getElemHeight(a),a.setStyle({display:"none"}),this.dynamicResize({height:modal_height+elem_height},"control_modal_resize","front"),this.waitForResize(function(){b?b(a,{queue:"end",scope:"control_modal_resize",duration:.2}):a.show()}.bind(this))},getElemHeight:function(a){return elem_height=a.getHeight(),elem_margins=parseInt(a.getStyle("margin-top"),"decimal")+parseInt(a.getStyle("margin-bottom"),"decimal"),elem_height+elem_margins},waitForResize:function(a){new PeriodicalExecuter(function(b){Effect.Queues.get("control_modal_resize").effects.length==0&&(b.stop(),a())},.2)},swapElems:function(a,b){typeof a=="string"?elem_hide=$(a):elem_hide=a,typeof b=="string"?elem_show=$(b):elem_show=b,height_add=this.getElemHeight(elem_show),height_sub=this.getElemHeight(elem_hide),delta=height_add-height_sub,modal_height=$("modal_container_holder").getHeight(),delta>0?(this.dynamicResize({height:modal_height+delta}),this.waitForResize(function(){Effect.SlideUp(elem_hide,{queue:"front",scope:"control_modal_resize",duration:.4}),Effect.SlideDown(elem_show,{queue:"end",scope:"control_modal_resize",duration:.4})})):(Effect.Fade(elem_hide,{queue:"front",scope:"control_modal_resize"}),Effect.Appear(elem_show,{queue:"front",scope:"control_modal_resize"}),this.waitForResize(function(){this.dynamicResize({height:modal_height+delta})}.bind(this)))},visible:function(){return this.container_holder?this.container_holder.visible():!1}});if(Object.isUndefined(Proto))var Proto={};Proto.Menu=Class.create({initialize:function(){var a=Prototype.emptyFunction;this.ie=Prototype.Browser.IE,this.options=Object.extend({selector:".contextmenu",className:"protoMenu",pageOffset:25,fade:!1,zIndex:100,beforeShow:a,beforeHide:a,beforeSelect:a,position:"mouse_click",location:null,click:"right",width:null,menuAlign:"left"},arguments[0]||{}),this.shim=new Element("iframe",{style:"position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none",src:"javascript:false;",frameborder:0}),this.options.fade=this.options.fade&&!Object.isUndefined(Effect),this.container=new Element("div",{className:this.options.className,style:"display:none"}),this.options.width!=null&&this.container.setStyle({width:this.options.width+"px"});var b=new Element("ul");this.options.menuItems.each(function(a){var c="";a.separator||(c=Object.extend(new Element("a",{href:!a.href||a.method=="post"||a.method=="put"||a.method=="delete"?"#":a.href,title:a.name,className:(a.className||"")+(a.disabled?" disabled":" enabled")}),{_method:a.method,_params:a.params,_confirm:a.confirm,_href:a.href,_callback:a.callback}),c.observe("click",this.onClick.bind(this)),c.observe("contextmenu",Event.stop),c.update(a.name),a.icon&&c.setStyle({backgroundImage:"url("+a.icon+")",backgroundPosition:"8px 50%",backgroundRepeat:"no-repeat"})),b.insert((new Element("li",{className:a.separator?"separator":""})).insert(c))}.bind(this)),$(document.body).insert(this.container.insert(b).observe("contextmenu",Event.stop)),this.ie&&$(document.body).insert(this.shim),this.options.click=="right"?(document.observe("click",function(a){this.container.visible()&&!a.isRightClick()&&(this.options.beforeHide(a),this.ie&&this.shim.hide(),this.container.hide())}.bind(this)),$$(this.options.selector).invoke("observe",Prototype.Browser.Opera?"click":"contextmenu",function(a){if(Prototype.Browser.Opera&&!a.ctrlKey)return;this.show(a)}.bind(this))):(document.observe("click",function(a){this.container.visible()&&(this.options.beforeHide(a),this.ie&&this.shim.hide(),this.container.hide())}.bind(this)),$$(this.options.selector).invoke("observe","click",function(a){this.container.visible()?this.container.hide():this.show(a),a.stop()}.bind(this)))},is_form_post:function(a){return},show:function(a){a.stop(),this.options.beforeShow(a);var b=Event.pointer(a).x,c=Event.pointer(a).y,d=this.container.getDimensions();if(this.options.position=="relative"){var e=this.options.location.cumulativeOffset();this.options.menuAlign=="left"?(b=e[0],c=e[1]+this.options.location.getHeight()-2):(b=e[0]+this.options.location.getWidth()-d.width,c=e[1]+this.options.location.getHeight()-2)}var f=document.viewport.getDimensions(),g=document.viewport.getScrollOffsets(),h={left:(b+d.width+this.options.pageOffset>f.width?f.width-d.width-this.options.pageOffset:b)+"px",top:(c-g.top+d.height>f.height&&c-g.top>d.height?c-d.height:c)+"px"};this.container.setStyle(h).setStyle({zIndex:this.options.zIndex}),this.ie&&
this.shim.setStyle(Object.extend(Object.extend(d,h),{zIndex:this.options.zIndex-1})).show(),this.options.fade?Effect.Appear(this.container,{duration:.25}):this.container.show(),this.event=a},onClick:function(a){var b=!1;if(a.target._href&&(!a.target._method||a.target._method=="get"))return!0;if(a.target._method=="delete"){if(confirm("Are you sure?")){var c=document.createElement("form");c.style.display="none",a.target.appendChild(c),c.method="POST",c.action=a.target._href;var d=document.createElement("input");return d.setAttribute("type","hidden"),d.setAttribute("name","_method"),d.setAttribute("value","delete"),c.appendChild(d),d=document.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name","authenticity_token"),d.setAttribute("value",window._token),c.appendChild(d),$H(a.target._params).each(function(a){d=document.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name",a.key),d.setAttribute("value",a.value),c.appendChild(d)}),c.submit(),a.stop(),!1}b=!0}return a.stop(),(b||a.target._callback)&&!a.target.hasClassName("disabled")&&(this.options.beforeSelect(a),this.ie&&this.shim.hide(),this.container.hide(),a.target._callback(this.event)),!0}}),String.prototype.parseColor=function(){var a="#";if(this.slice(0,4)=="rgb("){var b=this.slice(4,this.length-1).split(","),c=0;do a+=parseInt(b[c]).toColorPart();while(++c<3)}else if(this.slice(0,1)=="#"){if(this.length==4)for(var c=1;c<4;c++)a+=(this.charAt(c)+this.charAt(c)).toLowerCase();this.length==7&&(a=this.toLowerCase())}return a.length==7?a:arguments[0]||this},Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(a){return a.nodeType==3?a.nodeValue:a.hasChildNodes()?Element.collectTextNodes(a):""}).flatten().join("")},Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(a){return a.nodeType==3?a.nodeValue:a.hasChildNodes()&&!Element.hasClassName(a,b)?Element.collectTextNodesIgnoreClass(a,b):""}).flatten().join("")},Element.setContentZoom=function(a,b){return a=$(a),a.setStyle({fontSize:b/100+"em"}),Prototype.Browser.WebKit&&window.scrollBy(0,0),a},Element.getInlineOpacity=function(a){return $(a).style.opacity||""},Element.forceRerendering=function(a){try{a=$(a);var b=document.createTextNode(" ");a.appendChild(b),a.removeChild(b)}catch(c){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return-Math.cos(a*Math.PI)/2+.5},reverse:function(a){return 1-a},flicker:function(a){var a=-Math.cos(a*Math.PI)/4+.75+Math.random()/4;return a>1?1:a},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+.5},pulse:function(a,b){return-Math.cos(a*((b||5)-.5)*2*Math.PI)/2+.5},spring:function(a){return 1-Math.cos(a*4.5*Math.PI)*Math.exp(-a*6)},none:function(a){return 0},full:function(a){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";Prototype.Browser.IE&&(b+=";zoom:1"),a=$(a),$A(a.childNodes).each(function(c){c.nodeType==3&&(c.nodeValue.toArray().each(function(d){a.insertBefore((new Element("span",{style:b})).update(d==" "?String.fromCharCode(160):d),c)}),Element.remove(c))})},multiple:function(a,b){var c;(typeof a=="object"||Object.isFunction(a))&&a.length?c=a:c=$(a).childNodes;var d=Object.extend({speed:.1,delay:0},arguments[2]||{}),e=d.delay;$A(c).each(function(a,c){new b(a,Object.extend(d,{delay:c*d.speed+e}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(a,b){a=$(a),b=(b||"appear").toLowerCase();var c=Object.extend({queue:{position:"end",scope:a.id||"global",limit:1}},arguments[2]||{});Effect[a.visible()?Effect.PAIRS[b][1]:Effect.PAIRS[b][0]](a,c)}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal,Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[],this.interval=null},_each:function(a){this.effects._each(a)},add:function(a){var b=(new Date).getTime(),c=Object.isString(a.options.queue)?a.options.queue:a.options.queue.position;switch(c){case"front":this.effects.findAll(function(a){return a.state=="idle"}).each(function(b){b.startOn+=a.finishOn,b.finishOn+=a.finishOn});break;case"with-last":b=this.effects.pluck("startOn").max()||b;break;case"end":b=this.effects.pluck("finishOn").max()||b}a.startOn+=b,a.finishOn+=b,(!a.options.queue.limit||this.effects.length<a.options.queue.limit)&&this.effects.push(a),this.interval||(this.interval=setInterval(this.loop.bind(this),15))},remove:function(a){this.effects=this.effects.reject(function(b){return b==a}),this.effects.length==0&&(clearInterval(this.interval),this.interval=null)},loop:function(){var a=(new Date).getTime();for(var b=0,c=this.effects.length;b<c;b++)this.effects[b]&&this.effects[b].loop(a)}}),Effect.Queues={instances:$H(),get:function(a){return Object.isString(a)?this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue):a}},Effect.Queue=Effect.Queues.get("global"),Effect.Base=Class.create({position:null,start:function(a){function b(a,b){return(a[b+"Internal"]?"this.options."+b+"Internal(this);":"")+(a[b]?"this.options."+b+"(this);":"")}a&&a.transition===!1&&(a.transition=Effect.Transitions.linear),this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{}),this.currentFrame=0,this.state="idle",this.startOn=this.options.delay*1e3,this.finishOn=this.startOn+this.options.duration*1e3,this.fromToDelta=this.options.to-this.options.from,this.totalTime=this.finishOn-this.startOn,this.totalFrames=this.options.fps*this.options.duration,this.render=function(){function a(a,b){a.options[b+"Internal"]&&a.options[b+"Internal"](a),a.options[b]&&a.options[b](a)}return function(b){this.state==="idle"&&(this.state="running",a(this,"beforeSetup"),this.setup&&this.setup(),a(this,"afterSetup")),this.state==="running"&&(b=this.options.transition(b)*this.fromToDelta+this.options.from,this.position=b,a(this,"beforeUpdate"),this.update&&this.update(b),a(this,"afterUpdate"))}}(),this.event("beforeStart"),this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},loop:function(a){if(a>=this.startOn){if(a>=this.finishOn){this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),this.event("afterFinish");return}var b=(a-this.startOn)/this.totalTime,c=(b*this.totalFrames).round();c>this.currentFrame&&(this.render(b),this.currentFrame=c)}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this),this.state="finished"},event:function(a){this.options[a+"Internal"]&&this.options[a+"Internal"](this),this.options[a]&&this.options[a](this)},inspect:function(){var a=$H();for(property in this)Object.isFunction(this[property])||a.set(property,this[property]);return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}}),Effect.Parallel=Class.create(Effect.Base,{initialize:function(a){this.effects=a||[],this.start(arguments[1])},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1),b.cancel(),b.event("beforeFinish"),b.finish&&b.finish(a),b.event("afterFinish")})}}),Effect.Tween=Class.create(Effect.Base,{initialize:function(a,b,c){a=Object.isString(a)?$(a):a;var d=$A(arguments),e=d.last(),f=d.length==5?d[3]:null;this.method=Object.isFunction(e)?e.bind(a):Object.isFunction(a[e])?a[e].bind(a):function(b){a[e]=b},this.start(Object.extend({from:b,to:c},f||{}))},update:function(a){this.method(a)}}),Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction}),Effect.Opacity=Class.create(Effect.Base,{initialize:function(a){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});var b=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(b)},update:function(a){this.element.setOpacity(a)}}),Effect.Move=Class.create(Effect.Base,{initialize:function(a){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var b=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(b)},setup:function(){this.element.makePositioned(),this.originalLeft=parseFloat(this.element.getStyle("left")||"0"),this.originalTop=parseFloat(this.element.getStyle("top")||"0"),this.options.mode=="absolute"&&(this.options.x=this.options.x-this.originalLeft,this.options.y=this.options.y-this.originalTop)},update:function(a){this.element.setStyle({left:(this.options.x*a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}}),Effect.MoveBy=function(a,b,c){return new Effect.Move(a,Object.extend({x:c,y:b},arguments[3]||{}))},Effect.Scale=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({scaleX:!0,scaleY:!0,scaleContent:!0,scaleFromCenter:!1,scaleMode:"box",scaleFrom:100,scaleTo:b},arguments[2]||{});this.start(c)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||!1,this.elementPositioning=this.element.getStyle("position"),this.originalStyle={},["top","left","width","height","fontSize"].each(function(a){this.originalStyle[a]=this.element.style[a]}.bind(this)),this.originalTop=this.element.offsetTop,this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){a.indexOf(b)>0&&(this.fontSize=parseFloat(a),this.fontSizeType=b)}.bind(this)),this.factor=(this.options.scaleTo-this.options.scaleFrom)/100,this.dims=null,this.options.scaleMode=="box"&&(this.dims=[this.element.offsetHeight,this.element.offsetWidth]),/^content/.test(this.options.scaleMode)&&(this.dims=[this.element.scrollHeight,this.element.scrollWidth]),this.dims||(this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth])},update:function(a){var b=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType}),this.setDimensions(this.dims[0]*b,this.dims[1]*b)},finish:function(a){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(a,b){var c={};this.options.scaleX&&(c.width=b.round()+"px"),this.options.scaleY&&(c.height=a.round()+"px");if(this.options.scaleFromCenter){var d=(a-this.dims[0])/2,e=(b-this.dims[1])/2;this.elementPositioning=="absolute"?(this.options.scaleY&&(c.top=this.originalTop-d+"px"),this.options.scaleX&&(c.left=this.originalLeft-e+"px")):(this.options.scaleY&&(c.top=-d+"px"),this.options.scaleX&&(c.left=-e+"px"))}this.element.setStyle(c)}}),Effect.Highlight=Class.create(Effect.Base,{initialize:function(a){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var b=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(b)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={},this.options.keepBackgroundImage||(this.oldStyle.backgroundImage=this.element.getStyle("background-image"),this.element.setStyle({backgroundImage:"none"})),this.options.endcolor||(this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")),this.options.restorecolor||(this.options.restorecolor=this.element.getStyle("background-color")),this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this)),this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+(this._base[d]+this._delta[d]*a).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}}),Effect.ScrollTo=function(a){var b=arguments[1]||{},c=document.viewport.getScrollOffsets(),d=$(a).cumulativeOffset();return b.offset&&(d[1]+=b.offset),new Effect.Tween(null,c.top,d[1],b,function(a){scrollTo(c.left,a.round())})},Effect.Fade=function(a){a=$(a);var b=a.getInlineOpacity(),c=Object.extend({from:a.getOpacity()||1,to:0,afterFinishInternal:function(a){if(a.options.to!=0)return;a.element.hide().setStyle({opacity:b})}},arguments[1]||{});return new Effect.Opacity(a,c)},Effect.Appear=function(a){a=$(a);var b=Object.extend({from:a.getStyle("display")=="none"?0:a.getOpacity()||0,to:1,afterFinishInternal:function(a){a.element.forceRerendering()},beforeSetup:function(a){a.element.setOpacity(a.options.from).show()}},arguments[1]||{});return new Effect.Opacity(a,b)},Effect.Puff=function(a){a=$(a);var b={opacity:a.getInlineOpacity(),position:a.getStyle("position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return new Effect.Parallel([new Effect.Scale(a,200,{sync:!0,scaleFromCenter:!0,scaleContent:!0,restoreAfterFinish:!0}),new Effect.Opacity(a,{sync:!0,to:0})],Object.extend({duration:1,beforeSetupInternal:function(a){Position.absolutize(a.effects[0].element)},afterFinishInternal:function(a){a.effects[0].element.hide().setStyle(b)}},arguments[1]||{}))},Effect.BlindUp=function(a){return a=$(a),a.makeClipping(),new Effect.Scale(a,0,Object.extend({scaleContent:!1,scaleX:!1,restoreAfterFinish:!0,afterFinishInternal:function(a){a.element.hide().undoClipping()}},arguments[1]||{}))},Effect.BlindDown=function(a){a=$(a);var b=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:0,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(a){a.element.undoClipping()}},arguments[1]||{}))},Effect.SwitchOff=function(a){a=$(a);var b=a.getInlineOpacity();return new Effect.Appear(a,Object.extend({duration:.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(a){new Effect.Scale(a.element,1,{duration:.3,scaleFromCenter:!0,scaleX:!1,scaleContent:!1,restoreAfterFinish:!0,beforeSetup:function(a){a.element.makePositioned().makeClipping()},afterFinishInternal:function(a){a.element.hide().undoClipping().undoPositioned().setStyle({opacity:b})}})}},arguments[1]||{}))},Effect.DropOut=function(a){a=$(a);var b={top:a.getStyle("top"),left:a.getStyle("left"),opacity:a.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(a,{x:0,y:100,sync:!0}),new Effect.Opacity(a,{sync:!0,to:0})],Object.extend({duration:.5,beforeSetup:function(a){a.effects[0].element.makePositioned()},afterFinishInternal:function(a){a.effects[0].element.hide().undoPositioned().setStyle(b)}},arguments[1]||{}))},Effect.Shake=function(a){a=$(a);var b=Object.extend({distance:20,duration:.5},arguments[1]||{}),c=parseFloat(b.distance),d=parseFloat(b.duration)/10,e={top:a.getStyle("top"),left:a.getStyle("left")};return new Effect.Move(a,{x:c,y:0,duration:d,afterFinishInternal:function(a){new Effect.Move(a.element,{x:-c*2,y:0,duration:d*2,afterFinishInternal:function(a){new Effect.Move(a.element,{x:c*2,y:0,duration:d*2,afterFinishInternal:function(a){new Effect.Move(a.element,{x:-c*2,y:0,duration:d*2,afterFinishInternal:function(a){new Effect.Move(a.element,{x:c*2,y:0,duration:d*2,afterFinishInternal:function(a){new Effect.Move(a.element,{x:-c,y:0,duration:d,afterFinishInternal:function(a){a.element.undoPositioned().setStyle(e)}})}})}})}})}})}})},Effect.SlideDown=function(a){a=$(a).cleanWhitespace();var b=a.down().getStyle("bottom"),c=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:c.height,originalWidth:c.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makePositioned(),a.element.down().makePositioned(),window.opera&&a.element.setStyle({top:""}),a.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(a){a.element.down().setStyle({bottom:a.dims[0]-a.element.clientHeight+"px"})},afterFinishInternal:function(a){a.element.undoClipping().undoPositioned(),a.element.down().undoPositioned().setStyle({bottom:b})}},arguments[1]||{}))},Effect.SlideUp=function(a){a=$(a).cleanWhitespace();var b=a.down().getStyle("bottom"),c=a.getDimensions();return new Effect.Scale(a,window.opera?0:1,Object.extend({scaleContent:!1,scaleX:!1,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:c.height,originalWidth:c.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makePositioned(),a.element.down().makePositioned(),window.opera&&a.element.setStyle({top:""}),a.element.makeClipping().show()},afterUpdateInternal:function(a){a.element.down().setStyle({bottom:a.dims[0]-a.element.clientHeight+"px"})},afterFinishInternal:function(a){a.element.hide().undoClipping().undoPositioned(),a.element.down().undoPositioned().setStyle({bottom:b})}},arguments[1]||{}))},Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:!0,beforeSetup:function(a){a.element.makeClipping()},afterFinishInternal:function(a){a.element.hide().undoClipping()}})},Effect.Grow=function(a){a=$(a);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{}),c={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},d=a.getDimensions(),e,f,g,h;switch(b.direction){case"top-left":e=f=g=h=0;break;case"top-right":e=d.width,f=h=0,g=-d.width;break;case"bottom-left":e=g=0,f=d.height,h=-d.height;break;case"bottom-right":e=d.width,f=d.height,g=-d.width,h=-d.height;break;case"center":e=d.width/2,f=d.height/2,g=-d.width/2,h=-d.height/2}return new Effect.Move(a,{x:e,y:f,duration:.01,beforeSetup:function(a){a.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(a){new Effect.Parallel([new Effect.Opacity(a.element,{sync:!0,to:1,from:0,transition:b.opacityTransition}),new Effect.Move(a.element,{x:g,y:h,sync:!0,transition:b.moveTransition}),new Effect.Scale(a.element,100,{scaleMode:{originalHeight:d.height,originalWidth:d.width},sync:!0,scaleFrom:window.opera?1:0,transition:b.scaleTransition,restoreAfterFinish:!0})],Object.extend({beforeSetup:function(a){a.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(a){a.effects[0].element.undoClipping().undoPositioned().setStyle(c)}},b))}})},Effect.Shrink=function(a){a=$(a);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{}),c={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},d=a.getDimensions(),e,f;switch(b.direction){case"top-left":e=f=0;break;case"top-right":e=d.width,f=0;break;case"bottom-left":e=0,f=d.height;break;case"bottom-right":e=d.width,f=d.height;break;case"center":e=d.width/2,f=d.height/2}return new Effect.Parallel([new Effect.Opacity(a,{sync:!0,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(a,window.opera?1:0,{sync:!0,transition:b.scaleTransition,restoreAfterFinish:!0}),new Effect.Move(a,{x:e,y:f,sync:!0,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(a){a.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(a){a.effects[0].element.hide().undoClipping().undoPositioned().setStyle(c)}},b))},Effect.Pulsate=function(a){a=$(a);var b=arguments[1]||{},c=a.getInlineOpacity(),d=b.transition||Effect.Transitions.linear,e=function(a){return 1-d(-Math.cos(a*(b.pulses||5)*2*Math.PI)/2+.5)};return new Effect.Opacity(a,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(a){a.element.setStyle({opacity:c})}},b),{transition:e}))},Effect.Fold=function(a){a=$(a);var b={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return a.makeClipping(),new Effect.Scale(a,5,Object.extend({scaleContent:!1,scaleX:!1,afterFinishInternal:function(c){new Effect.Scale(a,1,{scaleContent:!1,scaleY:!1,afterFinishInternal:function(a){a.element.hide().undoClipping().setStyle(b)}})}},arguments[1]||{}))},Effect.Morph=Class.create(Effect.Base,{initialize:function(a){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var b=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(b.style))this.style=$H(b.style);else if(b.style.include(":"))this.style=b.style.parseStyle();else{this.element.addClassName(b.style),this.style=$H(this.element.getStyles()),this.element.removeClassName(b.style);var c=this.element.getStyles();this.style=this.style.reject(function(a){return a.value==c[a.key]}),b.afterFinishInternal=function(a){a.element.addClassName(a.options.style),a.transforms.each(function(b){a.element.style[b.style]=""})}}this.start(b)},setup:function(){function a(a){if(!a||["rgba(0, 0, 0, 0)","transparent"].include(a))a="#ffffff";return a=a.parseColor(),$R(0,2).map(function(b){return parseInt(a.slice(b*2+1,b*2+3),16)})}this.transforms=this.style.map(function(b){var c=b[0],d=b[1],e=null;if(d.parseColor("#zzzzzz")!="#zzzzzz")d=d.parseColor(),e="color";else if(c=="opacity")d=parseFloat(d),Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});else if(Element.CSS_LENGTH.test(d)){var f=d.match(/^([\+\-]?[0-9\.]+)(.*)$/);d=parseFloat(f[1]),e=f.length==3?f[2]:null}var g=this.element.getStyle(c);return{style:c.camelize(),originalValue:e=="color"?a(g):parseFloat(g||0),targetValue:e=="color"?a(d):d,unit:e}}.bind(this)).reject(function(a){return a.originalValue==a.targetValue||a.unit!="color"&&(isNaN(a.originalValue)||isNaN(a.targetValue))})},update:function(a){var b={},c,d=this.transforms.length;while(d--)b[(c=this.transforms[d]).style]=c.unit=="color"?"#"+Math.round(c.originalValue[0]+(c.targetValue[0]-c.originalValue[0])*a).toColorPart()+Math.round(c.originalValue[1]+(c.targetValue[1]-c.originalValue[1])*a).toColorPart()+Math.round(c.originalValue[2]+(c.targetValue[2]-c.originalValue[2])*a).toColorPart():(c.originalValue+(c.targetValue-c.originalValue)*a).toFixed(3)+(c.unit===null?"":c.unit);this.element.setStyle(b,!0)}}),Effect.Transform=Class.create({initialize:function(a){this.tracks=[],this.options=arguments[1]||{},this.addTracks(a)},addTracks:function(a){return a.each(function(a){a=$H(a);var b=a.values().first();this.tracks.push($H({ids:a.keys().first(),effect:Effect.Morph,options:{style:b}}))}.bind(this)),this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var b=a.get("ids"),c=a.get("effect"),d=a.get("options"),e=[$(b)||$$(b)].flatten();return e.map(function(a){return new c(a,Object.extend({sync:!0},d))})}).flatten(),this.options)}}),Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex"),Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/,String.__parseStyleElement=document.createElement("div"),String.prototype.parseStyle=function(){var a,b=$H();return Prototype.Browser.WebKit?a=(new Element("div",{style:this})).style:(String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>',a=String.__parseStyleElement.childNodes[0].style),Element.CSS_PROPERTIES.each(function(c){a[c]&&b.set(c,a[c])}),Prototype.Browser.IE&&this.include("opacity")&&b.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]),b},document.defaultView&&document.defaultView.getComputedStyle?Element.getStyles=function(a){var b=document.defaultView.getComputedStyle($(a),null);return Element.CSS_PROPERTIES.inject({},function(a,c){return a[c]=b[c],a})}:Element.getStyles=function(a){a=$(a);var b=a.currentStyle,c;return c=Element.CSS_PROPERTIES.inject({},function(a,c){return a[c]=b[c],a}),c.opacity||(c.opacity=a.getOpacity()),c},Effect.Methods={morph:function(a,b){return a=$(a),new Effect.Morph(a,Object.extend({style:b},arguments[2]||{})),a},visualEffect:function(a,b,c){a=$(a);var d=b.dasherize().camelize(),e=d.charAt(0).toUpperCase()+d.substring(1);return new Effect[e](a,c),a},highlight:function(a,b){return a=$(a),new Effect.Highlight(a,b),a}},$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(b,c){return b=$(b),Effect[a.charAt(0).toUpperCase()+a.substring(1)](b,c),b}}),$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]}),Element.addMethods(Effect.Methods);if(typeof Effect=="undefined")throw"controls.js requires including script.aculo.us' effects.js library";var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(a,b,c){a=$(a),this.element=a,this.update=$(b),this.hasFocus=!1,this.changed=!1,this.active=!1,this.index=0,this.entryCount=0,this.oldElementValue=this.element.value,this.setOptions?this.setOptions(c):this.options=c||{},this.options.paramName=this.options.paramName||this.element.name,this.options.tokens=this.options.tokens||[],this.options.frequency=this.options.frequency||.4,this.options.minChars=this.options.minChars||1,this.options.onShow=this.options.onShow||function(a,b){if(!b.style.position||b.style.position=="absolute")b.style.position="absolute",Position.clone(a,b,{setHeight:!1,offsetTop:a.offsetHeight});Effect.Appear(b,{duration:.15})},this.options.onHide=this.options.onHide||function(a,b){new Effect.Fade(b,{duration:.15})},typeof this.options.tokens=="string"&&(this.options.tokens=new Array(this.options.tokens)),this.options.tokens.include("\n")||this.options.tokens.push("\n"),this.observer=null,this.element.setAttribute("autocomplete","off"),Element.hide(this.update),Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this)),Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){Element.getStyle(this.update,"display")=="none"&&this.options.onShow(this.element,this.update),!this.iefix&&Prototype.Browser.IE&&Element.getStyle(this.update,"position")=="absolute"&&(new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" '+'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>'),this.iefix=$(this.update.id+"_iefix")),this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height}),this.iefix.style.zIndex=1,this.update.style.zIndex=2,Element.show(this.iefix)},hide:function(){this.stopIndicator(),Element.getStyle(this.update,"display")!="none"&&this.options.onHide(this.element,this.update),this.iefix&&Element.hide(this.iefix)},startIndicator:function(){this.options.indicator&&Element.show(this.options.indicator)},stopIndicator:function(){this.options.indicator&&Element.hide(this.options.indicator)},onKeyPress:function(a){if(this.active)switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry(),Event.stop(a);case Event.KEY_ESC:this.hide(),this.active=!1,Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious(),this.render(),Event.stop(a);return;case Event.KEY_DOWN:this.markNext(),this.render(),Event.stop(a);return}else if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&a.keyCode==0)return;this.changed=!0,this.hasFocus=!0,this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1e3)},activate:function(){this.changed=!1,this.hasFocus=!0,this.getUpdatedChoices()},onHover:function(a){var b=Event.findElement(a,"LI");this.index!=b.autocompleteIndex&&(this.index=b.autocompleteIndex,this.render()),Event.stop(a)},onClick:function(a){var b=Event.findElement(a,"LI");this.index=b.autocompleteIndex,this.selectEntry(),this.hide()},onBlur:function(a){setTimeout(this.hide.bind(this),250),this.hasFocus=!1,this.active=!1},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++)this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected");this.hasFocus&&(this.show(),this.active=!0)}else this.active=!1,this.hide()},markPrevious:function(){this.index>0?this.index--:this.index=this.entryCount-1,this.getEntry(this.index).scrollIntoView(!0)},markNext:function(){this.index<this.entryCount-1?this.index++:this.index=0,this.getEntry(this.index).scrollIntoView(!1)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=!1,this.updateElement(this.getCurrentEntry())},updateElement:function(a){if(this.options.updateElement){this.options.updateElement(a);return}var b="";if(this.options.select){var c=$(a).select("."+this.options.select)||[];c.length>0&&(b=Element.collectTextNodes(c[0],this.options.select))}else b=Element.collectTextNodesIgnoreClass(a,"informal");var d=this.getTokenBounds();if(d[0]!=-1){var e=this.element.value.substr(0,d[0]),f=this.element.value.substr(d[0]).match(/^\s+/);f&&(e+=f[0]),this.element.value=e+b+this.element.value.substr(d[1])}else this.element.value=b;this.oldElementValue=this.element.value,this.element.focus(),this.options.afterUpdateElement&&this.options.afterUpdateElement(this.element,a)},updateChoices:function(a){if(!this.changed&&this.hasFocus){this.update.innerHTML=a,Element.cleanWhitespace(this.update),Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var b=0;b<this.entryCount;b++){var c=this.getEntry(b);c.autocompleteIndex=b,this.addObservers(c)}}else this.entryCount=0;this.stopIndicator(),this.index=0,this.entryCount==1&&this.options.autoSelect?(this.selectEntry(),this.hide()):this.render()}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this)),Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=!1,this.tokenBounds=null,this.getToken().length>=this.options.minChars?this.getUpdatedChoices():(this.active=!1,this.hide()),this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var a=this.element.value;if(a.strip().empty())return[-1,0];var b=arguments.callee.getFirstDifferencePos(a,this.oldElementValue),c=b==this.oldElementValue.length?1:0,d=-1,e=a.length,f;for(var g=0,h=this.options.tokens.length;g<h;++g)f=a.lastIndexOf(this.options.tokens[g],b+c-1),f>d&&(d=f),f=a.indexOf(this.options.tokens[g],b+c),-1!=f&&f<e&&(e=f);return this.tokenBounds=[d+1,e]}}),Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(a,b){var c=Math.min(a.length,b.length);for(var d=0;d<c;++d)if(a[d]!=b[d])return d;return c},Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d),this.options.asynchronous=!0,this.options.onComplete=this.onComplete.bind(this),this.options.defaultParams=this.options.parameters||null,this.url=c},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a,this.options.defaultParams&&(this.options.parameters+="&"+this.options.defaultParams),new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}}),Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d),this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector
(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:!0,partialChars:2,ignoreCase:!0,fullSearch:!1,selector:function(a){var b=[],c=[],d=a.getToken(),e=0;for(var f=0;f<a.options.array.length&&b.length<a.options.choices;f++){var g=a.options.array[f],h=a.options.ignoreCase?g.toLowerCase().indexOf(d.toLowerCase()):g.indexOf(d);while(h!=-1){if(h==0&&g.length!=d.length){b.push("<li><strong>"+g.substr(0,d.length)+"</strong>"+g.substr(d.length)+"</li>");break}if(d.length>=a.options.partialChars&&a.options.partialSearch&&h!=-1)if(a.options.fullSearch||/\s/.test(g.substr(h-1,1))){c.push("<li>"+g.substr(0,h)+"<strong>"+g.substr(h,d.length)+"</strong>"+g.substr(h+d.length)+"</li>");break}h=a.options.ignoreCase?g.toLowerCase().indexOf(d.toLowerCase(),h+1):g.indexOf(d,h+1)}}return c.length&&(b=b.concat(c.slice(0,a.options.choices-b.length))),"<ul>"+b.join("")+"</ul>"}},a||{})}}),Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)},Ajax.InPlaceEditor=Class.create({initialize:function(a,b,c){this.url=b,this.element=a=$(a),this.prepareOptions(),this._controls={},arguments.callee.dealWithDeprecatedOptions(c),Object.extend(this.options,c||{}),!this.options.formId&&this.element.id&&(this.options.formId=this.element.id+"-inplaceeditor",$(this.options.formId)&&(this.options.formId="")),this.options.externalControl&&(this.options.externalControl=$(this.options.externalControl)),this.options.externalControl||(this.options.externalControlOnly=!1),this._originalBackground=this.element.getStyle("background-color")||"transparent",this.element.title=this.options.clickToEditText,this._boundCancelHandler=this.handleFormCancellation.bind(this),this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this),this._boundFailureHandler=this.handleAJAXFailure.bind(this),this._boundSubmitHandler=this.handleFormSubmission.bind(this),this._boundWrapperHandler=this.wrapUp.bind(this),this.registerListeners()},checkForEscapeOrReturn:function(a){if(!this._editing||a.ctrlKey||a.altKey||a.shiftKey)return;Event.KEY_ESC==a.keyCode?this.handleFormCancellation(a):Event.KEY_RETURN==a.keyCode&&this.handleFormSubmission(a)},createControl:function(a,b,c){var d=this.options[a+"Control"],e=this.options[a+"Text"];if("button"==d){var f=document.createElement("input");f.type="submit",f.value=e,f.className="editor_"+a+"_button","cancel"==a&&(f.onclick=this._boundCancelHandler),this._form.appendChild(f),this._controls[a]=f}else if("link"==d){var g=document.createElement("a");g.href="#",g.appendChild(document.createTextNode(e)),g.onclick="cancel"==a?this._boundCancelHandler:this._boundSubmitHandler,g.className="editor_"+a+"_link",c&&(g.className+=" "+c),this._form.appendChild(g),this._controls[a]=g}},createEditField:function(){var a=this.options.loadTextURL?this.options.loadingText:this.getText(),b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input"),b.type="text";var c=this.options.size||this.options.cols||0;0<c&&(b.size=c)}else b=document.createElement("textarea"),b.rows=1>=this.options.rows?this.options.autoRows:this.options.rows,b.cols=this.options.cols||40;b.name=this.options.paramName,b.value=a,b.className="editor_field",this.options.submitOnBlur&&(b.onblur=this._boundSubmitHandler),this._controls.editor=b,this.options.loadTextURL&&this.loadExternalText(),this._form.appendChild(this._controls.editor)},createForm:function(){function b(b,c){var d=a.options["text"+b+"Controls"];if(!d||c===!1)return;a._form.appendChild(document.createTextNode(d))}var a=this;this._form=$(document.createElement("form")),this._form.id=this.options.formId,this._form.addClassName(this.options.formClassName),this._form.onsubmit=this._boundSubmitHandler,this.createEditField(),"textarea"==this._controls.editor.tagName.toLowerCase()&&this._form.appendChild(document.createElement("br")),this.options.onFormCustomization&&this.options.onFormCustomization(this,this._form),b("Before",this.options.okControl||this.options.cancelControl),this.createControl("ok",this._boundSubmitHandler),b("Between",this.options.okControl&&this.options.cancelControl),this.createControl("cancel",this._boundCancelHandler,"editor_cancel"),b("After",this.options.okControl||this.options.cancelControl)},destroy:function(){this._oldInnerHTML&&(this.element.innerHTML=this._oldInnerHTML),this.leaveEditMode(),this.unregisterListeners()},enterEditMode:function(a){if(this._saving||this._editing)return;this._editing=!0,this.triggerCallback("onEnterEditMode"),this.options.externalControl&&this.options.externalControl.hide(),this.element.hide(),this.createForm(),this.element.parentNode.insertBefore(this._form,this.element),this.options.loadTextURL||this.postProcessEditField(),a&&Event.stop(a)},enterHover:function(a){this.options.hoverClassName&&this.element.addClassName(this.options.hoverClassName);if(this._saving)return;this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a),this._oldInnerHTML&&(this.element.innerHTML=this._oldInnerHTML,this._oldInnerHTML=null)},handleFormCancellation:function(a){this.wrapUp(),a&&Event.stop(a)},handleFormSubmission:function(a){var b=this._form,c=$F(this._controls.editor);this.prepareSubmission();var d=this.options.callback(b,c)||"";Object.isString(d)&&(d=d.toQueryParams()),d.editorId=this.element.id;if(this.options.htmlResponse){var e=Object.extend({evalScripts:!0},this.options.ajaxOptions);Object.extend(e,{parameters:d,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler}),new Ajax.Updater({success:this.element},this.url,e)}else{var e=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(e,{parameters:d,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler}),new Ajax.Request(this.url,e)}a&&Event.stop(a)},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName),this.removeForm(),this.leaveHover(),this.element.style.backgroundColor=this._originalBackground,this.element.show(),this.options.externalControl&&this.options.externalControl.show(),this._saving=!1,this._editing=!1,this._oldInnerHTML=null,this.triggerCallback("onLeaveEditMode")},leaveHover:function(a){this.options.hoverClassName&&this.element.removeClassName(this.options.hoverClassName);if(this._saving)return;this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName),this._controls.editor.disabled=!0;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(a){this._form.removeClassName(this.options.loadingClassName);var b=a.responseText;this.options.stripLoadedTextTags&&(b=b.stripTags()),this._controls.editor.value=b,this._controls.editor.disabled=!1,this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler}),new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;a&&$(this._controls.editor)["focus"==a?"focus":"activate"]()},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions),Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks),[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=!0,this.removeForm(),this.leaveHover(),this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this),this._listeners[b.key]=a,this.options.externalControlOnly||this.element.observe(b.key,a),this.options.externalControl&&this.options.externalControl.observe(b.key,a)}.bind(this))},removeForm:function(){if(!this._form)return;this._form.remove(),this._form=null,this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML,this.element.innerHTML=this.options.savingText,this.element.addClassName(this.options.savingClassName),this.element.style.backgroundColor=this._originalBackground,this.element.show()},triggerCallback:function(a,b){"function"==typeof this.options[a]&&this.options[a](this,b)},unregisterListeners:function(){$H(this._listeners).each(function(a){this.options.externalControlOnly||this.element.stopObserving(a.key,a.value),this.options.externalControl&&this.options.externalControl.stopObserving(a.key,a.value)}.bind(this))},wrapUp:function(a){this.leaveEditMode(),this._boundComplete(a,this.element)}}),Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy}),Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,a,b,c){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions,$super(a,b,c)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName,a.size=1,this._controls.editor=a,this._collection=this.options.collection||[],this.options.loadCollectionURL?this.loadCollection():this.checkForExternalText(),this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName),this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js))throw"Server returned an invalid collection representation.";this._collection=eval(js),this.checkForExternalText()}.bind(this),onFailure:this.onFailure}),new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(a){this._controls.editor.disabled=!0;var b=this._controls.editor.firstChild;b||(b=document.createElement("option"),b.value="",this._controls.editor.appendChild(b),b.selected=!0),b.update((a||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText(),this.options.loadTextURL?this.loadExternalText():this.buildOptionList()},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(a){this._text=a.responseText.strip(),this.buildOptionList()}.bind(this),onFailure:this.onFailure}),new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName),this._collection=this._collection.map(function(a){return 2===a.length?a:[a,a].flatten()});var a="value"in this.options?this.options.value:this._text,b=this._collection.any(function(b){return b[0]==a}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(d,e){c=document.createElement("option"),c.value=d[0],c.selected=b?d[0]==a:0==e,c.appendChild(document.createTextNode(d[1])),this._controls.editor.appendChild(c)}.bind(this)),this._controls.editor.disabled=!1,Field.scrollFreeActivate(this._controls.editor)}}),Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){function b(b,c){if(b in a||c===undefined)return;a[b]=c}if(!a)return;b("cancelControl",a.cancelLink?"link":a.cancelButton?"button":a.cancelLink==a.cancelButton==0?!1:undefined),b("okControl",a.okLink?"link":a.okButton?"button":a.okLink==a.okButton==0?!1:undefined),b("highlightColor",a.highlightcolor),b("highlightEndColor",a.highlightendcolor)},Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:!1,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:!0,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:!1,submitOnBlur:!1,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(a,b){new Effect.Highlight(b,{startcolor:this.options.highlightColor,keepBackgroundImage:!0})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor,a._effect&&a._effect.cancel()},onFailure:function(a,b){alert("Error communication with the server: "+a.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:!0})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}}),Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."},Form.Element.DelayedObserver=Class.create({initialize:function(a,b,c){this.delay=b||.5,this.element=$(a),this.callback=c,this.timer=null,this.lastValue=$F(this.element),Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(a){if(this.lastValue==$F(this.element))return;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1e3),this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null,this.callback(this.element,$F(this.element))}}),function(){var a=function(a,b){var c=a.relatedTarget;while(c&&c!=b)try{c=c.parentNode}catch(d){c=b}return c==b};Object.extend(Event,{mouseEnter:function(a,b,c){a=$(a);var d=c&&c.enterDelay?function(){window.setTimeout(b,c.enterDelay)}:b;Prototype.Browser.IE?a.observe("mouseenter",d):(a.hovered=!1,a.observe("mouseover",function(b){a.hovered||(a.hovered=!0,d(b))}))},mouseLeave:function(b,c,d){b=$(b);var e=d&&d.leaveDelay?function(){window.setTimeout(c,d.leaveDelay)}:c;Prototype.Browser.IE?b.observe("mouseleave",e):b.observe("mouseout",function(c){var d=Event.element(c);a(c,b)||(e(c),b.hovered=!1)})}}),Element.addMethods({hover:function(a,b,c,d){d=Object.extend({},d)||{},Event.mouseEnter(a,b,d),Event.mouseLeave(a,c,d)}})}();var PHover=Class.create({initialize:function(a,b,c){this.options=Object.extend({top_active_area_px:35,y_offset:0},c||{}),this.hover_div=$(a),this.position_div=$(b),this.child_divs=new Array,this.child_div_position=new Hash,this.setup(),this.t_dim=null,this.t_off=null},setup:function(){this.hover_div.hover(this.hoverHandler.bindAsEventListener(this),function(){})},mouseHandler:function(a){if(this.t_dim&&this.t_off){var b=Event.pointerX(a),c=Event.pointerY(a);b>this.t_off.left&&b<this.t_off.left+this.t_dim.width&&c>this.t_off.top-this.options.top_active_area_px&&c<this.t_off.top+this.t_dim.height||this.unhoverHandler()}},show:function(){this.hoverHandler()},hoverHandler:function(){document.observe("mousemove",this.mouseHandler.bindAsEventListener(this));var a=this.t_dim=this.hover_div.getDimensions(),b=this.t_off=this.hover_div.cumulativeOffset(),c=this.position_div.getDimensions(),d=this.position_div.cumulativeOffset();this.child_divs.each(function(a){this.position_child_div(c,d,a),a.show()}.bind(this))},position_child_div:function(a,b,c){var d={position:"absolute",top:b.top-c.getHeight()+this.options.y_offset+"px"};this.child_div_position.get(c.getAttribute("id"))=="topright"?d.left=b.left+a.width-c.getWidth()+"px":d.left=b.left+"px",c.setStyle(d)},reposition:function(a){var b=this.position_div.getDimensions(),c=this.position_div.cumulativeOffset();this.position_child_div(b,c,$(a))},unhoverHandler:function(){document.stopObserving("mousemove",this.mouseHandler.bindAsEventListener(this)),this.t_dim=null,this.t_off=null,this.child_divs.each(function(a){a.hasClassName("phover_donothide")||a.hide()})},addChildDiv:function(a,b){this.child_divs.push($(a)),this.child_div_position.set($(a).id,b),$(a).hide()}});PHover.created_hovers=new Hash,PHover.factory_create=function(a,b,c){if(!$(a))return;var d=PHover.created_hovers.get($(a).getAttribute("id"));if(d)return d;var e=new PHover(a,b,c);return PHover.created_hovers.set($(a).getAttribute("id"),e),e};if(typeof PSlideGallery2=="undefined"){Prototype.Browser.IE6=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6,Prototype.Browser.IE7=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==7,Prototype.Browser.IE8=Prototype.Browser.IE&&!Prototype.Browser.IE6&&!Prototype.Browser.IE7;var pgallery_stopclick=function(a){Event.stop(a)},themeWidth=$$('meta[name="width"]').first()?parseInt($$('meta[name="width"]').first().readAttribute("content")):500,loadingDiv=new Element("div",{style:"width: "+themeWidth+"px; padding-top: 158px; padding-bottom: 159px;text-align: center; border: 1px solid #aaa;"}),loadingImage=new Image;loadingImage.src="/images/loading.gif",loadingImage.width=16,loadingImage.height=16,Element.extend(loadingImage).setAttribute("id","mainImage"),Element.extend(loadingImage).setAttribute("style","border: none;"),loadingDiv.appendChild(loadingImage);var PImage2=Class.create({initialize:function(a){Object.extend(this,a),this.thumb||(this.thumb="/images/spacer.gif",this.thumbWidth=36,this.thumbHeight=36),this.imageObj=Element.extend(new Image),this.imageObj.observe("load",this.imageLoaded.bindAsEventListener(this)),this.imageObj.src=this.main,this.width&&(this.imageObj.width=this.width),this.height&&(this.imageObj.height=this.height),this.loaded=!1,Element.extend(this.imageObj).setAttribute("id","mainImage")},imageLoaded:function(){this.loaded=!0,this.loadCallback!=null&&(this.loadCallback(this.imageObj,this.loadCallback_meref),this.loadCallback=null)},getMainImage:function(a,b){this.loaded==1?a(this.imageObj,b):(a(loadingDiv,b),this.loadCallback=a,this.loadCallback_meref=b)}}),PSlideGallery2=Class.create({initialize:function(a,b,c){this.galleryDiv=$(a),this.zipFile=c.zipFile,this.zipFileSize=c.zipFileSize,this.showDownload=c.showDownload,this.externalUrl=c.external_url,$$(".posterous_site_data").length>0?(this.show_type=$$(".posterous_site_data")[0].readAttribute("data-show-type"),this.site_type=$$(".posterous_site_data")[0].readAttribute("data-site-type"),this.site_id=$$(".posterous_site_data")[0].readAttribute("data-site-id"),this.user_id=$$(".posterous_site_data")[0].readAttribute("data-user-id"),this.post_id=$$(".posterous_site_data")[0].readAttribute("data-post-id")):(this.show_type=document.body.readAttribute("data-show-type")||document.body.readAttribute("data-show_type")||window.show_type,this.site_type=document.body.readAttribute("data-site-type")||document.body.readAttribute("data-site_type")||window.site_type,this.site_id=document.body.readAttribute("data-site-id")||document.body.readAttribute("data-site_id")||window.site_id,this.user_id=document.body.readAttribute("data-user-id")||document.body.readAttribute("data-admin_id")||window.user_id,this.post_id=document.body.readAttribute("data-post-id")||window.post_id);if(this.site_type=="group"){thread_div=this.galleryDiv.up(".thread");if(thread_div){thread_slug=thread_div.readAttribute("data-slug"),thread_id=thread_div.readAttribute("data-site-id"),this.url_slug=thread_slug,this.thread_id=$$("article.post")[0].readAttribute("data-id");var d=[];$$("article.reply").each(function(a){a.readAttribute("data-parent_id")&&d.push(a.readAttribute("data-id"))}),this.reply_ids=d}else this.url_slug="",this.thread_id=0,this.reply_ids=[]}else post_div=this.galleryDiv.up(".post"),post_div!=undefined?post_title_div=post_div.down(".post-title"):post_title_div=undefined,post_title_div!=undefined?post_link_div=post_title_div.down("a"):post_link_div=undefined,post_link_div!=undefined&&(post_link=post_link_div.href,regex=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)\/(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,post_link.match(regex)&&post_link.match(/private/)?this.url_slug=post_link.replace(regex,"private/$4"):post_link.match(regex)&&(this.url_slug=post_link.replace(regex,"$4")));this.imageList=new Array,$A(b).each(function(a){this.imageList.push(new PImage2(a))}.bind(this)),this.idx=0;if(this.imageList.length==1&&this.imageList[0].largeWidth<=themeWidth&&!this.externalUrl)return;this.galleryDiv.update(""),this.generateGallery(),document.observe("keyup",this.handleKeyboard.bindAsEventListener(this))},generateGallery:function(){if(this.imageList.length>1){var a=new Element("div",{style:"margin-bottom: 3px;","class":"posterousGalleryNavigationDiv"}),b=new Element("a",{href:"#",onclick:"return false;",style:"vertical-align: middle;"}),c="<img src='/images/arrowleft.gif' border='0'>";b.update(c),a.appendChild(b);var d=document.createTextNode(" ");a.appendChild(d);var e=new Element("a",{href:"#",onclick:"return false;",style:"vertical-align: middle;"}),f="<img src='/images/arrowright.gif' border='0'>";e.update(f),a.appendChild(e),this.labelSpan=new Element("span"),this.labelSpan.addClassName("galleryLabel"),this.labelSpan.update("1 of "+this.imageList.length),a.appendChild(this.labelSpan),this.registerPrev(b),this.registerNext(e),this.galleryDiv.appendChild(a);var g=new Element("div",{style:"margin-bottom: 2px","class":"posterousGalleryThumbnailsDiv"});this.galleryDiv.appendChild(g);for(var h=0;h<this.imageList.length;h++){var i=this.imageList[h];if(i==null)continue;var j=new Element("a",{href:"#",onClick:"return false;",style:"margin-right: 5px !important;"}),k=new Element("img",{src:i.thumb,width:i.thumbWidth,height:i.thumbWidth});j.appendChild(k),g.appendChild(j),i.thumbLink=j,this.registerThumb(h,j),h==0&&j.addClassName("gallerySelectedImage")}}this.mainLink=new Element("a",{href:"#",onClick:"return false;"}),this.mainLink.addClassName("posterousGalleryMainlink"),this.mainImage=this.imageList[this.idx].imageObj,this.mainLink.appendChild(this.mainImage),this.galleryDiv.appendChild(this.mainLink),this.setupCommandPanel(),this.registerMainImage(this.mainImage),this.resizeShowBar()},setupCommandPanel:function(){if(this.commandSpan==null){this.commandSpan=new Element("span"),this.commandSpan.addClassName("show");var a=new Element("div",{style:"color: #fff; font-size: 14px;",id:this.galleryDiv.id+"-click"});a.update(this.externalUrl?"Click to view link":"Click to view large"),a.update(this.externalUrl?"Click to view link":"<a href='#' style='color:#fff' onclick='return false'>Click to view large</a>");if(this.imageList[this.idx].originalSize){var b=new Element("div",{style:"font-size: 14px;",id:this.galleryDiv.id+"-dl1"});b.addClassName("posterousGalleryLink"),b.update("Download full size ("+this.imageList[this.idx].originalSize+" KB)")}var c=new Element("div",{style:"font-size: 14px;",id:this.galleryDiv.id+"-dl2"});c.addClassName("posterousGalleryLink"),c.update("Download this gallery (ZIP, "+this.zipFileSize+" KB)");var d=new Element("div",{style:"font-size:14px;position:absolute;right:10px;bottom:0px;",id:this.galleryDiv.id+"-dl3"});this.url_slug!=undefined?Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?d.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' title='Click to view in full screen' />"):d.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' data-posterous-tooltip='Click to view in full screen' />"):Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?d.update("<a href='#' onclick='return false' class='view_slideshow' title='Click to view in full screen' />"):d.update("<a href='#' onclick='return false' class='view_slideshow' data-posterous-tooltip='Click to view in full screen' />"),this.commandDiv2=b,this.commandDiv3=c,this.commandDiv4=d,this.commandSpan.appendChild(d),this.showDownload&&(c&&(this.commandSpan.appendChild(c),c.observe("click",this.clickDownloadGallery.bindAsEventListener(this))),b&&(this.commandSpan.appendChild(b),b.observe("click",this.clickDownloadFull.bindAsEventListener(this)))),d.observe("click",this.handlePostSlideshow.bindAsEventListener(this)),this.mainLink.appendChild(this.commandSpan)}var e=this.imageList[this.idx].largeWidth<=themeWidth&&this.imageList[this.idx].largeHeight<=themeWidth&&!this.externalUrl,f=this.zipFile!=null;e?b&&this.commandDiv2.hide():(b&&this.commandDiv2.show(),d&&this.commandDiv4.show()),f?(c&&this.commandDiv3.show(),d&&this.commandDiv4.show()):c&&this.commandDiv3.hide(),this.showDownload||e||this.commandSpan.addClassName("show");var g=this.commandSpan},resizeShowBar:function(){$$("span.show").each(function(a){var b=a.down(".view_slideshow").up(),c=b.next(),d=b.next(1);if(b){if(c&&c.getStyle("display")=="none"&&d&&d.getStyle("display")=="none"||a.childElements().length<=1)Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?a.writeAttribute({style:"background-color:transparent"}):a.setStyle({"background-color":"transparent"});c&&c.getStyle("display")!="none"&&d&&d.getStyle("display")!="none"&&a.childElements().length>1&&(Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?b.writeAttribute({bottom:"8px"}):b.setStyle({bottom:"8px"}))}})},clickDownloadFull:function(){window.open(this.imageList[this.idx].original)},clickDownloadGallery:function(){window.open(this.zipFile)},registerThumb:function(a,b){b.observe("mousedown",this.handleThumbClick.bindAsEventListener(this,a)),Event.observe(b,"click",pgallery_stopclick,!1)},handleThumbClick:function(){var a=$A(arguments)[1];this.setIndex(a)},getCurrentPImage:function(){return this.imageList[this.idx]},registerMainImage:function(a){this.mainImage.observe("mousedown",this.handleClick.bindAsEventListener(this))},unregisterMainImage:function(a){this.mainImage.stopObserving("mousedown",this.handleClick.bindAsEventListener(this))},handleClick:function(a){Event.stop(a),this.externalUrl?document.location.href=this.externalUrl:this.setupLargeImage()},handlePostSlideshow:function(){$$(".posterous_site_data").length>0?(this.show_type=$$(".posterous_site_data")[0].readAttribute("data-show-type"),this.site_type=$$(".posterous_site_data")[0].readAttribute("data-site-type"),this.site_id=$$(".posterous_site_data")[0].readAttribute("data-site-id"),this.user_id=$$(".posterous_site_data")[0].readAttribute("data-user-id"),this.post_id=$$(".posterous_site_data")[0].readAttribute("data-post-id")):(this.show_type=document.body.readAttribute("data-show-type")||document.body.readAttribute("data-show_type")||window.show_type,this.site_type=document.body.readAttribute("data-site-type")||document.body.readAttribute("data-site_type")||window.site_type,this.site_id=document.body.readAttribute("data-site-id")||document.body.readAttribute("data-site_id")||window.site_id,this.user_id=document.body.readAttribute("data-user-id")||document.body.readAttribute("data-admin_id")||window.user_id,this.post_id=document.body.readAttribute("data-post-id")||window.post_id);var a=this.getCurrentPImage(),b=[];if(this.site_type!="group"){var c=this.galleryDiv.up(".inner")||this.galleryDiv.up(".copy")||this.galleryDiv.up(".post")||this.galleryDiv.up(".content")||this.galleryDiv.up(".post_body")||this.galleryDiv.up(".bodytext")||this.galleryDiv.up(".regular"),d=this.galleryDiv.readAttribute("data-posterous-file-list");b.push(a),c.childElements().each(function(c){if(c.hasClassName("posterousGalleryMainDiv")){var d=c.readAttribute("data-posterous-file-list"),e=unescape(d).evalJSON();for(var f=0,g=e.length;f<g;++f){var h=e[f];h.large!=a.large&&b.push(h)}}})}this.externalUrl?document.location.href=this.externalUrl:this.site_type=="group"||this.site_type=="application"||this.show_type!="site"&&this.show_type!="post"?this.site_type=="application"?(post_div=this.galleryDiv.up(".articlePost"),post_id=post_div.readAttribute("data-id"),site_id=post_div.readAttribute("data-site"),user_id=post_div.readAttribute("data-user"),slug=post_div.readAttribute("data-slug"),b.flatten().length<=1?slides=new startSlideshow({show_type:"post",site_type:this.site_type,post_id:post_id,site_id:site_id,user_id:user_id,image_list:b.flatten(),current_image:a,slug:slug,autoplay:!1}):slides=new startSlideshow({show_type:"post",site_type:this.site_type,post_id:post_id,site_id:site_id,user_id:user_id,image_list:b.flatten(),current_image:a,slug:slug,autoplay:!0})):(this.imageList.length<=1?slides=new startSlideshow({show_type:"thread",site_type:this.site_type,thread_id:this.thread_id,reply_ids:this.reply_ids,slug:this.url_slug,site_id:this.site_id,user_id:this.user_id,image_list:this.imageList,current_image:a,autoplay:!1}):slides=new startSlideshow({show_type:"thread",site_type:this.site_type,thread_id:this.thread_id,reply_ids:this.reply_ids,slug:this.url_slug,site_id:this.site_id,user_id:this.user_id,image_list:this.imageList,current_image:a,autoplay:!0}),this.url_slug&&this.thread_id?slideshow.setLocation("#!/"+this.url_slug+"/slideshow"):this.url_slug&&this.thread_id==undefined&&slideshow.setLocation("#!/"+this.url_slug+"/slideshow")):(b.flatten().length<=1?slides=new startSlideshow({show_type:"post",site_type:this.site_type,post_id:this.post_id,site_id:this.site_id,user_id:this.user_id,image_list:b.flatten(),current_image:a,slug:this.url_slug,autoplay:!1}):slides=new startSlideshow({show_type:"post",site_type:this.site_type,post_id:this.post_id,site_id:this.site_id,user_id:this.user_id,image_list:b.flatten(),current_image:a,slug:this.url_slug,autoplay:!0}),this.post_id?slideshow.setLocation("#!/slideshow"):this.url_slug&&this.post_id==undefined&&slideshow.setLocation("#!/"+this.url_slug+"/slideshow"))},setupLargeImage:function(){var a=this.getCurrentPImage();if(a.large!=null)var b=Control.Modal.open("<a href='#' onClick='Control.Modal.close();return false;'><img src='"+a.large+"'"+" width='"+a.largeWidth+"'"+" height='"+a.largeHeight+"'"+"id='posterousGalleryExpandedImg_"+this.galleryDiv.id+"'></a>",{opacity:.6,width:parseInt(a.largeWidth),height:parseInt(a.largeHeight)});this.setupSlideshowGlyph()},setupSlideshowGlyph:function(){var a=new Element("div",{style:"font-size: 14px;position:absolute;right:30px;bottom:15px;",id:this.galleryDiv.id+"-dl3"}),b=$("modal_container"),c=this.galleryDiv.id;this.url_slug!=undefined?Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?a.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' title='Click to view in full screen' />"):a.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' data-posterous-tooltip='Click to view in full screen' />"):Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6?a.update("<a href='#' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' title='Click to view in full screen' />"):a.update("<a href='#' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' data-posterous-tooltip='Click to view in full screen' />"),b.appendChild(a),a.observe("click",this.handlePostSlideshow.bindAsEventListener(this)),b.observe("mouseover",function(){$(""+c+"-slideshow")!=null&&$(""+c+"-slideshow").show()}),b.observe("mouseout",function(){$(""+c+"-slideshow")!=null&&$(""+c+"-slideshow").hide()})},registerPrev:function(a){a.observe("mousedown",this.prevButtonClick.bindAsEventListener(this)),Event.observe(a,"click",pgallery_stopclick,!1)},isVisibleInViewport:function(){var a=$(this.galleryDiv).viewportOffset().top;return a>=-200&&a<=document.viewport.getHeight()-200},handleKeyboard:function(a){if(!this.isVisibleInViewport())return;var b=a.charCode||a.keyCode;b==37?this.prev():b==39&&this.next()},prevButtonClick:function(){this.prev()},prev:function(){this.idx==0?this.setIndex(this.imageList.length-1):this.setIndex(this.idx-1)},registerNext:function(a){a.observe("mousedown",this.nextButtonClick.bindAsEventListener(this)),Event.observe(a,"click",pgallery_stopclick,!1)},nextButtonClick:function(){this.next()},next:function(){this.idx==this.imageList.length-1?this.setIndex(0):this.setIndex(this.idx+1)},setIndex:function(a){if(this.imageList[a].thumb!=null||this.imageList[this.idx].thumbLink!=null)this.imageList[this.idx].thumbLink.removeClassName("gallerySelectedImage"),this.imageList[a].thumbLink.addClassName("gallerySelectedImage");this.idx=a,this.labelSpan.update(this.idx+1+" of "+this.imageList.length),this.imageList[this.idx].getMainImage
(this.setMainImage,this),Control.Modal.current&&$("posterousGalleryExpandedImg_"+this.galleryDiv.id)&&this.setupLargeImage()},setMainImage:function(a,b){b==null&&(b=this);if(a==null)return;b.unregisterMainImage(b.mainImage),$(b.mainImage).replace(a),b.mainImage=a,b.registerMainImage(b.mainImage),b.setupCommandPanel()}})}if(PWidgets==null){var themeWidth=$$('meta[name="width"]').first()?parseInt($$('meta[name="width"]').first().readAttribute("content")):500,PWidgets="loaded";Event.observe(window,"load",function(){var a=$$(".post img, div.body div.inner img");for(var b=0;b<a.length;b++){var c=a[b];c.width>themeWidth&&new PosterousLargeExternal(c)}});var PosterousLargeExternal=Class.create({initialize:function(a){this.element=a,this.oldWidth=a.width,this.oldHeight=a.height,a.observe("click",this.handleClick.bindAsEventListener(this));var b=posterous_resize_image(a.width,a.height,themeWidth);b!=null&&(a.width=b[0],a.height=b[1]),a.addClassName("pointer_cursor")},handleClick:function(){var a=Control.Modal.open("<a href='#' onClick='Control.Modal.close();return false;'><img src='"+this.element.src+"'"+" width='"+this.oldWidth+"'"+" height='"+this.oldHeight+"'"+"></a>",{opacity:.6})}});function posterous_resize_image(a,b,c){return a>c?[c,c*b/a]:null}var pw_stopclick=function(a){Event.stop(a)}}var PFavorite=Class.create({initialize:function(a,b,c,d,e){this.options=Object.extend({y_offset:20},e||{}),this.hoverContainer=$(a),this.positionContainer=$(b),this.postid=c,this.isFaved=d,this.mouseoverHandler=this.mouseoverHandler_delegate.bindAsEventListener(this),this.mouseoutHandler=this.mouseoutHandler_delegate.bindAsEventListener(this),this.clickHandler=this.clickHandler_delegate.bindAsEventListener(this),this.isLoading=!1,this.createFavPanel(),this.tooltip=PHover.factory_create(a,b,this.options),this.tooltip.addChildDiv(this.favpanel,"topright"),this.favpanel.observe("mouseover",this.mouseoverHandler),this.favpanel.observe("mouseout",this.mouseoutHandler),this.favpanel.observe("click",this.clickHandler)},createFavPanel:function(){this.favpanel=new Element("div",{id:"favpanel_"+this.postid,style:"display:none;"}),this.favpanel.addClassName("fav_star"),this.favpanel.addClassName("posterous_favorite"),document.body.appendChild(this.favpanel),this.messageDiv=new Element("span",{style:"display:none;"}),this.favpanel.appendChild(this.messageDiv),this.favImg=new Element("img",{src:"/images/icons/star.png",width:16,height:16}),this.favpanel.appendChild(this.favImg),this.updateView()},mouseoverHandler_delegate:function(a){this.isLoading||(this.messageDiv.show(),this.favpanel.addClassName("fav_mouseover")),this.resetFavpanelPosition()},mouseoutHandler_delegate:function(a){this.isLoading||(this.messageDiv.hide(),this.favpanel.removeClassName("fav_mouseover")),this.resetFavpanelPosition()},updateMessage:function(){this.isLoading?this.messageDiv.innerHTML="Saving...":this.isFaved?this.messageDiv.innerHTML="Unfavorite this":this.messageDiv.innerHTML="Favorite this"},updateIcon:function(){this.isLoading?this.favImg.src="/images/loading.gif":this.isFaved?this.favImg.src="/images/icons/star.png":this.favImg.src="/images/icons/star-hover.png"},updateView:function(){this.updateMessage(),this.updateIcon()},clickHandler_delegate:function(a){this.isLoading=!0,this.messageDiv.show(),this.updateView(),this.favpanel.addClassName("phover_donothide");var b=this;new Ajax.Updater(this.messageDiv,"/reader/favorite",{parameters:{id:this.postid,add:!b.isFaved,authenticity_token:window._token},onLoading:function(){b.resetFavpanelPosition()},onComplete:function(){b.isFaved=!b.isFaved,b.isLoading=!1,b.updateIcon(),b.resetFavpanelPosition()}})},resetFavpanelPosition:function(){this.tooltip.reposition(this.favpanel.getAttribute("id"))}}),PComment=Class.create({initialize:function(a,b,c){this.container=$(c),this.postId=b,this.commentLink=$(a),this.linkClickHandler=this.linkClick_delegate.bindAsEventListener(this),this.commentLink.observe("click",this.linkClickHandler)},linkClick_delegate:function(a){return $(this.commentLink.parentNode).hide(),this.commentDiv==null?this.createCommentDiv():Effect.SlideDown(this.outerDiv,{duration:.5}),Event.stop(a),!1},hideCommentDiv:function(){Effect.SlideUp(this.outerDiv),Effect.SlideDown($(this.commentLink.parentNode))},createCommentDiv:function(){this.outerDiv=new Element("div",{"class":"posterous_comments_wrapper",style:"display: none"}),this.commentDiv=new Element("div"),this.commentDiv.addClassName("posterous_comments"),this.loadingDiv=new Element("div",{style:"display: none;"}),this.loadingDiv.addClassName("comment_loading_div"),this.loadingImg=new Element("img",{src:"/images/loading.gif"}),this.loadingDiv.appendChild(this.loadingImg),this.container.appendChild(this.loadingDiv),this.outerDiv.appendChild(this.commentDiv),this.container.appendChild(this.outerDiv),this.loadingDiv.show(),new Ajax.Updater(this.commentDiv,"/posts/getcomments",{parameters:{id:this.postId,authenticity_token:window._token},evalScripts:!0,onLoading:function(){},onComplete:function(){Effect.SlideDown(this.outerDiv,{duration:.5,afterFinish:function(){p.initializeCommentForm(null,this.commentDiv.down('[data-posterous-comment-form="true"]').id)}.bind(this)}),this.loadingDiv.hide(),FB.XFBML.parse()}.bind(this)})}}),PTwitterComment=Class.create({initialize:function(a,b,c,d,e,f,g){this.twitterCheckbox=$(a),this.commentBox=$(b),this.twitterBox=$(c),this.twitterDiv=$(d),this.twitterUsername=e,this.twitterShorturl=f,this.linkOutput=!0,this.showLink=g,this.setup(),this.updateAll()},updateAll:function(){this.updateTwitterBox(),this.updateCheckbox()},setup:function(){this.twitterCheckbox.observe("click",this.updateCheckbox.bindAsEventListener(this)),this.twitterBox.observe("change",function(){this.linkOutput=!1}.bindAsEventListener(this)),this.twitterBox.observe("keyup",this.updateTwitterCount.bindAsEventListener(this)),this.commentBox.observe("keyup",this.updateTwitterBox.bindAsEventListener(this)),this.numLeft=new Element("div",{style:"font-size: 10px; color: #090; line-height: 12px;"}),this.twitterDiv.appendChild(this.numLeft),this.twitterBoxExpander=new Texpand(this.twitterBox)},getCommentBoxValue:function(){return this.commentBox.value.gsub(/\n/,"")},specialTruncate:function(a,b){return a.length>b&&(a=a.substring(0,b-3).replace(/[ \.]\w+$/,""),a+="..."),a},updateTwitterBox:function(){if(!this.linkOutput)return;var a=this.twitterUsername?this.twitterUsername+" ":"",b=this.twitterShorturl?" "+this.twitterShorturl:"",c=140-a.length,d=this.getCommentBoxValue();c>=d.length&&this.twitterUsername&&!this.showLink?this.twitterBox.value=a+d:d.length>0&&(this.twitterBox.value=a+this.specialTruncate(d,c-b.length)+b),this.updateTwitterCount(),this.twitterBoxExpander._autoExpand()},updateTwitterCount:function(){var a=140-this.twitterBox.value.length;a>=0?this.numLeft.innerHTML=a+" characters left":this.numLeft.innerHTML=-1*a+" characters over the 140 character limit"},updateCheckbox:function(){this.twitterCheckbox.checked?this.twitterDiv.show():this.twitterDiv.hide()}}),Texpand=Class.create();Texpand.prototype={initialize:function(a){var b=this;this.element=$(a),this.increment=14;if(this.element.tagName.toLowerCase()!="textarea")throw"Texpand: can only be initialized with a <textarea> but got <"+this.element.tagName.toLowerCase()+">";if(typeof Prototype=="undefined"||parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6)throw"Texpand: requires Prototype 1.6.0+";if(typeof Effect=="undefined")throw"Textpand: requires Script.aculo.us, specifically Effects";this.element.insert({after:'<div id="texpand-mimic-'+this.element.identify()+'"></div>'}),this.mimic=this.element.next(),this.mimic.update(this.element.value);if(Prototype.Browser.IE){var c=this.element.getStyle("fontSize");if(c.search(/em/)>=0){var d=parseFloat(c.replace(/em/,""))*10;this.element.setStyle({fontSize:d+"px"})}}var e={},f=$w("borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing");return f.each(function(a){e[a]=b.element.getStyle(a)}),this.mimic.setStyle(e),this.mimic.setStyle({display:"none",position:"absolute",left:"-9999px",top:"-9999px"}),this.element.observe("keyup",b._autoExpand.bind(b)),this._autoExpand(null),this.element},_autoExpand:function(a){this.mimic.update(this.element.value.replace(/\n/gm,"<br />"));var b=this.mimic.getHeight(),c=this.element.getHeight(),d=c-b,e=c+(this.increment-d);if(d<this.increment){var f=Effect.Queues.get("texpand"+this.element.identify());f.each(function(a){a.cancel()}),this.element.morph("height: "+e+"px;",{duration:.1,queue:{position:"end",scope:"texpand"+this.element.identify(),limit:2}})}}};var PosterousHeader=Class.create({initialize:function(a,b){this.options=Object.extend({imgClear:"/images/header/default-clear-right.png",imgColored:"/images/header/yellow-arrow.png",imgArrow:"/images/header/yellow-arrow.png",imgExpanded:"/images/header/yellow-expanded.png",imgClearLeft:"/images/header/default-clear-left.png",imgColoredLeft:"/images/header/yellow-arrow-left.png",imgArrowLeft:"/images/header/yellow-arrow-left.png",imgExpandedLeft:"/images/header/yellow-expanded-left.png",clearDefault:!0,top_active_area_px:25,hide_offset_px:25,direction:"right"},b||{}),this.headerDiv=$(a),this.viewstate="",this.setup(),this.observeSubscriptionButtons()},observeSubscriptionButtons:function(){var a=$("posterous_bar_unsubscribe"),b=$("posterous_bar_subscribe"),c=$("posterous_loading_image");a&&b&&(a.observe("click",function(d){d.stop(),confirm("Are you sure you want to unsubscribe from this posterous?")&&this.performSubscriptionAction(a,b,c)}.bindAsEventListener(this)),b.observe("click",function(d){d.stop(),this.performSubscriptionAction(b,a,c)}.bindAsEventListener(this)))},performSubscriptionAction:function(a,b,c){action=a.readAttribute("data-action"),siteId=a.readAttribute("data-site_id"),method=action=="addsub"?"post":"delete",new Ajax.Request("/members",{method:method,parameters:{authenticity_token:window._token,site_id:siteId},onLoading:function(){c.show(),a.hide()},onSuccess:function(){b.show()},onComplete:function(){c.hide()}})},setup:function(){$("posterousbar_nojs")&&$("posterousbar_nojs").hide();if(this.options.clearDefault){var a=this.getParentBackgroundColor(this.headerDiv.up());this.getColorSum(a)>384?this.headerDiv.addClassName("posterousHeaderLight"):this.headerDiv.addClassName("posterousHeaderDark")}else this.headerDiv.addClassName("posterousHeaderLight");this.options.direction=="left"&&this.headerDiv.addClassName("posterousHeaderLeft"),this.headerDiv.addClassName("posterousHeader");var b=this.headerDiv.innerHTML;this.headerDiv.innerHTML="",this.options.direction=="right"?(this.defaultImg=(new Element("img",{src:this.options.clearDefault?this.options.imgClear:this.options.imgColored})).addClassName("posterousHeaderImageRight"),this.defaultArrowImg=(new Element("img",{src:this.options.imgArrow,style:"display: none;"})).addClassName("posterousHeaderImageRight"),this.defaultExpandedImg=(new Element("img",{src:this.options.imgExpanded,style:"display: none;"})).addClassName("posterousHeaderImageRight")):(this.defaultImg=(new Element("img",{src:this.options.clearDefault?this.options.imgClearLeft:this.options.imgColoredLeft})).addClassName("posterousHeaderImageLeft"),this.defaultArrowImg=(new Element("img",{src:this.options.imgArrowLeft,style:"display: none;"})).addClassName("posterousHeaderImageLeft"),this.defaultExpandedImg=(new Element("img",{src:this.options.imgExpandedLeft,style:"display: none;"})).addClassName("posterousHeaderImageLeft"));var c=(new Element("a",{href:"http://posterous.com/"})).addClassName("mp_logo_btn");c.appendChild(this.defaultImg),c.appendChild(this.defaultArrowImg),c.appendChild(this.defaultExpandedImg),this.posterousImg=this.defaultImg,this.headerDiv.appendChild(c),this.expandedDiv=(new Element("div",{id:this.headerDiv.id+"expanded_content",style:"display: none;"})).update("Hello world!"),this.expandedDiv.innerHTML=b,this.expandedDiv.addClassName(this.options.direction=="right"?this.options.clearDefault?"posterousHeaderExpandedDivRight":"posterousHeaderExpandedDivRightOpaque":this.options.clearDefault?"posterousHeaderExpandedDivLeft":"posterousHeaderExpandedDivLeftOpaque"),this.headerDiv.appendChild(this.expandedDiv),this.setState("hidden"),document.observe("mousemove",this.mouseHandler.bindAsEventListener(this)),Effect.Appear(this.headerDiv)},getParentBackgroundColor:function(a){if(a.getStyle==null)return"transparent";var b=a.getStyle("background-color");return b&&b!="transparent"&&b!="rgba(0, 0, 0, 0)"?b:a.up()?this.getParentBackgroundColor(a.up()):"transparent"},getColorSum:function(a){var b=0;return Prototype.Browser.IE&&(a=a.gsub(/^#/,""),a=a.gsub(/^([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/,"#{1}#{1}#{2}#{2}#{3}#{3}"),a=a.gsub(/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,function(a){return parseInt(a[1],16)+" "+parseInt(a[2],16)+" "+parseInt(a[3],16)})),a.scan(/\d+/,function(a){b+=parseInt(a)}),b},mouseHandler:function(a){var b=Event.pointerX(a),c=Event.pointerY(a);this.getCurrentPositions(),this.viewstate=="expanded"&&this.isInExpandedArea(b,c)||this.isInActivationArea(b,c)?this.setState("expanded"):this.viewstate!="expanded"&&this.isInTeaserArea(b,c)?this.setState("arrow"):this.setState("hidden")},setState:function(a){if(this.viewstate==a)return;a=="expanded"?(this.defaultImg.hide(),this.defaultArrowImg.hide(),this.posterousImg=this.defaultExpandedImg,Prototype.Browser.IE?this.expandedDiv.show():(this.sliding=!0,Effect.Appear(this.expandedDiv,Object.extend({duration:.15,afterFinish:function(){this.sliding=!1}.bindAsEventListener(this)}))),this.posterousImg.show()):a=="arrow"&&this.viewstate!="expanded"&&!this.sliding?(this.defaultImg.hide(),this.defaultExpandedImg.hide(),this.posterousImg=this.defaultArrowImg,this.posterousImg.show()):(this.posterousImg=this.defaultImg,Prototype.Browser.IE?(this.defaultArrowImg.hide(),this.defaultExpandedImg.hide(),this.posterousImg.show(),this.expandedDiv.hide()):(this.sliding=!0,Effect.Fade(this.expandedDiv,Object.extend({duration:.1,afterFinish:function(){this.defaultArrowImg.hide(),this.defaultExpandedImg.hide(),this.posterousImg.show(),this.sliding=!1}.bindAsEventListener(this)})))),this.viewstate=a},isInActivationArea:function(a,b){return b<this.e_off.top+this.e_dim.height+5&&a>=this.e_off.left&&a<=this.e_off.left+this.e_dim.width},isInExpandedArea:function(a,b){return b<this.t_off.top+this.t_dim.height+this.options.hide_offset_px&&a>=this.t_off.left-this.options.hide_offset_px&&a<=this.t_off.left+this.t_dim.width+this.options.hide_offset_px},isInTeaserArea:function(a,b){return b<this.t_off.top+this.t_dim.height+this.options.top_active_area_px&&a>=this.e_off.left-this.options.top_active_area_px&&a<=this.e_off.left+this.e_dim.width+this.options.top_active_area_px},getCurrentPositions:function(){this.e_dim=this.posterousImg.getDimensions(),this.e_off=this.posterousImg.cumulativeOffset(),this.t_dim=this.headerDiv.getDimensions(),this.t_off=this.headerDiv.cumulativeOffset()}});document.observe("dom:loaded",function(){$("posterous_modal_flash")&&(setTimeout("Effect.Appear($('posterous_modal_flash'))",1e3),$("posterous_modal_flash").observe("click",function(){Effect.Fade($("posterous_modal_flash"),{duration:.5})})),$("footerbar")&&$("footerbar").hasClassName("claimbar")&&setTimeout("Effect.BlindDown($('footerbar'))",1e3)});var isIphone=navigator.userAgent.toLowerCase().indexOf("mobile")!=-1&&(navigator.userAgent.toLowerCase().indexOf("iphone")!=-1||navigator.userAgent.toLowerCase().indexOf("ipod")!=-1||navigator.userAgent.toLowerCase().indexOf("ipad")!=-1),Application=Class.create({_posterousDefaultAnimationDurationLong:.5,_posterousDefaultAnimationDurationShort:.2,modalWindow:null,posts:{},postIds:[],retries:0,initialize:function(){if($$("body").first().hasClassName("mobile")){this.initializeMobile();return}this.registerProtomenus(),this.initializeSubscriptionButtons(),this.initializeSubscriptionLinks(),this.initializeTagModal();if(!$$('meta[name="generator"]').first())return;try{this.registerShowOnClickActions(),this.registerShowOnHoverActions(),this.registerSearchBoxes(),this.registerComment(),this.registerRetweetButtons(),this.parseCodeBlocks(),this.fillAllTimeAgoFields()}catch(a){}this.afterDeferredContentCallbacks=[this.setAuthenticityToken.bind(this),this.registerPosterousBar.bind(this),this.registerSubscribeLinks.bind(this),this.registerSubscribeContent.bind(this),this.createFavorite.bind(this),this.replaceViewCounts.bind(this),this.createNewCommentForm.bind(this),this.initializeCommentForm.bind(this),this.insertAdminBox.bind(this),this.removeUnauthorizedEditBoxes.bind(this),this.fixDeleteLinks.bind(this),this.registerProtomenus.bind(this),this.postMixpanelUserActivity.bind(this),this.postMixpanelSiteActivity.bind(this)]},initializeMobile:function(){this.fillAllTimeAgoFields()},makeDeferredCallbacks:function(a){this.afterDeferredContentCallbacks.each(function(b){b(a)},this),window.deferredContent=a,$j(window).trigger("app:deferredContentComplete")},postMixpanelUserActivity:function(a){},postMixpanelSiteActivity:function(){var a=$j("[data-site-id]");if(a.length>0)var b=a.attr("data-site-id"),c=a.attr("data-site-is-private")},registerProtomenus:function(){Prototype.Browser.IE||$$('[data-posterous-protomenu="true"]').each(function(a){a.href="#",a.down("img").show(),items=$(a.readAttribute("data-posterous-items-list-id")).select("li a").map(function(a){return{href:a.href,name:a.innerHTML,icon:a.readAttribute("data-icon")}}),new Proto.Menu({selector:"#"+a.id,position:"relative",location:a,click:"left",width:200,className:"menu desktop",menuItems:items})})},registerShowOnClickActions:function(){$$('[data-posterous-show-on-click="true"]').each(function(a){var b=$(a.readAttribute("data-posterous-hide-on-click-id")),c=$(a.readAttribute("data-posterous-action-trigger-id")),d=$(a.readAttribute("data-posterous-id-to-show-on-click"));c&&d&&c.observe("click",function(a){a.stop(),b&&b.hide(),Effect.toggle(d,"slide",{duration:this._posterousDefaultAnimationDurationLong,afterFinish:function(){$j("body").trigger("show-on-click:finished")}})}.bindAsEventListener(this))},this)},registerShowOnHoverActions:function(){$$('[data-posterous-show-on-hover="true"]').each(function(a){var b=$(a.readAttribute("data-posterous-action-trigger-id")),c=$(a.readAttribute("data-posterous-id-to-show-on-hover"));b&&c&&(b.observe("mouseover",function(){c.show()}),b.observe("mouseout",function(){c.hide()}))})},registerSubscribeLinks:function(a){$$('[data-posterous-subscribe-link="true"]').each(function(b){var c=$(b.readAttribute("data-posterous-action-trigger-id")),d=$(b.readAttribute("data-posterous-id-to-be-replaced")),e=$(b.readAttribute("data-posterous-loading-element")),f=b.readAttribute("data-posterous-subscription-action").strip()=="addsub"?"addsub":"removesub",g=b.readAttribute("data-posterous-site-id");f=="addsub"?a.subscribed_to_this_site?b.hide():b.show():a.subscribed_to_this_site?b.show():b.hide(),c&&c.observe("click",function(a){a.stop(),new Ajax.Request("/members/modal",{method:"get",evalScripts:!0,parameters:{site_id:g},onLoading:function(){e.show(),c.hide(),d.update()},onComplete:function(){e.hide()},onSuccess:function(a){var b=a.responseJSON;Control.Modal.open(b.rsp,{height:5,width:500}),Control.Modal.showInternalElement($("modal_container").down(),Effect.Appear),this.initializeSubscriptionModal()}.bind(this)})}.bind(this))}.bind(this))},initializeSubscriptionButtons:function(){$$('[data-posterous-subscribe-onsite-link="true"]').each(function(a){new StateButton(a,{initialState:a.readAttribute("data-posterous-member-type"),states:{unsubscribed:{text:"Subscribe"},subscribed:{text:"Subscribed",tooltip:"Click to change notification settings or unsubscribe."},contributor:{text:"You're a contributor",tooltip:"Click to change notification settings or unsubscribe."},admin:{text:"You're an admin",tooltip:"Click to change notification settings or unsubscribe."},nonuser:{text:"Subscribe by email"},loading:{text:"Loading..."}},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},initializeSubscriptionLinks:function(){$$(".posterous_trigger_member_modal").each(function(a){new StateLink(a,{initialState:a.readAttribute("data-posterous-member-type"),states:{unsubscribed:{text:"Subscribe"},subscribed:{text:"Manage how I get email updates"},contributor:{text:"Manage how I get email updates"},admin:{text:"Manage how I get email updates"},nonuser:{text:"Subscribe by email"},loading:{text:"Loading..."}},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},registerSubscribeContent:function(a){$$('[data-posterous-subscribe2-link="true"]').each(function(b){new StateContainer(b,{initialState:a.member_type,states:{unsubscribed:b.readAttribute("data-posterous-subscription-unsubscribed-content"),subscribed:b.readAttribute("data-posterous-subscription-subscribed-content"),contributor:b.readAttribute("data-posterous-subscription-contributor-content"),admin:b.readAttribute("data-posterous-subscription-admin-content"),nonuser:b.readAttribute("data-posterous-subscription-non-user-content"),loading:b.readAttribute("data-posterous-loading")},stateTriggers:{unsubscribed:b.readAttribute("data-posterous-subscription-unsubscribed-action"),subscribed:b.readAttribute("data-posterous-subscription-subscribed-action"),contributor:b.readAttribute("data-posterous-subscription-contributor-action"),admin:b.readAttribute("data-posterous-subscription-admin-action"),nonuser:b.readAttribute("data-posterous-subscription-non-user-action")},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},subscriptionButtonClicked:function(a){var b=a.currentState(),c=a.element.readAttribute("data-posterous-site-id");a.changeState("loading");var d=null,e=this;b=="unsubscribed"?new Ajax.Request("/members",{method:"post",parameters:{site_id:c,authenticity_token:window._token},onComplete:a.changeState.bind(a,"subscribed"),onSuccess:function(){e.openSubscriptionModal(b,c,{stateButton:a,afterClose:function(){b!="unsubscribed"&&a.changeState(b)}})}}):this.openSubscriptionModal(b,c,{stateButton:a,afterClose:function(){b!="unsubscribed"&&a.changeState(b)}})},openSubscriptionModal:function(a,b,c){var d=$H({}),c=d.merge($H(c||{})),e=a=="nonuser"?500:250;new Ajax.Request("/members/modal",{method:"get",parameters:{site_id:b,just_followed:a=="unsubscribed"?!0:null},onSuccess:function(b){Control.Modal.open(b.responseJSON.rsp,{height:5,width:e,afterClose:c.get("afterClose")}),Control.Modal.showInternalElement($("modal_container").down(),Effect.Appear),this.initializeSubscriptionModal(c),typeof c.get("callback")=="function"&&c.get("callback")(a)}.bind(this)})},initializeSubscriptionModal:function(a){$$(".modal_cancel").each(function(a){a.observe("click",Control.Modal.close)}),this.initializeNotificationForm(a),this.initializeSubscriptionForm(a)},initializeNotificationForm:function(a){$("notification_user_option_form")&&$("notification_user_option_select").observe("change",function(){$("notification_user_option_form").request({onLoading:function(){$("notification_user_option_ajax_result").update("<img src='/images/loading.gif' width='16' height='16' alt='loading'/>")},onSuccess:function(a){var b=a.responseJSON;$("notification_user_option_ajax_result").update("<img src='/images/icons/silk/accept.png' width='16' height='16'/>")},onFailure:function(a){var b=a.responseJSON;$("notification_user_option_ajax_result").update("<img src='/images/icons/silk/error.png' width='16' height='16'/>")}})})},initializeSubscriptionForm:function(a){if($("subscribe_form")){var b=$$("#modal_container .subscription_form").first();$("subscribe_form_submit").observe("click",function(c){c.stop(),(!b||b.readAttribute("data-is-admin-or-contributor")!=""||confirm("Are you sure you want to remove yourself from this site?"))&&$("subscribe_form").request({onLoading:function(){$("subscribe_form_response").visible()&&Control.Modal.hideInternalElement($("subscribe_form_response")),Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_buttons"),$("subscribe_form_loading"))})},onSuccess:function(c){var d=c.responseJSON;$("subscribe_form_response").removeClassName("subscribe_form_response_fail"),$("subscribe_form_response").addClassName("subscribe_form_response_success"),$("subscribe_form_response").update(d.rsp),b&&a.get("stateButton")&&(delete Control.Modal.current.options.afterClose,b.readAttribute("data-member")==""?a.get("stateButton").changeState("unsubscribed"):b.readAttribute("data-logged-in")==""&&a.get("stateButton").changeState("subscribed")),Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_loading"),$("subscribe_form_response"))}),Effect.waitForQueueClear(function(){d.reloadWindow?window.location.reload(!0):setTimeout(function(){Control.Modal.close(!1,!0)},1500)})},onFailure:function(a){$("subscribe_form_response").addClassName("subscribe_form_response_fail"),$("subscribe_form_response").update(a.responseJSON.rsp),Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_loading"),$("subscribe_form_buttons"))}),Effect.waitForQueueClear(function(){Control.Modal.showInternalElement($("subscribe_form_response"))})}})})}},registerSearchBoxes:function(){$$('[data-posterous-search-box="true"]').each(function(a){var b=$(a.readAttribute("data-posterous-search-button-id")),c=$(a.readAttribute("data-posterous-search-box-id")),d=!1;b&&c&&(b.observe("mouseover",function(){d=!0}),b.observe("mouseout",function(){d=!1}),c.observe("focus",function(){b.show()}),c.observe("blur",function(){d||b.hide()}))})},registerPosterousBar:function(a){$$('[data-posterous-bar="true"]').each(function(b){$(b.readAttribute("data-posterous-action-id")||b.id).insert({bottom:a.posterous_bar}),new PosterousHeader($(b.readAttribute("data-posterous-action-id")||b.id),{direction:b.readAttribute("data-posterous-direction")||"left",clearDefault:b.readAttribute("data-posterous-translucent")||"false"})}),$$('[data-posterous-bar-legacy="true"]').each(function(b){b.update(a.posterous_bar_legacy).show()},this);var b=$j("a[data-mixpanel-id=mp_slideshow_btn]")},createFavorite:function(a){if(a.logged_in){var b=null;$$('[data-posterous-favorite="true"]').each(function(c){$(c.readAttribute("data-posterous-position"))&&$(c.readAttribute("data-posterous-hover"))&&(b=a.post_favorited[parseInt(c.readAttribute("data-posterous-identifier"),10)],new PFavorite(c.readAttribute("data-posterous-hover"),c.readAttribute("data-posterous-position"),c.readAttribute("data-posterous-identifier"),b==1))},this);var c;$j("[data-posterous-like-button-for-post-id]").each(function(b){c=$j(this).attr("data-posterous-like-button-for-post-id"),p.setLikedState(c,a.post_favorited[parseInt(c,10)])})}},setLikedState:function(a,b){var c=$j('[data-posterous-like-button-for-post-id="'+a+'"]');if(b)var d=c.attr("data-posterous-unlike-text"),e="unlike_post",f=c.attr("data-unlike-url");else var d=c.attr("data-posterous-like-text"),e="like_post",f=c.attr("data-like-url");c.removeClass().addClass(e).attr("href",f).attr("title",d).children("span").html(d),!Modernizr&&(document.body||document.documentElement).style.WebkitPerspective===undefined||!Modernizr.csstransforms3d?b?(c.children(".p_unlike_icon").show(),c.children(".p_like_icon").hide()):(c.children(".p_unlike_icon").hide(),c.children(".p_like_icon").show()):(c.children(".p_unlike_icon").show(),c.children(".p_like_icon").show())},registerComment:function(){$$('[data-posterous-comment="true"]').each(function(a){$(a.readAttribute("data-posterous-comment-link"))&&(window[a.readAttribute("data-posterous-comment-var")]=new PComment($(a.readAttribute("data-posterous-comment-link")),a.readAttribute("data-posterous-post-identifier"),$(a.readAttribute("data-posterous-post-div"))))})},registerRetweetButtons:function(){$$('[data-posterous-retweet="true"]').each(function(a){new PModal(a.id,"/posts/retweet",{post_id:a.readAttribute("data-posterous-post-id"),authenticity_token:window._token},{width:500,height:160,identifier:"retweet_modal_"+a.readAttribute("data-posterous-post-id")})})},parseCodeBlocks:function(){$$('[data-posterous-parse-code="true"]').length>0&&(dp.SyntaxHighlighter.ClipboardSwf="/javascripts/syntaxhighlighter/clipboard.swf",dp.SyntaxHighlighter.HighlightAll("code",!1))},replaceViewCounts:function(a){$$('[data-posterous-view-count="true"]').each(function(b){var c=parseInt(b.readAttribute("data-posterous-post-id"),10);a&&a.post_views&&(a.post_views[c]||a.post_views[c]===0)&&b.replace(a.post_views[c])})},fillAllTimeAgoFields:function(){var a=null;$$('[data-posterous-time-ago="true"]').each(function(b){a=parseInt(b.readAttribute("data-posterous-pubdate"),10),b.replace(this._timeAgoInWords(a)+" ago")},this)},insertAdminBox:function(a){$$('[data-posterous-admin-box="true"]').each(function(b){b.replace(a.admin_box)})},renderCaptcha:function(a){var b="p_comment_captcha",c=$j("#"+b),d=".commentunit:last input:submit",e="#recaptable_table";c.length>0?(c.insertBefore(d,a),Recaptcha.reload(),Recaptcha.focus_response_field()):(c=$j('<div id="'+b+'"></div>').insertBefore(d,a),Recaptcha.create("6LfjeMwSAAAAAClMhZogTtkOqrAAIKHqYBn3dPZJ",b,{theme:"white",callback:function(){Recaptcha.focus_response_field()}}))},resetErrors:function(a){Recaptcha.destroy(),$j(a).prev().remove(),$j("#p_comment_captcha").remove()},initializeCommentForm:function(a,b){var c=null,d=!1,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=b?[$(b)]:$$('[data-posterous-comment-form="true"]');$$('[data-posterous-user-setting-toggle="true"]').each(function(a){a.observe("click",function(){a.checked?new Ajax.Request("/user_settings/set/"+a.readAttribute("data-posterous-user-setting-attribute"),{method:"get"}):new Ajax.Request("/user_settings/unset/"+a.readAttribute("data-posterous-user-setting-attribute"),{method:"get"})})}),l.each(function(a){c=a.readAttribute("data-posterous-post-id"),d=a.readAttribute("data-posterous-facebook")=="true",(h=$("pcomment_newbody_"+c))&&new Texpand(h),a.select('.facebook_login_button, [data-facebook-login-botton="true"]').each(function(a){a.observe("click",function(b){b.stop(),FB.login(function(b){window.location.href=a.href})})}),(f=a.down(".facebook_logout_button"))&&f.observe("click",function(a){a.stop(),FB.logout(function(a){window.location.reload(!0)})});if(k=$$('[data-posterous-twitter-oauth="true"]').first())this.posts=unescape(k.readAttribute("data-posterous-post-ids").gsub("+"," ")).evalJSON();a.select(".twitter_login_button").each(function(a){a.observe("click",function(a){a.stop(),this.initOauthAndRedirectToPost("1",this.posts[parseInt(c,10)])}.bindAsEventListener(this))},this);if(i=$("comment_email_notify_toast_"+c))$("comment_email_notify_"+c).observe("click",function(){this._refreshToast(c,!0)}),this._refreshToast(c,!1);if(twitterPreview=$("twitter_preview_"+c))j=new PTwitterComment("push_twitter_comment_"+c,"pcomment_newbody_"+c,"twitter_body_"+c,"twitter_preview_"+c,twitterPreview.readAttribute("data-posterous-twitter-username"),twitterPreview.readAttribute("data-posterous-short-url"),twitterPreview.readAttribute("data-posterous-show-lin")),j.updateAll();a.observe("submit",function(b){b.stop(),$("push_fbfeed_"+c)&&$("push_fbfeed_"+c).checked&&FB.getSession()==null&&FB.login(Prototype.empty),$("pcomment_submit_loading_"+c).show(),$("posterous_submit_"+c).hide(),$j.ajax({type:"post",url:a.action,data:$j(this).serialize(),success:function(a){$("pcomment_newbody_"+c).value="",$("twitter_body_"+c)&&($("twitter_body_"+c).value="")},complete:function(b){var e=$j("#pcomment_form_"+c),f=e.children(),g=f.last(),h=$j(".comment_value.comment_ajax_response",e);b.status==200?(p.resetErrors(g),$j("#pcomment_comments_new_"+c).append(b.responseText)):(h.length>0?$j(b.responseText).replaceAll(g.prev()):$j(b.responseText).insertBefore(g),p.renderCaptcha(a)),$("pcomment_submit_loading_"+c).hide(),$("posterous_submit_"+c).show(),$("first_comment_"+c)&&$("first_comment_"+c).hide(),$("pcomment_comments_new_"+c).highlight(),d&&p.publishCommentToFacebook(c)}})})},this)},publishCommentToFacebook:function(a,b,c){window["fb_comment_"+a]=b||$("pcomment_newbody_"+a).value,window["push_fbfeed_"+a]=c||($("push_fbfeed_"+a)?$("push_fbfeed_"+a).checked:!1),window["push_fbfeed_"+a]&&(window["fb_comment_attachment_"+a]==undefined&&(window["fb_comment_attachment_"+a]=null),window["fb_comment_action_link_"+a]==undefined&&(window["fb_comment_action_link_"+a]=null
),window.fbid_site_owner==undefined&&(window.fbid_site_owner=1),new PeriodicalExecuter(function(b){FB.getSession()!=null&&(FB.ui({method:"stream.publish",message:window["fb_comment_"+a],user_message_prompt:"What are your comments?",attachment:window["fb_comment_attachment_"+a],action_links:window["fb_comment_action_link_"+a]}),b.stop())},1)),FB.XFBML.parse()},createNewCommentForm:function(a){if(!a.new_comment_form)return;$$('[data-posterous-new-comment-form="true"]').each(function(b){b.replace(a.new_comment_form),FB.XFBML.parse()})},initializeTagForm:function(a,b){var c=$j(this),d=$j.parseJSON($j(b.modal).find("[data-tag-feed]").attr("data-tag-feed")),e=c.attr("data-post-id"),f=$j(b.modal).find("[data-tag-feed]").attr("data-create-url"),g=$j(b.modal).find("[data-tag-feed]").attr("data-destroy-url"),h=new ProtoMultiSelect("tags-input-box",null,{feed:d,defaultMessage:"Type the name of a tag you'd like to add to this post.",newValues:!0,sortResults:!0,onUserAdd:function(a){$j.jsonp({url:f,data:{tags:a.caption,post_id:e,authenticity_token:window._token,format:"jsonp"}})},onUserRemove:function(a){$j.jsonp({url:g,data:{caption:a.caption,id:a.value,new_value:a.newValue,post_id:e,authenticity_token:window._token,format:"jsonp"}})}});h.inputElem.focus()},initializeTagModal:function(){$j('a[data-posterous-tag-form="true"]').bind("modal:success",this.initializeTagForm)},removeUnauthorizedEditBoxes:function(a){$$('[data-posterous-edit-box="true"]').each(function(b){a.edit_boxes[parseInt(b.readAttribute("data-posterous-post-id"),10)]?b.removeClassName("posterous_edit_box_hidden"):b.remove()})},setAuthenticityToken:function(a){a.authenticity_token&&(window._token=a.authenticity_token,window._posterousToken=a.posterous_authenticity_token)},fixDeleteLinks:function(){$$('[data-posterous-delete-link="true"]').each(function(a){a.observe("click",function(b){a.innerHTML="Deleting...",Event.stop(b),confirm(a.readAttribute("data-posterous-confirm"))&&new Ajax.Request(a.href,{method:"delete",parameters:{authenticity_token:window._token},onSuccess:function(){window.location.reload()}})})})},_refreshToast:function(a,b){$("comment_email_notify_"+a).checked?($("comment_email_notify_toast_"+a).value="Please enter your email address here",$("comment_email_notify_toast_"+a).show(),b&&($("comment_email_notify_toast_"+a).focus(),$("comment_email_notify_toast_"+a).select())):($("comment_email_notify_toast_"+a).value="",$("comment_email_notify_toast_"+a).hide())},initOauthAndRedirectToPost:function(a,b){this.modalWindow=window.open("","_blank","height=400,width=800,left=300,top=200,resizable=yes",!0),this.modalWindow.location.href=$$('[data-posterous-twitter-oauth="true"]').first().readAttribute("data-posterous-redirect-url")+a,new PeriodicalExecuter(function(a){this.modalWindow.closed&&(window.location.href==b||window.location.href+"#comments"==b?window.location.reload():window.location.href=b,a.stop())}.bind(this),.25)},_timeAgoInWords:function(a){var b=Math.floor((new Date).getTime()/1e3);return this._distanceOfTimeInWords(b,a)},_distanceOfTimeInWords:function(a,b){return secondsAgo=a-b,minutesAgo=Math.max(Math.floor(secondsAgo/60),0),minutesAgo==0?"less than a minute":minutesAgo==1?"1 minute ago":minutesAgo<45?minutesAgo+" minutes":minutesAgo<90?" 1 hour":(hoursAgo=Math.floor(minutesAgo/60),minutesAgo<1440?hoursAgo+" hours":minutesAgo<2880?"1 day":(daysAgo=Math.floor(minutesAgo/1440),minutesAgo<43200?daysAgo+" days":minutesAgo<86400?"1 month":(monthsAgo=Math.floor(minutesAgo/43200),minutesAgo<525960?monthsAgo+" months":minutesAgo<1051920?"1 year":(yearsAgo=Math.floor(minutesAgo/525960),"over "+yearsAgo+" years"))))}});typeof Effect!="undefined"&&Object.extend(Effect,{swapElems:function(a,b,c){c||(c={}),Effect.Fade(a,Object.extend(c,{queue:"front"})),Effect.Appear(b,Object.extend(c,{queue:"end"}))},waitForQueueClear:function(a,b){b||(b="global"),new PeriodicalExecuter(function(c){Effect.Queues.get(b).effects.length==0&&(c.stop(),a())},.2)}}),Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction,this.transport.abort(),Ajax.activeRequestCount--},document.observe("dom:loaded",function(){p=new Application,$$("body").first().fire("posterous:initialized")});var ActionMenu=Class.create({initialize:function(a,b){var c=$H({onItemSelected:null,onMenuOpened:null});this.menu=$(a),!this.menu.readAttribute("data-menu-activated")!="true"&&(this.menu.writeAttribute("data-menu-activated","true"),this.options=c.merge($H(b||{})),this.button=this.menu.down(".button, .action_menu_dropdown_button"),this.dropDown=this.button.next(),this.button.observe("click",this.menuOpened.bindAsEventListener(this)),this.dropDown.select("a").each(function(a){a.observe("click",this.itemSelected.bindAsEventListener(this,a))},this))},itemSelected:function(a,b,c){c||typeof this.options.get("onItemSelected")=="function"&&this.options.get("onItemSelected")(a,b,this)},menuOpened:function(a){a.stop(),ActionMenu.resetAllDropdowns(),this.button.hasClassName("active")||(this.button.addClassName("active"),this.dropDown.show()),this.menu.setStyle({zIndex:1e3}),typeof this.options.get("onMenuOpened")=="function"&&this.options.get("onMenuOpened")(a,this)}});ActionMenu.resetAllDropdowns=function(){$$(".action_menu, .state_menu").each(function(a){a.setStyle({zIndex:1}),a.down(".action_menu_dropdown:visible").hide(),a.down(".action_menu_dropdown_button, .button").removeClassName("active")})};var StateMenu=Class.create(ActionMenu,{initialize:function($super,a,b){$super(a,b),this.value=this.menu.readAttribute("data-value")||this.button.down("span").innerHTML,this.previousItem=this.menu.select("li.selected a").first()||this.menu.select("li").first()},itemSelected:function($super,a,b,c){a&&a.stop();var d=b.down("span").innerHTML,e=b.readAttribute("data-value")||d;this.menu.writeAttribute("data-value",e),this.value=this.menu.readAttribute("data-value"),this.button.down("span").innerHTML=d,this.previousItem=b.up("ul").select("li.selected a").first(),b.up("ul").select("li").invoke("removeClassName","selected"),b.up("li").addClassName("selected"),this.updateNotifMessage(e),ActionMenu.resetAllDropdowns(),$super(a,b,c)},updateNotifMessage:function(a){$j(".notif_message span").hide(),$j(".notif_message span[data-role="+a+"]").show()},undo:function(){this.itemSelected(null,this.previousItem,!0)}}),ActionSplitButton=Class.create({initialize:function(a,b){this.menu=$(a),this.onItemSelected=b,this.menu.select("li").each(function(a){a.observe("click",this.itemSelected.bindAsEventListener(this,a))},this)},itemSelected:function(a,b){a.stop(),b.hasClassName("active")||(b.up("ul").select("li").invoke("removeClassName","active"),b.addClassName("active"),typeof this.onItemSelected=="function"&&this.onItemSelected(a,b))}}),AutoFadeInput=Class.create({initialize:function(a,b){var c=$H({onKeypress:null,onBlur:null,onFocus:null});this.options=c.merge($H(b||{})),this.input=$(a),this.label=this.input.adjacent("label").first(),this.input.observe("keyup",this.keyWasPressed.bind(this)),this.input.observe("focus",this.inputWasFocused.bind(this)),this.input.observe("blur",this.inputWasBlurred.bind(this)),this.keyWasPressed()},keyWasPressed:function(){this.input.present()&&this.label.hide(),typeof this.options.get("onKeypress")=="function"&&this.options.get("onKeypress")(this)},inputWasBlurred:function(){this.input.present()||this.label.appear({duration:Application.prototype._posterousDefaultAnimationDurationShort,to:1}),typeof this.options.get("onBlur")=="function"&&this.options.get("onBlur")(this)},inputWasFocused:function(){this.label.fade({duration:Application.prototype._posterousDefaultAnimationDurationShort,to:.5}),typeof this.options.get("onFocus")=="function"&&this.options.get("onFocus")(this)}}),ErrorBox=Class.create({initialize:function(a,b,c,d,e){a=$(a);var f=(new Element("a",{"class":"close",href:"#",title:"Close this popup"})).update("Close"),g=(new Element("h1")).update(b.stripTags()),h=(new Element("p")).update(c.stripTags()),i=(new Element("div",{"class":"p_popup "+e})).insert((new Element("div")).insert((new Element("div",{"class":"inner"})).insert(f).insert(g).insert(h)));this.outer=i,$(document.body).insert(i);var j=a.cumulativeOffset(),k=a.getWidth(),l=i.getDimensions(),m=j[1]-l.height-20,n=j[0]+k/2-l.width/2;i.setStyle({left:n+"px",top:m+"px"}),f.observe("click",function(a){Event.stop(a),d!==!1?this.dropAndFade(f.up(".p_popup"),{duration:Application.prototype._posterousDefaultAnimationDurationLong,afterFinish:function(){i.remove()}}):i.remove()}.bind(this)),document.body.observe("click",function(a){Event.element(a).up(".p_popup")||$$(".p_popup").invoke("remove")}),d!==!1?this.dropAndAppear(i,{duration:Application.prototype._posterousDefaultAnimationDurationLong}):i.show().setOpacity(1)},dropAndAppear:function(a,b){a.addClassName("active"),typeof a.style["webkitTransform"]=="undefined"?new Effect.Parallel([new Effect.Move(a.down(),{sync:!0,y:20,mode:"relative"}),new Effect.Appear(a.down(),{sync:!0})],b||{}):a.show()},dropAndFade:function(a,b){typeof a.style["webkitTransform"]=="undefined"?new Effect.Parallel([new Effect.Move(a.down(),{sync:!0,y:-20,mode:"relative"}),new Effect.Fade(a.down())],b||{}):a.removeClassName("active")},dismiss:function(){this.dropAndFade(this.outer,{afterFinish:function(){this.outer.remove(),delete this}.bind(this)})}}),StateLink=Class.create({initialize:function(a,b){var c=$H({states:{}});this.element=$(a),this.options=c.merge($H(b||{})),this.states=this.options.get("states"),this.observeStateTrigger(),this.changeState(this.options.get("initialState")||"")},observeStateTrigger:function(){this.element.observe("click",this.buttonClicked.bindAsEventListener(this))},buttonClicked:function(a){a.stop(),typeof this.options.get("onButtonClicked")=="function"&&this.options.get("onButtonClicked")(this)},changeState:function(a){var b=this.currentState();this.element.writeAttribute("data-state",a),this.element.removeClassName(b).addClassName(a),this.updateStateText(),this.states[this.currentState()].tooltip?this.element.writeAttribute("data-posterous-tooltip",this.states[this.currentState()].tooltip):this.element.removeAttribute("data-posterous-tooltip"),typeof this.options.get("onChangeState")=="function"&&this.options.get("onChangeState")(this)},updateStateText:function(){var a=this.currentState();this.states[a]&&this.element.update(this.states[a].text)},currentState:function(){return this.element.readAttribute("data-state")}}),StateButton=Class.create(StateLink,{updateStateText:function(){var a=this.currentState();this.states[a]&&this.element.down("span").update(this.states[a].text)}}),StateContainer=Class.create(StateLink,{observeStateTrigger:function(){this.stateTriggers=$H(this.options.get("stateTriggers")||{}),this.stateTriggers.each(function(a){$(a.value).observe("click",this.buttonClicked.bindAsEventListener(this))},this)},changeState:function($super,a){var b=this.currentState();this.element.writeAttribute("data-state",a),this.states[b]&&$(this.states[b]).hide(),this.states[a]&&$(this.states[a]).show(),typeof this.options.get("onChangeState")=="function"&&this.options.get("onChangeState")(this)}});(function(a,b){a(function(){a("[data-posterous-tooltip]").live("mouseover mouseout",function(b){if(b.type=="mouseover"){var c=a(this).attr("data-posterous-tooltip"),d=a(this).offset(),e=a(this).innerHeight(),f=a(this).innerWidth(),g=a(window).width(),h="left";d.left+200>g&&(h="right"),a("body").append('<div class="p_tooltip '+h+'" data-posterous-tooltip-box="true"><div class="p_nub"><div class="p_icon"></div></div><div class="inner">'+c+"</div></div>"),a(".p_tooltip").css({top:d.top+e+8+"px"}),h=="right"?a(".p_tooltip").css({right:g-d.left-f/2-31+"px"}):a(".p_tooltip").css({left:d.left+f/2-31+"px"})}else a('[data-posterous-tooltip-box="true"]').remove();return!1})})})($j),document.observe("click",ActionMenu.resetAllDropdowns),typeof window.innerShiv=="undefined"&&(window.innerShiv=function(a){return a});var Responses=function(a){function b(){a("[data-posterous-toggle-for]").live("click",function(b){b.preventDefault(),window.event!==undefined&&(event.returnValue=!1);var c=a(this),d=c.attr("data-posterous-toggle-for"),e=c.siblings('[name="'+d+'"]'),f=e.val();return f=="1"?(c.removeClass("active"),e.val("0")):(c.addClass("active"),e.val("1")),!1})}function c(){a('[data-posterous-twitter-login-button="true"]').live("click",function(b){return b.preventDefault(),window.event!==undefined&&(event.returnValue=!1),p.initOauthAndRedirectToPost("1",a(this).attr("data-posterous-jumpto-url")),!1})}function d(){a('[data-posterous-facebook-login-botton="true"]').live("click",function(a){return a.preventDefault(),window.event!==undefined&&(event.returnValue=!1),FB.login(function(a){(window.location.href=f.href)?window.location.reload():window.location.href=f.href}),!1})}function e(){return a(".p_action_links a").live("click",function(b){b.preventDefault(),window.event!==undefined&&(event.returnValue=!1);var c=a(this),d=this,e=a(this).attr("href");if(c.attr("data-confirm")&&!confirm(c.attr("data-confirm")))return!1;u(c),a.ajax({url:e,type:"get",success:function(a){var b=new ErrorBox(d,"Done and done.",a,!0,"confirmation");g(c,b)},error:function(a){new ErrorBox(c,"Oops. There was an error",a,!0,"error")},complete:function(){v(c)}})}),!1}function g(b,c){a(b).attr("data-posterous-approve-comment")=="true"?setTimeout(function(){a(b).remove(),c.dismiss()},4e3):setTimeout(function(){c.dismiss(),a(b).closest("article").fadeOut(500,function(){a(b).remove()})},3e3)}function h(){a(".p_responses_link a").live("click",function(b){b.preventDefault(),window.event!==undefined&&(event.returnValue=!1);var c=a(this),d=c.attr("href"),e=c.attr("data-response-post-id"),f=a('[data-posterous-responses-for-post-id="'+e+'"]'),g=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");return g!=undefined&&g=="site"?(z(f),f.children(".p_response_container").size()>0&&f.children(".p_response_container").css("display")!="none"&&c.parent().siblings(".p_comment_link").hasClass("active")==0?f.children().slideUp():f.children(".p_response_container").size()>0?f.children().slideDown():(x(f),a.ajax({url:d,type:"get",dataType:"json",data:{authenticity_token:window._token},success:function(a){y(f),f.append(innerShiv(a.html)),f.find(".p_response_container").slideDown(),f.find(".p_response_container").find(".p_responses_list").children().show(),FB.XFBML.parse()}}))):f.children(".p_like_failed").size()>0&&(z(f),f.children().slideDown(),f.next(".p_comment_form").slideDown()),!1})}function i(){return a(".p_like_link .like_post, .p_like_link .unlike_post").live("click",function(b){b.preventDefault(),window.event!==undefined&&(event.returnValue=!1);var c=a(this),d=c.hasClass("like_post"),e=c.attr("href"),f=c.parents(".p_response_widget").next();z(f);var g="loading_class";if(c.hasClass(g))return!1;c.addClass(g),d?x(f,"Liking"):x(f,"Unliking"),a.ajax({url:e,type:"get",dataType:"json",data:{authenticity_token:window._token},complete:function(){c.removeClass(g)},success:function(b){y(f),d?(f.children().size()>0&&(f.children(".p_response_container").children(".p_responses_list").append(innerShiv(b.html)),f.children(".p_response_container").children(".p_responses_list").find(".p_like:last").fadeIn()),count_elm=c.parent().parent().children(".p_responses_link").children().children("strong"),r(count_elm)):(f.children().size()>0&&a('[data-posterous-responses-for-post-id="'+b.post_id+'"] [data-likes_user_id="'+b.user_id+'"]').remove(),count_elm=c.parent().parent().children(".p_responses_link").children().children("strong"),s(count_elm)),p.setLikedState(b.post_id,d)},error:function(b,d){var e=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");y(f),f.children().size()>0&&(f.children().slideUp(),e!=undefined&&e=="post"&&f.next(".p_comment_form").slideUp()),f.append(innerShiv(a.parseJSON(b.responseText).html)),f.find(".p_like_failed").slideDown(),c.parent().siblings(".p_comment_link").hasClass("active")&&(c.parent().siblings(".p_comment_link").children(".p_comment_link a").removeClass("active"),c.parent().siblings(".p_comment_link").removeClass("active")),c.parent().siblings(".p_responses_link").hasClass("active")&&c.parent().siblings(".p_responses_link").removeClass("active"),FB.XFBML.parse()}})}),!1}function j(){a(".p_comment_link a").live("click",function(b){b.preventDefault(),window.event!==undefined&&(event.returnValue=!1);var c=a(this),d=c.attr("href"),e=c.attr("data-comment-post-id"),f=a('[data-posterous-responses-for-post-id="'+e+'"]'),g=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");return g!=undefined&&g=="post"?f.children(".p_like_failed").size()>0?(z(f),f.children().slideDown(),f.next(".p_comment_form").slideDown(),setTimeout(function(){form_elm=f.next(".p_comment_form").find("#new_comment"),a("html, body").animate({scrollTop:form_elm.offset().top},500),form_elm.children(".p_not_authorized").size()>0?form_elm.children(".p_comment_section").children().children("#comment_name").focus():form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()},500)):(form_elm=f.next(".p_comment_form").find("#new_comment"),a("html, body").animate({scrollTop:form_elm.offset().top},500),form_elm.children(".p_not_authorized").size()>0?form_elm.children(".p_comment_section").children().children("#comment_name").focus():form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()):(z(f),f.children(".p_response_container").size()>0&&f.children(".p_response_container").css("display")!="none"&&c.parent().siblings(".p_responses_link").hasClass("active")==0?f.children().slideUp():(x(f),f.children(".p_response_container").size()>0?(f.children().slideDown(),y(f),list_form=f.children(".p_response_container").children(".p_comment_form").find("#new_comment"),form_elm=list_form.size()==0?f.next(".p_comment_form").find("#new_comment"):list_form,a("html, body").animate({scrollTop:form_elm.offset().top},500),form_elm.children(".p_not_authorized").size()>0?form_elm.children(".p_comment_section").children().children("#comment_name").focus():form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()):a.ajax({url:d,type:"get",dataType:"json",data:{authenticity_token:window._token},success:function(b){y(f),f.append(innerShiv(b.html)),f.find(".p_response_container").slideDown(),f.find(".p_response_container").find(".p_responses_list").children().fadeIn(),form_elm=f.children(".p_response_container").children(".p_comment_form"),FB.XFBML.parse(),a("html, body").animate({scrollTop:form_elm.offset().top},500),form_elm.find("#new_comment").children(".p_not_authorized").size()>0?form_elm.find("#new_comment").children(".p_comment_section").children().children("#comment_name").focus():form_elm.find("#new_comment").children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()}}))),!1})}function k(){var b=".p_responses_link a",c=".p_like_link a",d=".p_comment_link a",e=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");typeof e!="undefined"&&e=="post"&&a(b).parent().addClass("active"),a(b).live("click",function(){var b=a(this),c=b.parent();c.hasClass("active")?e!=undefined&&e=="site"&&c.removeClass("active"):c.addClass("active"),c.siblings(".p_comment_link").children(d).hasClass("active")&&(c.siblings(".p_comment_link").children(d).removeClass("active"),c.siblings(".p_comment_link").removeClass("active")),c.siblings(".p_like_link").hasClass("active")&&c.siblings(".p_like_link").removeClass("active")}),a(d).live("click",function(){var b=a(this),c=b.parent();b.hasClass("active")?e!=undefined&&e=="site"&&(b.removeClass("active"),c.removeClass("active")):(b.addClass("active"),c.addClass("active")),c.siblings(".p_responses_link").hasClass("active")&&c.siblings(".p_responses_link").removeClass("active"),c.siblings(".p_like_link").hasClass("active")&&c.siblings(".p_like_link").removeClass("active")})}function l(b,c,d){var e="p_comment_captcha",f=a("#"+e),g=".p_comment_section:last > .p_submit",h="#recaptable_table";f.length>0?(f.insertBefore(g,b),Recaptcha.reload(),Recaptcha.focus_response_field(),m(f.get(0),c,d)):(f=a('<div id="'+e+'"></div>').insertBefore(g,b),Recaptcha.create("6LfjeMwSAAAAAClMhZogTtkOqrAAIKHqYBn3dPZJ",e,{theme:"white",callback:function(){Recaptcha.focus_response_field(),m(f.get(0),c,d)}}))}function m(a,b,c){new ErrorBox(a,b,c,!0,"error")}function n(b){Recaptcha.destroy(),a("#p_comment_captcha",b).remove()}function o(){a(".new_comment").find("button").live("click",function(b){b.preventDefault(),window.event!==undefined&&(event.returnValue=!1);var c=a(this),d=c.find("span"),e=c.closest("form"),f=d.text(),g=e.find(".p_responses_list");return c.addClass("loading").attr("disabled","disabled"),d.html("Submitting..."),e.find("[data-posterous-push-to-facebook]").val()=="1"&&FB.getSession()==null&&FB.login(),a.ajax({type:"post",url:e.attr("action"),dataType:"json",data:e.serialize(),success:function(b){var g=a("body").attr("data-show-type")||a(".posterous_site_data").first().attr("data-show-type");a(".p_no_responses").remove(),container=g!=undefined&&g=="site"?e.parent().parent():e.parent().prev().find(".p_response_container"),container.children(".p_responses_list").append(innerShiv(b.html)),container.children(".p_responses_list").find(".p_comment:last").fadeIn(),e.find("[data-posterous-push-to-facebook]").size()>0&&p.publishCommentToFacebook(e.find('[name="comment[post_id]"]').val(),e.find("textarea").val(),e.find("[data-posterous-push-to-facebook]").val()=="1"),c.removeClass("loading").removeAttr("disabled"),d.text(f),count_elm=container.children(".p_responses_list").parent().parent().siblings(".p_response_widget").children().children(".p_responses_link").children().children("strong"),r(count_elm),e[0].reset(),n()},error:function(b){var d=a.parseJSON(b.responseText);c.removeClass("loading").removeAttr("disabled").children().html(f),d.return_heading=="We think this might be spam."?l(e,d.return_heading,d.messages[0]):m(c.get(0),d.return_heading,d.messages[0])}}),!1}),a(".new_comment").live("submit",function(a){return a.preventDefault(),window.event!==undefined&&(event.returnValue=!1),!1})}function q(){a(".new_comment").find("button").live("click",function(b){b.preventDefault();var c=a(this),d=a(".action_button_label"),e=c.closest("form"),f=d.text();return c.addClass("loading").attr("disabled","disabled"),d.text("Submitting..."),a.ajax({type:"post",url:e.attr("action"),dataType:"json",data:e.serialize(),success:function(b){a(b.html).hide().appendTo(".p_responses_list").fadeIn(function(){a(".p_responses_list").children().css("opacity","")}),c.removeClass("loading").removeAttr("disabled"),d.text(f),e[0].reset()}}),!1})}function r(a){count=a.html(),new_count=parseInt(count)+1,a.html(new_count),header_elm=a.parents(".p_response_widget").next().children(".p_response_container .p_view_all_link"),header_elm&&header_elm.html("View All "+new_count)}function s(a){count=count_elm.html(),new_count=parseInt(count)-1,a.html(new_count),header_elm=a.parents(".p_response_widget").next().children(".p_response_container .p_view_all_link"),header_elm&&header_elm.html("View All "+new_count)}function t(b){return a(b).parents(".p_responses").hasClass("dark")?"/images/site/responses_loader_dark.gif":"/images/site/responses_loader.gif"}function u(b){a(b).addClass("loading").append('<img src="'+t(b)+'" alt=""/>')}function v(b){a(b).removeClass("loading").children("img").remove()}function w(a,b){return(new Image).src=t(a),b!=null?'<div class="loading_comment"><div class="loading"><img src="'+t(a)+'" /><span>'+b+"...</span></div></div>":'<div class="loading_comment"><div class="loading"><img src="'+t(a)+'" /><span>Loading...</span></div></div>'}function x(a,b){var c=w(a,b);response_item=a.siblings(".p_response_widget").children().children(".p_responses_link"),response_item.children().hide(),response_item.prepend(c).show()}function y(a){response_item=a.siblings(".p_response_widget").children().children(".p_responses_link"),response_item.children(".loading_comment").remove(),response_item.children().show()}function z(a){failed_elm=a.children(".p_like_failed"),failed_elm.size()>0&&failed_elm.remove()}a(document).ready(function(){window.hotmail!=1?(h(),i(),j(),k(),e(),c(),b(),o(),a(".p_responses_list").children().show()):(a.support.opacity=!0,q())})},responses=Responses($j),ContentParts=function(a){function b(){FlashDetect.installed?(a("[data-posterous-flash-video-embed]").show(),a("[data-posterous-html5-video-embed]").hide()):(a("[data-posterous-flash-video-embed]").hide(),a("[data-posterous-html5-video-embed]").show()),a("[data-posterous-html5-video-embed] video").click(function(a){this.play()})}function c(){FlashDetect.installed?(a("[data-posterous-flash-audio-embed]").show(),a("[data-posterous-html5-audio-embed]").hide()):(a("[data-posterous-flash-audio-embed]").hide(),a("[data-posterous-html5-audio-embed]").show())}function d(){if(FlashDetect.installed){var b;a('[data-posterous-scribd-embed="false"]').each(function(c){a(this).attr("id","posterous_scribd_embed_"+c),b=scribd.Document.getDocFromUrl(a(this).attr("data-posterous-url"),"pub-50214570658991172461"),b.addParam("height",600),b.addParam("width",500),b.addParam("public",!1),b.addParam("disable_print",1),b.addParam("download_formats",""),b.addParam("disable_related_docs",1),b.addParam("hide_disabled_buttons",1),b.addParam("my_user_id",a(this).attr("data-posterous-user-id")),b.write("posterous_scribd_embed_"+c),a(this).attr("data-posterous-scribd-embed","true")})}}function e(){a('[data-posterous-image-gallery][data-posterous-image-gallery-initialized="false"]').each(function(b){new PSlideGallery2(a(this).get()[0],a.parseJSON(unescape(a(this).attr("data-posterous-file-list"))),a.parseJSON(unescape(a(this).attr("data-posterous-options")))),a(this).attr("data-posterous-image-gallery-initialized","true")})}return{init:function(){b(),c(),d(),e()}}},contentParts=ContentParts(jQuery);$j(document).ready(function(){contentParts.init()});var handlebars=function(){var a={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,hashSegments:29,hashSegment:30,ID:31,EQUALS:32,pathSegments:33,SEP:34,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",31:"ID",32:"EQUALS",34:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[26,1],[29,2],[29,1],[30,3],[30,3],[21,1],[33,3],[33,1]],performAction:function(b,c,d,e,f,g,h){var i=g.length-1;switch(f){case 1:return g[i-1];case 2:this.$=new e.ProgramNode(g[i-2],g[i]);break;case 3:this.$=new e.ProgramNode(g[i]);break;case 4:this.$=new e.ProgramNode([]);break;case 5:this.$=[g[i]];break;case 6:g[i-1].push(g[i]),this.$=g[i-1];break;case 7:this.$=new e.InverseNode(g[i-2],g[i-1],g[i]);break;case 8:this.$=new e.BlockNode(g[i-2],g[i-1],g[i]);break;case 9:this.$=g[i];break;case 10:this.$=g[i];break;case 11:this.$=new e.ContentNode(g[i]);break;case 12:this.$=new e.CommentNode(g[i]);break;case 13:this.$=new e.MustacheNode(g[i-1][0],g[i-1][1]);break;case 14:this.$=new e.MustacheNode(g[i-1][0],g[i-1][1]);break;case 15:this.$=g[i-1];break;case 16:this.$=new e.MustacheNode(g[i-1][0],g[i-1][1]);break;case 17:this.$=new e.MustacheNode(g[i-1][0],g[i-1][1],!0);break;case 18:this.$=new e.PartialNode(g[i-1]);break;case 19:this.$=new e.PartialNode(g[i-2],g[i-1]);break;case 20:break;case 21:this.$=[[g[i-2]].concat(g[i-1]),g[i]];break;case 22:this.$=[[g[i-1]].concat(g[i]),null];break;case 23:this.$=[[g[i-1]],g[i]];break;case 24:this.$=[[g[i]],null];break;case 25:g[i-1].push(g[i]),this.$=g[i-1];break;case 26:this.$=[g[i]];break;case 27:this.$=g[i];break;case 28:this.$=new e.StringNode(g[i]);break;case 29:this.$=new e.HashNode(g[i]);break;case 30:g[i-1].push(g[i]),this.$=g[i-1];break;case 31:this.$=[g[i]];break;case 32:this.$=[g[i-2],g[i]];break;case 33:this.$=[g[i-2],new e.StringNode(g[i])];break;case 34:this.$=new e.IdNode(g[i]);break;case 35:g[i-2].push(g[i]),this.$=g[i-2];break;case 36:this.$=[g[i]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,31:[1,25],33:24},{17:26,21:23,31:[1,25],33:24},{17:27,21:23,31:[1,25],33:24},{17:28,21:23,31:[1,25],33:24},{21:29,31:[1,25],33:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,31:[1,25],33:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:39,30:42,31:[1,43],33:24},{18:[2,34],28:[2,34],31:[2,34],34:[1,44]},{18:[2,36],28:[2,36],31:[2,36],34:[2,36]},{18:[1,45]},{18:[1,46]},{18:[1,47]},{18:[1,48],21:49,31:[1,25],33:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:50,31:[1,25],33:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:51,27:52,28:[1,41],29:39,30:42,31:[1,43],33:24},{18:[2,23]},{18:[2,26],28:[2,26],31:[2,26]},{18:[2,29],30:53,31:[1,54]},{18:[2,27],28:[2,27],31:[2,27]},{18:[2,28],28:[2,28],31:[2,28]},{18:[2,31],31:[2,31]},{18:[2,36],28:[2,36],31:[2,36],32:[1,55],34:[2,36]},{31:[1,56]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,57]},{18:[1,58]},{18:[2,21]},{18:[2,25],28:[2,25],31:[2,25]},{18:[2,30],31:[2,30]},{32:[1,55]},{21:59,28:[1,60],31:[1,25],33:24},{18:[2,35],28:[2,35],31:[2,35],34:[2,35]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,32],31:[2,32]},{18:[2,33],31:[2,33]}],defaultActions:{16:[2,1],37:[2,23],51:[2,21]},parseError:function(b,c){throw new Error(b)},parse:function(b){function o(a){d.length=d.length-2*a,e.length=e.length-a,f.length=f.length-a}function p(){var a;return a=c.lexer.lex()||1,typeof a!="number"&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0,l=2,m=1;this.lexer.setInput(b),this.lexer.yy=this.yy,this.yy.lexer=this.lexer;var n=this.lexer.yylloc;f.push(n),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var q,r,s,t,u,v,w={},x,y,z,A;for(;;){s=d[d.length-1],this.defaultActions[s]?t=this.defaultActions[s]:(q==null&&(q=p()),t=g[s]&&g[s][q]);if(typeof t=="undefined"||!t.length||!t[0]){if(!k){A=[];for(x in g[s])this.terminals_[x]&&x>2&&A.push("'"+this.terminals_[x]+"'");var B="";this.lexer.showPosition?B="Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+A.join(", "):B="Parse error on line "+
(i+1)+": Unexpected "+(q==1?"end of input":"'"+(this.terminals_[q]||q)+"'"),this.parseError(B,{text:this.lexer.match,token:this.terminals_[q]||q,line:this.lexer.yylineno,loc:n,expected:A})}if(k==3){if(q==m)throw new Error(B||"Parsing halted.");j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,q=p()}for(;;){if(l.toString()in g[s])break;if(s==0)throw new Error(B||"Parsing halted.");o(1),s=d[d.length-1]}r=q,q=l,s=d[d.length-1],t=g[s]&&g[s][l],k=3}if(t[0]instanceof Array&&t.length>1)throw new Error("Parse Error: multiple actions possible at state: "+s+", token: "+q);switch(t[0]){case 1:d.push(q),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(t[1]),q=null,r?(q=r,r=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,k>0&&k--);break;case 2:y=this.productions_[t[1]][1],w.$=e[e.length-y],w._$={first_line:f[f.length-(y||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(y||1)].first_column,last_column:f[f.length-1].last_column},v=this.performAction.call(w,h,j,i,this.yy,t[1],e,f);if(typeof v!="undefined")return v;y&&(d=d.slice(0,-1*y*2),e=e.slice(0,-1*y),f=f.slice(0,-1*y)),d.push(this.productions_[t[1]][0]),e.push(w.$),f.push(w._$),z=g[d[d.length-2]][d[d.length-1]],d.push(z);break;case 3:return!0}}return!0}},b=function(){var a={EOF:1,parseError:function(b,c){if(!this.yy.parseError)throw new Error(b);this.yy.parseError(b,c)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.match+=a,this.matched+=a;var b=a.match(/\n/);return b&&this.yylineno++,this._input=this._input.slice(1),a},unput:function(a){return this._input=a+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=(new Array(a.length+1)).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d;this._more||(this.yytext="",this.match="");var e=this._currentRules();for(var f=0;f<e.length;f++){b=this._input.match(this.rules[e[f]]);if(b){d=b[0].match(/\n.*/g),d&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-1:this.yylloc.last_column+b.length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,e[f],this.conditionStack[this.conditionStack.length-1]);if(a)return a;return}}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return typeof b!="undefined"?b:this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}};return a.performAction=function(b,c,d,e){var f=e;switch(d){case 0:this.begin("mu");if(c.yytext)return 14;break;case 1:return 14;case 2:return 24;case 3:return 16;case 4:return 20;case 5:return 19;case 6:return 19;case 7:return 23;case 8:return 23;case 9:return c.yytext=c.yytext.substr(3,c.yyleng-5),this.begin("INITIAL"),15;case 10:return 22;case 11:return 32;case 12:return 31;case 13:return 31;case 14:return 34;case 15:break;case 16:return this.begin("INITIAL"),18;case 17:return this.begin("INITIAL"),18;case 18:return c.yytext=c.yytext.substr(1,c.yyleng-2).replace(/\\"/g,'"'),28;case 19:return 31;case 20:return"INVALID";case 21:return 5}},a.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{!.*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^[a-zA-Z0-9_]+(?=[=} /.])/,/^./,/^$/],a.conditions={mu:{rules:[2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],inclusive:!1},INITIAL:{rules:[0,1,21],inclusive:!0}},a}();return a.lexer=b,a}();typeof require!="undefined"&&typeof exports!="undefined"&&(exports.parser=handlebars,exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)},exports.main=function(b){if(!b[1])throw new Error("Usage: "+b[0]+" FILE");if(typeof process!="undefined")var c=require("fs").readFileSync(require("path").join(process.cwd(),b[1]),"utf8");else var d=require("file").path(require("file").cwd()),c=d.join(b[1]).read({charset:"utf-8"});return exports.parser.parse(c)},typeof module!="undefined"&&require.main===module&&exports.main(typeof process!="undefined"?process.argv.slice(1):require("system").args));var Handlebars={};Handlebars.Parser=handlebars,Handlebars.parse=function(a){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(a)},Handlebars.print=function(a){return(new Handlebars.PrintVisitor).accept(a)},Handlebars.Runtime={},Handlebars.Runtime.compile=function(a){var b=Handlebars.parse(a);return function(a,c,d){c=c||Handlebars.helpers,d=d||Handlebars.partials;var e=new Handlebars.Context(a,c,d),f=new Handlebars.Runtime(e);return f.accept(b),f.buffer}},Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(a,b,c){c&&(b.not=c),this.helpers[a]=b},Handlebars.registerPartial=function(a,b){this.partials[a]=b},Handlebars.registerHelper("blockHelperMissing",function(a,b,c){c=c||function(){};var d="",e=Object.prototype.toString.call(a);e==="[object Function]"&&(a=a());if(a===!0)return b(this);if(a===!1||a==null)return c(this);if(e==="[object Array]"){if(a.length>0)for(var f=0,g=a.length;f<g;f++)d+=b(a[f]);else d=c(this);return d}return b(a)},function(a,b){return b(a)}),Handlebars.registerHelper("each",function(a,b,c){var d="";if(a&&a.length>0)for(var e=0,f=a.length;e<f;e++)d+=b(a[e]);else d=c(this);return d}),Handlebars.registerHelper("if",function(a,b,c){return!a||a==[]?c(this):b(this)}),Handlebars.registerHelper("unless",function(a,b,c){return Handlebars.helpers["if"].call(this,a,c,b)}),Handlebars.registerHelper("with",function(a,b){return b(a)}),Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){}},Handlebars.log=function(a,b){Handlebars.logger.log(a,b)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(a,b){this.type="program",this.statements=a,b&&(this.inverse=new Handlebars.AST.ProgramNode(b))},Handlebars.AST.MustacheNode=function(a,b,c){this.type="mustache",this.id=a[0],this.params=a.slice(1),this.hash=b,this.escaped=!c},Handlebars.AST.PartialNode=function(a,b){this.type="partial",this.id=a,this.context=b};var a=function(a,b){if(a.original!==b.original)throw new Handlebars.Exception(a.original+" doesn't match "+b.original)};Handlebars.AST.BlockNode=function(b,c,d){a(b.id,d),this.type="block",this.mustache=b,this.program=c},Handlebars.AST.InverseNode=function(b,c,d){a(b.id,d),this.type="inverse",this.mustache=b,this.program=c},Handlebars.AST.ContentNode=function(a){this.type="content",this.string=a},Handlebars.AST.HashNode=function(a){this.type="hash",this.pairs=a},Handlebars.AST.IdNode=function(a){this.type="ID",this.original=a.join("/");var b=[],c=0;for(var d=0,e=a.length;d<e;d++){var f=a[d];if(f==="..")c++;else{if(f==="."||f==="this")continue;b.push(f)}}this.parts=b,this.depth=c,this.isSimple=b.length===1&&c===0},Handlebars.AST.StringNode=function(a){this.type="STRING",this.string=a},Handlebars.AST.CommentNode=function(a){this.type="comment",this.comment=a}}(),Handlebars.Visitor=function(){},Handlebars.Visitor.prototype={accept:function(a){return this[a.type](a)}},Handlebars.Exception=function(a){this.message=a},Handlebars.SafeString=function(a){this.string=a},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var a={"<":"&lt;",">":"&gt;"},b=/&(?!\w+;)|[<>]/g,c=/[&<>]/,d=function(b){return a[b]||"&amp;"};Handlebars.Utils={escapeExpression:function(a){return a instanceof Handlebars.SafeString?a.toString():a==null||a===!1?"":c.test(a)?a.replace(b,d):a},isEmpty:function(a){return typeof a=="undefined"?!0:a===null?!0:a===!1?!0:Object.prototype.toString.call(a)==="[object Array]"&&a.length===0?!0:!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(a,b){a.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,invokeInverse:14,assignToHash:15},a.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:1,lookup:1,invokeMustache:2,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:2,invokePartial:1,push:1,invokeInverse:1,assignToHash:1},a.DISASSEMBLE_MAP={};for(var c in a.OPCODE_MAP){var d=a.OPCODE_MAP[c];a.DISASSEMBLE_MAP[d]=c}a.multiParamSize=function(b){return a.MULTI_PARAM_OPCODES[a.DISASSEMBLE_MAP[b]]},a.prototype={disassemble:function(){var b=this.opcodes,c,d,e=[],f,g,h;for(var i=0,j=b.length;i<j;i++){c=b[i];if(c==="DECLARE")g=b[++i],h=b[++i],e.push("DECLARE "+g+" = "+h);else{f=a.DISASSEMBLE_MAP[c];var k=a.multiParamSize(c),l=[];for(var m=0;m<k;m++)d=b[++i],typeof d=="string"&&(d='"'+d.replace("\n","\\n")+'"'),l.push(d);f=f+" "+l.join(" "),e.push(f)}}return e.join("\n")},guid:0,compile:function(a){return this.children=[],this.depths={list:[]},this.program(a)},accept:function(a){return this[a.type](a)},program:function(a){var b=a.statements,c;this.opcodes=[];for(var d=0,e=b.length;d<e;d++)c=b[d],this[c.type](c);return this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(b){var c=(new a).compile(b),d=this.guid++;this.usePartial=this.usePartial||c.usePartial,this.children[d]=c;for(var e=0,f=c.depths.list.length;e<f;e++){depth=c.depths.list[e];if(depth<2)continue;this.addDepth(depth-1)}return d},block:function(a){var b=a.mustache,c,d,e,f,g=this.setupStackForMustache(b),h=this.compileProgram(a.program);a.program.inverse&&(f=this.compileProgram(a.program.inverse),this.declare("inverse",f)),this.opcode("invokeProgram",h,g.length),this.declare("inverse",null),this.opcode("append")},inverse:function(a){this.ID(a.mustache.id);var b=this.compileProgram(a.program);this.opcode("invokeInverse",b),this.opcode("append")},hash:function(a){var b=a.pairs,c,d;this.opcode("push","{}");for(var e=0,f=b.length;e<f;e++)c=b[e],d=c[1],this.accept(d),this.opcode("assignToHash",c[0])},partial:function(a){var b=a.id;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","context"),this.opcode("invokePartial",b.original),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){var b=this.setupStackForMustache(a);this.opcode("invokeMustache",b.length,a.id.original),a.escaped?this.opcode("appendEscaped"):this.opcode("append")},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth),this.opcode("lookupWithHelpers",a.parts[0]||null);for(var b=1,c=a.parts.length;b<c;b++)this.opcode("lookup",a.parts[b])},STRING:function(a){this.opcode("pushString",a.string)},comment:function(){},pushParams:function(a){var b=a.length,c;while(b--)c=a[b],this[c.type](c)},opcode:function(b,c,d){this.opcodes.push(a.OPCODE_MAP[b]),c!==undefined&&this.opcodes.push(c),d!==undefined&&this.opcodes.push(d)},declare:function(a,b){this.opcodes.push("DECLARE"),this.opcodes.push(a),this.opcodes.push(b)},addDepth:function(a){if(a===0)return;this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a))},setupStackForMustache:function(a){var b=a.params;return this.pushParams(b),a.hash?this.hash(a.hash):this.opcode("push","{}"),this.ID(a.id),b}},b.prototype={nameLookup:function(a,c,d){return b.RESERVED_WORDS[c]?a+"['"+c+"']":a+"."+c},appendToBuffer:function(a){return"buffer = buffer + "+a+";"},initializeBuffer:function(){return this.quotedString("")},compile:function(a,b){this.environment=a,this.data=b,this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileChildren(a,b),Handlebars.log(Handlebars.logger.DEBUG,a.disassemble()+"\n\n");var c=a.opcodes,d,e,f,h;this.i=0;for(g=c.length;this.i<g;this.i++)d=this.nextOpcode(0),d[0]==="DECLARE"?(this.i=this.i+2,this[d[1]]=d[2]):(this.i=this.i+d[1].length,this[d[0]].apply(this,d[1]));return this.createFunction()},nextOpcode:function(b){var c=this.environment.opcodes,d=c[this.i+b],e,f,g,h;if(d==="DECLARE")return e=c[this.i+1],f=c[this.i+2],["DECLARE",e,f];e=a.DISASSEMBLE_MAP[d],g=a.multiParamSize(d),h=[];for(var i=0;i<g;i++)h.push(c[this.i+i+1+b]);return[e,h]},eat:function(a){this.i=this.i+a.length},preamble:function(){var a=[];a.push("var buffer = "+this.initializeBuffer()+", currentContext = context");var b="helpers = helpers || Handlebars.helpers;";this.environment.usePartial&&(b+=" partials = partials || Handlebars.partials;"),a.push(b),this.lastContext=0,this.source=a},createFunction:function(){var a={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(a,b,c,d){var e=this.programs[a];return d?Handlebars.VM.program(this.children[a],b,c,d):e?e:(e=this.programs[a]=Handlebars.VM.program(this.children[a],b,c),e)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop},b=this.stackVars.concat(this.registers.list);b.length>0&&(this.source[0]=this.source[0]+", "+b.join(", ")),this.source[0]=this.source[0]+";",this.source.push("return buffer;");var c=["Handlebars","context","helpers","partials"];this.data&&c.push("data");for(var d=0,e=this.environment.depths.list.length;d<e;d++)c.push("depth"+this.environment.depths.list[d]);c.length===4&&!this.environment.usePartial&&c.pop(),c.push(this.source.join("\n"));var f=Function.apply(this,c);return f.displayName="Handlebars.js",Handlebars.log(Handlebars.logger.DEBUG,f.toString()+"\n\n"),a.render=f,a.children=this.environment.children,function(b,c,d,e,f){try{var g=Array.prototype.slice.call(arguments);return g.unshift(Handlebars),a.render.apply(a,g)}catch(h){throw h}}},appendContent:function(a){this.source.push(this.appendToBuffer(this.quotedString(a)))},append:function(){var a=this.popStack();this.source.push("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }")},appendEscaped:function(){var a=this.nextOpcode(1),b="";a[0]==="appendContent"&&(b=" + "+this.quotedString(a[1][0]),this.eat(a)),this.source.push(this.appendToBuffer("this.escapeExpression("+this.popStack()+")"+b))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a,a===0?this.source.push("currentContext = context;"):this.source.push("currentContext = depth"+a+";"))},lookupWithHelpers:function(a){if(a){var b=this.nextStack(),c="if('"+a+"' in helpers) { "+b+" = "+this.nameLookup("helpers",a,"helper")+"; } else { "+b+" = "+this.nameLookup("currentContext",a,"context")+"; }";this.source.push(c)}else this.pushStack("currentContext")},lookup:function(a){var b=this.topStack();this.source.push(b+" = "+this.nameLookup(b,a,"context")+";")},pushString:function(a){this.pushStack(this.quotedString(a))},push:function(a){this.pushStack(a)},invokeMustache:function(a,b){this.populateParams(a,this.quotedString(b),"{}",null,function(a,b,c){this.source.push("else if("+c+"=== undefined) { "+a+" = helpers.helperMissing.call("+b+"); }"),this.source.push("else { "+a+" = "+c+"; }")})},invokeProgram:function(a,b){var c=this.programExpression(this.inverse),d=this.programExpression(a);this.populateParams(b,null,d,c,function(a,b,c){this.source.push("else { "+a+" = helpers.blockHelperMissing.call("+b+"); }")})},populateParams:function(a,b,c,d,e){var f=this.popStack(),g,h=[],i=this.popStack();for(var j=0;j<a;j++){var k=this.popStack();h.push(k)}this.register("tmp1",c),this.source.push("tmp1.hash = "+i+";"),d&&(this.source.push("tmp1.fn = tmp1;"),this.source.push("tmp1.inverse = "+d+";")),this.data&&this.source.push("tmp1.data = data;"),h.push("tmp1"),d&&h.push(d),this.populateCall(h,f,b||f,e)},populateCall:function(a,b,c,d){var e=["context"].concat(a).join(", "),f=["context"].concat(c).concat(a).join(", ");nextStack=this.nextStack(),this.source.push("if(typeof "+b+" === 'function') { "+nextStack+" = "+b+".call("+e+"); }"),d.call(this,nextStack,f,b)},invokeInverse:function(a){var b=this.programExpression(a),c=["context",this.topStack(),"this.noop",b];this.pushStack("helpers.blockHelperMissing.call("+c.join(", ")+")")},invokePartial:function(a){this.pushStack("this.invokePartial("+this.nameLookup("partials",a,"partial")+", '"+a+"', "+this.popStack()+", helpers, partials);")},assignToHash:function(a){var b=this.popStack(),c=this.topStack();this.source.push(c+"['"+a+"'] = "+b+";")},compiler:b,compileChildren:function(a,b){var c=a.children,d,e,f=[];for(var g=0,h=c.length;g<h;g++)d=c[g],e=new this.compiler,f[g]=e.compile(d,b);a.rawChildren=c,a.children=f},programExpression:function(a){if(a==null)return"this.noop";var b=[a,"helpers","partials"],c=this.environment.rawChildren[a].depths.list;this.data&&b.push("data");for(var d=0,e=c.length;d<e;d++)depth=c[d],depth===1?b.push("context"):b.push("depth"+(depth-1));return this.environment.usePartial||(b[3]?b[2]="null":b.pop()),c.length===0?"this.program("+b.join(", ")+")":(b[0]="this.children["+a+"]","this.programWithDepth("+b.join(", ")+")")},register:function(a,b){this.useRegister(a),this.source.push(a+" = "+b+";")},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},pushStack:function(a){return this.source.push(this.nextStack()+" = "+a+";"),"stack"+this.stackSlot},nextStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(a){return'"'+a.replace(/\\/,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var e="break case catch continue default delete do else finally for function if in instanceof new return switch this throw try typeof var void while with null true false".split(" ");compilerWords=b.RESERVED_WORDS={};for(var f=0,g=e.length;f<g;f++)compilerWords[e[f]]=!0}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.VM={programWithDepth:function(a){var b=Array.prototype.slice.call(arguments,1);return function(c,d,e,f){return b[0]=d||b[0],b[1]=e||b[1],b[2]=f||b[2],a.apply(this,[c].concat(b))}},program:function(a,b,c,d){return function(e,f,g,h){return a(e,f||b,g||c,h||d)}},noop:function(){return""},compile:function(a,b){var c=Handlebars.parse(a),d=(new Handlebars.Compiler).compile(c);return(new Handlebars.JavaScriptCompiler).compile(d,b)},invokePartial:function(a,b,c,d,e){if(a===undefined)throw new Handlebars.Exception("The partial "+b+" could not be found");return a instanceof Function?a(c,d,e):(e[b]=Handlebars.VM.compile(a),e[b](c,d,e))}},Handlebars.compile=Handlebars.VM.compile,function(a){a.Class.extend("Modal",{openModals:[],currentModal:function(){return this.openModals.length?this.openModals[0]:null}},{extractArgs:function(a,b){typeof a=="string"?this.url=a:(this.link=a,this.url=this.link.attr("href")),this.options=b||{}},init:function(b,c){this.extractArgs(b,c);var d=a(document).scrollTop()+200;this.modal=a("body").append(Modal.template({})).find('[data-posterous-modal-container="true"]').last().get(),a(this.modal).css({"padding-top":d}),this.transmit(),a(this.modal).click(a.proxy(this.closeUnlessClickedInsideWindow,this)),Modal.openModals.push(this)},transmit:function(){a.jsonp({url:this.url,data:{format:"modal"},success:a.proxy(this.onSuccess,this),error:a.proxy(this.onError,this)})},showLoader:function(){a(this.modal).find(".p_modal_contents").css({visibility:"hidden"}),a(this.modal).find(".p_modal_loading").show()},hideLoader:function(){a(this.modal).find(".p_modal_loading").hide(),a(this.modal).find(".p_modal_contents").css({visibility:"visible"})},closeUnlessClickedInsideWindow:function(b){if(b.target==b.currentTarget||a(b.target).closest(".p_modal_close").length)b.preventDefault(),this.close()},onSuccess:function(b){a(this.modal).find(".p_modal_title h1").text(b.title);var c=a(unescape(b.contents)).hide().appendTo(a(this.modal).find(".p_modal_contents")),d=c.outerWidth()+40,e=c.outerHeight()+47+40;a(this.modal).find(".p_modal_inner").animate({width:d+"px",height:e+"px"},{complete:a.proxy(function(){this.hideLoader(),c.show(),this.link&&this.link.triggerHandler("modal:success",this),typeof this.options["onSuccess"]=="function"&&this.options.onSuccess(this),a(this.modal).find(".p_modal_inner").css({height:"auto"})},this)})},onError:function(b){this.hideLoader(),a(this.modal).find(".p_modal_contents").html('Something went wrong. Please try again, or email us at <a href="mailto:help@posterous.com">help@posterous.com.</a>'),this.link&&this.link.trigger("modal:failure"),typeof this.options["onFailure"]=="function"&&this.options.onFailure(this)},close:function(){var b=a.inArray(this,this.Class.openModals);b!=-1&&this.Class.openModals.splice(b,1),a(this.modal).hide().remove()}}),Modal.extend("SubModal",{init:function(b,c){this.extractArgs(b,c),a("div.p_submodal").remove(),a("div.p_modal_main").append(Modal.sub_template({}));var d=a("div.p_modal_main").outerWidth(),e=.66*d,f=(d-e)/2;a("div.p_submodal").css("left",f+"px"),a("div.p_submodal_inner").css("width",e+"px"),a("div.p_submodal").hide(),a("div.p_submodal").show("slide",{direction:"up"}),this.transmit()},onSuccess:function(b){a("div.p_modal_loading").hide(),a("div.p_submodal_contents").prepend(unescape(b.contents));var c=a(".p_submodal_contents").outerHeight();a(".p_submodal .p_submodal_inner").animate({height:c+"px"}),this.link&&this.link.triggerHandler("submodal:success",this)}}),a(function(){a.get("/javascripts/views/modal.html.handlebars",function(a){Modal.template=Handlebars.compile(a)}),a.get("/javascripts/views/submodal.html.handlebars",function(a){Modal.sub_template=Handlebars.compile(a)}),a("body").delegate('a[data-posterous-modal="true"]',"click",function(b){b.preventDefault(),new Modal(a(this))}),a("body").delegate('a[data-posterous-submodal="true"]',"click",function(b){b.preventDefault(),new SubModal(a(this))}),a("body").delegate('a[data-posterous-submodal-close="true"]',"click",function(b){b.preventDefault(),a("div.p_submodal").hide("slide",{direction:"up"})})})}(jQuery),function(a){a.Class.extend("Map",{maps:[]},{init:function(b){this.mapDiv=a(b);var c={zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMAL},mapTypeControl:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,size:new google.maps.Size(300,150)},d=a.parseJSON(this.mapDiv.attr("data-posterous-lat-lngs"));if(d.length==0)return;d=a.map(d,function(a,b){return new google.maps.LatLng(parseFloat(a[0]),parseFloat(a[1]))}),this.bounds=new google.maps.LatLngBounds,this.googleMap=new google.maps.Map(document.getElementById(this.mapDiv.attr("id")),c);for(i=0;i<d.length;i++)new google.maps.Marker({position:d[i],map:this.googleMap}),this.bounds.extend(d[i]);this.googleMap.fitBounds(this.bounds),this.googleMap.zoom!=undefined&&this.resize()},resize:function(){google.maps.event.trigger(this.googleMap,"resize"),this.googleMap.fitBounds(this.bounds),this.googleMap.setZoom(Math.min(this.googleMap.zoom,parseInt(this.mapDiv.attr("data-posterous-max-zoom"),10)))}}),a(function(){a('[data-posterous-map="true"]').each(function(b){a(this).attr("id","map_"+Math.floor(Math.random()*1e3)),Map.maps.push(new Map(a(this))),a("body").bind("show-on-click:finished",function(){a.each(Map.maps,function(a,b){b.resize()})})})})}(jQuery),function(a,b){var c,d="([^/]+)",e=/:([\w\d]+)/g,f=/\?([^#]*)$/,g=function(a){return Array.prototype.slice.call(a)},h=function(a){return Object.prototype.toString.call(a)==="[object Function]"},i=function(a){return Object.prototype.toString.call(a)==="[object Array]"},j=decodeURIComponent,k=encodeURIComponent,l=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},m=function(a){return function(b,c){return this.route.apply(this,[a,b,c])}},n={},o=[];c=function(){var b=g(arguments),d,e;c.apps=c.apps||{};if(b.length===0||b[0]&&h(b[0]))return c.apply(c,["body"].concat(b));if(typeof (e=b.shift())=="string")return d=c.apps[e]||new c.Application,d.element_selector=e,b.length>0&&a.each(b,function(a,b){d.use(b)}),d.element_selector!=e&&delete c.apps[e],c.apps[d.element_selector]=d,d},c.VERSION="0.6.2",c.addLogger=function(a){o.push(a)},c.log=function(){var b=g(arguments);b.unshift("["+Date()+"]"),a.each(o,function(a,d){d.apply(c,b)})},typeof b.console!="undefined"?h(b.console.log.apply)?c.addLogger(function(){b.console.log.apply(b.console,arguments)}):c.addLogger(function(){b.console.log(arguments)}):typeof console!="undefined"&&c.addLogger(function(){console.log.apply(console,arguments)}),a.extend(c,{makeArray:g,isFunction:h,isArray:i}),c.Object=function(b){return a.extend(this,b||{})},a.extend(c.Object.prototype,{escapeHTML:l,h:l,toHash:function(){var b={};return a.each(this,function(a,c){h(c)||(b[a]=c)}),b},toHTML:function(){var b="";return a.each(this,function(a,c){h(c)||(b+="<strong>"+a+"</strong> "+c+"<br />")}),b},keys:function(a){var b=[];for(var c in this)(!h(this[c])||!a)&&b.push(c);return b},has:function(b){return this[b]&&a.trim(this[b].toString())!=""},join:function(){var a=g(arguments),b=a.shift();return a.join(b)},log:function(){c.log.apply(c,arguments)},toString:function(b){var c=[];return a.each(this,function(a,d){(!h(d)||b)&&c.push('"'+a+'": '+d.toString())}),"Sammy.Object: {"+c.join(",")+"}"}}),c.HashLocationProxy=function(a,b){this.app=a,this.is_native=!1,this._startPolling(b)},c.HashLocationProxy.prototype={bind:function(){var d=this,e=this.app;a(b).bind("hashchange."+this.app.eventNamespace(),function(a,f){d.is_native===!1&&!f&&(c.log("native hash change exists, using"),d.is_native=!0,b.clearInterval(c.HashLocationProxy._interval)),e.trigger("location-changed")}),c.HashLocationProxy._bindings||(c.HashLocationProxy._bindings=0),c.HashLocationProxy._bindings++},unbind:function(){a(b).unbind("hashchange."+this.app.eventNamespace()),c.HashLocationProxy._bindings--,c.HashLocationProxy._bindings<=0&&b.clearInterval(c.HashLocationProxy._interval)},getLocation:function(){var a=b.location.toString().match(/^[^#]*(#.+)$/);return a?a[1]:""},setLocation:function(a){return b.location=a},_startPolling:function(d){var e=this;if(!c.HashLocationProxy._interval){d||(d=10);var f=function(){var d=e.getLocation();(!c.HashLocationProxy._last_location||d!=c.HashLocationProxy._last_location)&&b.setTimeout(function(){a(b).trigger("hashchange",[!0])},13),c.HashLocationProxy._last_location=d};f(),c.HashLocationProxy._interval=b.setInterval(f,d)}}},c.Application=function(a){var b=this;this.routes={},this.listeners=new c.Object({}),this.arounds=[],this.befores=[],this.namespace=(new Date).getTime()+"-"+parseInt(Math.random()*1e3,10),this.context_prototype=function(){c.EventContext.apply(this,arguments)},this.context_prototype.prototype=new c.EventContext,h(a)&&a.apply(this,[this]),this._location_proxy||this.setLocationProxy(new c.HashLocationProxy(this,this.run_interval_every)),this.debug&&this.bindToAllEvents(function(a,c){b.log(b.toString(),a.cleaned_type,c||{})})},c.Application.prototype=a.extend({},c.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:!1,element_selector:"body",debug:!1,raise_errors:!1,run_interval_every:50,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(b){return b?a(this.element_selector).find(b):a(this.element_selector)},use:function(){var a=g(arguments),b=a.shift(),d=b||"";try{a.unshift(this),typeof b=="string"&&(d="Sammy."+b,b=c[b]),b.apply(this,a)}catch(e){typeof b=="undefined"?this.error("Plugin Error: called use() but plugin ("+d.toString()+") is not defined",e):h(b)?this.error("Plugin Error",e):this.error("Plugin Error: called use() but '"+d.toString()+"' is not a function",e)}return this},setLocationProxy:function(a){var b=this._location_proxy;this._location_proxy=a,this.isRunning()&&(b&&b.unbind(),this._location_proxy.bind())},route:function(b,c,f){var g=this,i=[],j,k;!f&&h(c)&&(c=b,f=c,b="any"),b=b.toLowerCase();if(c.constructor==String){e.lastIndex=0;while((k=e.exec(c))!==null)i.push(k[1]);c=new RegExp("^"+c.replace(e,d)+"$")}return typeof f=="string"&&(f=g[f]),j=function(a){var b={verb:a,path:c,callback:f,param_names:i};g.routes[a]=g.routes[a]||[],g.routes[a].push(b)},b==="any"?a.each(this.ROUTE_VERBS,function(a,b){j(b)}):j(b),this},get:m("get"),post:m("post"),put:m("put"),del:m("delete"),any:m("any"),mapRoutes:function(b){var c=this;return a.each(b,function(a,b){c.route.apply(c,b)}),this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(a,b,c){var d=this;typeof c=="undefined"&&(c=b);var e=function(){var a,b,e;a=arguments[0],e=arguments[1],e&&e.context?(b=e.context,delete e.context):b=new d.context_prototype(d,"bind",a.type,e,a.target),a.cleaned_type=a.type.replace(d.eventNamespace(),""),c.apply(b,[a,e])};return this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(e),this.isRunning()&&this._listen(a,e),this},trigger:function(a,b){return this.$element().trigger([a,this.eventNamespace()].join("."),[b]),this},refresh:function(){return this.last_location=null,this.trigger("location-changed"),this},before:function(a,b){return h(a)&&(b=a,a={}),this.befores.push([a,b]),this},after:function(a){return this.bind("event-context-after",a)},around:function(a){return this.arounds.push(a),this},isRunning:function(){return this._running},helpers:function(b){return a.extend(this.context_prototype.prototype,b),this},helper:function(a,b){return this.context_prototype.prototype[a]=b,this},run:function(c){if(this.isRunning())return!1;var d=this;return a.each(this.listeners.toHash(),function(b,c){a.each(c,function(a,c){d._listen(b,c)})}),this.trigger("run",{start_url:c}),this._running=!0,this.last_location=null,this.getLocation()==""&&typeof c!="undefined"&&this.setLocation(c),this._checkLocation(),this._location_proxy.bind(),this.bind("location-changed",function(){d._checkLocation()}),this.bind("submit",function(b){var c=d._checkFormSubmission(a(b.target).closest("form"));return c===!1?b.preventDefault():!1}),a(b).bind("beforeunload",function(){d.unload()}),this.trigger("changed")},unload:function(){if(!this.isRunning())return!1;var b=this;return this.trigger("unload"),this._location_proxy.unbind(),this.$element().unbind("submit").removeClass(b.eventNamespace()),a.each(this.listeners.toHash(),function(c,d){a.each(d,function(a,d){b._unlisten(c,d)})}),this._running=!1,this},bindToAllEvents:function(b){var c=this;return a.each(this.APP_EVENTS,function(a,d){c.bind(d,b)}),a.each(this.listeners.keys(!0),function(a,d){c.APP_EVENTS.indexOf(d)==-1&&c.bind(d,b)}),this},routablePath:function(a){return a.replace(f,"")},lookupRoute:function(b,c){var d=this,e=!1;return this.trigger("lookup-route",{verb:b,path:c}),typeof this.routes[b]!="undefined"&&a.each(this.routes[b],function(a,b){if(d.routablePath(c).match(b.path))return e=b,!1}),e},runRoute:function(b,c,d,e){var f=this,g=this.lookupRoute(b,c),h,i,k,l,m,n,o,p,q;this.log("runRoute",[b,c].join(" ")),this.trigger("run-route",{verb:b,path:c,params:d}),typeof d=="undefined"&&(d={}),a.extend(d,this._parseQueryString(c));if(g){this.trigger("route-found",{route:g}),(p=g.path.exec(this.routablePath(c)))!==null&&(p.shift(),a.each(p,function(a,b){g.param_names[a]?d[g.param_names[a]]=j(b):(d.splat||(d.splat=[]),d.splat.push(j(b)))})),h=new this.context_prototype(this,b,c,d,e),k=this.arounds.slice(0),m=this.befores.slice(0),o=[h].concat(d.splat),i=function(){var a;while(m.length>0){n=m.shift();if(f.contextMatchesOptions(h,n[0])){a=n[1].apply(h,[h]);if(a===!1)return!1}}return f.last_route=g,h.trigger("event-context-before",{context:h}),a=g.callback.apply(h,o),h.trigger("event-context-after",{context:h}),a},a.each(k.reverse(),function(a,b){
var c=i;i=function(){return b.apply(h,[c])}});try{q=i()}catch(r){this.error(["500 Error",b,c].join(" "),r)}return q}return this.notFound(b,c)},contextMatchesOptions:function(a,b,c){var d=b;if(typeof d=="undefined"||d=={})return!0;typeof c=="undefined"&&(c=!0);if(typeof d=="string"||h(d.test))d={path:d};if(d.only)return this.contextMatchesOptions(a,d.only,!0);if(d.except)return this.contextMatchesOptions(a,d.except,!1);var e=!0,f=!0;return d.path&&(h(d.path.test)?e=d.path.test(a.path):e=d.path.toString()===a.path),d.verb&&(f=d.verb===a.verb),c?f&&e:!f||!e},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(a){return this._location_proxy.setLocation(a)},swap:function(a){return this.$element().html(a)},templateCache:function(a,b){return typeof b!="undefined"?n[a]=b:n[a]},clearTemplateCache:function(){return n={}},notFound:function(a,b){var c=this.error(["404 Not Found",a,b].join(" "));return a==="get"?c:!0},error:function(a,b){b||(b=new Error),b.message=[a,b.message].join(" "),this.trigger("error",{message:b.message,error:b});if(this.raise_errors)throw b;this.log(b.message,b)},_checkLocation:function(){var a,b;a=this.getLocation();if(!this.last_location||this.last_location[0]!="get"||this.last_location[1]!=a)this.last_location=["get",a],b=this.runRoute("get",a);return b},_getFormVerb:function(b){var c=a(b),d,e;return e=c.find('input[name="_method"]'),e.length>0&&(d=e.val()),d||(d=c[0].getAttribute("method")),a.trim(d.toString().toLowerCase())},_checkFormSubmission:function(b){var c,d,e,f,g;this.trigger("check-form-submission",{form:b}),c=a(b),d=c.attr("action"),e=this._getFormVerb(c);if(!e||e=="")e="get";return this.log("_checkFormSubmission",c,d,e),e==="get"?(this.setLocation(d+"?"+this._serializeFormParams(c)),g=!1):(f=a.extend({},this._parseFormParams(c)),g=this.runRoute(e,d,f,b.get(0))),typeof g=="undefined"?!1:g},_serializeFormParams:function(a){var b="",c=a.serializeArray(),d;if(c.length>0){b=this._encodeFormPair(c[0].name,c[0].value);for(d=1;d<c.length;d++)b=b+"&"+this._encodeFormPair(c[d].name,c[d].value)}return b},_encodeFormPair:function(a,b){return k(a)+"="+k(b)},_parseFormParams:function(a){var b={},c=a.serializeArray(),d;for(d=0;d<c.length;d++)b=this._parseParamPair(b,c[d].name,c[d].value);return b},_parseQueryString:function(a){var b={},c,d,e,g;c=a.match(f);if(c){d=c[1].split("&");for(g=0;g<d.length;g++)e=d[g].split("="),b=this._parseParamPair(b,j(e[0]),j(e[1]))}return b},_parseParamPair:function(a,b,c){return a[b]?i(a[b])?a[b].push(c):a[b]=[a[b],c]:a[b]=c,a},_listen:function(a,b){return this.$element().bind([a,this.eventNamespace()].join("."),b)},_unlisten:function(a,b){return this.$element().unbind([a,this.eventNamespace()].join("."),b)}}),c.RenderContext=function(a){this.event_context=a,this.callbacks=[],this.previous_content=null,this.content=null,this.next_engine=!1,this.waiting=!1},c.RenderContext.prototype=a.extend({},c.Object.prototype,{then:function(a){if(!h(a)){if(!(typeof a=="string"&&a in this.event_context))return this;var c=this.event_context[a];a=function(a){return c.apply(this.event_context,[a])}}var d=this;return this.waiting?this.callbacks.push(a):(this.wait(),b.setTimeout(function(){var b=a.apply(d,[d.content,d.previous_content]);b!==!1&&d.next(b)},13)),this},wait:function(){this.waiting=!0},next:function(a){this.waiting=!1,typeof a!="undefined"&&(this.previous_content=this.content,this.content=a),this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(b,c,d){var e=this;return this.then(function(){var f,g,i,j;h(c)?(d=c,c={}):c=a.extend({},c),d&&this.then(d);if(typeof b=="string")return i=b.match(/\.json$/)||c.json,f=i&&c.cache===!0||c.cache!==!1,e.next_engine=e.event_context.engineFor(b),delete c.cache,delete c.json,c.engine&&(e.next_engine=c.engine,delete c.engine),f&&(g=this.event_context.app.templateCache(b))?g:(this.wait(),a.ajax(a.extend({url:b,data:{},dataType:i?"json":null,type:"get",success:function(a){f&&e.event_context.app.templateCache(b,a),e.next(a)}},c)),!1);if(b.nodeType)return b.innerHTML;if(b.selector)return e.next_engine=b.attr("data-engine"),c.clone===!1?b.remove()[0].innerHTML.toString():b[0].innerHTML.toString()})},render:function(a,b,c){return h(a)&&!b?this.then(a):(!b&&this.content&&(b=this.content),this.load(a).interpolate(b,a).then(c))},partial:function(a,b){return this.render(a,b).swap()},send:function(){var a=this,b=g(arguments),c=b.shift();return i(b[0])&&(b=b[0]),this.then(function(d){return b.push(function(b){a.next(b)}),a.wait(),c.apply(c,b),!1})},collect:function(b,c,d){var e=this,f=function(){h(b)&&(c=b,b=this.content);var d=[],f=!1;return a.each(b,function(a,b){var g=c.apply(e,[a,b]);return g.jquery&&g.length==1&&(g=g[0],f=!0),d.push(g),g}),f?d:d.join("")};return d?f():this.then(f)},renderEach:function(b,c,d,e){return i(c)&&(e=d,d=c,c=null),this.load(b).then(function(f){var g=this;d||(d=i(this.previous_content)?this.previous_content:[]);if(!e)return this.collect(d,function(a,d){var e={},g=this.next_engine||b;return c?e[c]=d:e=d,this.event_context.interpolate(f,e,g)},!0);a.each(d,function(a,d){var h={},i=this.next_engine||b;c?h[c]=d:h=d,e(d,g.event_context.interpolate(f,h,i))})})},interpolate:function(a,b,c){var d=this;return this.then(function(e,f){!a&&f&&(a=f),this.next_engine&&(b=this.next_engine,this.next_engine=!1);var g=d.event_context.interpolate(e,a,b);return c?f+g:g})},swap:function(){return this.then(function(a){this.event_context.swap(a)}).trigger("changed",{})},appendTo:function(b){return this.then(function(c){a(b).append(c)}).trigger("changed",{})},prependTo:function(b){return this.then(function(c){a(b).prepend(c)}).trigger("changed",{})},replace:function(b){return this.then(function(c){a(b).html(c)}).trigger("changed",{})},trigger:function(a,b){return this.then(function(c){typeof b=="undefined"&&(b={content:c}),this.event_context.trigger(a,b)})}}),c.EventContext=function(a,b,d,e,f){this.app=a,this.verb=b,this.path=d,this.params=new c.Object(e),this.target=f},c.EventContext.prototype=a.extend({},c.Object.prototype,{$element:function(){return this.app.$element(g(arguments).shift())},engineFor:function(a){var b=this,c;if(h(a))return a;a=a.toString();if(c=a.match(/\.([^\.]+)$/))a=c[1];return a&&h(b[a])?b[a]:b.app.template_engine?this.engineFor(b.app.template_engine):function(a,b){return a}},interpolate:function(a,b,c){return this.engineFor(c).apply(this,[a,b])},render:function(a,b,d){return(new c.RenderContext(this)).render(a,b,d)},renderEach:function(a,b,d,e){return(new c.RenderContext(this)).renderEach(a,b,d,e)},load:function(a,b,d){return(new c.RenderContext(this)).load(a,b,d)},partial:function(a,b){return(new c.RenderContext(this)).partial(a,b)},send:function(){var a=new c.RenderContext(this);return a.send.apply(a,arguments)},redirect:function(){var a,b=g(arguments),c=this.app.getLocation();b.length>1?(b.unshift("/"),a=this.join.apply(this,b)):a=b[0],this.trigger("redirect",{to:a}),this.app.last_location=[this.verb,this.path],this.app.setLocation(a),c==a&&this.app.trigger("location-changed")},trigger:function(a,b){return typeof b=="undefined"&&(b={}),b.context||(b.context=this),this.app.trigger(a,b)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(a){return this.app.swap(a)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(b){return a.parseJSON(b)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}}),a.sammy=b.Sammy=c}(jQuery,window),function(a){a.fn.swipe=function(b){var c={threshold:{x:30,y:10},swipeLeft:function(){alert("swiped left")},swipeRight:function(){alert("swiped right")}},b=a.extend(c,b);return this?this.each(function(){function f(a){d.x=a.targetTouches[0].pageX,d.y=a.targetTouches[0].pageY}function g(a){a.preventDefault(),e.x=a.targetTouches[0].pageX,e.y=a.targetTouches[0].pageY}function h(a){var b=d.y-e.y;b<c.threshold.y&&b>c.threshold.y*-1&&(changeX=d.x-e.x,changeX>c.threshold.x&&c.swipeLeft(),changeX<c.threshold.x*-1&&c.swipeRight())}function f(a){d.x=a.targetTouches[0].pageX,d.y=a.targetTouches[0].pageY,e.x=d.x,e.y=d.y}function i(a){}var b=a(this),d={x:0,y:0},e={x:0,y:0};this.addEventListener("touchstart",f,!1),this.addEventListener("touchmove",g,!1),this.addEventListener("touchend",h,!1),this.addEventListener("touchcancel",i,!1)}):!1}}(jQuery),$j(function(){slideshow.run(),$j(".posterousHeaderActions a.slideshow").live("click",function(a){a.preventDefault(),slideshow.setLocation("#!/slideshow")})});var slideshow=$j.sammy(function(){this.get("#!/",function(){this.log("slideshows")}),this.get("#!/slideshow",function(){if($j(".posterous_site_data").length>0)var a=$j(".posterous_site_data").first().attr("data-show-type"),b=$j(".posterous_site_data").first().attr("data-site-type"),c=$j(".posterous_site_data").first().attr("data-site-id"),d=$j(".posterous_site_data").first().attr("data-user-id"),e=$j(".posterous_site_data").first().attr("data-post-id");else var a=$j("body").attr("data-show-type")||$j("body").attr("data-show_type")||window.show_type,b=$j("body").attr("data-site-type")||$j("body").attr("data-site_type")||window.site_type,c=$j("body").attr("data-site-id")||$j("body").attr("data-site_id")||window.site_id,d=$j("body").attr("data-user-id")||$j("body").attr("data-admin_id")||window.user_id,e=$j("body").attr("data-post-id")||window.post_id;b!="group"&&$j("#whole_site").length==0&&(this.log("running sitewide"),slides=new startSlideshow({show_type:a,site_type:b,post_id:e,site_id:c,user_id:d,image_list:null,current_image:null,autoplay:!0}))}),this.get("#!/:slug/slideshow",function(){if($j(".posterous_site_data").length>0)var a=$j(".posterous_site_data").first().attr("data-show-type"),b=$j(".posterous_site_data").first().attr("data-site-type"),c=$j(".posterous_site_data").first().attr("data-site-id"),d=$j(".posterous_site_data").first().attr("data-user-id"),e=$j(".posterous_site_data").first().attr("data-post-id");else var a=$j("body").attr("data-show-type")||$j("body").attr("data-show_type")||window.show_type,b=$j("body").attr("data-site-type")||$j("body").attr("data-site_type")||window.site_type,c=$j("body").attr("data-site-id")||$j("body").attr("data-site_id")||window.site_id,d=$j("body").attr("data-user-id")||$j("body").attr("data-admin_id")||window.user_id,e=$j("body").attr("data-post-id")||window.post_id;b!="group"&&(e!=undefined||$j("#this_post")==undefined||$j("#this_post")!=undefined&&!$j("#this_post").hasClass("clicked"))&&(this.log("running post slides"),this.redirect("/"+this.params.slug+"/#!/slideshow"))}),this.get("#!/private/:slug/slideshow",function(){if($j(".posterous_site_data").length>0)var a=$j(".posterous_site_data").first().attr("data-show-type"),b=$j(".posterous_site_data").first().attr("data-site-type"),c=$j(".posterous_site_data").first().attr("data-site-id"),d=$j(".posterous_site_data").first().attr("data-user-id"),e=$j(".posterous_site_data").first().attr("data-post-id");else var a=$j("body").attr("data-show-type")||$j("body").attr("data-show_type")||window.show_type,b=$j("body").attr("data-site-type")||$j("body").attr("data-site_type")||window.site_type,c=$j("body").attr("data-site-id")||$j("body").attr("data-site_id")||window.site_id,d=$j("body").attr("data-user-id")||$j("body").attr("data-admin_id")||window.user_id,e=$j("body").attr("data-post-id")||window.post_id;b!="group"&&(e!=undefined||$j("#this_post")==undefined||$j("#this_post")!=undefined&&!$j("#this_post").hasClass("clicked"))&&(this.log("running post slides"),this.redirect("/private/"+this.params.slug+"/#!/slideshow"))}),this.get("#!/:slug",function(){this.log("route for "+this.params.slug)})});Prototype.Browser.IE6=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6,Prototype.Browser.IE7=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==7,Prototype.Browser.IE8=Prototype.Browser.IE&&!Prototype.Browser.IE6&&!Prototype.Browser.IE7;var slideshowTimer,currentPages=[],currentPage=null,currentSlideLength=null,pageAttempts=0,image_post_ids=[],image_sources=[],slideCount=0,windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,startSlideshow=Class.create({initialize:function(a){this.show_type=a.show_type,this.site_type=a.site_type,this.current_image=a.current_image,this.image_list=a.image_list,this.user_id=a.user_id,this.site_id=a.site_id,this.post_id=a.post_id,this.thread_id=a.thread_id,this.reply_ids=a.reply_ids,this.slug=a.slug,this.autoplay=a.autoplay,this.setupPostSlideshow();if(this.site_type!=undefined&&this.show_type=="thread"){$("this_thread").addClassName("clicked");var b=setTimeout(function(){this.current_image!=null?(this.insertThreadSlides(),this.insertThreadReplySlides(),this.startThreadSlides()):(this.insertThreadSlides(),this.insertThreadReplySlides()),this.setupSlideControls()}.bind(this),1e3)}else if(this.show_type=="site"||this.show_type=="group"&&this.site_type=="group")var b=setTimeout(function(){this.insertSiteSlides(),this.setupSlideControls()}.bind(this),1e3);else if(this.show_type=="post"&&this.current_image!=null&&this.image_list!=null){$("this_post").addClassName("clicked");var b=setTimeout(function(){this.insertPostSlides(),this.startPostSlides(),this.setupSlideControls()}.bind(this),250)}else if(this.show_type=="post"&&this.current_image==null&&this.image_list==null){$("this_post").addClassName("clicked"),$("whole_site").addClassName("clicked");var b=setTimeout(function(){this.insertPostSlides(),this.setupSlideControls()}.bind(this),1e3)}this.boundKeyboardSlides=this.keyboardSlides.bind(this),this.boundStopSlides=this.stopSlides.bind(this),Event.observe(document.onresize?document:window,"resize",function(){this.resizeImages()}.bind(this))},setupPostSlideshow:function(){var a=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,b=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;$("slide_div")==undefined?(isIphone?this.slide_div=new Element("div",{id:"slide_div",style:"margin:0;display: none; background: black none repeat scroll 0% 0%; position: fixed; top: 0px; right: 0px; vertical-align:middle; text-align:center; width: 100%; height:"+window.innerHeight+"px; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; z-index: 9999;"}):this.slide_div=new Element("div",{id:"slide_div",style:"margin:0;display: none; background: black none repeat scroll 0% 0%; position: fixed; top: 0px; right: 0px; vertical-align:middle; text-align:center; width: 100%; height:100%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; z-index: 9999;"}),new Effect.Appear(document.body.appendChild(this.slide_div),{duration:.5})):new Effect.Appear($("slide_div"),{duration:.5}),!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8&&this.site_type!=undefined&&this.site_type!="group"&&document.body.setStyle({overflow:"hidden"});if(this.slide_div!=undefined){this.autoplay==1&&this.site_type!=undefined&&this.site_type=="group"&&this.show_type=="thread"?this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="switch">                <a class="on" href="#" onclick="return false;" id="this_thread">This Thread</a> |                <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>              </div>                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>            </div>         </div>'}):this.autoplay==1&&this.show_type=="site"||this.show_type=="group"&&this.site_type=="group"?this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="navigation">                <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>              </div>            </div>         </div>'}):this.autoplay==0&&this.site_type!=undefined&&this.site_type=="group"&&this.show_type=="thread"?this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="switch">                <a class="on" href="#" onclick="return false;" id="this_thread">This Thread</a> |                <a href="#" onclick="return false;" id="whole_site">Whole Site</a>              </div>                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>            </div>         </div>'}):this.autoplay==0&&this.show_type=="site"||this.show_type=="group"&&this.site_type=="group"?this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>              </div>           </div>'}):this.autoplay==1?this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close" ><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="switch">                  <a class="on" href="#" onclick="return false;" id="this_post">This Post</a> |                  <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>                </div>                  <div id="navigation">                    <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                  </div>              </div>           </div>'}):this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="switch">                  <a class="on" href="#" onclick="return false;" id="this_post">This Post</a> |                  <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>                </div>                  <div id="navigation">                    <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                  </div>              </div>           </div>'});var c=$$(".posterous_site_data")[0]?$$(".posterous_site_data")[0].readAttribute("data-site-location"):!1,d=$$(".posterous_site_data")[0]?$$(".posterous_site_data")[0].readAttribute("data-site-id"):0;if(c=="true"){var e=d=="3008319"?"post-to-image-blogworld":"post-to-image",f=d=="3008319"?"post-to-blogworld":"post-to",g=new Element("div",{"class":"event_slideshow_instructions"});g.insert({top:'          <img id="'+e+'" src="/images/posterous_p_logo.png">           <div id="'+f+'">             Download Posterous for the iPhone to post here       \t\t</div>'}),this.slide_div.insert({top:g})}}isIphone&&noTouchMove()},resizeImages:function(){var a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,b=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,c=a/b;$$("img.img").each(function(d){currentFactor=d.readAttribute("scaling-factor"),c>currentFactor?!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8?d.writeAttribute({width:"100%",height:"","scaling-factor":currentFactor}):d.writeAttribute({width:b+"px",height:b/currentFactor+"px","scaling-factor":currentFactor}):!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8?d.writeAttribute({height:"100%",width:"","scaling-factor":currentFactor}):d.writeAttribute({height:a+"px",width:a/currentFactor+"px","scaling-factor":currentFactor})})},insertPostSlides:function(){var a=this,b=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,c=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,d=b/c;$("slideshow_loading").show(),console.log("inserting post slides");if(this.current_image){var e=this.current_image;if(e.large!=null){var f=parseInt(e.largeWidth),g=parseInt(e.largeHeight),h=g/f;image=new Element("img",{src:e.large,"class":"img","scaling-factor":h})}else{var f=parseInt(e.imageObj.width),g=parseInt(e.imageObj.height),h=g/f;image=new Element("img",{src:e.imageObj.src,"class":"img","scaling-factor":h})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>h?image.writeAttribute({width:c+"px",height:c/h+"px"}):image.writeAttribute({height:b+"px",width:b/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>h){var i=c/f*g;image.writeAttribute({height:i,width:c})}else{var j=b/g*f;image.writeAttribute({height:b,width:j})}else d>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide activeslide clicked",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({top:slide.insert({top:image})}),slideCount+=1}if(this.image_list!=null||this.current_image!=null){for(var k=0,l=this.image_list.length;k<l;++k){var m=this.image_list[k];if(this.image_list[k]!=e){if(m.large!=null){var f=parseInt(m.largeWidth),g=parseInt(m.largeHeight),h=g/f;image=new Element("img",{src:m.large,"class":"img","scaling-factor":h})}else{var f=parseInt(m.imageObj.width),g=parseInt(m.imageObj.height),h=g/f;image=new Element("img",{src:m.imageObj.src,"class":"img","scaling-factor":h})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>h?image.writeAttribute({width:c+"px",height:c/h+"px"}):image.writeAttribute({height:b+"px",width:b/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>h){var i=c/f*g;image.writeAttribute({height:i,width:c})}else{var j=b/g*f;image.writeAttribute({height:b,width:j})}else d>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){a.autoplay?(console.log("autoplay"),$("pauseplay").hasClassName("play")?($("pauseplay").removeClassName("play"),$("pauseplay").addClassName("pause"),a.playSlides()):(a.stopSlides(),a.playSlides())):console.log("no autoplay")},100)}else{var n=$("slidesource").childElements(),o=[],p="/api/v2",q=p+"/users/"+this.user_id+"/sites/"+this.site_id+"/posts/"+this.post_id+"/photos";new Ajax.Request(q,{method:"get",onLoading:function(){$("slideshow_loading").show()},onSuccess:function(a){var e=a.responseText.evalJSON();for(var i=0,j=e.length;i<j;++i){var k=e[i];if(k.scaled1000!=undefined){f=k.scaled1000.width,g=k.scaled1000.height,h=g/f,image=new Element("img",{src:k.scaled1000.url,alt:k.scaled1000.caption,"data-id":k.scaled1000.post_id,"class":"img","scaling-factor":h});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>h?image.writeAttribute({width:c+"px",height:c/h+"px"}):image.writeAttribute({height:b+"px",width:b/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>h){var l=c/f*g;image.writeAttribute({height:l,width:c})}else{var m=b/g*f;image.writeAttribute({height:b,width:m})}else d>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(k.scaled500){f=k.scaled500.width,g=k.scaled500.height,h=g/f,image=new Element("img",{src:k.scaled500.url,alt:k.scaled500.caption,"data-id":k.scaled500.post_id,"class":"img","scaling-factor":h});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>h?image.writeAttribute({width:c+"px",height:c/h+"px"}):image.writeAttribute({height:b+"px",width:b/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>h){var l=c/f*g;image.writeAttribute({height:l,width:c})}else{var m=b/g*f;image.writeAttribute({height:b,width:m})}else d>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(k.full){f=k.full.width,g=k.full.height,h=g/f,image=new Element("img",{src:k.full.url,alt:k.full.caption,"data-id":k.full.post_id,"class":"img","scaling-factor":h});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>h?image.writeAttribute({width:c+"px",height:c/h+"px"}):image.writeAttribute({height:b+"px",width:b/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>h){var l=c/f*g;image.writeAttribute({height:l,width:c})}else{var m=b/g*f;image.writeAttribute({height:b,width:m})}else d>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){$("slideshow_loading").hide();var a=$("slidesource").childElements().first();slides=$("slidesource").childElements(),a.addClassName("activeslide"),a.appear()},500)},onFailure:function(){alert("Weird, something went wrong with the slideshow for this post. Try refreshing your browser.")},onComplete:function(){a.autoplay==1&&$("slidesource").childElements().length>1&&(console.log("autoplay"),$("pauseplay").hasClassName("play")?($("pauseplay").removeClassName("play"),$("pauseplay").addClassName("pause"),a.playSlides()):(a.stopSlides(),a.playSlides()))}})}},startPostSlides:function(){var a=$("slidesource").down(".activeslide");$("slideshow_loading").hide();if(a==undefined){var b=$("slidesource").down(".slide");slides=$("slidesource").childElements(),b.addClassName("activeslide"),b.appear({duration:.5})}else a.appear({duration:.5})},startThreadSlides:function(){var a=$("slidesource").down(".activeslide");$("slideshow_loading").hide();if(a==undefined){var b=$("slidesource").down(".slide");slides=$("slidesource").childElements(),b.addClassName("activeslide"),b.appear({duration:.5})}else a.appear({duration:.5});this.autoplay&&this.reply_ids.length<1&&(console.log("autoplay"),$("pauseplay").hasClassName("play")?($("pauseplay").removeClassName("play"),$("pauseplay").addClassName("pause"),this.playSlides()):(this.stopSlides(),this.playSlides()))},setupSlideControls:function(){var a=this;document.observe("keydown",this.keyboardSlides.bind(this)),$("nextslide").observe("click",function(){var a=$("slidesource").childElements();a.length>1&&this.nextSlide()}.bind(this)),$("prevslide").observe("click",function(){var a=$("slidesource").childElements();a.length>1&&this.prevSlide()}.bind(this)),$("pauseplay").observe("click",function(){var a=$("slidesource").childElements();a.length>1&&($("pauseplay").hasClassName("play")?($("pauseplay").removeClassName("play"),$("pauseplay").addClassName("pause"),this.playSlides()):$("pauseplay").hasClassName("pause")&&($("pauseplay").removeClassName("pause"),$("pauseplay").addClassName("play"),this.stopSlides()))}.bind(this)),$("close").observe("click",function(){$("pauseplay").hasClassName("pause")&&($("pauseplay").removeClassName("pause"),$("pauseplay").addClassName("play"),this.stopSlides()),new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keydown",this.boundKeyboardSlides),$("slide_div")!=undefined&&$("slide_div").remove()}}),!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8&&this.site_type!=undefined&&this.site_type!="group"&&document.body.setStyle({overflow:"auto"}),isIphone&&doTouchMove(),this.slug&&this.site_type=="group"?slideshow.setLocation("#!/"+this.slug):slideshow.setLocation("#!/")}.bind(this)),$("this_post")!=undefined&&$("this_post").observe("click",function(){$("pauseplay").hasClassName("pause")&&($("pauseplay").removeClassName("pause"),$("pauseplay").addClassName("play"),this.stopSlides()),$("this_post").hasClassName("on")||($("whole_site").removeClassName("on"),$("this_post").addClassName("on"),this.switchSlideshow(),this.insertPostSlides(),this.startPostSlides()),this.slug!=undefined&&this.show_type=="site"?slideshow.setLocation("#!/"+this.slug+"/slideshow"):this.slug!=undefined&&this.show_type=="post"&&slideshow.setLocation("#!/slideshow")}.bind(this)),$("this_thread")!=undefined&&$("this_thread").observe("click",function(){$("pauseplay").hasClassName("pause")&&($("pauseplay").removeClassName("pause"),$("pauseplay").addClassName("play"),this.stopSlides()),$("this_thread").hasClassName("on")||($("whole_site").removeClassName("on"),$("this_thread").addClassName("on"),this.switchSlideshow(),this.insertThreadSlides(),this.insertThreadReplySlides(),this.current_image!=null&&this.startThreadSlides()),this.
slug!=undefined&&slideshow.setLocation("/#!/"+this.slug+"/slideshow")}.bind(this)),$("whole_site")!=undefined&&(pageAttempts=0,$("whole_site").observe("click",function(){$("whole_site").hasClassName("on")||($("this_post")?$("this_post").removeClassName("on"):$("this_thread")&&$("this_thread").removeClassName("on"),$("whole_site").addClassName("clicked"),$("whole_site").addClassName("on"),this.insertSiteSlides()),(this.show_type=="site"||this.show_type=="post")&&slideshow.setLocation("#!/slideshow")}.bind(this))),document.observe("load",function(){setTimeout(function(){$("controls-wrapper").hide(),$("close").hide()},4500)}.bind(this)),document.observe("mousemove",function(){clearTimeout(this.controltimer),$("controls-wrapper")!=undefined&&$("controls-wrapper").show(),$("close")!=undefined&&$("close").show(),this.controltimer=setTimeout(function(){$("controls-wrapper")!=undefined&&$("controls-wrapper").hide(),$("close")!=undefined&&$("close").hide()},4500)}.bind(this))},keyboardSlides:function(a){var b=this,c=$("slidesource").childElements(),d=a.charCode||a.keyCode;c.length>1&&(d==37?this.prevSlide():d==39?this.nextSlide():d==32&&($("pauseplay").hasClassName("play")?($("pauseplay").removeClassName("play"),$("pauseplay").addClassName("pause"),this.playSlides()):$("pauseplay").hasClassName("pause")&&($("pauseplay").removeClassName("pause"),$("pauseplay").addClassName("play"),this.stopSlides()))),d==27&&($("pauseplay").hasClassName("pause")&&($("pauseplay").removeClassName("pause"),$("pauseplay").addClassName("play"),this.stopSlides()),new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keydown",this.boundKeyboardSlides),$("slide_div")!=undefined&&$("slide_div").remove()}}),!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8&&this.site_type!=undefined&&this.site_type!="group"&&document.body.setStyle({overflow:"auto"}),this.slug&&this.site_type=="group"?slideshow.setLocation("#!/"+this.slug):slideshow.setLocation("#!/"))},nextSlide:function(){$("pauseplay").hasClassName("pause")&&($("pauseplay").removeClassName("pause"),$("pauseplay").addClassName("play"),this.stopSlides()),active_slide=$$("#slidesource .activeslide").first(),next_slide=active_slide.next(".slide"),next_slide==undefined&&(next_slide=$("slidesource").down(".slide"),slideCount<currentSlideLength&&this.updateSiteSlides()),active_slide.removeClassName("activeslide"),next_slide.addClassName("activeslide"),next_slide.hasClassName("clicked")||(slideCount+=1,next_slide.addClassName("clicked")),currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on"))?this.updateSiteSlides():currentSlideLength!=null&&slideCount==currentSlideLength&&($("whole_site")==undefined||$("whole_site").hasClassName("on"))&&(console.log("update slides"),this.updateSiteSlides()),active_slide.fade(),next_slide.appear()},prevSlide:function(){$("pauseplay").hasClassName("pause")&&($("pauseplay").removeClassName("pause"),$("pauseplay").addClassName("play"),this.stopSlides()),active_slide=$$("#slidesource .activeslide").first(),prev_slide=active_slide.previous(".slide"),prev_slide==undefined&&(prev_slide=$("slidesource").childElements().last(),slideCount<currentSlideLength&&this.updateSiteSlides()),active_slide.removeClassName("activeslide"),prev_slide.addClassName("activeslide"),prev_slide.hasClassName("clicked")||(slideCount+=1,prev_slide.addClassName("clicked")),currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on"))?this.updateSiteSlides():currentSlideLength!=null&&slideCount==currentSlideLength&&($("whole_site")==undefined||$("whole_site").hasClassName("on"))&&this.updateSiteSlides(),active_slide.fade(),prev_slide.appear()},playSlides:function(){var a=this;slideshowTimer=window.setInterval(function(){active_slide=$$("#slidesource .activeslide").first();if(active_slide==undefined)return;next_slide=active_slide.next(".slide"),next_slide==undefined&&(next_slide=$("slidesource").down(".slide"),slideCount<currentSlideLength&&a.updateSiteSlides()),active_slide.removeClassName("activeslide"),next_slide.addClassName("activeslide"),next_slide.hasClassName("clicked")||(slideCount+=1,next_slide.addClassName("clicked")),currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on"))?a.updateSiteSlides():currentSlideLength!=null&&slideCount==currentSlideLength&&($("whole_site")==undefined||$("whole_site").hasClassName("on"))&&a.updateSiteSlides(),active_slide.fade(),next_slide.appear()},7e3)},stopSlides:function(){return window.clearInterval(slideshowTimer),!1},insertThreadSlides:function(){var a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,b=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,c=a/b;image_sources=[];var d=this;console.log("inserting thread slides");if(this.current_image){var e=this.current_image;if(e.large!=null){image_sources.push(e.large);var f=parseInt(e.largeWidth),g=parseInt(e.largeHeight),h=g/f;image=new Element("img",{src:e.large,"class":"img","scaling-factor":h})}else{var f=parseInt(e.imageObj.width),g=parseInt(e.imageObj.height),h=g/f;image=new Element("img",{src:e.imageObj.src,"class":"img","scaling-factor":h})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>h?image.writeAttribute({width:b+"px",height:b/h+"px"}):image.writeAttribute({height:a+"px",width:a/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>h){var i=b/f*g;image.writeAttribute({height:i,width:b})}else{var j=a/g*f;image.writeAttribute({height:a,width:j})}else c>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide activeslide clicked",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({top:slide.insert({top:image})}),slideCount+=1}if(this.image_list!=null||this.current_image!=null)for(var k=0,l=this.image_list.length;k<l;++k){var m=this.image_list[k];if(this.image_list[k]!=e){if(m.large!=null){image_sources.push(m.large);var f=parseInt(m.largeWidth),g=parseInt(m.largeHeight),h=g/f;image=new Element("img",{src:m.large,"class":"img","scaling-factor":h})}else{image_sources.push(m.imageObj.src);var f=parseInt(m.imageObj.width),g=parseInt(m.imageObj.height),h=g/f;image=new Element("img",{src:m.imageObj.src,"class":"img","scaling-factor":h})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>h?image.writeAttribute({width:b+"px",height:b/h+"px"}):image.writeAttribute({height:a+"px",width:a/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>h){var i=b/f*g;image.writeAttribute({height:i,width:b})}else{var j=a/g*f;image.writeAttribute({height:a,width:j})}else c>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}}else{var n=$("slidesource").childElements();image_sources=[];var o="/api/v2",p=o+"/users/"+this.user_id+"/sites/"+this.site_id+"/posts/"+this.thread_id+"/photos";new Ajax.Request(p,{method:"get",onLoading:function(){$("slideshow_loading").show()},onSuccess:function(e){var i=e.responseText.evalJSON();for(var j=0,k=i.length;j<k;++j){var l=i[j];if(l.scaled1000!=undefined){image_sources.push(l.scaled1000.url),f=l.scaled1000.width,g=l.scaled1000.height,h=g/f,image=new Element("img",{src:l.scaled1000.url,alt:l.scaled1000.caption,"data-id":l.scaled1000.post_id,"class":"img","scaling-factor":h});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>h?image.writeAttribute({width:b+"px",height:b/h+"px"}):image.writeAttribute({height:a+"px",width:a/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>h){var m=b/f*g;image.writeAttribute({height:m,width:b})}else{var n=a/g*f;image.writeAttribute({height:a,width:n})}else c>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(l.scaled500){image_sources.push(l.scaled500.url),f=l.scaled500.width,g=l.scaled500.height,h=g/f,image=new Element("img",{src:l.scaled500.url,alt:l.scaled500.caption,"data-id":l.scaled500.post_id,"class":"img","scaling-factor":h});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>h?image.writeAttribute({width:b+"px",height:b/h+"px"}):image.writeAttribute({height:a+"px",width:a/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>h){var m=b/f*g;image.writeAttribute({height:m,width:b})}else{var n=a/g*f;image.writeAttribute({height:a,width:n})}else c>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(l.full){image_sources.push(l.full.url),f=l.full.width,g=l.full.height,h=g/f,image=new Element("img",{src:l.full.url,alt:l.full.caption,"data-id":l.full.post_id,"class":"img","scaling-factor":h});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>h?image.writeAttribute({width:b+"px",height:b/h+"px"}):image.writeAttribute({height:a+"px",width:a/h+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>h){var m=b/f*g;image.writeAttribute({height:m,width:b})}else{var n=a/g*f;image.writeAttribute({height:a,width:n})}else c>h?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){$("slideshow_loading").hide();var a=$("slidesource").childElements().first();slides=$("slidesource").childElements(),a.addClassName("activeslide"),a.appear()},500),d.autoplay&&d.reply_ids.length<1&&(console.log("autoplay"),$("pauseplay").hasClassName("play")?($("pauseplay").removeClassName("play"),$("pauseplay").addClassName("pause"),d.playSlides()):(d.stopSlides(),d.playSlides()))},onFailure:function(){alert("Weird, something went wrong with the thread slideshow. Try refreshing your browser.")}})}},insertThreadReplySlides:function(){var a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,b=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,c=a/b,d=this,e=$("slidesource").childElements(),f="/api/v2";console.log("inserting thread reply slides");for(var g=0,h=this.reply_ids.length;g<h;++g){var i=this.reply_ids[g],j=f+"/users/"+this.user_id+"/sites/"+this.site_id+"/posts/"+i+"/photos";new Ajax.Request(j,{method:"get",onSuccess:function(e){var f=e.responseText.evalJSON();for(var g=0,h=f.length;g<h;++g){var i=f[g];if(i.scaled1000&&image_sources.include(i.scaled1000.url)||i.scaled500&&image_sources.include(i.scaled500.url)||i.full&&image_sources.include(i.full.url))console.log("has image");else{console.log("new image");if(i.scaled1000!=undefined){image_sources.push(i.scaled1000.url),currentWidth=i.scaled1000.width,currentHeight=i.scaled1000.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:i.scaled1000.url,alt:i.scaled1000.caption,"data-id":i.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>currentFactor?image.writeAttribute({width:b+"px",height:b/currentFactor+"px"}):image.writeAttribute({height:a+"px",width:a/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>currentFactor){var j=b/currentWidth*currentHeight;image.writeAttribute({height:j,width:b})}else{var k=a/currentHeight*currentWidth;image.writeAttribute({height:a,width:k})}else c>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(i.scaled500){image_sources.push(i.scaled500.url),currentWidth=i.scaled500.width,currentHeight=i.scaled500.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:i.scaled500.url,alt:i.scaled500.caption,"data-id":i.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>currentFactor?image.writeAttribute({width:b+"px",height:b/currentFactor+"px"}):image.writeAttribute({height:a+"px",width:a/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>currentFactor){var j=b/currentWidth*currentHeight;image.writeAttribute({height:j,width:b})}else{var k=a/currentHeight*currentWidth;image.writeAttribute({height:a,width:k})}else c>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(i.full){image_sources.push(i.full.url),currentWidth=i.full.width,currentHeight=i.full.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:i.full.url,alt:i.full.caption,"data-id":i.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)c>currentFactor?image.writeAttribute({width:b+"px",height:b/currentFactor+"px"}):image.writeAttribute({height:a+"px",width:a/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(c>currentFactor){var j=b/currentWidth*currentHeight;image.writeAttribute({height:j,width:b})}else{var k=a/currentHeight*currentWidth;image.writeAttribute({height:a,width:k})}else c>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}}}setTimeout(function(){d.autoplay==1&&($("pauseplay").hasClassName("play")?($("pauseplay").removeClassName("play"),$("pauseplay").addClassName("pause"),d.playSlides()):(d.stopSlides(),d.playSlides()))},1e3)},onFailure:function(){alert("Weird, something went wrong with the thread slideshow. Try refreshing your browser.")}})}},insertSiteSlides:function(a){var b=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,c=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,d=b/c,e=$("slidesource").childElements(),f=[],g="/api/v2";currentPages=[],image_post_ids=[];var h=this;a=a||0,randompage=a+1;var i=g+"/users/"+this.user_id+"/sites/"+this.site_id+"/photos?page="+randompage;console.log("inserting site slides"),active_slide=$$("#slidesource .activeslide").first(),active_slide!=undefined&&active_slide.fade({duration:1});if(e.length>0){for(var j=0,k=e.length;j<k;++j){var l=e[j];l.remove()}if(this.image_list!=null||this.current_image!=null)for(var j=0,k=this.image_list.length;j<k;++j){var l=this.image_list[j];l.large!=null?f.push(l.large):f.push(l.imageObj.src)}}new Ajax.Request(i,{method:"get",onLoading:function(){$("slideshow_loading").show()},onSuccess:function(a){var e=a.responseText.evalJSON();if(e.length==0)pageAttempts+=1,pageAttempts>=30?(new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keyup",this.boundKeyboardSlides),$("slide_div")!=undefined&&$("slide_div").remove()}}),!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8&&this.site_type!=undefined&&this.site_type!="group"&&document.body.setStyle({overflow:"auto"}),this.slug&&this.site_type=="group"?slideshow.setLocation("#!/"+this.slug):slideshow.setLocation("#!/"),alert("We can't seem to find any photos for this site.")):(currentPages.push(randompage),h.insertSiteSlides(randompage));else{pageAttempts=0,slideCount=0,currentPage=randompage,currentPages.push(randompage),currentSlideLength=e.length;var f=e[0];if(f.scaled1000){image_post_ids.push(f.scaled1000.post_id),currentWidth=f.scaled1000.width,currentHeight=f.scaled1000.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:f.scaled1000.url,alt:f.scaled1000.caption,"data-id":f.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var g=c/currentWidth*currentHeight;image.writeAttribute({height:g,width:c})}else{var i=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:i})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(f.scaled500){image_post_ids.push(f.scaled500.post_id),currentWidth=f.scaled500.width,currentHeight=f.scaled500.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:f.scaled500.url,alt:f.scaled500.caption,"data-id":f.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var g=c/currentWidth*currentHeight;image.writeAttribute({height:g,width:c})}else{var i=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:i})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(f.full){image_post_ids.push(f.full.post_id),currentWidth=f.full.width,currentHeight=f.full.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:f.full.url,alt:f.full.caption,"data-id":f.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var g=c/currentWidth*currentHeight;image.writeAttribute({height:g,width:c})}else{var i=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:i})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}setTimeout(function(){active_slide=$("slidesource").down(".activeslide"),slide=$("slidesource").down(".slide"),active_slide==undefined&&slide!=undefined&&($("slideshow_loading").hide(),slide.addClassName("activeslide"),slide.addClassName("clicked"),slideCount+=1,slide.appear())},500);for(var j=1,k=e.length;j<k;++j){var f=e[j];if(f.scaled1000){image_post_ids.push(f.scaled1000.post_id),currentWidth=f.scaled1000.width,currentHeight=f.scaled1000.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:f.scaled1000.url,alt:f.scaled1000.caption,"data-id":f.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var g=c/currentWidth*currentHeight;image.writeAttribute({height:g,width:c})}else{var i=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:i})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(f.scaled500){image_post_ids.push(f.scaled500.post_id),currentWidth=f.scaled500.width,currentHeight=f.scaled500.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:f.scaled500.url,alt:f.scaled500.caption,"data-id":f.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var g=c/currentWidth*currentHeight;image.writeAttribute({height:g,width:c})}else{var i=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:i})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(f.full){image_post_ids.push(f.full.post_id),currentWidth=f.full.width,currentHeight=f.full.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:f.full.url,alt:f.full.caption,"data-id":f.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var g=c/currentWidth*currentHeight;image.writeAttribute({height:g,width:c})}else{var i=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:i})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){console.log("load photos and start slideshow"),$("pauseplay").hasClassName("play")?($("pauseplay").removeClassName("play"),$("pauseplay").addClassName("pause"),h.playSlides()):(h.stopSlides(),h.playSlides())},1500)}},onFailure:function(){alert("Weird, something went wrong with the site wide slideshow. Try refreshing your browser.")}})},updateSiteSlides:function(a){if($("this_post")!=undefined&&$("this_post").hasClassName("on")||$("this_thread")!=undefined&&$("this_thread").hasClassName("on"))return;var b=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,c=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,d=b/c,e=$("slidesource").childElements(),f=[],g=$$(".posterous_site_data")[0]?$$(".posterous_site_data")[0].readAttribute("data-site-location"):!1,h=this,i="/api/v2",j=i+"/users/"+this.user_id+"/sites/"+this.site_id+"/photos?page="+a;console.log("updating site slides");if(e.length>0)for(var k=0,l=e.length;k<l;++k){var m=e[k];f.push(m.readAttribute("data-id"))}new Ajax.Request(j,{method:"get",onSuccess:function(a){var e=a.responseText.evalJSON();if(e.length==0||currentPages.include(randompage)&&randompage!=1){pageAttempts+=1,currentPages.push(randompage),h.updateSiteSlides(rand(30));return}pageAttempts=0,slideCount=0,currentPage=randompage,currentPages.push(randompage),currentSlideLength=e.length;for(var f=0,g=e.length;f<g;++f){var i=e[f];if(i.scaled1000&&image_post_ids.include(i.scaled1000.post_id))console.log("has image");else if(i.scaled500&&image_post_ids.include(i.scaled500.post_id))console.log("has image");else if(i.full&&image_post_ids.include(i.full.post_id))console.log("has image");else{console.log("new image");if(i.scaled1000){image_post_ids.push(i.scaled1000.post_id),currentWidth=i.scaled1000.width,currentHeight=i.scaled1000.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:i.scaled1000.url,alt:i.scaled1000.caption,"data-id":i.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var j=c/currentWidth*currentHeight;image.writeAttribute({height:j,width:c})}else{var k=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:k})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(i.scaled500){image_post_ids.push(i.scaled500.post_id),currentWidth=i.scaled500.width,currentHeight=i.scaled500.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:i.scaled500.url,alt:i.scaled500.caption,"data-id":i.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var j=c/currentWidth*currentHeight;image.writeAttribute({height:j,width:c})}else{var k=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:k})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}else if(i.full){image_post_ids.push(i.full.post_id),currentWidth=i.full.width,currentHeight=i.full.height,currentFactor=currentHeight/currentWidth,image=new Element("img",{src:i.full.url,alt:i.full.caption,"data-id":i.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)d>currentFactor?image.writeAttribute({width:c+"px",height:c/currentFactor+"px"}):image.writeAttribute({height:b+"px",width:b/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(d>currentFactor){var j=c/currentWidth*currentHeight;image.writeAttribute({height:j,width:c})}else{var k=b/currentHeight*currentWidth;image.writeAttribute({height:b,width:k})}else d>currentFactor?image.writeAttribute("width","100%"):image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"}),(Prototype.Browser.IE7||Prototype.Browser.IE6)&&slide.writeAttribute({style:"left:0px;display:none;"}),$("slidesource").insert({bottom:slide.insert({top:image})})}}}},onFailure:function(){return!1}})},switchSlideshow:function(){var a=$("slidesource").childElements();active_slide=$$("#slidesource .activeslide").first(),active_slide!=undefined&&active_slide.fade({duration:1});for(var b=0,c=a.length;b<c;++b){var d=a[b];d.remove()}}});((function(){var a=this,b=a.Backbone,c;typeof exports!="undefined"?c=exports:c=a.Backbone={},c.VERSION="0.5.2";var d=a._;!d&&typeof require!="undefined"&&(d=require("underscore")._);var e=a.jQuery||a.Zepto;c.noConflict=function(){return a.Backbone=b,this},c.emulateHTTP=!1,c.emulateJSON=!1,c.Events={bind:function(a,b,c){var d=this._callbacks||(this._callbacks={}),e=d[a]||(d[a]=[]);return e.push([b,c]),this},unbind:function(a,b){var c;if(!a)this._callbacks={};else if(c=this._callbacks)if(!b)c[a]=[];else{var d=c[a];if(!d)return this;for(var e=0,f=d.length;e<f;e++)if(d[e]&&b===d[e][0]){d[e]=null;break}}return this},trigger:function(a){var b,c,d,e,f,g=2;if(!(c=this._callbacks))return this;while(g--){d=g?a:"all";if(b=c[d])for(var h=0,i=b.length;h<i;h++)(e=b[h])?(f=g?Array.prototype.slice.call(arguments,1):arguments,e[0].apply(e[1]||this,f)):(b.splice(h,1),h--,i--)}return this}},c.Model=function(a,b){var c;a||(a={});if(c=this.defaults)d.isFunction(c)&&(c=c.call(this)),a=d.extend({},c,a);this.attributes={},this._escapedAttributes={},this.cid=d.uniqueId("c"),this.set(a,{silent:!0}),this._changed=!1,this._previousAttributes=d.clone(this.attributes),b&&b.collection&&(this.collection=b.collection),this.initialize(a,b)},d.extend(c.Model.prototype,c.Events,{_previousAttributes:null,_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return d.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var c=this.attributes[a];return this._escapedAttributes[a]=v(c==null?"":""+c)},has:function(a){return this.attributes[a]!=null},set:function(a,b){b||(b={});if(!a)return this;a.attributes&&(a=a.attributes);var c=this.attributes,e=this._escapedAttributes;if(!b.silent&&this.validate&&!this._performValidation(a,b))return!1;this.idAttribute in a&&(this.id=a[this.idAttribute]);var f=this._changing;this._changing=!0;for(var g in a){var h=a[g];d.isEqual(c[g],h)||(c[g]=h,delete e[g],this._changed=!0,b.silent||this.trigger("change:"+g,this,h,b))}return!f&&!b.silent&&this._changed&&this.change(b),this._changing=!1,this},unset:function(a,b){if(a in this.attributes){b||(b={});var c=this.attributes[a],d={};return d[a]=void 0,!b.silent&&this.validate&&!this._performValidation(d,b)?!1:(delete this.attributes[a],delete this._escapedAttributes[a],a==this.idAttribute&&delete this.id,this._changed=!0,b.silent||(this.trigger("change:"+a,this,void 0,b),this.change(b)),this)}return this},clear:function(a){a||(a={});var b,c=this.attributes,d={};for(b in c)d[b]=void 0;if(!a.silent&&this.validate&&!this._performValidation(d,a))return!1;this.attributes={},this._escapedAttributes={},this._changed=!0;if(!a.silent){for(b in c)this.trigger("change:"+b,this,void 0,a);this.change(a)}return this},fetch:function(a){a||(a={}),a.showLoader=a.showLoader==0?!1:!0,a.showLoader&&Posterous.showLoader();var b=this,d=a.success;return a.success=function(c,e,f){Posterous.hideLoader();if(!b.set(b.parse(c,f),a))return!1;d&&d(b,c)},a.error=u(a.error,b,a),(this.sync||c.sync).call(this,"read",this,a)},save:function(a,b){b||(b={});if(a&&!this.set(a,b))return!1;var d=this,e=b.success;b.success=function(a,c,f){if(!d.set(d.parse(a,f),b))return!1;e&&e(d,a,f)},b.error=u(b.error,d,b);var f=this.isNew()?"create":"update";return(this.sync||c.sync).call(this,f,this,b)},destroy:function(a){a||(a={});if(this.isNew())return this.trigger("destroy"
,this,this.collection,a);var b=this,d=a.success;return a.success=function(c){b.trigger("destroy",b,b.collection,a),d&&d(b,c)},a.error=u(a.error,b,a),(this.sync||c.sync).call(this,"delete",this,a)},url:function(){var a=s(this.collection)||this.urlRoot||t();return this.isNew()?a:a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(a){this.trigger("change",this,a),this._previousAttributes=d.clone(this.attributes),this._changed=!1},hasChanged:function(a){return a?this._previousAttributes[a]!=this.attributes[a]:this._changed},changedAttributes:function(a){a||(a=this.attributes);var b=this._previousAttributes,c=!1;for(var e in a)d.isEqual(b[e],a[e])||(c=c||{},c[e]=a[e]);return c},previous:function(a){return!a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return d.clone(this._previousAttributes)},_performValidation:function(a,b){var c=this.validate(a);return c?(b.error?b.error(this,c,b):this.trigger("error",this,c,b),!1):!0}}),c.Collection=function(a,b){b||(b={}),b.comparator&&(this.comparator=b.comparator),d.bindAll(this,"_onModelEvent","_removeReference"),this._reset(),a&&this.reset(a,{silent:!0}),this.initialize.apply(this,arguments)},d.extend(c.Collection.prototype,c.Events,{model:c.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,b){if(d.isArray(a))for(var c=0,e=a.length;c<e;c++)this._add(a[c],b);else this._add(a,b);return this},remove:function(a,b){if(d.isArray(a))for(var c=0,e=a.length;c<e;c++)this._remove(a[c],b);else this._remove(a,b);return this},get:function(a){return a==null?null:this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return this.models=this.sortBy(this.comparator),a.silent||this.trigger("reset",this,a),this},pluck:function(a){return d.map(this.models,function(b){return b.get(a)})},reset:function(a,b){return a||(a=[]),b||(b={}),this.each(this._removeReference),this._reset(),this.add(a,{silent:!0}),b.silent||this.trigger("reset",this,b),this},fetch:function(a){a||(a={});var b=this,d=a.success;return a.success=function(c,e,f){b[a.add?"add":"reset"](b.parse(c,f),a),d&&d(b,c)},a.error=u(a.error,b,a),(this.sync||c.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b||(b={}),a=this._prepareModel(a,b);if(!a)return!1;var d=b.success;return b.success=function(a,e,f){c.add(a,b),d&&d(a,e,f)},a.save(null,b),a},parse:function(a,b){return a},chain:function(){return d(this.models).chain()},_reset:function(a){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,b){if(a instanceof c.Model)a.collection||(a.collection=this);else{var d=a;a=new this.model(d,{collection:this}),a.validate&&!a._performValidation(d,b)&&(a=!1)}return a},_add:function(a,b){b||(b={}),a=this._prepareModel(a,b);if(!a)return!1;var c=this.getByCid(a);if(c)throw new Error(["Can't add the same model to a set twice",c.id]);this._byId[a.id]=a,this._byCid[a.cid]=a;var d=b.at!=null?b.at:this.comparator?this.sortedIndex(a,this.comparator):this.length;return this.models.splice(d,0,a),a.bind("all",this._onModelEvent),this.length++,b.silent||a.trigger("add",a,this,b),a},_remove:function(a,b){return b||(b={}),a=this.getByCid(a)||this.get(a),a?(delete this._byId[a.id],delete this._byCid[a.cid],this.models.splice(this.indexOf(a),1),this.length--,b.silent||a.trigger("remove",a,this,b),this._removeReference(a),a):null},_removeReference:function(a){this==a.collection&&delete a.collection,a.unbind("all",this._onModelEvent)},_onModelEvent:function(a,b,c,d){if((a=="add"||a=="remove")&&c!=this)return;a=="destroy"&&this._remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments)}});var f=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty"];d.each(f,function(a){c.Collection.prototype[a]=function(){return d[a].apply(d,[this.models].concat(d.toArray(arguments)))}}),c.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var g=/:([\w\d]+)/g,h=/\*([\w\d]+)/g,i=/[-[\]{}()+?.,\\^$|#\s]/g;d.extend(c.Router.prototype,c.Events,{initialize:function(){},route:function(a,b,e){c.history||(c.history=new c.History),d.isRegExp(a)||(a=this._routeToRegExp(a)),c.history.route(a,d.bind(function(c){var d=this._extractParameters(a,c);e.apply(this,d),this.trigger.apply(this,["route:"+b].concat(d))},this))},navigate:function(a,b){c.history.navigate(a,b)},_bindRoutes:function(){if(!this.routes)return;var a=[];for(var b in this.routes)a.unshift([b,this.routes[b]]);for(var c=0,d=a.length;c<d;c++)this.route(a[c][0],a[c][1],this[a[c][1]])},_routeToRegExp:function(a){return a=a.replace(i,"\\$&").replace(g,"([^/]*)").replace(h,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}}),c.History=function(){this.handlers=[],d.bindAll(this,"checkUrl")};var j=/^#*/,k=/msie [\w.]+/,l=!1;d.extend(c.History.prototype,{interval:50,getFragment:function(a,b){if(a==null)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c),a.indexOf(this.options.root)==0&&(a=a.substr(this.options.root.length))}else a=window.location.hash;return a.replace(j,"")},start:function(a){if(l)throw new Error("Backbone.history has already been started");this.options=d.extend({},{root:"/"},this.options,a),this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var b=this.getFragment(),c=document.documentMode,f=k.exec(navigator.userAgent.toLowerCase())&&(!c||c<=7);f&&(this.iframe=e('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?e(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!f?e(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval),this.fragment=b,l=!0;var g=window.location,h=g.pathname==this.options.root;return this._wantsPushState&&!this._hasPushState&&!h?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&h&&g.hash&&(this.fragment=g.hash.replace(j,""),window.history.replaceState({},document.title,g.protocol+"//"+g.host+this.options.root+this.fragment)),this.loadUrl())},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();b==this.fragment&&this.iframe&&(b=this.getFragment(this.iframe.location.hash));if(b==this.fragment||b==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=d.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0});return c},navigate:function(a,b){var c=(a||"").replace(j,"");console.log(c);if(this._hasPushState){var d=window.location;c.indexOf(this.options.root)!=0&&(c=this.options.root+c),this.fragment=c,window.history.pushState({},document.title,d.protocol+"//"+d.host+c)}else console.log("else"),console.log(c),window.location.hash=this.fragment=c,this.iframe&&c!=this.getFragment(this.iframe.location.hash)&&(this.iframe.document.open().close(),this.iframe.location.hash=c);b&&this.loadUrl(a)}}),c.View=function(a){this.cid=d.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.delegateEvents(),this.initialize.apply(this,arguments)};var m=function(a){return e(a,this.el)},n=/^(\S+)\s*(.*)$/,o=["model","collection","el","id","attributes","className","tagName"];d.extend(c.View.prototype,c.Events,{tagName:"div",$:m,initialize:function(){},render:function(){return this},remove:function(){return e(this.el).remove(),this},make:function(a,b,c){var d=document.createElement(a);return b&&e(d).attr(b),c&&e(d).html(c),d},delegateEvents:function(a){if(!a&&!(a=this.events))return;e(this.el).unbind(".delegateEvents"+this.cid);for(var b in a){var c=this[a[b]];if(!c)throw new Error('Event "'+a[b]+'" does not exist');var f=b.match(n),g=f[1],h=f[2];c=d.bind(c,this),g+=".delegateEvents"+this.cid,h===""?e(this.el).bind(g,c):e(this.el).delegate(h,g,c)}},_configure:function(a){this.options&&(a=d.extend({},this.options,a));for(var b=0,c=o.length;b<c;b++){var e=o[b];a[e]&&(this[e]=a[e])}this.options=a},_ensureElement:function(){if(!this.el){var a=this.attributes||{};this.id&&(a.id=this.id),this.className&&(a["class"]=this.className),this.el=this.make(this.tagName,a)}else d.isString(this.el)&&(this.el=e(this.el).get(0))}});var p=function(a,b){var c=r(this,a,b);return c.extend=this.extend,c};c.Model.extend=c.Collection.extend=c.Router.extend=c.View.extend=p,c.methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},c.sync=function(a,b,f){var g=c.methodMap[a],h=d.extend({type:g,dataType:"json"},f);return h.url||(h.url=s(b)||t()),!h.data&&b&&(a=="create"||a=="update")&&(h.contentType="application/json",h.data=JSON.stringify(d.extend({},b.toJSON(),{authenticity_token:window._token}))),c.emulateJSON&&(h.contentType="application/x-www-form-urlencoded",h.data=h.data?{model:h.data}:{},h.data.authenticity_token=window._token),c.emulateHTTP&&(g==="PUT"||g==="DELETE")&&(c.emulateJSON&&(h.data._method=g),h.type="POST",h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)},h.authenticity_token=window._token),h.type!=="GET"&&(h.processData=!1),h.beforeSend=function(a){a.setRequestHeader("X-Xhrsource","posterous")},e.ajax(h)};var q=function(){},r=function(a,b,c){var e;return b&&b.hasOwnProperty("constructor")?e=b.constructor:e=function(){return a.apply(this,arguments)},d.extend(e,a),q.prototype=a.prototype,e.prototype=new q,b&&d.extend(e.prototype,b),c&&d.extend(e,c),e.prototype.constructor=e,e.__super__=a.prototype,e},s=function(a){return!a||!a.url?null:d.isFunction(a.url)?a.url():a.url},t=function(){throw new Error('A "url" property or function must be specified')},u=function(a,b,c){return function(d){a?a(b,d,c):b.trigger("error",b,d,c)}},v=function(a){return a.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}})).call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};(function(a,c,d,e){var f;return a.Posterous=a.Posterous||{BASE_URL:"/api/2",Collections:{},Models:{},Views:{}},f=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Model),a.prototype.hasMany=function(a,b){return this[a]=new b,this[a][Posterous.getConstructorName(this).toLowerCase()]=this},a.prototype.belongsTo=function(a,b){return this[a]=this.collection?this.collection[a]:new b({id:this.get(""+a+"_id")})},a.prototype.hasOne=function(a,b){return this[a]=new b,this[a][Posterous.getConstructorName(this).toLowerCase()]=this},a}(),Posterous.Model=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,f),a.prototype.hasMany=function(a,b){return this[a]=new b,this[a][Posterous.getConstructorName(this).toLowerCase()]=this},a.prototype.belongsTo=function(a,b){return this[a]=this.collection?this.collection[a]:new b({id:""+a+"_id"})},a.prototype.hasOne=function(a,b){return this[a]=new b,this[a][Posterous.getConstructorName(this).toLowerCase()]=this},a.prototype.toJSON=function(){return this._wrappedAttributes()},a.prototype._wrappedAttributes=function(){var a;return a={},a[this._namespace()]=_.clone(this.attributes),a},a.prototype._namespace=function(){if(!this.namespaceKey)throw new Error("A 'namespaceKey' property must be specified");return this.namespaceKey},a}(),Posterous.MovableModel=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.initialize=function(){return this._url=this.url},a.prototype.fetch=function(a){var b,c,d,e;return a||(a={}),(e=a.showLoader)==null&&(a.showLoader=!0),a.showLoader&&Posterous.showLoader(),c=this,d=a.success,a.success=function(b,e,f){if(!c.set(c.parse(b,f),a))return!1;if(d)return d(c,b)},b=a.abortable,a.error=Posterous._wrapError(a.error,c,a),(this.sync||Backbone.sync).call(this,"read",this,a,b)},a.prototype.moveUrl=function(){return this._url()+"/move"},a.prototype.canMoveTo=function(a){return!0},a.prototype.moveTo=function(a,b){var c,d,e,f;return b=b||{},this.canMoveTo(a)?(d=this,f=b.success,c=b.error,e=_.extend(b,{success:function(a,b){a._resetUrl();if(f)return f(a,b)},error:function(a,b){return a._resetUrl(),c?c(a,b):a.trigger("error",a,b,e)}}),this.url=this.moveUrl,this.attributes.position=a,Posterous.MovableModel.prototype.save.call(this,null,e)):(c=JSON.stringify({message:["Can't move to position "+a],error:"Validation Failed"}),b.error?b.error(this,c):this.trigger("error",this,c),this)},a.prototype._resetUrl=function(){return this.url=this._url},a}(),Posterous.PaginatedCollection=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.initialize=function(){return _.bindAll(this,"parse"),a.__super__.initialize.apply(this,arguments)},a.prototype.formatCacheKey=function(a){var b,c,d;return a==null&&(a={}),c=a.url,c+=function(){var c,e;c=a.data,e=[];for(b in c)d=c[b],e.push(""+b+"|"+d);return e}().join("|"),c},a.prototype.parse=function(a,b){return this.perPage=+b.getResponseHeader("x-per-page"),this.currentPage=+b.getResponseHeader("x-current-page")||1,this.totalPages=+b.getResponseHeader("x-total-pages"),this.totalEntries=+b.getResponseHeader("x-total-entries"),a},a.prototype.fetch=function(a){var b,c,d,e;return a||(a={}),c=this,d=a.success,b=a.abortable,(e=a.showLoader)==null&&(a.showLoader=!0),a.showLoader&&Posterous.showLoader(),a.originalSuccess=a.success,a.success=function(b,e,f){return c[a.add?"add":"reset"](c.parse(b,f),a),d&&d(c,b),Posterous.hideLoader()},a.error=Posterous._wrapError(a.error,c,a),(this.sync||Backbone.sync).call(this,"read",this,a,b)},a.prototype.getUrl=function(a){return!a||!a.url?null:_.isFunction(a.url)?a.url():a.url},a.prototype.urlError=function(){throw new Error('A "url" property or function must be specified')},a.prototype.sync=function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o=this;d==null&&(d=!0),i={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},n=i[a],m=_.extend({type:n,dataType:"json"},c),this.currentPage=this.currentPage||1,this.perPage=this.perPage||c.perPage||10,j=a==="create"||a==="update"?JSON.stringify(b.toJSON()):{},this.currentPage&&(j.page=this.currentPage),this.perPage&&(j.per_page=this.perPage),m.url||(m.url=this.getUrl(b)||urlError()),this.currentPage&&(c.useBeforeDisplayDate&&(this.currentPage=1),l=/\?/.test(m.url)?"&":"?",m.url=""+m.url+l+"page="+this.currentPage+"&per_page="+this.perPage,c.useBeforeDisplayDate&&(h=(new Date(this.last().get("display_date"))).getTime()/1e3,m.url+="&before_display_date="+h)),!m.data&&b&&(a==="create"||a==="update")&&(m.contentType="application/json",m.data=j),Backbone.emulateJSON&&(m.contentType="application/x-www-form-urlencoded",m.data=m.data?{model:m.data}:{}),Backbone.emulateHTTP&&(n==="PUT"||n==="DELETE")&&(Backbone.emulateJSON&&(m.data._method=n),m.type="POST",m.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",n)}),m.type!=="GET"&&(m.processData=!1),m.beforeSend=function(a){return a.setRequestHeader("X-Xhrsource","posterous")};if(n==="GET"){f=this.formatCacheKey(m),k=m.success,m.success=function(a,b,c){return k&&k(a,b,c),Dashboard.Cache[f]={xhr:c,resp:a,status:b},Posterous.hideLoader()};if(g=Dashboard.Cache[f])return this.totalPages=g.totalPages,this.currentPage=g.currentPage,k(g.resp,g.status,g.xhr),!0}return d?Dashboard.currentRequest=e.ajax(m):e.ajax(m)},a.prototype.fetchPage=function(a,b){return typeof this.totalPages!="undefined"&&this._errorIfOutsideRange(a),this.currentPage=a,this.fetch(b)},a.prototype.fetchNextPage=function(a){return this._errorIfNewCollection(),this.fetchPage(this.currentPage+1,a)},a.prototype.fetchPreviousPage=function(a){return this._errorIfNewCollection(),this.fetchPage(this.currentPage-1,a)},a.prototype.hasNextPage=function(){return this._errorIfNewCollection(),this._isPageInRange(this.currentPage+1)},a.prototype.hasPreviousPage=function(){return this._errorIfNewCollection(),this._isPageInRange(this.currentPage-1)},a.prototype.nextPage=function(){var a;if(this._isPageInRange(a=this.currentPage+1))return a},a.prototype.previousPage=function(){var a;if(this._isPageInRange(a=this.currentPage-1))return a},a.prototype._isPageInRange=function(a){return a<=this.totalPages&&a>=1},a.prototype._errorIfNewCollection=function(){if(typeof this.currentPage=="undefined"||typeof this.totalPages=="undefined")throw new Error("Must initialize the collection by first calling `fetch` or `fetchPage`.")},a.prototype._errorIfOutsideRange=function(a){if(!this._isPageInRange(a))throw new Error("Page "+a+" cannot be fetched: there are only "+this.totalPages+" pages available")},a}(),Posterous._wrapError=function(a,b,c){return function(d){return Posterous.hideLoader(),a?a(b,d):b.trigger("error",b,d,c)}},Posterous.showLoader=function(){},Posterous.hideLoader=function(){},Posterous.fetchAndAssignCurrentUser=function(a){return this.currentUser=a?new Posterous.Models.User(a):null},Posterous.getConstructorName=function(a){return a.namespaceKey}})(window,document,void 0,jQuery)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Post=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="post",a.prototype.mediaType=null,a.prototype.url=function(){var a;return a=""+Posterous.BASE_URL+"/sites/"+this.get("site_id")+"/posts",this.isNew()?a:""+a+"/"+this.id},a.prototype.initialize=function(){return this.hasMany("comments",Posterous.Collections.Comments),this.hasMany("likes",Posterous.Collections.Likes),this.belongsTo("site",Posterous.Models.Site),this.belongsTo("user",Posterous.Models.User),this.belongsTo("email",Posterous.Models.Email)},a.prototype.fetchResponses=function(a){return $.ajax({url:""+this.url()+"/responses",data:{authenticity_token:window._token},success:a,beforeSend:function(a){return a.setRequestHeader("X-Xhrsource","posterous")}})},a.prototype.approve=function(a){return $.ajax({url:""+this.url()+"/approve",type:"post",data:{_method:"put",authenticity_token:window._token},success:a,beforeSend:function(a){return a.setRequestHeader("X-Xhrsource","posterous")}})},a.prototype.flag=function(a){return $.ajax({url:""+Posterous.BASE_URL+"/popular_posts/"+this.id,type:"post",data:{_method:"delete",is_flagged:!0,authenticity_token:window._token},success:a})},a.prototype.flag=function(a){return $.ajax({url:""+Posterous.BASE_URL+"/popular_posts/"+this.id,type:"post",data:{_method:"delete",is_flagged:!0,authenticity_token:window._token},success:a})},a.prototype.type=function(){return this.mediaType?this.mediaType:this.media().videos.length>=1?this.mediaType="video":this.media().audio_files.length>=1?this.mediaType="audio":this.media().images.length>1?this.mediaType="gallery":this.media().images.length===1?this.mediaType="image":this.mediaType="text"},a.prototype.fullUrl=function(){return this.get("is_private")?this.get("full_url").replace(this.get("slug"),"private/"+this.get("privatestring")):this.get("full_url")},a.prototype.hasPreviewImage=function(){return this.media().images!=="undefined"&&this.media().images.length>0},a.prototype.previewImage=function(){return(this.media().images[0].scaled500||this.media().images[0].full).url},a.prototype.media=function(){return this.get("media")},a.prototype.vimeoId=function(){return this.extractIframe()},a.prototype.youTubeId=function(){return this.extractIframe()},a.prototype.hasYouTube=function(){return this.get("body_cleaned").indexOf("www.youtube.com")!==-1},a.prototype.hasVimeo=function(){return this.get("body_cleaned").indexOf("player.vimeo.com/video")!==-1},a.prototype.wrappedBody=function(){return $("<div>"+this.get("body_cleaned")+"</div>")},a.prototype.extractIframe=function(){var a,b,c,d,e,f,g,h;b=this.wrappedBody().find("iframe");if(b.length===0)return null;f=_.last(b.attr("src").split("/"));if(b.attr("src").indexOf("youtube")!==-1||b.attr("src").indexOf("vimeo")!==-1)return e=_.first(f.split("?")),c=b.attr("height"),d=b.attr("width"),h=this.resizeVideo(c,d),a=h[0],g=h[1],{videoId:e,height:a,width:g}},a.prototype.resizeVideo=function(a,b){var c,d;return d=b/a,c=500/d,[Math.floor(c),500]},a.prototype.isOwnedByCurrentUser=function(){return this.get("is_owned_by_current_user")},a.prototype.isEditableByCurrentUser=function(){return this.isOwnedByCurrentUser()||this.get("current_member")==="admin"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Account=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.id="backboneisworsethanphp",a.prototype.namespaceKey="user",a.prototype.url=function(){return""+Posterous.BASE_URL+"/account"},a.prototype.formConfig={password:{type:"Dashboard.Views.PasswordFieldView",opts:{label:"Password",description:"Type your password to delete your account"}}},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Activity=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="activity",a.prototype.initialize=function(){},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Comment=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="comment",a.prototype.formConfig={body:{type:"Dashboard.Views.TextAreaView",opts:{label:"Comment:"}}},a.prototype.validate=function(a){var b;b=[],a.body||b.push("Body must be present");if(b.length>0)return b;return},a.prototype.initialize=function(){return this.belongsTo("post",Posterous.Models.Post)},a.prototype.isReallyNew=!0,a.prototype.isNew=function(){return this.isReallyNew},a.prototype.url=function(){var a;return a=this.post.url()+"/comments",this.isNew()?a:""+a+"/"+this.id},a.prototype.approve=function(a){return $.post(""+this.url()+"/approve",{_method:"put",authenticity_token:_token},a)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Email=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="email",a.prototype.formConfig={email:{type:"Dashboard.Views.TextFieldView",opts:{label:"Email Address",description:'Type an email then click "Add Email". We will send a confirmation to that address.'}}},a.prototype.url=function(){var a;this.user=Dashboard.currentUser;if(!this.user||!this.user.id)throw new Error("Email must belong to a valid user");return a=this.user.url()+"/emails",this.isNew()?a:""+a+"/"+this.id},a.prototype.initialize=function(){return this.belongsTo("user",Posterous.Models.User)},a.prototype.makePrimary=function(a,b){return this.save({primary:!0},{success:a,error:b})},a.prototype.sendConfirmation=function(a,b){return this.save({send_confirmation:!0},{success:a,error:b})},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.ExternalSite=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="external_site",a.prototype.save=function(){throw new Error("External Sites cannot be created or updated")},a.prototype.initialize=function(){return this.belongsTo("site",Posterous.Models.Site)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.FriendSource=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="source",a.prototype.service=function(){return this.get("service")},a.prototype.href=function(){return this.get("href")},a.prototype.name=function(){return this.get("name")},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Like=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="like",a.prototype.save=function(a,b){if(this.isNew())return Posterous.Model.prototype.save.call(this,a,b);throw new Error("Likes cannot be updated")},a.prototype.initialize=function(){return this.belongsTo("post",Posterous.Models.Post)},a.prototype.url=function(){var a;return a=this.post.url()+"/likes",this.isNew()?a:""+a+"/"+this.id},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Link=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.MovableModel),a.prototype.namespaceKey="link",a.prototype.validate=function(a){var b;b=[],a.title||b.push("Title must be present"),a.url||b.push("URL must be present");if(b.length>0)return b;return},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.LinkCategory=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.MovableModel),a.prototype.namespaceKey="link_category",a.prototype.initialize=function(){return Posterous.MovableModel.prototype.initialize.call(this),this.links=new Posterous.Collections.Links,this.links.category=this},a.prototype.validate=function(a){var b;b=[],a.title||b.push("Title must be present");if(b.length>0)return b;return},a.prototype.save=function(a,b){if(this.canEdit())return Posterous.Model.prototype.save.call(this,a,b);throw new Error("Cannot change Navigation category")},a.prototype.destroy=function(a){if(this.canDestroy())return Posterous.Model.prototype.destroy.call(this,a);throw new Error("Cannot destroy Navigation category")},a.prototype.canEdit=function(){return!this.isNavigation()},a.prototype.canDestroy=function(){return!this.isNavigation()},a.prototype.isNavigation=function(){return this.get("position")===0},a.prototype.canMoveTo=function(a){return a>0},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.MailSetting=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="mail_setting",a.prototype.formConfig={mysubs:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Your subscription email",optionsForSelect:[["Daily",2],["Weekly",3],["Never",4]]}},post_replies:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"When you email a new post",description:'When you <a href="https://posterous.uservoice.com/knowledgebase/articles/36522-how-to-post-by-email" class="help">send a post via email</a>',optionsForSelect:[["Instantly",1],["Never",4]]}},subs:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Follow emails",description:"When someone follows one of your spaces",optionsForSelect:[["Instantly",1],["Daily",2],["Weekly",3],["Never",4]]}},comments:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Response emails",description:"When someone responds to your posts",optionsForSelect:[["Instantly",1],["Daily",2],["Never",4]]}},moderation:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Moderation emails",description:"When a post or comment needs moderation",optionsForSelect:[["Instantly",1],["Daily",2],["Weekly",3],["Never",4]]}},whatsnew:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Posterous Newsletter",optionsForSelect:[["Monthly",5],["Never",4]]}}},a.prototype.url=function(){return Posterous.BASE_URL+"/users/me/mail_setting"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Notification=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="notification",a.prototype.initialize=function(){},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Page=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="page",a.prototype.validate=function(a){var b;b=[],a.title||b.push("Title must be present"),a.body||b.push("Body must be present");if(b.length>0)return b;return},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.PopularPost=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Models.Post),a.prototype.remove=function(a){return $.ajax({url:""+Posterous.BASE_URL+"/popular_posts/"+this.id,type:"post",data:{_method:"delete",authenticity_token:window._token},success:a})},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Site=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="site",a.prototype.formConfig={name:{type:"Dashboard.Views.TextFieldView",opts:{label:"Space Name",description:"This is the title others will see on your Space (required)."}},subhead:{type:"Dashboard.Views.TextAreaView",opts:{label:"Description"}},hostname:{type:"Dashboard.Views.UrlFieldView",opts:{label:"URL",description:"This is the web address of your Space. You can change it later (required)."}}},a.prototype.url=function(){var a;return a=Posterous.BASE_URL+"/sites",this.isNew()?a:a+"/"+this.id},a.prototype.initialize=function(){return this.hasOne("theme",Posterous.Models.Theme),this.hasOne("profile",Posterous.Models.SiteProfile),this.hasMany("posts",Posterous.Collections.Posts),this.hasMany("external_sites",Posterous.Collections.ExternalSites),this.hasMany("link_categories",Posterous.Collections.LinkCategories),this.hasMany("pages",Posterous.Collections.Pages),this.hasMany("activities",Posterous.Collections.Activities),this.hasMany("followers"
,Posterous.Collections.Followers),this.hasMany("authors",Posterous.Collections.Authors),this.hasMany("drafts",Posterous.Collections.Drafts)},a.prototype.subscribe=function(a){return $.post(""+this.url()+"/subscribe",{_method:"put",authenticity_token:_token},a)},a.prototype.unsubscribe=function(a){return $.post(""+this.url()+"/unsubscribe",{_method:"put",authenticity_token:_token},a)},a.prototype.subscribeViaJsonp=function(a,b){return jQuery.jsonp({url:""+this.url()+"/subscribe_via_jsonp.jsonp",success:a,error:b})},a.prototype.unsubscribeViaJsonp=function(a,b){return jQuery.jsonp({url:""+this.url()+"/unsubscribe_via_jsonp.jsonp",success:a,error:b})},a.prototype.subscribe_by_email=function(a,b){return $.post(""+this.url()+"/subscribe_by_email",{_method:"put",email:a,authenticity_token:_token},b)},a.prototype.enableInstant=function(a){return this.set({current_user_notification_frequency:"immediately"}),$.post(""+this.url()+"/notifications",{_method:"put",email_notifications:"instant",authenticity_token:_token},a)},a.prototype.disableInstant=function(a){return this.set({current_user_notification_frequency:"daily"}),$.post(""+this.url()+"/notifications",{_method:"put",email_notifications:"daily",authenticity_token:_token},a)},a.prototype.makePrimary=function(a){return $.post(""+this.url()+"/make_primary",{_method:"put",authenticity_token:_token},a)},a.prototype.mergeImport=function(a,b){return b==null&&(b=null),$.post(""+this.url()+"/merge_with_site",{_method:"put",authenticity_token:_token,merge_target_site_id:a},b)},a.prototype.currentUserRole=function(){return this.get("current_user_role")},a.prototype.roleWithIndefiniteArticle=function(){if(this.isAdmin())return"an administrator of";if(this.isContributor())return"a contributor to";if(this.isSubscriber())return"a follower of"},a.prototype.isAdmin=function(){return this.currentUserRole()==="admin"},a.prototype.isContributor=function(){return this.currentUserRole()==="contributor"},a.prototype.isSubscriber=function(){return this.currentUserRole()==="subscriber"},a.prototype.isAuthor=function(){return this.isAdmin()||this.isContributor()},a.prototype.isMember=function(){return this.isAdmin()||this.isContributor()||this.isSubscriber()},a.prototype.isPrimaryFor=function(a){return this.id===a.get("site_id")},a.prototype.hostname=function(){return this.get("hostname")},a.prototype.fullUrl=function(){return this.get("full_hostname")},a.prototype.canBeLeftByCurrentUser=function(){return!this.isPrimaryFor(Dashboard.currentUser)&&(this.get("current_user_role")==="contributor"||this.get("admins_count")>1)},a.prototype.canBeDeletedByCurrentUser=function(){return this.get("current_user_role")==="admin"&&!this.isPrimaryFor(Dashboard.currentUser)},a.prototype.canBeMadePrimary=function(){return!this.isPrimaryFor(Dashboard.currentUser)&&this.get("current_user_role")==="admin"},a.prototype.addMembers=function(a,b){return $.post("/sites/"+this.id+"/add_members",{_method:"put",emails:a,role:"contributor",authenticity_token:_token},b)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.SitePrivacy=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="site",a.prototype.formConfig={is_private:{type:"Dashboard.Views.RadioButtonView",opts:{choices:[{name:"is_private",label:"Everyone (Public)",value:"0",description:"Your Space is public and can be viewed by anyone."},{name:"is_private",label:"Only the people you choose (Private—by invitation only)",value:"1",description:"Only those you add to the <a id='link_to_members' href='#'>members & followers</a> list can view."},{name:"is_private",label:"People who know the password (Private—password protected)",value:"1",description:"A Space password is required to view. <a href='https://posterous.uservoice.com/knowledgebase/articles/46461' class='small_link'>&raquo; Learn more</a>"}]}},password:{type:"Dashboard.Views.PasswordFieldView",opts:{label:"password",description:"Choose a password for the Space"}},post_permission:{type:"Dashboard.Views.RadioButtonView",opts:{choices:[{name:"post_permission",label:"Only the people you choose (Members Only)",value:"1",description:"Only those in your <a id='link_to_members' href='#'>members list</a> can post to your Space. This is useful for family photo albums, group blogs, or private group communication."},{name:"post_permission",label:"Anyone can submit Guest Posts for your approval",value:"2",description:"Guest posts submitted by non-members won't appear in your Space until you approve them. This is useful if you'd like to solicit content from a large group of people. <a href='https://posterous.uservoice.com/knowledgebase/articles/46462' class='small_link'>&raquo; Learn more</a>"}]}},comment_permission:{type:"Dashboard.Views.RadioButtonView",opts:{choices:[{name:"comment_permission",label:"Everyone",value:"1",description:"Anyone can comment"},{name:"comment_permission",label:"Logged-in users only",value:"2",description:"Only logged-in Spaces, Facebook, and Twitter users can comment."},{name:"comment_permission",label:"Nobody",value:"0",description:"Commenting is disabled."}]}},moderate_comments:{type:"Dashboard.Views.CheckBoxView",opts:{label:"All comments need to be approved by you",description:"",values:{on:"1",off:"0"}}},download_permission:{type:"Dashboard.Views.CheckBoxView",opts:{label:"Show download links for media",description:"Allow downloading of any photos, videos, audio files, or documents posted in the Space.",values:{on:"0",off:"1"}}},dont_show_locations:{type:"Dashboard.Views.CheckBoxView",opts:{label:"Show location of geotagged photos",description:"If your camera includes location information in photos, the location will be displayed on a map.",values:{on:"0",off:"1"}}}},a.prototype.url=function(){return Posterous.BASE_URL+"/sites/"+this.id},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.SiteProfile=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="site_profile",a.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Site Profile must belong to a valid site");return this.site.url()+"/profile"},a.prototype.create=function(a,b){return this.save(a,b)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.Theme=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="theme",a.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Theme must belong to a valid site");return this.site.url()+"/theme"},a.prototype.update=function(a,b){return $.post(""+this.url(),{_method:"put",theme_id:a,authenticity_token:window._token},b)},a.prototype.save=function(){throw new Error("Theme is a read-only resource and cannot be saved")},a.prototype.destroy=function(){throw new Error("Theme is a read-only resource and cannot be destroyed")},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.UpdatePassword=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="user",a.prototype.formConfig={old_password:{type:"Dashboard.Views.PasswordFieldView",opts:{label:"Old Password"}},new_password:{type:"Dashboard.Views.PasswordFieldView",opts:{label:"New Password"}}},a.prototype.url=function(){return Posterous.BASE_URL+("/users/"+this.id+"/update_password")},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Models.User=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.Model),a.prototype.namespaceKey="user",a.prototype.formConfig={firstname:{type:"Dashboard.Views.TextFieldView",opts:{label:"First Name"}},lastname:{type:"Dashboard.Views.TextFieldView",opts:{label:"Last Name"}},nickname:{type:"Dashboard.Views.TextFieldView",opts:{}},body:{type:"Dashboard.Views.TextAreaView",opts:{description:"Appears on your profile page.",label:"Profile text"}},profile_pic:{type:"Dashboard.Views.FileFieldView",opts:{label:"Profile Image"}}},a.prototype.states=["welcome","profile","findFriends","post","customize","autopost","downloadApp","addPeople","addGallery","addVideo","explore","createSpace","confirmEmail"],a.prototype.eventsForNewUser=[{name:"next",from:["autopost","downloadApp","addPeople","addVideo","createSpace","addGallery","welcome","profile","post","customize","findFriends"],to:"completed"}],a.prototype.url=function(){return Posterous.BASE_URL+("/users/"+this.id)},a.prototype.initialize=function(){return this.hasMany("notifications",Posterous.Collections.Notifications),this.hasMany("reader_posts",Posterous.Collections.ReaderPosts),this.hasMany("unmoderated_posts",Posterous.Collections.UnmoderatedPosts),this.hasMany("unmoderated_comments",Posterous.Collections.UnmoderatedComments),this.hasMany("sites",Posterous.Collections.Sites),this.hasMany("user_sites",Posterous.Collections.UserSites),this.hasMany("emails",Posterous.Collections.Emails),this.hasMany("subscriptions",Posterous.Collections.Subscriptions),this.hasMany("imports",Posterous.Collections.Imports),this.hasOne("mail_setting",Posterous.Models.MailSetting),this.hasMany("activities",Posterous.Collections.Activities)},a.prototype.initializeStateMachine=function(){return this.stateMachine=StateMachine.create({initial:this.get("onboarding_status_state"),events:this.eventsForNewUser}),this.showManageTooltip(),this.stateMachine.onskip=this.stateMachine.onnext=this.stateMachine.onskipall=this.updateOnboardingState,this.progressStateMachineAndSaveUnlessCompleted()},a.prototype.progressStateMachineAndSaveUnlessCompleted=function(){if(this.stateMachine.current!=="completed")return this.stateMachine.next(),this.save({onboarding_status_attributes:{state:this.stateMachine.current}})},a.prototype.showManageTooltip=function(){var a=this;if(this.stateMachine.current!=="autopost"&&this.stateMachine.current!=="createSpace"&&this.get("onboarding_status_origin")==="existing"&&$.cookie("manageTipShown")!=="true"&&$.cookie("manageTipShown")!==!0)return $.cookie("manageTipShown","true",{expires:365}),this.tooltip=new Posterous.TooltipView({target:$("li.spaces"),title:"Looking for Manage?",body:"Manage has been moved to the Spaces tab. You can manage your Spaces and posts from here.",links:[{text:"Take me there",href:"#spaces",htmlClass:"go_to_manage",callback:function(){return Posterous.TooltipView.prototype.closeAll()}}]})},a.prototype.primarySite=function(){var a,b=this;return _sites?(a=_(_sites).find(function(a){return a.id===b.get("site_id")}),new Posterous.Models.Site(a)):null},a.prototype.isNewOnPage=function(a){var b;return b=this.get("onboarding_status_origin")==="new"&&$.cookie("billboard_"+a)!=="shown",$.cookie("billboard_"+a,"shown",{expires:3650}),b},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Activities=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Activity,a.prototype.url=function(){if(typeof this.site!="undefined")return this.site.url()+"/activities?snippets=true";if(typeof this.user!="undefined")return this.user.url()+"/activities?snippets=true"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Authors=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.User,a.prototype.url=function(){return this.site.url()+"/authors"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Comments=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.Comment,a.prototype.url=function(){return Posterous.BASE_URL+"/comments"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Drafts=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Post,a.prototype.perPage=20,a.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Posts collection must belong to a valid site");return this.site.url()+"/posts/drafts"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Emails=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Email,a.prototype.url=function(){return Posterous.BASE_URL+"/users/me/emails"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.ExplorePosts=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Post,a.prototype.perPage=20,a.prototype.url=function(){return Posterous.BASE_URL+"/explore"},a}()}.call(this),Posterous.Collections.Exports=function(){function a(){}return a.prototype.fetch=function(a){var b=this;return this.hash={},$.getJSON("/api/2/users/me/exports",function(c){var d,e,f;for(e=0,f=c.length;e<f;e++)d=c[e],b.hash[d.site_id]=d;return a()})},a.prototype.toHash=function(){return{164:{state:"done",updateAt:"May 23rd 2012, 8:15 PM",downloadLink:"http://download.link/123456",fileSize:"1.53 GB"},106:{state:"done",updateAt:"May 23rd 2012, 8:15 PM",downloadLink:"http://download.link/123456",fileSize:"1.53 GB"},80:{state:"processing",updateAt:"May 23rd 2012, 8:15 PM",downloadLink:"http://download.link/123456",fileSize:"1.53 GB"},32:{state:"processing",updateAt:"May 23rd 2012, 8:15 PM",downloadLink:"http://download.link/123456",fileSize:"1.53 GB"}}},a}(),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.ExternalSites=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.ExternalSite,a.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("External Sites collection must belong to a valid site");return this.site.url()+"/external_sites"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Followers=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.User,a.prototype.url=function(){return this.site.url()+"/subscribers"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.FriendSources=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.FriendSource,a.prototype.url=function(){return Posterous.BASE_URL+"/users/me/friends/sources"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Friends=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.Site,a.prototype.url=function(){return Posterous.BASE_URL+"/users/me/friends"},a.prototype.followAll=function(a){var b,c,d;return d=""+Posterous.BASE_URL+"/users/me/subscriptions",b=0,c={site_ids:[]},this.each(function(a){return c.site_ids[b]=a.get("id"),b++}),$.ajax({url:d,type:"post",data:$.extend(c,{authenticity_token:_token}),complete:a,beforeSend:function(a){return a.setRequestHeader("X-Xhrsource","posterous")}})},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Imports=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Site,a.prototype.url=function(){return Posterous.BASE_URL+"/sites/imports?completed=true"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Likes=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.Like,a.prototype.url=function(){if(!this.post||!this.post.id)throw new Error("Likes collection must belong to a valid post");return this.post.url()+"/likes"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.LinkCategories=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.LinkCategory,a.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Link Categories collection must belong to a valid site");return this.site.url()+"/link_categories"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Links=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.Link,a.prototype.url=function(){if(!this.category||!this.category.id)throw new Error("Links collection must belong to a valid category");return this.category.url()+"/links"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Notifications=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Notification,a.prototype.url=function(){return Posterous.BASE_URL+"/users/me/activities/stream?snippets=true"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Pages=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.Page,a.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Pages collection must belong to a valid site");return this.site.url()+"/pages"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.PopularPosts=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.PopularPost,a.prototype.perPage=20,a.prototype.url=function(){return Posterous.BASE_URL+"/popular_posts"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Posts=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Post,a.prototype.perPage=20,a.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Posts collection must belong to a valid site");return this.site.url()+"/posts"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.ReaderPosts=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Post,a.prototype.perPage=20,a.prototype.url=function(){if(!this.user||!this.user.id)throw new Error("ReaderPosts collection must belong to a valid user");return Posterous.BASE_URL+("/users/"+this.user.id+"/subscriptions/posts")},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.SiteActivities=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Activity,a.prototype.url=function(){return Posterous.BASE_URL+"/sites//activity?snippets=true"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Sites=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Site,a.prototype.perPage=20,a.prototype.url=function(){return Posterous.BASE_URL+"/sites"},a.prototype.findByHostname=function(a){var b;return b=Dashboard.defaultSites.pluck("hostname").indexOf(a),b!==-1?Dashboard.defaultSites.at(b):null},a.prototype.suggestHostname=function(a,b){return $.get(""+this.url()+"/suggest_hostname?name="+a,b)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Subscriptions=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Site,a.prototype.url=function(){return this.user.url()+"/subscriptions"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.Themes=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.Theme,a.prototype.initialize=function(a){if(a)return this.type=a.type},a.prototype.url=function(){return this.type?Posterous.BASE_URL+("/themes/types/"+this.type):Posterous.BASE_URL+"/themes"},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.UnmoderatedComments=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.Collection),a.prototype.model=Posterous.Models.Comment,a.prototype.url=function(){if(!this.user||!this.user.id)throw new Error("UnmoderatedComments collection must belong to a valid user");return Posterous.BASE_URL+("/users/"+this.user.id+"/comments/unmoderated")},a.prototype.approveAll=function(a){var b;return b=Posterous.BASE_URL+("/users/"+this.user.id+"/comments/approve_all_unmoderated"),$.ajax({url:b,type:"post",data:{_method:"put",authenticity_token:window._token},success:a,beforeSend:function(a){return a.setRequestHeader("X-Xhrsource","posterous")}})},a.prototype.deleteAll=function(a){var b;return b=Posterous.BASE_URL+("/users/"+this.user.id+"/comments/destroy_all_unmoderated"),$.ajax({url:b,type:"post",data:{_method:"delete",authenticity_token:window._token},success:a,beforeSend:function(a){return a.setRequestHeader("X-Xhrsource","posterous")}})},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.UnmoderatedPosts=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Post,a.prototype.url=function(){if(!this.user||!this.user.id)throw new Error("UnmoderatedPosts collection must belong to a valid user");return Posterous.BASE_URL+("/users/"+this.user.id+"/posts/unmoderated")},a.prototype.approveAll=function(a){var b;return b=Posterous.BASE_URL+("/users/"+this.user.id+"/posts/approve_all_unmoderated"),$.ajax({url:b,type:"post",data:{_method:"put",authenticity_token:window._token},success:a,beforeSend:function(a){return a.setRequestHeader("X-Xhrsource","posterous")}})},a.prototype.deleteAll=function(a){var b;return b=Posterous.BASE_URL+("/users/"+this.user.id+"/posts/destroy_all_unmoderated"),$.ajax({url:b,type:"delete",data:{_method:"put",authenticity_token:window._token},success:a,beforeSend:function(a){return a.setRequestHeader("X-Xhrsource","posterous")}})},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Collections.UserSites=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Posterous.PaginatedCollection),a.prototype.model=Posterous.Models.Site,a.prototype.url=function(){return this.user.url()+"/sites/public"},a}()}.call(this),_.isFunction(window.innerShiv)||(window.innerShiv=function(a,b){return b==null&&(b=!0),a}),jQuery(window).bind("app:deferredContentComplete",function(){var a;return Posterous.fetchAndAssignCurrentUser(deferredContent.current_user.evalJSON()),a=new Posterous.Views.PosterousBarView({model:new Posterous.Models.Site(deferredContent.site.evalJSON())}),jQuery("#pbar").html(a.el)}),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Views.PosterousBarLoginFormView=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.View),a.prototype.template=JST.posterous_bar_login_form,a.prototype.tagName="div",a.prototype.className="pbar_login_form_view",a.prototype.events={"click .sign_up":"switchPaneToSignUp","click .log_in":"switchPaneToLogin","click .log_in_form button":"logInSubmit","click .sign_up_form button":"signUpSubmit"},a.prototype.initialize=function(){return this.render()},a.prototype.render=function(){return $j(this.el).html(this.template({site:this.model})),this.initializeAutoFadeInputs(),this.switchPane("sign_up")},a.prototype.logInSubmit=function(a){return a.preventDefault(),this.$(".log_in_form").submit(),!1},a.prototype.signUpSubmit=function(a){return a.preventDefault(),this.$(".sign_up_form").submit(),!1},a.prototype.initializeAutoFadeInputs=function(){return this.$(".auto_fade_input input").each(function(){return new AutoFadeInput(this)})},a.prototype.switchPane=function(a){return a==null&&(a="login"),this.$("form").hide(),this.$("menu li").removeClass("active"),a==="login"?(this.$(".log_in_form").show(),this.$(".sign_up_form").hide(),this.$(".sign_up").removeClass("active"),this.$(".log_in").addClass("active"),this.$("#pbar_login_email").first().focus()):(this.$(".log_in_form").hide(),this.$(".sign_up_form").show(),this.$(".sign_up").addClass("active"),this.$(".log_in").removeClass("active"),this.$("#pbar_user_toast").first().focus())},a.prototype.switchPaneToLogin=function(a){return a.preventDefault(),this.switchPane("login"),!1},a.prototype.switchPaneToSignUp=function(a){return a.preventDefault(),this.switchPane("sign_up"),!1},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Views.PosterousBarMenuView=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.View),a.prototype.template=JST.posterous_bar_menu,a.prototype.tagName="div",a.prototype.className="pbar_menu_view",a.prototype.initialize=function(){return this.render()},a.prototype.render=function(){return $j(this.el).html(innerShiv(this.template({site:this.model})))},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Views.PosterousBarNotificationView=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.View),a.prototype.template=JST.posterous_bar_notification,a.prototype.tagName="div",a.prototype.className="pbar_notification_view",a.prototype.initialize=function(){return this.render()},a.prototype.render=function(){return $j(this.el).html(this.template({message:this.options.message,links:this.options.links}))},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Views.PosterousBarView=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.View),a.prototype.template=JST.posterous_bar,a.prototype.tagName="div",a.prototype.className="pbar",a.prototype.events={"click .pbar_close":"close","click .pbar_login_form":"follow","click .pbar_unfollow":"unfollow","click .unfollow_for_real":"unfollowForReal","click .cancel_unfollow":"close","click .pbar_menu":"openMenu","click .pbar_join":"clickedJoin"},a.prototype.initialize=function(){return _.bindAll(this,"close","subscribeSuccess","subscribeError","unsubscribeSuccess","unsubscribeError"),this.site=this.model,this.render()},
a.prototype.close=function(a){var b=this;return a==null&&(a=null),a!=null&&a.preventDefault(),this.closeAllPanes(!1,function(){return b.currentPane=null,b.$(".pbar_main").hide()}),!1},a.prototype.clickedJoin=function(a){return a.preventDefault(),window.location.href=this.$(".pbar_join").attr("href"),!1},a.prototype.hoverAway=function(a){return a.preventDefault(),this.currentPane==="menu"&&(this.menuTimeout=setTimeout(this.close,500)),!1},a.prototype.render=function(){return this.currentPane=null,this.subViews={login_form:new Posterous.Views.PosterousBarLoginFormView({model:this.site}),menu:new Posterous.Views.PosterousBarMenuView({model:this.site})},$j(this.el).html(innerShiv(this.template({site:this.site}))),this.$(".pbar_forgot").hide(),this.appendSubViews(),this.close()},a.prototype.appendSubViews=function(){var a=this;return _(_(this.subViews).values()).each(function(b){return a.$(".pbar_body").append($j(b.el).hide())})},a.prototype.unfollow=function(a){return a.preventDefault(),this.closeAllPanes(),this.site.isSubscriber()&&this.site.get("is_private")===!1?this.unfollowForReal(a):this.displayWarning("You are a member of the Space. If unfollow, you will leave the Space permanently. Would you like to proceed?",[{text:"Cancel",htmlClass:"cancel_unfollow",href:"#"},{text:"Unfollow",htmlClass:"unfollow_for_real",href:"#"}]),!1},a.prototype.displayWarning=function(a,b){return this.$(".pbar_warning_view").remove(),this.$(".pbar_body").append($j((new Posterous.Views.PosterousBarWarningView({message:a,buttons:b})).el).hide()),this.activatePane("warning")},a.prototype.unfollowForReal=function(a){return a.preventDefault(),this.closeAllPanes(),this.$(".pbar_unfollow").html("Unfollowing..."),this.site.unsubscribeViaJsonp(this.unsubscribeSuccess,this.unsubscribeError),!1},a.prototype.follow=function(a){var b=this;return a.preventDefault(),this.closeAllPanes(),Posterous.currentUser?(this.$(".pbar_login_form").html("Following..."),this.site.subscribeViaJsonp(this.subscribeSuccess,this.subscribeError)):this.activatePane("login_form",!0,function(){return b.$(".pbar_forgot").show(),b.$(".pbar_login").hide()}),!1},a.prototype.subscribeSuccess=function(){return this.site.set({current_user_role:"subscriber"}),this.render(),this.displayNotification("<strong>"+this.site.get("name")+"</strong> has been added to your Reader",[{text:"Open Reader",htmlClass:"pbar_open_reader",href:"http://"+POSTEROUS_HOSTNAME+"/"}])},a.prototype.unsubscribeSuccess=function(){if(this.site.get("is_private")===!0){window.location.href="http://"+POSTEROUS_HOSTNAME;return}return this.site.set({current_user_role:null}),this.render(),this.displayNotification("You are no longer following <strong>"+this.site.get("name")+"</strong>")},a.prototype.displayNotification=function(a,b){return this.$(".pbar_notification_view").remove(),this.$(".pbar_body").append($j((new Posterous.Views.PosterousBarNotificationView({message:a,links:b})).el).hide()),this.activatePane("notification")},a.prototype.subscribeError=function(){return this(".pbar_login_form").html("Follow"),this.displayErrorMessage()},a.prototype.unsubscribeError=function(){return this(".pbar_login_form").html("Unfollow"),this.displayErrorMessage()},a.prototype.displayErrorMessage=function(){return this.displayNotification("<strong>Oops!</strong><br />We are experiencing technical difficulties. Please try again later")},a.prototype.keepMenuOpen=function(a){return a.preventDefault(),clearTimeout(this.menuTimeout),!1},a.prototype.openMenu=function(a){return a.preventDefault(),clearTimeout(this.menuTimeout),this.currentPane==="menu"?this.closeAllPanes():a.type==="click"&&this.activatePane("menu"),!1},a.prototype.activatePane=function(a,b,c){var d=this;return b==null&&(b=!0),this.$(".pbar_main").show(),this.closeAllPanes(b,function(){return d.currentPane=a,d.openPane(a,b),typeof c=="function"?c():void 0})},a.prototype.openPane=function(a,b){return this.$("a.pbar_"+a).addClass("active"),(a==="warning"||a==="notification")&&this.$("a.pbar_unfollow, a.pbar_login_form").addClass("active"),this.$(".pbar_"+a+"_view").show(),$j(this.el).addClass("active")},a.prototype.closeAllPanes=function(a,b){return this.currentPane=null,$j(this.el).removeClass("active"),this.$("header li a").removeClass("active"),this.$(".pbar_body > div").hide(),this.$(".pbar_forgot").hide(),this.$(".pbar_login").show(),typeof b=="function"?b():void 0},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Posterous.Views.PosterousBarWarningView=function(){function a(){a.__super__.constructor.apply(this,arguments)}return b(a,Backbone.View),a.prototype.template=JST.posterous_bar_warning,a.prototype.tagName="div",a.prototype.className="pbar_warning_view",a.prototype.initialize=function(){return this.render()},a.prototype.render=function(){return $j(this.el).html(innerShiv(this.template({message:this.options.message,buttons:this.options.buttons})))},a}()}.call(this);