<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">

<title>
John Lam on Software&nbsp;|&nbsp;Archive&nbsp;|&nbsp;February</title>
    
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="http://iunknown.com/wp-content/themes/headlines/style.css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://feeds.feedburner.com/LessIsBetter" />
<link rel="pingback" href="http://iunknown.com/xmlrpc.php" />
   
<!--[if IE 6]>
<script type="text/javascript" src="http://iunknown.com/wp-content/themes/headlines/includes/js/pngfix.js"></script>
<script type="text/javascript" src="http://iunknown.com/wp-content/themes/headlines/includes/js/menu.js"></script>
<link rel="stylesheet" type="text/css" media="all" href="http://iunknown.com/wp-content/themes/headlines/css/ie6.css" />
<![endif]-->	

<!--[if IE 7]>
<link rel="stylesheet" type="text/css" media="all" href="http://iunknown.com/wp-content/themes/headlines/css/ie7.css" />
<![endif]-->
   
<script type='text/javascript' src='http://iunknown.com/wp-includes/js/jquery/jquery.js?ver=1.4.2'></script>
<script type='text/javascript' src='http://iunknown.com/wp-content/themes/headlines/includes/js/superfish.js?ver=3.0.1'></script>
<script type='text/javascript' src='http://iunknown.com/wp-content/themes/headlines/includes/js/woo_tabs.js?ver=3.0.1'></script>
<script type='text/javascript' src='http://iunknown.com/wp-content/themes/headlines/includes/js/cufon-yui.js?ver=3.0.1'></script>
<script type='text/javascript' src='http://iunknown.com/wp-content/themes/headlines/includes/js/Liberation.font.js?ver=3.0.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://iunknown.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://iunknown.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='John Lam on Software' href='http://iunknown.com' />
<meta name="generator" content="WordPress 3.0.1" />
<meta name="generator" content="Headlines 2.4.1" />
<meta name="generator" content="Woo Framework Version 2.5.3" />
<script type="text/javascript">Cufon.replace("h2, h3, h4, h5, h6, .title, .cufon");</script>
<style type="text/css">.widget h3 { line-height:22px; }</style>
<link href="http://iunknown.com/wp-content/themes/headlines/styles/color.css" rel="stylesheet" type="text/css" />
<link href="http://iunknown.com/wp-content/themes/headlines/custom.css" rel="stylesheet" type="text/css" />
<!-- Woo Styling -->
<style type="text/css">
#logo img { display:none; }
#logo .site-title, #logo .site-description { display:block; } 
</style>

<!--[if lte IE 7]>
<script type="text/javascript">
jQuery(function() {
	var zIndexNumber = 1000;
	jQuery('div').each(function() {
		jQuery(this).css('zIndex', zIndexNumber);
		zIndexNumber -= 1;
	});
});
</script>
<![endif]-->


</head>


<body>

<div id="container">
       
	<div id="top">
    
		
        <div id="header" class="col-full">
       
            <div id="logo">
               
                                
                                    <h1 class="site-title"><a href="http://iunknown.com">John Lam on Software</a></h1>
                                
                    <span class="site-description">Working for The Man in Redmond</span>
                
            </div><!-- /#logo -->
               
			            <div id="twitter-top">
            	<div class="logo">
                    <a href="http://www.twitter.com/john_lam" title="Follow on Twitter"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-twitter.png" alt="Twitter" /></a>                
                </div>
                <div class="tweet">
	                <ul id="twitter_update_list"><li></li></ul>
                </div>
            </div><!-- /#topad -->
			                       
        </div><!-- /#header -->
        
        <div id="navigation">
        
			<div id="page-nav">
    <div class="col-full">
        <ul id="nav" class="fl">
        
            <li><a href="http://iunknown.com"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-home.png" class="ico-home" alt="Home" /></a></li>
			        
            <li class="page_item page-item-2"><a href="http://iunknown.com/about" title="About">About</a></li>
            
			            
            
        </ul><!-- /#nav1 -->
        
        <ul class="rss fr">
                        <li><a href="http://feeds.feedburner.com/LessIsBetter">Posts</a></li>
        </ul><!-- /.rss -->
    </div><!-- /.col-full -->
</div><!-- /#page-nav -->
                        
            <div id="cat-nav">
                <div class="col-full">
                    <ul id="secnav" class="fl">
                    
					                    
						      
                        <li>
                            <a href="http://iunknown.com/category/ironruby">IronRuby</a>
                            
                                                    </li>        
                              
                        <li>
                            <a href="http://iunknown.com/category/microsoft">Microsoft</a>
                            
                                                    </li>        
                              
                        <li>
                            <a href="http://iunknown.com/category/misc_geek">Misc Geek</a>
                            
                                                    </li>        
                              
                        <li>
                            <a href="http://iunknown.com/category/personal">Personal</a>
                            
                                                    </li>        
                              
                        <li>
                            <a href="http://iunknown.com/category/rubyclr">RubyCLR</a>
                            
                                                    </li>        
                              
                        <li>
                            <a href="http://iunknown.com/category/uncategorized">Uncategorized</a>
                            
                                                    </li>        
                                                
					                        
                    </ul><!-- /#nav2 -->
                    
                                        <div id="search" class="fr">
                        <form method="get" id="searchform" action="http://iunknown.com">
                            <input type="text" class="field" name="s" id="s"  value="Enter keywords..." onfocus="if (this.value == 'Enter keywords...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Enter keywords...';}" />
                            <input class="submit btn" type="image" src="http://iunknown.com/wp-content/themes/headlines/images/ico-search.png" value="Go" />
                        </form>
                    </div><!-- /#search -->
                                    </div><!-- /.col-full -->
            </div><!-- /#cat-nav -->
            
        </div><!-- /#navigation -->
    
    </div><!--/#top-->       
    <div id="content" class="col-full">
		<div id="main" class="col-left">
            
		        
                        <span class="archive_header">Archive | February, 2006</span>

                        
            <div class="fix"></div>
        
                                                                            
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/generics-stabilizing.html" rel="bookmark" title="Generics stabilizing">Generics stabilizing</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />28. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/generics-stabilizing.html#comments" title="Comment on Generics stabilizing">2 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p>RubyCLR now supports multi-type generic types such as <code>Dictionary&lt;T, U&gt;</code>. I also changed the nasty <code>cons</code> method to the infinitely cleaner <code>of</code> method. Here&#8217;s some tests to show the progress:</p>
<pre><code>
def test_create_two_parameter_generic_type
dict = Dictionary.of(Int32, Int32).new
dict.add(1, 1)
dict.add(2, 2)
assert_equal 1, dict[1]
assert_equal 2, dict[2]
end
def test_dictionary_with_string_key
dict = Dictionary.of(System::String, Int32).new
dict['John'] = 42
dict['Ruby'] = 2
assert_equal 42, dict['John']
assert_equal 2, dict['Ruby']
end
</code></pre>
<p>The one thing that I&#8217;m not happy with right now is being forced to fully qualify the <code>System::String</code> type. I might add some code to special-case that type name in the <code>of</code> method and alias to the <span class="caps">CLR</span> <code>String</code> type from the Ruby <code>String</code> type.</p>
<p>You might be wondering how I implement the generic types. I generate a Ruby shadow class that has a mangled name. For example, <code>Dictionary.of(Int32,Int32)</code>, maps to a Ruby class called <code>Dictionary_generic_Int32_Int32</code>, which is generated the first time <code>of</code> is called. On all subsequent calls, I just look up the Ruby shadow class name. This is also how I handle arrays (you can really think of arrays as a special case of generics).</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/generics-in-rubyclr.html" rel="bookmark" title="Generics in RubyCLR">Generics in RubyCLR</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />28. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/generics-in-rubyclr.html#comments" title="Comment on Generics in RubyCLR">4 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p>I got a crude implementation of generics up and running in RubyCLR today. It does what these tests say it does, and nothing more <img src='http://iunknown.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
<pre><code>
class GenericsTests &lt; TestCase
include System::Collections::Generic
def test_make_generic_type
c = List.cons(Int32)
assert_equal 'System::Collections::Generic::List_generic_Int32', c.name
assert_equal 'System.Collections.Generic.List`1[[System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]]', c.clr_type.full_name
end
def test_create_generic_type
list = List.cons(Int32).new
assert_equal 'List`1', list.clr_type.name
end
def test_call_generic_type
list = List.cons(Int32).new
list.add(42)
assert_equal 42, list[0]
end
def test_type_conversion_error
assert_raises TypeError do
list = List.cons(Int32).new
list.add('42')
end
end
end
</code></pre>
<p>As for feedback, I&#8217;m not all that happy with the name <code>cons</code> for the method that creates a generic type. Suggestions would be welcome (but they have to be easy to type, since I&#8217;m competing with <code>List&lt;Int32&gt;</code> <img src='http://iunknown.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
<p>I also ran some crude performance benchmarks for adding 1M integers to each data structure:</p>
<ul>
<li><code>ArrayList</code>   = 1.15s</li>
<li><code>List&lt;Int32&gt;</code> = 1.00s</li>
<li>Ruby <code>Array</code>  = 0.66s</li>
</ul>
<p>I just wanted to get some order of magnitude estimates of performance. So far I&#8217;m quite happy with the performance of the bridge. 1M method calls / second is nothing to sneeze at.</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/ides-and-complexity.html" rel="bookmark" title="IDEs and complexity">IDEs and complexity</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />28. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/ides-and-complexity.html#respond" title="Comment on IDEs and complexity">0 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p><a href="http://patricklogan.blogspot.com/2006/02/this-is-enterprise-stuff-look-out.html">Worth repeating</a>:</p>
<blockquote>
<p>Intellisense and code generation is an isolated developer trick for hiding real complexity and risk.</p>
</blockquote>
<p>Patrick Logan does a great job of capturing why I don&#8217;t like the complexity of today&#8217;s IDEs.</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/rubyclr-and-auto_dispose.html" rel="bookmark" title="RubyCLR and auto_dispose">RubyCLR and auto_dispose</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />27. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/rubyclr-and-auto_dispose.html#comments" title="Comment on RubyCLR and auto_dispose">4 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p>In the <a href="http://www.iunknown.com/articles/2006/02/20/second-drop-of-rubyclr">second drop of RubyCLR</a>, I had a broken implementation of <code>auto_dispose</code>, which automatically calls an object&#8217;s <a href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfSystemIDisposableClassDisposeTopic.asp">Dispose</a> method for you. Fortunately, Gunter Szolderits noticed this problem, and sent me a really lovely implementation that allows for parallel assignment. That means that instead of writing this:</p>
<pre><code>
auto_dispose(D.new) do |dc|
auto_dispose(AD.new) do |adc|
adc.good_method
end
dc.good_method
end
</code></pre>
<p>you can now write this:</p>
<pre><code>
auto_dispose(D.new, AD.new) do |dc, adc|
adc.good_method
dc.good_method
end
</code></pre>
<p>Using the new <a href="http://www.iunknown.com/articles/2006/02/27/interfaces-and-rubyclr">interfaces</a> implementation, the implementation of <code>auto_dispose</code> now looks like this:</p>
<pre><code>
def auto_dispose(*objs)
yield(*objs) if block_given?
ensure
objs.each do |obj|
if obj != nil
disposable = obj.as IDisposable
disposable.dispose if disposable != nil
end
end
end
</code></pre>
<p>Now, is that pretty or what? And I mean both the usage and the implementation!</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/interfaces-and-rubyclr.html" rel="bookmark" title="Interfaces and RubyCLR">Interfaces and RubyCLR</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />27. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/interfaces-and-rubyclr.html#comments" title="Comment on Interfaces and RubyCLR">3 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p><a href="http://www.iunknown.com/articles/2006/02/23/rubyclr-interfaces">My earlier implementation of interfaces</a> for RubyCLR was incomplete. I didn&#8217;t have code to let you test whether an object implemented the interface requested. There are a couple of approaches that you can use to solve this problem: via reflection at runtime and via a shim method that &#8220;knows&#8221; about all of the interfaces that an object implements.</p>
<p>I chose the second option: implementing two new methods <code>is</code> and <code>as</code>. The goal is to eventually provide the same semantics as the C# <a href="http://msdn.microsoft.com/library/en-us/csref/html/vclrfispg.asp">is</a> and <a href="http://msdn.microsoft.com/library/en-us/csref/html/vclrfas.asp">as</a> operators. You can use the <code>is</code> method to test whether an object implements an interface, and you can use the <code>as </code> operator to return a reference to that interface.</p>
<p>I use Reflection to enumerate all of the interfaces of a class and bake in all of those interface references by recording the <a href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemruntimetypehandleclasstopic.asp">RuntimeTypeHandle</a> for each one of the interfaces. This approach gives me superior performance  since I avoid using Reflection on all but the first call to the <code>is</code> or <code>as</code> methods of a type.</p>
<p>The ultimate goal is that <code>is</code> and <code>as</code> will match the semantics of <code>is</code> and <code>as</code> in C#. Currently I&#8217;m missing support for the boxing and unboxing scenarios as well as the super-type scenario.</p>
<p>Here&#8217;s the unit test for the <code>is</code> method:</p>
<pre><code>
def test_is
m = System::Data::DataSet.new
assert m.is?(System::Data::DataSet)
assert m.is?(IComponent)
assert m.is?(IDisposable)
assert m.is?(IServiceProvider)
assert m.is?(IListSource)
assert m.is?(System::Xml::Serialization::IXmlSerializable)
assert m.is?(ISupportInitializeNotification)
assert m.is?(ISupportInitialize)
assert m.is?(System::Runtime::Serialization::ISerializable)
assert !m.is?(System::Data::IColumnMapping)
end
</code></pre>
<p>and a simpler test for the <code>as</code> method:</p>
<pre><code>
def test_as
a = ArrayList.new
a.add(1)
e = a.as(IEnumerable).get_enumerator.as(IEnumerator)
assert e.move_next
assert 1, e.current
assert !e.move_next
assert_equal nil, a.as(IComponent)
end
</code></pre>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/native-ruby-array-data-binding.html" rel="bookmark" title="Native Ruby array data binding">Native Ruby array data binding</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />23. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/native-ruby-array-data-binding.html#comments" title="Comment on Native Ruby array data binding">3 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p>I spent some time today hacking out an experimental implementation of native Ruby array data binding. It works by using a <span class="caps">CLR</span> helper class called <code>DataBinder</code> that implements <code>IList</code>, and calls back to Ruby using delegates to retrieve the data. This gives the following usage model:</p>
<pre><code>
names = ['John', 'Paul', 'George', Ringo']
list_box.data_source = names.make_bindable
</code></pre>
<p>To make this work, I inject a <code>make_bindable</code> method into the <code>Array</code> class:</p>
<pre><code>
def make_bindable
binder = DataBinder.new
binder.get_data do |sender, args|
args.current_object = self[args.index]
end
binder.get_count do |sender, args|
args.count = self.length
end
binder
end
</code></pre>
<p>Thoughts? Does this feel good?</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/rubyclr-is-all-about-choice.html" rel="bookmark" title="RubyCLR is all about choice">RubyCLR is all about choice</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />23. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/rubyclr-is-all-about-choice.html#comments" title="Comment on RubyCLR is all about choice">5 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p>Look at what I got working this morning:</p>
<pre><code>
def test_enumerator
a = ArrayList.new
a.Add(1)
a.Add(2)
a.Add(3)
e = a.get_interface(IEnumerable).GetEnumerator.get_interface(IEnumerator)
assert e.MoveNext
assert 1, e.Current
assert e.MoveNext
assert 2, e.Current
assert e.MoveNext
assert 3, e.Current
assert !e.MoveNext
end
</code></pre>
<p>vs.</p>
<pre><code>
def test_enumerator
a = ArrayList.new
a.add(1)
a.add(2)
a.add(3)
e = a.get_interface(IEnumerable).get_enumerator.get_interface(IEnumerator)
assert e.move_next
assert 1, e.current
assert e.move_next
assert 2, e.current
assert e.move_next
assert 3, e.current
assert !e.move_next
end
</code></pre>
<p>By the way, both work in the same app.</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/rubyclr-interfaces.html" rel="bookmark" title="RubyCLR Interfaces">RubyCLR Interfaces</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />23. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/rubyclr-interfaces.html#comments" title="Comment on RubyCLR Interfaces">4 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p>A notable feature that was missing from the <a href="http://www.iunknown.com/articles/2006/02/20/second-drop-of-rubyclr">second drop of RubyCLR</a> was support for interfaces. Also, I was missing support for integrating .NET Reflection with Ruby Reflection.</p>
<p>I spent some time yesterday adding these features to RubyCLR. This is what I wound up with:</p>
<pre><code>
def test_enumerator
a = ArrayList.new
a.Add(1)
a.Add(2)
a.Add(3)
enum = a.get_interface('System.Collections.IEnumerable')
e    = enum.GetEnumerator.get_interface('System.Collections.IEnumerator')
assert e.MoveNext
assert 1, e.Current
assert e.MoveNext
assert 2, e.Current
assert e.MoveNext
assert 3, e.Current
assert !e.MoveNext
end
</code></pre>
<p>As you could imagine, I&#8217;m going to add explicit support for an <code>each</code> method on enumerable objects.</p>
<p>Implementing <code>get_interface</code> turned out to be easier than expected:</p>
<pre><code>
def get_interface(name)
klass = self.class
create_safe_ruby_instance_method(klass, 'get_interface') do
ldstr        name.to_s
ld_this      klass
call         'static Marshal::ToRubyObjectAsInterface(String, Object)'
ret
end
get_interface(name)
end
</code></pre>
<p>The C++ <code>ToRubyObjectAsInterface</code> simply thunks to some existing code in the C++ part of the RubyCLR runtime.</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/google-calc.html" rel="bookmark" title="Google Calc">Google Calc</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />21. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/google-calc.html#comments" title="Comment on Google Calc">1 Comment</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p>Justin just posted an awesome sample that uses RubyCLR to the ruby-talk list:</p>
<p><img src="http://static.flickr.com/27/102769655_160658c51e_o.png" alt="" /></p>
<p>I had no idea that Google&#8217;s calculator could work with fortnights as a unit!</p>
<p>Here&#8217;s a link to the <a href="http://groups.google.com/group/comp.lang.ruby/browse_thread/thread/197f2650a1ca9f25/b7ea0676a15fa46c?lnk=st&#38;q=rubyclr&#38;rnum=1&#38;hl=en#b7ea0676a15fa46c">complete source</a> to his app.</p>
<p>The more people I can get to use it, the sooner we&#8217;ll all have a production-quality release to work with!</p>
<p>Keep those samples coming!</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
                                                                                
            <div class="box">
                    <div class="post">
                        
						 
                        <h2 class="title"><a href="http://iunknown.com/2006/02/second-drop-of-rubyclr.html" rel="bookmark" title="Second Drop of RubyCLR">Second Drop of RubyCLR</a></h2>
                        <p class="post-meta">
							<img src="http://iunknown.com/wp-content/themes/headlines/images/ico-time.png" alt="" />20. Feb, 2006                            <span class="comments"><img src="http://iunknown.com/wp-content/themes/headlines/images/ico-comment.png" alt="" /><a href="http://iunknown.com/2006/02/second-drop-of-rubyclr.html#comments" title="Comment on Second Drop of RubyCLR">18 Comments</a></span>
                        </p>
                        <div class="entry">
                            
                            							<p>It&#8217;s alive and it&#8217;s real:</p>
<p><img src="http://static.flickr.com/43/102353551_a14d82507d_o.png" alt="" /></p>
<p>This second release of my RubyCLR bridge contains a non-trivial Windows Forms 2.0 application written <strong>entirely in Ruby</strong>. If you don&#8217;t want to download the entire drop, you can <a href="http://www.iunknown.com/images/rssreader.rb">click here</a> to look at the source.</p>
<p>If you thought you&#8217;ve seen this application before, you&#8217;re right &#8211; it&#8217;s a partial port of Joe Stegman&#8217;s <a href="http://www.windowsforms.net/Default.aspx?tabindex=4&#38;tabid=49"><span class="caps">RSS</span> Reader application</a> that was designed to show off some of the more interesting features of Windows Forms 2.0.</p>
<p>I&#8217;m pretty sure I could have finished porting the rest of the app, but I think I ported enough of it to demonstrate that you can actually use this drop to build a real app.</p>
<p>There are now 106 tests and 165 assertions in the unit test suite. They all pass.</p>
<p>This build now contains release builds of <code>RbDynamicMethod.dll</code> and <code>RubyClrTests.dll</code>, so it should run on any computer that has Ruby 1.8.2 and .NET Frameworks 2.0 <span class="caps">RTM</span> installed.</p>
<p><a href="http://www.iunknown.com/images/RbDynamicMethod.zip">Get the bits here</a>.</p>
<p>Enjoy.</p>
                                                        
                        </div>
                        <div class="fix"></div>
                    </div><!-- /.post -->
                                                        
                    <div class="post-bottom">
                        <div class="fl"><span class="cat"><a href="http://iunknown.com/category/uncategorized" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span></div>
                        <div class="fr"></div> 
                        <div class="fix"></div>                       
                    </div>
            </div>        
                                                    
              

            <div class="more_entries">
                                <div class="fl"></div>
                <div class="fr"><a href="http://iunknown.com/2006/02/page/2" >Older Entries</a></div>
                <br class="fix" />
                 
            </div>		
                
		</div><!-- /#main -->

        <div id="sidebar" class="col-right">

	<!-- Widgetized Sidebar -->	
	<div id="text-3" class="widget widget_text"><h3>Subscribe!</h3>			<div class="textwidget"><p><a href="http://feeds.feedburner.com/LessIsBetter"><img src="http://feeds.feedburner.com/~fc/LessIsBetter?bg=FF9900&amp;fg=000000&amp;anim=0" height="26" width="88" style="border:0" alt="" /></a></p></div>
		</div>		
    
	<!-- TABS STARTS --> 
		<div id="tabs">
		
		<ul class="wooTabs tabs">
			<li><a href="#pop">Popular</a></li>
			<li><a href="#feat">Latest</a></li>
            <li><a href="#comm">Comments</a></li>
			<li><a href="#tagcloud">Tags</a></li>
		</ul>	
		
		<div class="fix"></div>
		
		<div class="inside">
		 <div id="pop">
			<ul>
					<li>
			                
            <a href="http://iunknown.com/2007/07/a-first-look-at-ironruby.html" title="A first look at IronRuby">A first look at IronRuby</a>
            <span class="meta"></span>
    		<div style="clear:both"></div>

        </li>
		<li>
			                
            <a href="http://iunknown.com/2006/08/funtwo-unmasked.html" title="funtwo unmasked">funtwo unmasked</a>
            <span class="meta"></span>
    		<div style="clear:both"></div>

        </li>
		<li>
			                
            <a href="http://iunknown.com/2006/10/dynamic-languages-microsoft-and-me.html" title="Dynamic Languages, Microsoft, and me">Dynamic Languages, Microsoft, and me</a>
            <span class="meta"></span>
    		<div style="clear:both"></div>

        </li>
		<li>
			                
            <a href="http://iunknown.com/2008/03/dynamic-silverlight-part-1-hello-world.html" title="Dynamic Silverlight Part 1: Hello, World!">Dynamic Silverlight Part 1: Hello, World!</a>
            <span class="meta"></span>
    		<div style="clear:both"></div>

        </li>
		<li>
			                
            <a href="http://iunknown.com/2007/08/ironruby-on-rubyforge.html" title="IronRuby on Rubyforge!">IronRuby on Rubyforge!</a>
            <span class="meta"></span>
    		<div style="clear:both"></div>

        </li>
                    
			</ul>
           </div>
           
         <div id="feat"> 
	        <ul>
			<li>
		<a title="Permalink to  Motorola DROID Review" href="http://iunknown.com/2009/12/motorola-droid-review.html" rel="bookmark">Motorola DROID Review</a>
	<span class="meta">10. Dec, 2009</span>
	<div class="fix"></div>
</li>
<li>
		<a title="Permalink to  Passing the torch" href="http://iunknown.com/2009/11/passing-the-torch.html" rel="bookmark">Passing the torch</a>
	<span class="meta">17. Nov, 2009</span>
	<div class="fix"></div>
</li>
<li>
		<a title="Permalink to  Dynamic Languages at TechEd 2009" href="http://iunknown.com/2009/05/dynamic-languages-at-teched-2009.html" rel="bookmark">Dynamic Languages at TechEd 2009</a>
	<span class="meta">18. May, 2009</span>
	<div class="fix"></div>
</li>
<li>
		<a title="Permalink to  Disable that annoying beep on Thinkpads when resuming from Sleep" href="http://iunknown.com/2009/01/disable-that-annoying-beep-on-thinkpads-when-resuming-from-sleep.html" rel="bookmark">Disable that annoying beep on Thinkpads when resuming from Sleep</a>
	<span class="meta">02. Jan, 2009</span>
	<div class="fix"></div>
</li>
<li>
		<a title="Permalink to  Hello, 2009" href="http://iunknown.com/2009/01/hello-2009.html" rel="bookmark">Hello, 2009</a>
	<span class="meta">01. Jan, 2009</span>
	<div class="fix"></div>
</li>
		
                    
			</ul>
          </div>
          <div id="comm">  
			<ul>
			<li>
    <img alt='' src='http://0.gravatar.com/avatar/4ad7dd07b56137ee7f0c5df0eb6969c0?s=48&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D48&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' />
	<a href="http://iunknown.com/2009/11/passing-the-torch.html#comment-2277" title="on  Passing the torch">
		GM: Looks like the torch was handed off because it was...
    </a>
    <div style="clear:both"></div>
</li>
<li>
    <img alt='' src='http://0.gravatar.com/avatar/80e59186a64b60730e07c6db7bf61637?s=48&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D48&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' />
	<a href="http://iunknown.com/2009/11/passing-the-torch.html#comment-2276" title="on  Passing the torch">
		Louis Salin: What about... now!?

With the news of IronRuby b...
    </a>
    <div style="clear:both"></div>
</li>
<li>
    <img alt='' src='http://1.gravatar.com/avatar/f02db29ff83998a5c98eab1d7747a4ad?s=48&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D48&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' />
	<a href="http://iunknown.com/2009/11/passing-the-torch.html#comment-2275" title="on  Passing the torch">
		James Manning: "will happen later this month" 6+ months ago :)
...
    </a>
    <div style="clear:both"></div>
</li>
<li>
    <img alt='' src='http://0.gravatar.com/avatar/6833fa22704a4277b814a6c4960f346d?s=48&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D48&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' />
	<a href="http://iunknown.com/2009/12/motorola-droid-review.html#comment-2264" title="on  Motorola DROID Review">
		bob: The Google Voice Integration feature is also the f...
    </a>
    <div style="clear:both"></div>
</li>
<li>
    <img alt='' src='http://1.gravatar.com/avatar/117f5367e23fba4305caf41e103d7280?s=48&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D48&amp;r=G' class='avatar avatar-48 photo' height='48' width='48' />
	<a href="http://iunknown.com/2007/07/a-first-look-at-ironruby.html#comment-2263" title="on  A first look at IronRuby">
		Quiz: Used for my final project , thanks...
    </a>
    <div style="clear:both"></div>
</li>
                    
			</ul>
	      </div>
			<div id="tagcloud">
			    			</div>
		
	</div><!-- INSIDE END -->
	
	</div><!-- TABS END -->
	
	<div class="fix" style="height:25px !important;"></div>
	
	  
	<!-- TABS END -->    
    
	<!-- Widgetized Sidebar -->	
	<div id="archives-3" class="widget widget_archive"><h3>Archives</h3>		<select name="archive-dropdown" onchange='document.location.href=this.options[this.selectedIndex].value;'> <option value="">Select Month</option> 	<option value='http://iunknown.com/2009/12'> December 2009 </option>
	<option value='http://iunknown.com/2009/11'> November 2009 </option>
	<option value='http://iunknown.com/2009/05'> May 2009 </option>
	<option value='http://iunknown.com/2009/01'> January 2009 </option>
	<option value='http://iunknown.com/2008/10'> October 2008 </option>
	<option value='http://iunknown.com/2008/09'> September 2008 </option>
	<option value='http://iunknown.com/2008/08'> August 2008 </option>
	<option value='http://iunknown.com/2008/07'> July 2008 </option>
	<option value='http://iunknown.com/2008/06'> June 2008 </option>
	<option value='http://iunknown.com/2008/05'> May 2008 </option>
	<option value='http://iunknown.com/2008/04'> April 2008 </option>
	<option value='http://iunknown.com/2008/03'> March 2008 </option>
	<option value='http://iunknown.com/2008/02'> February 2008 </option>
	<option value='http://iunknown.com/2008/01'> January 2008 </option>
	<option value='http://iunknown.com/2007/12'> December 2007 </option>
	<option value='http://iunknown.com/2007/11'> November 2007 </option>
	<option value='http://iunknown.com/2007/10'> October 2007 </option>
	<option value='http://iunknown.com/2007/09'> September 2007 </option>
	<option value='http://iunknown.com/2007/08'> August 2007 </option>
	<option value='http://iunknown.com/2007/07'> July 2007 </option>
	<option value='http://iunknown.com/2007/06'> June 2007 </option>
	<option value='http://iunknown.com/2007/05'> May 2007 </option>
	<option value='http://iunknown.com/2007/04'> April 2007 </option>
	<option value='http://iunknown.com/2007/03'> March 2007 </option>
	<option value='http://iunknown.com/2007/02'> February 2007 </option>
	<option value='http://iunknown.com/2007/01'> January 2007 </option>
	<option value='http://iunknown.com/2006/12'> December 2006 </option>
	<option value='http://iunknown.com/2006/11'> November 2006 </option>
	<option value='http://iunknown.com/2006/10'> October 2006 </option>
	<option value='http://iunknown.com/2006/09'> September 2006 </option>
	<option value='http://iunknown.com/2006/08'> August 2006 </option>
	<option value='http://iunknown.com/2006/07'> July 2006 </option>
	<option value='http://iunknown.com/2006/06'> June 2006 </option>
	<option value='http://iunknown.com/2006/05'> May 2006 </option>
	<option value='http://iunknown.com/2006/04'> April 2006 </option>
	<option value='http://iunknown.com/2006/03'> March 2006 </option>
	<option value='http://iunknown.com/2006/02'> February 2006 </option>
	<option value='http://iunknown.com/2006/01'> January 2006 </option>
	<option value='http://iunknown.com/2005/12'> December 2005 </option>
	<option value='http://iunknown.com/2005/11'> November 2005 </option>
	<option value='http://iunknown.com/2005/10'> October 2005 </option>
 </select>
</div><div id="twitter-1" class="widget widget_twitter"><h3><a href="http://twitter.com/john_lam" class="twitter_title_link">Tweets</a></h3><ul class="twitter"><li class="twitter-item"> Why you don't mess with Nolan Ryan: <a href="http://nyti.ms/diukqc" class="twitter-link">http://nyti.ms/diukqc</a> </li><li class="twitter-item"> <a href="http://twitter.com/Werner" class="twitter-user">@Werner</a> looks like you were on the plane ... everything ok?! </li><li class="twitter-item"> Another favorite photo ... this one with no people in it (hard to do): <a href="http://flic.kr/p/8NmeQq" class="twitter-link">http://flic.kr/p/8NmeQq</a> </li><li class="twitter-item"> One of my favorite photos from my trip: <a href="http://flic.kr/p/8Nhkt4" class="twitter-link">http://flic.kr/p/8Nhkt4</a> </li><li class="twitter-item"> In other news, good to hear <a href="http://twitter.com/migueldeicaza" class="twitter-user">@migueldeicaza</a> and <a href="http://twitter.com/jschementi" class="twitter-user">@jschementi</a> take over stewardship of IronRuby! </li><li class="twitter-item"> Catching up on news ... good to see that my friend Jim Hugunin has gone public about his departure: <a href="http://bit.ly/bN3Z6u" class="twitter-link">http://bit.ly/bN3Z6u</a> We'll miss you, Jim </li><li class="twitter-item"> Giant (unorganized) photo dump from China trip available here: <a href="http://bit.ly/cC4yLK" class="twitter-link">http://bit.ly/cC4yLK</a> </li><li class="twitter-item"> <a href="http://twitter.com/emalamisura" class="twitter-user">@emalamisura</a> the closest to landscape was when we were in Hengdian <a href="http://bit.ly/b6BTp0" class="twitter-link">http://bit.ly/b6BTp0</a>. Emperor Qin's 1:1 scale palace was spectacular </li><li class="twitter-item"> Back from beyond the Great Firewall of China. Fantastic experience. 1000 frames shot. Links to come. </li><li class="twitter-item"> Seattle train station has seen better days. Reminds me of the Kingdome. </li></ul></div>
<div id="flickr" class="widget">
	<h3 class="widget_title">Photos on <span>Flick<span>r</span></span></h3>
	<div class="wrap">
		<script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?count=18&amp;display=latest&amp;size=s&amp;layout=x&amp;source=user&amp;user=23649168@N00"></script>        
		<div class="fix"></div>
	</div>
</div>

		
             
	
</div><!-- /#sidebar -->
    </div><!-- /#content -->
		
    <!-- Footer Widget Area Starts -->
	<div id="footer-widgets">
		<div class="container col-full">
            <div class="block">
                		           
            </div>
            <div class="block">
                		           
            </div>
            <div class="block last">
                		           
            </div>
   			<div class="fix"></div>
		</div>    
    </div>
    <!-- Footer Widget Area Ends -->

	<div id="footer">
		<div class="col-full">
            <div id="copyright" class="col-left">
                <p>&copy; 2010 John Lam on Software. All Rights Reserved.</p>
            </div>
            
            <div id="credit" class="col-right">
                <p>Powered by <a href="http://www.wordpress.org">Wordpress</a>. Designed by <a href="http://www.woothemes.com"><img src="http://iunknown.com/wp-content/themes/headlines/images/woothemes.png" width="87" height="21" alt="Woo Themes" /></a></p>
            </div>
		</div>
	</div>
	<!-- footer Ends -->
	
</div><!-- /#container -->

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-12323255-1");
pageTracker._trackPageview();
} catch(err) {}</script>

	<script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
	<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/john_lam.json?callback=twitterCallback2&amp;count=1"></script>
</body>
</html>