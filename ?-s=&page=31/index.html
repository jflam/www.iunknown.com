<!DOCTYPE html>
<html xmlns:fb="http://www.facebook.com/2008/fbml" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
      <meta http-equiv="X-UA-Compatible" content="chrome=1" />
      <meta name="width" content="500" />
      <meta name="generator" content="Posterous" />
      <script src="/javascripts/vendor/modernizr.custom.09241.js?1363729396" type="text/javascript"></script>
      <!--[if lt IE 9]>
        <script src="/javascripts/innershiv.js?1363729396" type="text/javascript"></script>
      <![endif]-->
      <link href="/bundles/posts.css" media="screen" rel="stylesheet" type="text/css" />
      <!--[if lt IE 9]>
        <link href="/bundles/ie.css" media="screen" rel="stylesheet" type="text/css" />
      <![endif]-->
      <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/LessIsBetter"/>
      <meta name="medium" content="blog" /><link rel="image_src" href="http://posterous.com/images/profile/missing-public-space-75.png" />
      <script type="text/javascript">
//<![CDATA[
window._token = '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='; beforeload = (new Date()).getTime(); pagetype = 'list';
//]]>
</script>
      <script src="/bundles/sites_initialization.js" type="text/javascript"></script>
      <script type="text/javascript">
//<![CDATA[
var $j = jQuery.noConflict();
//]]>
</script>
      <script type="text/javascript">
//<![CDATA[
var POSTEROUS_HOSTNAME = 'posterous.com'
//]]>
</script>
      <script data-posterous-deferred-content-url="http://iunknown.com/posts/deferred_content.jsonp" data-posts-data="%5B%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22second-drop-of-rubyclr%22%2C%22post_id%22%3A36932864%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22indexers-and-ruby%22%2C%22post_id%22%3A36932862%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22covariance-in-the-clr%22%2C%22post_id%22%3A36932855%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22data-binding-and-ruby%22%2C%22post_id%22%3A36932852%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22method-interception%22%2C%22post_id%22%3A36932850%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22windows-forms-and-rubyclr-happy-together%22%2C%22post_id%22%3A36932848%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22enumerations-in-rubyclr%22%2C%22post_id%22%3A36932847%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22method-overload-resolution%22%2C%22post_id%22%3A36932844%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22clr-value-types-in-ruby%22%2C%22post_id%22%3A36932843%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_url_slug%22%3A%22user-defined-value-type-marshaling%22%2C%22post_id%22%3A36932841%2C%22user_id%22%3A931119%7D%5D" id="posterous_initialization_script" src="/javascripts/initialize.js?1363729396" type="text/javascript"></script>
      
    <script src="/bundles/tags.js" type="text/javascript"></script><link rel="canonical" href="http://iunknown.com?page=31" />
<link href="/themes/light-matter/post-style.css" rel="stylesheet" type="text/css" />
<!--[if lte IE 8]>
	<link href="/themes/light-matter/ie-style.css" rel="stylesheet" type="text/css" />
<![endif]-->
<title>John Lam on Software - Home</title>
</head>
<body><div class="posterous_site_data" data-post-id="undefined" data-posterous-hostname="posterous.com" data-show-type="site" data-site-id="2278433" data-site-is-private="false" data-site-location="false" data-site-type="posterous" data-user-id="931119"></div><div class="posterous_ojs" data-posterous-admin-box="true"></div><div class="posterousPrivateBox">
	
	
</div>
      <div id="fb-root"></div>
        <script>
          window.fbAsyncInit = function() {
            FB.init({
              appId  : '6694405826',
              status : true, // check login status
              cookie : true, // enable cookies to allow the server to access the session
              xfbml  : true, // parse XFBML
              oauth  : true

            });
            
          };

          (function() {
            var e = document.createElement('script');
            e.type = 'text/javascript';
            e.src = 'http://connect.facebook.net/en_US/all.js';
            e.async = true;
            document.getElementById('fb-root').appendChild(e);
          }());
        </script>
    
  <div id="pbar">
        				<noscript>
  <div id="posterousbar_nojs">
    <a href="http://posterous.com/"><img src="/images/header/yellow.png" alt="Posterous" /></a>
  </div>
</noscript>
              </div>
<div id="header-container">
	<div id="header">
		
		<h1 class="site-name"><a href="http://iunknown.com">John Lam on Software</a></h1>
		<p class="site-description"></p>
	</div>
</div>

                
	<div id="pages-container">
		<div id="pages">
            <ul>
            	
                
                    <li><a href="http://about.me/jlam" title="About me" class="">About me</a></li>
                
              
            </ul>
		</div>
	</div>

              
<div id="container">
	<ul class="post-list clearfix">
		
			<li class="post-item clearfix" id="post_36932864">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932864"><a href="http://iunknown.com/2006/02/second-drop-of-rubyclr.html">Second Drop of RubyCLR</a></h3>
					
					
						<ul class="meta">
							<li class="date">21 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/second-drop-of-rubyclr.html" id="comment_link_36932864">18 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932864"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932864">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932864">
	
	<li><a href="http://posterous.com/posts/edit/36932864">Edit</a></li>
  <li><a href="/posts/destroy/36932864" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932864/tags/edit_multiple" data-post-id="36932864" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932864" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932864">
					<div class="copy">
						<p>It&rsquo;s alive and it&rsquo;s real:</p>
<p><div class='posterousGalleryMainDiv p_embed p_image_embed' data-posterous-file-list='%5B%7B%22large%22%3A%22http%3A%2F%2Fgetfile9.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FbrIffJEgzbnDsiJnAFidGftGGtglkGImAlcADHsbjgqcCeEAtbrxohHAtGba%2Fmedia_httpstaticflick_bieth.png.scaled1000.png%22%2C%22originalWidth%22%3A%22460%22%2C%22largeWidth%22%3A%22460%22%2C%22thumb%22%3A%22http%3A%2F%2Fgetfile3.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FbrIffJEgzbnDsiJnAFidGftGGtglkGImAlcADHsbjgqcCeEAtbrxohHAtGba%2Fmedia_httpstaticflick_bieth.png.thumb.png%22%2C%22originalHeight%22%3A%22547%22%2C%22largeHeight%22%3A%22547%22%2C%22thumbWidth%22%3A%2236%22%2C%22height%22%3A%22547%22%2C%22main%22%3A%22http%3A%2F%2Fgetfile2.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FbrIffJEgzbnDsiJnAFidGftGGtglkGImAlcADHsbjgqcCeEAtbrxohHAtGba%2Fmedia_httpstaticflick_bieth.png.scaled500.png%22%2C%22thumbHeight%22%3A%2236%22%2C%22originalSize%22%3A%2230%22%2C%22original%22%3A%22http%3A%2F%2Fgetfile8.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FbrIffJEgzbnDsiJnAFidGftGGtglkGImAlcADHsbjgqcCeEAtbrxohHAtGba%2Fmedia_httpstaticflick_bieth.png%22%2C%22width%22%3A%22460%22%7D%5D' data-posterous-image-gallery-initialized='false' data-posterous-image-gallery='true' data-posterous-options='%7B%22zipFile%22%3Anull%2C%22zipFileSize%22%3Anull%2C%22external_url%22%3Anull%2C%22showDownload%22%3Atrue%2C%22url_slug%22%3A%22second-drop-of-rubyclr%22%7D'>
<img alt="Media_httpstaticflick_bieth" height="547" src="http://getfile2.posterous.com/getfile/files.posterous.com/import-fueh/brIffJEgzbnDsiJnAFidGftGGtglkGImAlcADHsbjgqcCeEAtbrxohHAtGba/media_httpstaticflick_bieth.png.scaled500.png" width="460" />

</div>
</p>
<p>This second release of my RubyCLR bridge contains a non-trivial Windows Forms 2.0 application written <strong>entirely in Ruby</strong>. If you don&rsquo;t want to download the entire drop, you can <a href="http://www.iunknown.com/images/rssreader.rb">click here</a> to look at the source.</p>
<p>If you thought you&rsquo;ve seen this application before, you&rsquo;re right &ndash; it&rsquo;s a partial port of Joe Stegman&rsquo;s <a href="http://www.windowsforms.net/Default.aspx?tabindex=4&amp;tabid=49"><span class="caps">RSS</span> Reader application</a> that was designed to show off some of the more interesting features of Windows Forms 2.0.</p>
<p>I&rsquo;m pretty sure I could have finished porting the rest of the app, but I think I ported enough of it to demonstrate that you can actually use this drop to build a real app.</p>
<p>There are now 106 tests and 165 assertions in the unit test suite. They all pass.</p>
<p>This build now contains release builds of <code>RbDynamicMethod.dll</code> and <code>RubyClrTests.dll</code>, so it should run on any computer that has Ruby 1.8.2 and .NET Frameworks 2.0 <span class="caps">RTM</span> installed.</p>
<p><a href="http://www.iunknown.com/images/RbDynamicMethod.zip">Get the bits here</a>.</p>
<p>Enjoy.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/second-drop-of-rubyclr.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932862">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932862"><a href="http://iunknown.com/2006/02/indexers-and-ruby.html">Indexers and Ruby</a></h3>
					
					
						<ul class="meta">
							<li class="date">20 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/indexers-and-ruby.html" id="comment_link_36932862">0 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932862"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932862">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932862">
	
	<li><a href="http://posterous.com/posts/edit/36932862">Edit</a></li>
  <li><a href="/posts/destroy/36932862" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932862/tags/edit_multiple" data-post-id="36932862" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932862" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932862">
					<div class="copy">
						<p>I can support indexers (properties with parameters) in my bridge. So these tests pass:</p>
<div class="CodeRay">
  <div class="code"><pre>def test_property_overload_resolution
o = System::PropertyOverloads.new
o[4] = 42
o['5'] = 43
assert_equal 42, o[4]
assert_equal 43, o[5]
assert_equal 42, o['4']
assert_equal 43, o['5']
end</pre></div>
</div>

<p>given these properties written in C++:</p>
<div class="CodeRay">
  <div class="code"><pre>property int default[int] {
int get(int index) { return _values[index]; }
void set(int index, int value) { _values[index] = value; }
}
property int default[String^] {
int get(String^ index) { return _values[Convert::ToInt32(index)]; }
void set(String^ index, int value) { _values[Convert::ToInt32(index)] = value; }
}</pre></div>
</div>

<p>I was writing some corner case tests to validate my new <code>fastproperty</code> code generator (for non-overloaded properties, I bind directly to the method to avoid a runtime lookup) when I came across this interesting oddity:</p>
<div class="CodeRay">
  <div class="code"><pre>static property int OverloadedProperty {
int get() { return 1; }
}
static property int OverloadedProperty[int] {
int get(int x) { return _overloadedValue; }
void set(int x, int value) { _overloadedValue = value; }
}</pre></div>
</div>

<p>Note that in C++ I can overload non-default properties (I don&rsquo;t think you can do this in C# or VB). The <span class="caps">CLR</span>, of course, supports this but it appears that the languages don&rsquo;t.</p>
<p>I&rsquo;m not really sure how to support this case in Ruby:</p>
<p><code>PropertyTests.OverloadedProperty[]</code></p>
<p>It resolves into a call to <code>OverloadedProperty</code>, followed by a call to the <code>[]</code> method on the object that was returned by <code>OverloadedProperty</code>.</p>
<p>I don&rsquo;t think there are cases in the libraries that require this, nor can I think of a good reason why I should support this case.</p>
<p>What do y&rsquo;all think?</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/indexers-and-ruby.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932855">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932855"><a href="http://iunknown.com/2006/02/covariance-in-the-clr.html">Covariance in the CLR</a></h3>
					
					
						<ul class="meta">
							<li class="date">17 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/covariance-in-the-clr.html" id="comment_link_36932855">5 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932855"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932855">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932855">
	
	<li><a href="http://posterous.com/posts/edit/36932855">Edit</a></li>
  <li><a href="/posts/destroy/36932855" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932855/tags/edit_multiple" data-post-id="36932855" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932855" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932855">
					<div class="copy">
						<p>While writing my first real Ruby app using my bridge, I came across my first real honest-go-goodness nasty bug. Most of the other bugs have been nice and deterministic &ndash; something I just did caused the bridge to blow up. This one was just plain nasty, and of course it was based on an invalid assumption. It manifested itself as a corrupted call stack and dumped me rather unceramoniously into the debugger.</p>
<p>Here&rsquo;s the invalid assumption: I thought that there wasn&rsquo;t return-value <a href="http://en.wikipedia.org/wiki/Parameter_covariance">covariance</a> in C# (the <span class="caps">CLR</span> supports return-value covariance, but I thought this was a safe assumption since I figured most folks wouldn&rsquo;t be writing code using <code>ilasm</code>).</p>
<p>For example, you cannot have these two methods in the same type:</p>
<p><code>int Method()</code> and <code>string Method()</code></p>
<p>However, if they can be distinguished based on their parameter lists, then it&rsquo;s OK:</p>
<p><code>int Method(int)</code> and <code>string Method(string)</code></p>
<p>I had made the assumption in my overload shim that all overloads would return the same type. Oops. I ran into this bug when I was calling <code>ToolStripItemCollection.Add</code>.</p>
<p>What&rsquo;s worse, the <span class="caps">MSDN</span> docs essentially imply that all of the return values are the same since the return values of the methods aren&rsquo;t shown in the overloads list. I only noticed this when I pulled out Reflector to look at the methods myself.</p>
<p>I&rsquo;m really happy that this was the root cause of the stack corruption bug. I was worried that there was something flaky about the interactions between the garbage collectors on both sides of the marshaling boundary &hellip;</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/covariance-in-the-clr.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932852">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932852"><a href="http://iunknown.com/2006/02/data-binding-and-ruby.html">Data Binding and Ruby</a></h3>
					
					
						<ul class="meta">
							<li class="date">17 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/data-binding-and-ruby.html" id="comment_link_36932852">2 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932852"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932852">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932852">
	
	<li><a href="http://posterous.com/posts/edit/36932852">Edit</a></li>
  <li><a href="/posts/destroy/36932852" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932852/tags/edit_multiple" data-post-id="36932852" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932852" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932852">
					<div class="copy">
						<p>It&rsquo;s going to take a lot of work to let you data bind against a native Ruby array, or a native Ruby array of objects. So how about some helper methods that takes an array of Ruby objects and converts it into a <code>DataTable</code>? Or a helper method that converts a Ruby array into an <code>ArrayList</code>? (Once generics are working I can marshal it into an array or a <code>List&lt;T&gt;</code>).</p>
<p>While this is not the most efficient way to do things since it involves copying data in memory, would it be a useful workaround in the short term?</p>
<p><strong>Update:</strong> I implemented this tonight after fixing some bugs in my overload resolution algorithm. Works like a charm.</p>
<div class="CodeRay">
  <div class="code"><pre>def marshal_to_data_table(array)
dt = DataTable.new
raise 'array must have at least one element' if array.length &lt; 1
schema = array[0].members
schema.each { |column_name| dt.Columns.Add(column_name) }
array.each do |element|
row = dt.NewRow
schema.each do |column_name|
row[column_name] = element.send column_name
end
dt.Rows.Add(row)
end
dt
end</pre></div>
</div>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/data-binding-and-ruby.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932850">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932850"><a href="http://iunknown.com/2006/02/method-interception.html">Method interception</a></h3>
					
					
						<ul class="meta">
							<li class="date">16 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/method-interception.html" id="comment_link_36932850">2 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932850"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932850">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932850">
	
	<li><a href="http://posterous.com/posts/edit/36932850">Edit</a></li>
  <li><a href="/posts/destroy/36932850" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932850/tags/edit_multiple" data-post-id="36932850" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932850" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932850">
					<div class="copy">
						<p>I&rsquo;m trying to think of some simple scenarios where Ruby&rsquo;s dynamic nature could be put to good use in writing .NET applications. Here&rsquo;s one off the top of my head:</p>
<div class="CodeRay">
  <div class="code"><pre>class TextBox
import Text=
alias  old_set_Text Text=
def Text=(value)
puts &quot;Changed value from #{self.Text} to #{value}&quot;
old_set_Text(value)
end
end</pre></div>
</div>

<p>The <code>TextBox</code> class that you see is a Windows Forms <code>TextBox</code>. Here&rsquo;s a case where I can intercept all calls to change the <code>Text</code> property of <em>any</em> <code>TextBox</code> control in the application (I can also do this per-control as well).</p>
<p>Of course, it only works if you call from Ruby &ndash; this can&rsquo;t be used, for example, to monitor how C# code changes the <code>Text</code> property of <code>TextBox</code> controls.</p>
<p>The <code>import</code> directive / method that you see is some hypothetical syntax to force my bridge to generate the method shim for <code>Text=</code> (this is done automatically the first time you try to use the property in normal usage scenarios).</p>
<p>Another idea is to monitor <code>SqlConnection</code> opens and closes to make sure that they are balanced. I did this example many years ago when I wrote my <span class="caps">AOP</span> weaver for the <span class="caps">CLR</span>.</p>
<p>If folks could leave some comments about how they could see using method interception via Ruby, I&rsquo;d be very interested in seeing if I can code it up using my bridge.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/method-interception.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932848">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932848"><a href="http://iunknown.com/2006/02/windows-forms-and-rubyclr-happy-together.html">Windows Forms and RubyCLR: Happy Together</a></h3>
					
					
						<ul class="meta">
							<li class="date">16 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/windows-forms-and-rubyclr-happy-together.html" id="comment_link_36932848">2 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932848"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932848">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932848">
	
	<li><a href="http://posterous.com/posts/edit/36932848">Edit</a></li>
  <li><a href="/posts/destroy/36932848" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932848/tags/edit_multiple" data-post-id="36932848" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932848" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932848">
					<div class="copy">
						<p>I was going to write something about how I got nested types working last night, and some cool Ruby features that I discovered to make it work (remind me later &ndash; it is a very cool story), but there&rsquo;s something much more exciting to report:</p>
<p><strong>I&rsquo;ve built my first trivial Windows Forms 2.0 Application using RubyCLR!</strong></p>
<p><div class='posterousGalleryMainDiv p_embed p_image_embed' data-posterous-file-list='%5B%7B%22large%22%3A%22http%3A%2F%2Fgetfile1.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FlpljHnHrfbcfDIBrfuquitcijrpopyCoCmFiJCtAfpFrxFtrcpzvFueqHwan%2Fmedia_httpstaticflick_CdBmE.png.scaled1000.png%22%2C%22originalWidth%22%3A%22568%22%2C%22largeWidth%22%3A%22568%22%2C%22thumb%22%3A%22http%3A%2F%2Fgetfile5.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FlpljHnHrfbcfDIBrfuquitcijrpopyCoCmFiJCtAfpFrxFtrcpzvFueqHwan%2Fmedia_httpstaticflick_CdBmE.png.thumb.png%22%2C%22originalHeight%22%3A%22299%22%2C%22largeHeight%22%3A%22299%22%2C%22thumbWidth%22%3A%2236%22%2C%22height%22%3A%22263%22%2C%22main%22%3A%22http%3A%2F%2Fgetfile5.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FlpljHnHrfbcfDIBrfuquitcijrpopyCoCmFiJCtAfpFrxFtrcpzvFueqHwan%2Fmedia_httpstaticflick_CdBmE.png.scaled500.png%22%2C%22thumbHeight%22%3A%2236%22%2C%22originalSize%22%3A%2218%22%2C%22original%22%3A%22http%3A%2F%2Fgetfile3.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FlpljHnHrfbcfDIBrfuquitcijrpopyCoCmFiJCtAfpFrxFtrcpzvFueqHwan%2Fmedia_httpstaticflick_CdBmE.png%22%2C%22width%22%3A%22500%22%7D%5D' data-posterous-image-gallery-initialized='false' data-posterous-image-gallery='true' data-posterous-options='%7B%22zipFile%22%3Anull%2C%22zipFileSize%22%3Anull%2C%22external_url%22%3Anull%2C%22showDownload%22%3Atrue%2C%22url_slug%22%3A%22windows-forms-and-rubyclr-happy-together%22%7D'>
<a href="http://getfile1.posterous.com/getfile/files.posterous.com/import-fueh/lpljHnHrfbcfDIBrfuquitcijrpopyCoCmFiJCtAfpFrxFtrcpzvFueqHwan/media_httpstaticflick_CdBmE.png.scaled1000.png"><img alt="Media_httpstaticflick_cdbme" height="263" src="http://getfile5.posterous.com/getfile/files.posterous.com/import-fueh/lpljHnHrfbcfDIBrfuquitcijrpopyCoCmFiJCtAfpFrxFtrcpzvFueqHwan/media_httpstaticflick_CdBmE.png.scaled500.png" width="500" /></a>

</div>
</p>
<p>Yes, it is the &ldquo;Hello, World&rdquo; Windows Forms data binding application, but it represents a major step forward in the maturity of RubyCLR. Lots of features had to be added to the product to make this work, and that&rsquo;s what&rsquo;s been driving most of my development effort recently; I&rsquo;m worrying less about the edge cases for now, and focusing on implementing the most important core features to make it usable.</p>
<p>Now, this application is not intended to represent anything about how one would actually write Windows Forms applications using Ruby &ndash; this application is <strong>very</strong> un-Ruby-esque. I can imagine lots of ways to improve how it&rsquo;s implemented, and I&rsquo;m going to spend a few days building an app to see what kinds of idioms I can discover along the way (provided the bridge is stable enough to actually build that app).</p>
<p>Here&rsquo;s the code:</p>
<div class="CodeRay">
  <div class="code"><pre>require 'rubyclr'
RubyClr::reference 'System.Data'
RubyClr::reference 'System.Drawing'
RubyClr::reference 'System.Windows.Forms'
include System
include System::Data
include System::Data::SqlClient
include System::Drawing
include System::Windows::Forms
class MainForm
attr_reader :form, :grid
CS  = 'server=.\SQLEXPRESS;database=adventureworks;integrated security=sspi'
SQL = 'select * from humanresources.employee'
def create_form(grid)
form               = Form.new
form.AutoScaleMode = AutoScaleMode::Font
form.ClientSize    = Size.new(292, 266)
form.Controls.Add(grid)
form.Load do |sender, args|
adapter = SqlDataAdapter.new(SQL, CS)
ds      = DataSet.new
adapter.Fill(ds, 'Employee')
grid.DataSource = ds
grid.DataMember = 'Employee'
end
form
end
def create_gridview
grid = DataGridView.new
grid.ColumnHeadersHeightSizeMode = DataGridViewColumnHeadersHeightSizeMode::AutoSize
grid.Dock     = DockStyle::Fill
grid.Location = Point.new(0, 0)
grid.Size     = Size.new(292, 266)
grid.TabIndex = 0
grid
end
def initialize
@grid = create_gridview
@form = create_form(@grid)
end
end
Application.EnableVisualStyles
Application.SetCompatibleTextRenderingDefault false
main = MainForm.new
Application.Run(main.form)</pre></div>
</div>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/windows-forms-and-rubyclr-happy-together.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932847">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932847"><a href="http://iunknown.com/2006/02/enumerations-in-rubyclr.html">Enumerations in RubyCLR</a></h3>
					
					
						<ul class="meta">
							<li class="date">15 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/enumerations-in-rubyclr.html" id="comment_link_36932847">2 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932847"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932847">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932847">
	
	<li><a href="http://posterous.com/posts/edit/36932847">Edit</a></li>
  <li><a href="/posts/destroy/36932847" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932847/tags/edit_multiple" data-post-id="36932847" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932847" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932847">
					<div class="copy">
						<p>I added enumerations support to RubyCLR today. It was a bit tricky since Ruby has no native support for enumerations (or user-defined value types), so I have to fake out enumerations using Ruby objects. For most scenarios, it feels very much like an enumeration would in C#.</p>
<p>Here&rsquo;s a simple Windows Forms MessageBox sample that uses enumerations:</p>
<div class="CodeRay">
  <div class="code"><pre>require 'rubyclr'
RubyClr::reference 'System.Windows.Forms'
include System::Windows::Forms
result = MessageBox.Show('Yes or no?', 'Answer this!',
MessageBoxButtons::YesNo)
puts result.to_s</pre></div>
</div>

<p>The <code>to_s</code> method outputs the string value of the enum, in this case Yes or No based on which button the user clicks. I also support adding, subtracting and bitwise or operations against enumerations.</p>
<p>My overload resolution algorithm needs to account for implicit up-conversions to the enumeration&rsquo;s underlying type. That will be accounted for when I rewrite that algorithm beginning tomorrow.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/enumerations-in-rubyclr.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932844">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932844"><a href="http://iunknown.com/2006/02/method-overload-resolution.html">Method Overload Resolution</a></h3>
					
					
						<ul class="meta">
							<li class="date">13 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/method-overload-resolution.html" id="comment_link_36932844">0 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932844"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932844">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932844">
	
	<li><a href="http://posterous.com/posts/edit/36932844">Edit</a></li>
  <li><a href="/posts/destroy/36932844" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932844/tags/edit_multiple" data-post-id="36932844" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932844" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932844">
					<div class="copy">
						<p>The current method overload algorithm in the RubyCLR bridge is a placeholder. It only works for very simple cases (which, granted easily account for 80+% of the cases). It doesn&rsquo;t handle corner cases very well, nor does it handle parameter arrays (although there is some code there to handle those cases, it&rsquo;s just not called right now). The algorithm is also fairly poor both in terms of space and in time. So there&rsquo;s quite a lot of room for improvement there.</p>
<p>In this next iteration, I&rsquo;m planning on tackling the generics overloading problem, which requires me to think very carefully about the algorithm.</p>
<p>Before tackling generics, I decided to spend some time writing test cases for non-generic corner cases, as well as cleaning up a bunch of missing bits in the code. Rather than reinventing the wheel, I decided to take a look at the test cases for <a href="http://www.gotdotnet.com/workspaces/workspace.aspx?id=ad7acff7-ab1e-4bcb-99c0-57ac5a3a9742">IronPython</a>, since I figure that they would have a similar set of problems to deal with.</p>
<p>I found a <em>very</em> clever set of test cases in <code>BindingTest.py</code>. As I ported them to Ruby, I discovered a number of missing features in my existing codebase (such as marshaling Booleans as parameters &ndash; I was missing an entry in a hashtable). I&rsquo;ve spent part of the day fixing those bugs and writing a new set of unit tests in preparation for a rewrite of the method overload algorithm.</p>
<p>One thing that I discovered while looking at the Python unit tests is that I&rsquo;m going to have to tackle enumerations sooner rather than later. Once I have support for enumerations in RubyCLR, I&rsquo;ll ship a new drop, likely by the end of the week.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/method-overload-resolution.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932843">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932843"><a href="http://iunknown.com/2006/02/clr-value-types-in-ruby.html">CLR Value Types in Ruby</a></h3>
					
					
						<ul class="meta">
							<li class="date">11 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/clr-value-types-in-ruby.html" id="comment_link_36932843">0 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932843"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932843">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932843">
	
	<li><a href="http://posterous.com/posts/edit/36932843">Edit</a></li>
  <li><a href="/posts/destroy/36932843" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932843/tags/edit_multiple" data-post-id="36932843" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932843" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932843">
					<div class="copy">
						<p>I thought I&rsquo;d expand a bit on a problem that I solved today. Consider this bit of C# code:</p>
<div class="CodeRay">
  <div class="code"><pre>Point p1 = new Point(2, 3);
Point p2 = p1;
p2.X += 1;
Assert.Equals(p1.X + 1, p2.X);</pre></div>
</div>

<p>This should run without throwing an assertion, right? That&rsquo;s because the semantics of value types in the <span class="caps">CLR</span> dictate that they must be <em>copied</em> upon assignment.</p>
<p>However, consider this Ruby code that uses my bridge:</p>
<div class="CodeRay">
  <div class="code"><pre>p1 = Point.new(2, 3)
p2 = p1
p2.X += 1
assert_equal p1.X, p2.X</pre></div>
</div>

<p>This code also runs without throwing an assertion. What you&rsquo;re seeing is Ruby treating all objects as reference types for assignment purposes. Ruby doesn&rsquo;t know anything about .NET value types, so its behavior is consistent with its type system.</p>
<p>However, if you use the Ruby <code>clone</code> method, you will see the same behavior as the C# code:</p>
<div class="CodeRay">
  <div class="code"><pre>p1 = Point.new(2, 3)
p2 = p1.clone
p2.X += 1
assert_equal p1.X + 1, p2.X</pre></div>
</div>

<p>I had to do a bit of hacking to implement <code>clone</code> semantics correctly for <code>T_DATA</code> Ruby C object types. There&rsquo;s still some work to be done to implement <code>clone</code> correctly for <span class="caps">CLR</span> reference types once I turn my attention to object identity in the near future.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/clr-value-types-in-ruby.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932841">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932841"><a href="http://iunknown.com/2006/02/user-defined-value-type-marshaling.html">User-defined value type marshaling</a></h3>
					
					
						<ul class="meta">
							<li class="date">10 Feb 2006</li>
							<li class="comments"><a href="http://iunknown.com/2006/02/user-defined-value-type-marshaling.html" id="comment_link_36932841">2 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932841"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932841">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932841">
	
	<li><a href="http://posterous.com/posts/edit/36932841">Edit</a></li>
  <li><a href="/posts/destroy/36932841" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', '0FnFBGShnKUoaCXqnAAX5pVbrxj8itj9ET6MgPcR5ZY='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932841/tags/edit_multiple" data-post-id="36932841" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932841" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932841">
					<div class="copy">
						<p>I got value type marshaling working tonight (but not creation just yet &ndash; but that&rsquo;s fairly straightforward). It wasn&rsquo;t quite as hard as I thought since I previously thought that value types could be extended. I&rsquo;ll write more about this issue tomorrow.</p>
<p>Here are the unit tests that now pass:</p>
<div class="CodeRay">
  <div class="code"><pre>static Point GetPoint() {
return Point(3, 4);
}
...
class ValueTypeTests &lt; Test::Unit::TestCase
def test_get_point
p = System::MarshalerTests.GetPoint
assert_equal 3, p.X
assert_equal 4, p.Y
assert_equal 'System.Drawing.Point', p.class_name
end
def test_point_instance_method
p = System::MarshalerTests.GetPoint
p.Offset(1, 1)
assert_equal 4, p.X
assert_equal 5, p.Y
end
end</pre></div>
</div>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2006/02/user-defined-value-type-marshaling.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
		<li class="pagination">
			<div class="pagination"><a href="http://iunknown.com?page=30&amp;-s=" class="prev_page" rel="prev">&laquo; Previous</a> <a href="http://iunknown.com?page=1&amp;-s=" rel="start">1</a> <a href="http://iunknown.com?page=2&amp;-s=">2</a> <span class="gap">&hellip;</span> <a href="http://iunknown.com?page=27&amp;-s=">27</a> <a href="http://iunknown.com?page=28&amp;-s=">28</a> <a href="http://iunknown.com?page=29&amp;-s=">29</a> <a href="http://iunknown.com?page=30&amp;-s=" rel="prev">30</a> <span class="current">31</span> <a href="http://iunknown.com?page=32&amp;-s=" rel="next">32</a> <a href="http://iunknown.com?page=33&amp;-s=">33</a> <a href="http://iunknown.com?page=34&amp;-s=">34</a> <a href="http://iunknown.com?page=35&amp;-s=">35</a> <a href="http://iunknown.com?page=36&amp;-s=">36</a> <a href="http://iunknown.com?page=37&amp;-s=">37</a> <a href="http://iunknown.com?page=38&amp;-s=">38</a> <a href="http://iunknown.com?page=32&amp;-s=" class="next_page" rel="next">Next &raquo;</a></div> 
		</li>		
	</ul>
</div>

<div id="footer-container">
	<div id="footer">
	
		<ul class="three-column clearfix">
    		<li class="column clearfix">
				
                    <h4>About</h4>
                    <p>I create software tools for scientists and engineers in the Technical Computing Group at Microsoft. Before that, I was a founding member of the IronRuby team.</p>
                    <div class="siteviews">127277 Views</div>
				
                
			</li>
			<li class="column">
            
                
            
				<h4>Get Updates</h4>
          <div class="subscribe_to_mysite clearfix">
              
              <div><a href="http://feeds.feedburner.com/LessIsBetter" class="subscribe_link" target="_blank">Subscribe via RSS</a> </div>
              <div class="social-bookmarks">
                  <a href="http://twitter.com/john_lam" class="p_external_site p_twitter" rel="me">Twitter</a>
              </div>
          </div>

			</li>
            <li class="column last">
                
                
              

            </li>
		</ul>
		
		<form class="search-form" method="get">
            <input name="sort" value="" type="hidden" />
            <input name="search" class="search" id="searchbox" value="" type="text" />
            <input class="search_button" value="Search" type="submit" />
        </form>
        
              
            
	
	</div>
</div>



  
      <script type="text/javascript">
    	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    	</script>
    	<script type="text/javascript">
    	var pageTracker = _gat._getTracker("UA-4054156-1");
    	pageTracker._setDomainName("none");
    	pageTracker._setAllowLinker(true);
    	pageTracker._setAllowHash(false);
    	pageTracker._initData();
    	pageTracker._trackPageview();
    	</script>
    
  
  <!-- Quantcast Tag --> 
  <script type="text/javascript">
    var _qevents = _qevents || [];
    _qevents.push( { qacct:"p-16ewveTurfCCM"} );
  </script>
  <script type="text/javascript" src="//edge.quantserve.com/quant.js" async></script>
  <noscript>
  <div style="display: none;"><img src="https://pixel.quantserve.com/pixel/p-16ewveTurfCCM.gif" height="1" width="1" alt="Quantcast"/></div>
  </noscript>
  <!-- End Quantcast tag -->


	<script type="text/javascript">
		try {
			var pageTrackerUser = _gat._getTracker("UA-12323255-1");
			pageTrackerUser._trackPageview();
		} catch (err) {}
	</script>


<script src="http://www.scribd.com/javascripts/view.js" type="text/javascript"></script>
<script src="/bundles/sites_views.js" type="text/javascript"></script>
<script src="/bundles/sites.js" type="text/javascript"></script>
<script src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js" type="text/javascript"></script>

<script>
	var fbid_site_owner = 1;
</script>












<div class="posterous_ojs" data-posterous-twitter-oauth="true" data-posterous-post-ids="%7B%2236932862%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Findexers-and-ruby.html%22%2C%2236932841%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fuser-defined-value-type-marshaling.html%22%2C%2236932852%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fdata-binding-and-ruby.html%22%2C%2236932864%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fsecond-drop-of-rubyclr.html%22%2C%2236932843%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fclr-value-types-in-ruby.html%22%2C%2236932844%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fmethod-overload-resolution.html%22%2C%2236932855%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fcovariance-in-the-clr.html%22%2C%2236932847%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fenumerations-in-rubyclr.html%22%2C%2236932848%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fwindows-forms-and-rubyclr-happy-together.html%22%2C%2236932850%22%3A%22http%3A%2F%2Fiunknown.com%2F2006%2F02%2Fmethod-interception.html%22%7D" data-posterous-redirect-url="http://posterous.com/oauth/init_oauth_and_redirect/?ssod=iunknown.com&oauth_provider_type="></div>
<script type="text/javascript" src="http://platform.twitter.com/widgets.js" defer></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<div style="display: none;"><iframe src="http://posterous.com/analytics_tracker" style="height: 1px; width: 1px;"></iframe></div></body>
</html>



