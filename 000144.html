<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

<title>iunknown.com: Code generation: C# vs. VB.NET</title>

<link rel="stylesheet" href="http://www.iunknown.com/styles-site.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.iunknown.com/index.rdf" />

<link rel="start" href="http://www.iunknown.com/" title="Home" />
<link rel="prev" href="http://www.iunknown.com/000143.html" title="More Red Arrows Pictures" />

<link rel="next" href="http://www.iunknown.com/000145.html" title="Information Overload" />


<script type="text/javascript" language="javascript">
<!--

function OpenTrackback (c) {
    window.open(c,
                    'trackback',
                    'width=480,height=480,scrollbars=yes,status=yes');
}

var HOST = 'www.iunknown.com';

// Copyright (c) 1996-1997 Athenia Associates.
// http://www.webreference.com/js/
// License is granted if and only if this entire
// copyright notice is included. By Tomer Shiran.

function setCookie (name, value, expires, path, domain, secure) {
    var curCookie = name + "=" + escape(value) + ((expires) ? "; expires=" + expires.toGMTString() : "") + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + ((secure) ? "; secure" : "");
    document.cookie = curCookie;
}

function getCookie (name) {
    var prefix = name + '=';
    var c = document.cookie;
    var nullstring = '';
    var cookieStartIndex = c.indexOf(prefix);
    if (cookieStartIndex == -1)
        return nullstring;
    var cookieEndIndex = c.indexOf(";", cookieStartIndex + prefix.length);
    if (cookieEndIndex == -1)
        cookieEndIndex = c.length;
    return unescape(c.substring(cookieStartIndex + prefix.length, cookieEndIndex));
}

function deleteCookie (name, path, domain) {
    if (getCookie(name))
        document.cookie = name + "=" + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + "; expires=Thu, 01-Jan-70 00:00:01 GMT";
}

function fixDate (date) {
    var base = new Date(0);
    var skew = base.getTime();
    if (skew > 0)
        date.setTime(date.getTime() - skew);
}

function rememberMe (f) {
    var now = new Date();
    fixDate(now);
    now.setTime(now.getTime() + 365 * 24 * 60 * 60 * 1000);
    setCookie('mtcmtauth', f.author.value, now, '', HOST, '');
    setCookie('mtcmtmail', f.email.value, now, '', HOST, '');
    setCookie('mtcmthome', f.url.value, now, '', HOST, '');
}

function forgetMe (f) {
    deleteCookie('mtcmtmail', '', HOST);
    deleteCookie('mtcmthome', '', HOST);
    deleteCookie('mtcmtauth', '', HOST);
    f.email.value = '';
    f.author.value = '';
    f.url.value = '';
}

//-->
</script>





</head>

<body>

<div id="banner">
<h1><a href="http://www.iunknown.com/" accesskey="1"><img src="/mt-static/images/iunknown.png" width="350" height="60" border="0"></a></h1>
<span class="description">Home of the Practical Eye for the .NET Guy</span>
</div>

<div id="container">

<div class="blog">

<div id="menu">
<a href="http://www.iunknown.com/000143.html">&laquo; More Red Arrows Pictures</a> |

<a href="http://www.iunknown.com/">Main</a>
| <a href="http://www.iunknown.com/000145.html">Information Overload &raquo;</a>

</div>

</div>


<div class="blog">

<h2 class="date">September 06, 2002</h2>

<div class="blogbody">

<h3 class="title">Code generation: C# vs. VB.NET</h3>

<p><P>I spent a bit of time today investigating the CIL generated by the VB.NET compiler vs. the CIL generated by the C# compiler. Consider the following VB.NET code:</P><br />
<P><CODE>&nbsp; Public Function AddThreeAndSeven() As Integer<BR>&nbsp;&nbsp;&nbsp; Dim a As Integer = 3<BR>&nbsp;&nbsp;&nbsp; Dim b As Integer = 7<BR>&nbsp;&nbsp;&nbsp; Return a + b<BR>&nbsp; End Function</CODE></P><br />
<P>When run through vbc.exe using release settings, this is the CIL that is generated:</P><br />
<P><CODE>.maxstack 2<BR>.locals (int V_0, int V_1, int V_2)<BR>L_0000: ldc.i4.3 <BR>L_0001: stloc.0 <BR>L_0002: ldc.i4.7 <BR>L_0003: stloc.2 <BR>L_0004: ldloc.0 <BR>L_0005: ldloc.2 <BR>L_0006: add.ovf <BR>L_0007: ret</CODE></P><br />
<P>Consider exactly the same function written using C#:</P><br />
<P><CODE>public int AddThreeAndSeven()<BR>{<BR>&nbsp; int a = 3;<BR>&nbsp; int b = 7;<BR>&nbsp; return a + b;<BR>}</CODE></P><br />
<P>This is the CIL that is generated:</P><br />
<P><CODE>.maxstack 2<BR>.locals (int V_0, int V_1)<BR>L_0000: ldc.i4.3 <BR>L_0001: stloc.0 <BR>L_0002: ldc.i4.7 <BR>L_0003: stloc.1 <BR>L_0004: ldloc.0 <BR>L_0005: ldloc.1 <BR>L_0006: add <BR>L_0007: ret</CODE></P><br />
<P>As you can see, the VB.NET code allocates space for an additional local variable <EM>that is never used</EM>. This is behavior is consistent between debug and release builds. I'm rather surprised by this behavior, but I'm certain that the JIT catches the unused variable and allocates space in the stack frame appropriately.</P></p>

<a name="more"></a>


<span class="posted">Posted by John at September  6, 2002 08:53 PM

<br /></span>

</div>

<div class="comments-head"><a name="mailthisentry"></a>Mail this entry</div>

<form method="post" action="http://www.iunknown.com/cgi-bin/mt-send-entry.cgi">
<input type="hidden" name="entry_id" value="144" />
<input type="hidden" name="_redirect" value="http://www.iunknown.com/000144.html" />
Email this entry to:<br />
<input name="to" size="20" /><br /><br />
Your email address:<br />
<input name="from" size="20" /><br /><br />
Message (optional):<br />
<textarea name="message" rows="5" cols="20" wrap="virtual"></textarea><br /><br />
<input type="submit" value="Send" />
</form>


<div class="comments-head"><a name="comments"></a>Comments</div>

<div class="comments-body">
<p>aereawr</p>
<span class="comments-post">Posted by: <a target="_blank" href="http://arer">sara</a> at June 23, 2003 11:29 AM</span>
</div>
<div class="comments-body">
<p>jghj</p>
<span class="comments-post">Posted by:  at April 21, 2004 07:43 AM</span>
</div>




</div>
</div>
</body>
</html>
