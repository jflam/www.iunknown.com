<!-- Published by Fog Creek Software CityDesk EKANXPWNIHDVOPBJ/5193B323/211 -->


<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Code generation: C# vs. VB.NET</title>
  <link rel="stylesheet" href="../iunknown.css"/>
  <script type="text/javascript" src="http://www.haloscan.com/load.php?user=jlam"></script>
  <script language="javascript">
    function HaloScan2( id ) {
      location.href='http://www.haloscan.com/comments.php?user=jlam&comment='+id;
    }
  </script>
</head>
<body>
  <a href="http://www.iunknown.com"><img src="../Images/iunknown.png" width="350" height="60" border="0"></a> 
  <table width="700px" border="0" cellspacing="10">
    <tr>
      <td width="76%" valign="top">
        <div class="entryTitle">Code generation: C# vs. VB.NET</div>
        <div class="entryDate">2002-09-06</div>
        <p><P>I spent a bit of time today investigating the CIL generated by the VB.NET compiler vs. the CIL generated by the C# compiler. Consider the following VB.NET code:</P>
<P><CODE>&nbsp; Public Function AddThreeAndSeven() As Integer<BR>&nbsp;&nbsp;&nbsp; Dim a As Integer = 3<BR>&nbsp;&nbsp;&nbsp; Dim b As Integer = 7<BR>&nbsp;&nbsp;&nbsp; Return a + b<BR>&nbsp; End Function</CODE></P>
<P>When run through vbc.exe using release settings, this is the CIL that is generated:</P>
<P><CODE>.maxstack 2<BR>.locals (int V_0, int V_1, int V_2)<BR>L_0000: ldc.i4.3 <BR>L_0001: stloc.0 <BR>L_0002: ldc.i4.7 <BR>L_0003: stloc.2 <BR>L_0004: ldloc.0 <BR>L_0005: ldloc.2 <BR>L_0006: add.ovf <BR>L_0007: ret</CODE></P>
<P>Consider exactly the same function written using C#:</P>
<P><CODE>public int AddThreeAndSeven()<BR>{<BR>&nbsp; int a = 3;<BR>&nbsp; int b = 7;<BR>&nbsp; return a + b;<BR>}</CODE></P>
<P>This is the CIL that is generated:</P>
<P><CODE>.maxstack 2<BR>.locals (int V_0, int V_1)<BR>L_0000: ldc.i4.3 <BR>L_0001: stloc.0 <BR>L_0002: ldc.i4.7 <BR>L_0003: stloc.1 <BR>L_0004: ldloc.0 <BR>L_0005: ldloc.1 <BR>L_0006: add <BR>L_0007: ret</CODE></P>
<P>As you can see, the VB.NET code allocates space for an additional local variable <EM>that is never used</EM>. This is behavior is consistent between debug and release builds. I'm rather surprised by this behavior, but I'm certain that the JIT catches the unused variable and allocates space in the stack frame appropriately.</P><img src="../Images/blue_button.jpg" alt="Permanent Link" width="18" height="18" align="top"></p>
        <a href="javascript:HaloScan2('Weblog/CodegenerationCvs.VB.NET.html');"><script type="text/javascript">postCount('Weblog/CodegenerationCvs.VB.NET.html');</script></a>
      </td>
      <td width="24%" valign="top">
        <a href="http://www.iunknown.com/rss.xml"><img src="../Images/xml.png" width="36" height="14" border="0"></a>
  
        <p><img src="../Images/about.png" width="100" height="25"></p>
        <div class="aboutEntry"> 
          
            <A href="../About/Aboutme.html">About me</A><br>
          
            <A href="../About/fog0000000006.html">About this site</A><br>
          
            <A href="../About/fog0000000010.html">My plan</A><br>
          
            <A href="../About/fog0000000009.html">My other life</A><br>
          
            <A href="../About/fog0000000008.html">My products</A><br>
          
            <A href="../About/fog0000000013.html">My publications</A><br>
          
        </div>

        <p><img src="../Images/archives.png" width="100" height="25"></p>
        <div class="archiveEntry">
         
           <A href="../Archives/February2003.html">February2003</A><br>
         
           <A href="../Archives/January2003.html">January 2003</A><br>
         
           <A href="../Archives/December2002.html">December 2002</A><br>
         
           <A href="../Archives/November2002.html">November 2002</A><br>
         
           <A href="../Archives/October2002.html">October 2002</A><br>
         
           <A href="../Archives/September2002.html">September 2002</A><br>
         
           <A href="../Archives/August2002.html">August 2002</A><br>
         
           <A href="../Archives/July2002.html">July 2002</A><br>
         
           <A href="../Archives/June2002.html">June 2002</A><br>
         
           <A href="../Archives/May2002.html">May 2002</A><br>
         
           <A href="../Archives/April2002.html">April 2002</A><br>
         
           <A href="../Archives/fog0000000116.html">March 2002</A><br>
         
           <A href="../Archives/fog0000000091.html">February 2002</A><br>
         
           <A href="../Archives/fog0000000046.html">January 2002</A><br>
         
           <A href="../Archives/fog0000000030.html">December 2001</A><br>
         
        </div>

        <p><img src="../Images/articles.png" width="100" height="25"></p>
        <div class="articleEntry">
          
            - <A href="../Articles/Booksuggestions.html">Book suggestions</A><br>
          
            - <A href="../Articles/fog0000000082.html">Interface dispatch vs. object reference dispatch</A><br>
          
            - <A href="../Articles/fog0000000065.html">x86 Resources</A><br>
          
            - <A href="../Articles/fog0000000041.html">Entertainment PC's Part 2</A><br>
          
            - <A href="../Articles/fog0000000034.html">Entertainment PC's</A><br>
          
            - <A href="../Articles/fog0000000025.html">Hello CppUnit</A><br>
          
        </div>

        <p><img src="../Images/links.png" width="100" height="25"></p>
        <div class="linkEntry">
          <a href="http://www.gotdotnet.com/team/dbox/spoutlet.aspx">Don Box</a><br>
          <a href="http://www.stronglytyped.com/">Richard Caetano</a><br>
          <a href="http://www.razorsoft.net/weblog/">Peter Drayton</a><br>
          <a href="http://radio.weblogs.com/0109845/">Jeroen Frijters</a><br>
          <a href="http://radio.weblogs.com/0105852/">Sam Gentile</a><br>
          <a href="http://radio.weblogs.com/0106747/">Scott Hanselman</a><br>
          <a href="http://radio.weblogs.com/0104813/">Drew Marsh</a><br>
          <a href="http://www.dotnetremoting.cc/dotnetcentric/">Ingo Rammer</a><br>
          <a href="http://www.winterdom.com/weblog/">Tomas Restrepo</a><br>
          <a href="http://www.sellsbrothers.com/">Chris Sells</a><br>
          <a href="http://www.joelonsoftware.com/">Joel Spolsky</a><br>
          <a href="http://radio.weblogs.com/0108971/">Clemens Vasters</a><br>
          <a href="http://staff.develop.com/jasonw/weblog/">Jason Whittington</a><br>
          <a href="http://dotnetguy.techieswithcats.com/">Brad Wilson</a><br>
        </div>
      </td>
    </tr>
  </table>
</body>
</html>
