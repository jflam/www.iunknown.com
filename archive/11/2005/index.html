<!DOCTYPE html>
<html xmlns:fb="http://www.facebook.com/2008/fbml" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
      <meta http-equiv="X-UA-Compatible" content="chrome=1" />
      <meta name="width" content="500" />
      <meta name="generator" content="Posterous" />
      <script src="/javascripts/vendor/modernizr.custom.09241.js?1353003457" type="text/javascript"></script>
      <!--[if lt IE 9]>
        <script src="/javascripts/innershiv.js?1353003457" type="text/javascript"></script>
      <![endif]-->
      <link href="/bundles/posts.css" media="screen" rel="stylesheet" type="text/css" />
      <!--[if lt IE 9]>
        <link href="/bundles/ie.css" media="screen" rel="stylesheet" type="text/css" />
      <![endif]-->
      <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/LessIsBetter"/>
      <meta name="medium" content="blog" /><link rel="image_src" href="http://posterous.com/images/profile/missing-public-space-75.png" />
      <script type="text/javascript">
//<![CDATA[
window._token = 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='; beforeload = (new Date()).getTime(); pagetype = 'list';
//]]>
</script>
      <script src="/bundles/sites_initialization.js" type="text/javascript"></script>
      <script type="text/javascript">
//<![CDATA[
var $j = jQuery.noConflict();
//]]>
</script>
      <script type="text/javascript">
//<![CDATA[
var POSTEROUS_HOSTNAME = 'posterous.com'
//]]>
</script>
      <script data-posterous-deferred-content-url="http://iunknown.com/posts/deferred_content.jsonp" data-posts-data="%5B%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932685%2C%22post_url_slug%22%3A%22embed-movies-in-powerpoint%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932683%2C%22post_url_slug%22%3A%22matthews-birthday-present%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932682%2C%22post_url_slug%22%3A%22torcamp%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932680%2C%22post_url_slug%22%3A%22indigo-and-ruby-great-together-well-sort-of%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932678%2C%22post_url_slug%22%3A%22indigo-and-flickr-happy-at-last%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932676%2C%22post_url_slug%22%3A%22indigo-and-flickr-not-happy-together%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932668%2C%22post_url_slug%22%3A%22synergy-147%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932667%2C%22post_url_slug%22%3A%22avalon-november-ctp%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932664%2C%22post_url_slug%22%3A%22ruby-in-the-enterprise%22%2C%22user_id%22%3A931119%7D%2C%7B%22post_is_private%22%3Afalse%2C%22post_id%22%3A36932663%2C%22post_url_slug%22%3A%22ruby-com-and-the-clr%22%2C%22user_id%22%3A931119%7D%5D" id="posterous_initialization_script" src="/javascripts/initialize.js?1353003457" type="text/javascript"></script>
      
    <script src="/bundles/tags.js" type="text/javascript"></script><link rel="canonical" href="http://iunknown.com" />
<link href="/themes/light-matter/post-style.css" rel="stylesheet" type="text/css" />
<!--[if lte IE 8]>
	<link href="/themes/light-matter/ie-style.css" rel="stylesheet" type="text/css" />
<![endif]-->
<title>John Lam on Software - Home</title>
</head>
<body><div class="posterous_site_data" data-post-id="undefined" data-posterous-hostname="posterous.com" data-show-type="site" data-site-id="2278433" data-site-is-private="false" data-site-location="false" data-site-type="posterous" data-user-id="931119"></div><div class="posterous_ojs" data-posterous-admin-box="true"></div><div class="posterousPrivateBox">
	
	
</div>
      <div id="fb-root"></div>
        <script>
          window.fbAsyncInit = function() {
            FB.init({
              appId  : '6694405826',
              status : true, // check login status
              cookie : true, // enable cookies to allow the server to access the session
              xfbml  : true, // parse XFBML
              oauth  : true

            });
            
          };

          (function() {
            var e = document.createElement('script');
            e.type = 'text/javascript';
            e.src = 'http://connect.facebook.net/en_US/all.js';
            e.async = true;
            document.getElementById('fb-root').appendChild(e);
          }());
        </script>
    
  <div id="pbar">
        				<noscript>
  <div id="posterousbar_nojs">
    <a href="http://posterous.com/"><img src="/images/header/yellow.png" alt="Posterous" /></a>
  </div>
</noscript>
              </div>
<div id="header-container">
	<div id="header">
		
		<h1 class="site-name"><a href="http://iunknown.com">John Lam on Software</a></h1>
		<p class="site-description"></p>
	</div>
</div>

                
	<div id="pages-container">
		<div id="pages">
            <ul>
            	
                
                    <li><a href="http://about.me/jlam" title="About me" class="">About me</a></li>
                
              
            </ul>
		</div>
	</div>

              
<div id="container">
	<ul class="post-list clearfix">
		
			<li class="post-item clearfix" id="post_36932685">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932685"><a href="http://iunknown.com/2005/11/embed-movies-in-powerpoint.html">Embed movies in PowerPoint</a></h3>
					
					
						<ul class="meta">
							<li class="date">30 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/embed-movies-in-powerpoint.html" id="comment_link_36932685">2 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932685"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932685">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932685">
	
	<li><a href="http://posterous.com/posts/edit/36932685">Edit</a></li>
  <li><a href="/posts/destroy/36932685" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932685/tags/edit_multiple" data-post-id="36932685" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932685" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932685">
					<div class="copy">
						<p>There was something <em>really</em> special about <a href="http://blog.zenspider.com/">Ryan Davis&rsquo;</a> excellent ZenHacks talk at RubyConf 2005. It took me a while to figure out what was going on, but it initially looked to me like he was typing code into a command shell embedded in the middle of his Keynote slide deck. As it turned out, he was playing QuickTime movies from within his slide deck, which let him give the <em>feel</em> of a live coding session, but with better commentary since he didn&rsquo;t have to think, talk and type at the same time.</p>
<p>I decided to try the same approach for my talk tonight. However, I quickly ran into a large number of technical blocking issues. Here&rsquo;s a set of notes to help anyone else that&rsquo;s trying to use this technique.</p>
<p>1) <a href="http://www.techsmith.com/">Camtasia</a> rocks. I have a full license for <a href="http://www.macromedia.com/software/robodemo/">Captivate</a> but I think I&rsquo;m going to pony up the cash for Camtasia as well. The main reason for the switch is the ability to create <span class="caps">WMV</span> files directly from Camtasia.</p>
<p>2) Your screen cast video will look really crappy if it is scaled. The main problem with PowerPoint is that it <strong>insists</strong> on scaling your video to whatever your output device resolutiion is. One way to get around this is to force the slide show resolution to a fixed resolution (I used 1024&times;768):</p>
<p><div class='posterousGalleryMainDiv p_embed p_image_embed' data-posterous-file-list='%5B%7B%22external%22%3Atrue%2C%22height%22%3Anull%2C%22main%22%3A%22images%2Fscreen_resolution.png%22%2C%22width%22%3Anull%7D%5D' data-posterous-image-gallery-initialized='false' data-posterous-image-gallery='false' data-posterous-options='%7B%22zipFile%22%3Anull%2C%22zipFileSize%22%3Anull%2C%22external_url%22%3Anull%2C%22showDownload%22%3Atrue%2C%22url_slug%22%3A%22embed-movies-in-powerpoint%22%7D'>
<img alt="" src="/images/images/screen_resolution.png" />

</div>
</p>
<p>Next, you must force the size of your video clip to be a fixed size (7.8125&rdquo; works for an 800&times;600 movie using the default PowerPoint slide sizes).</p>
<p>3). Setup your video to play automatically. This makes for a much more seamless experience when you land on a slide with a video. I had a really hard time making things work the way I wanted with <span class="caps">SWF</span> files generated by Captivate, which was a major reason why I&rsquo;m considering ponying up the $$$ to buy Camtasia (it&rsquo;s not cheap either, but a good deal cheaper than Captivate).</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/embed-movies-in-powerpoint.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932683">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932683"><a href="http://iunknown.com/2005/11/matthews-birthday-present.html">Matthew's Birthday Present</a></h3>
					
					
						<ul class="meta">
							<li class="date">29 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/matthews-birthday-present.html" id="comment_link_36932683">0 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932683"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932683">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932683">
	
	<li><a href="http://posterous.com/posts/edit/36932683">Edit</a></li>
  <li><a href="/posts/destroy/36932683" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932683/tags/edit_multiple" data-post-id="36932683" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932683" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932683">
					<div class="copy">
						<p>I just finished updating Matthew&rsquo;s Birthday Present for the <span class="caps">RTM</span> release of .NET 2.0. I&rsquo;ll be unveiling <a href="http://www.cttdnug.org/DesktopDefault.aspx?tabid=104">Matthew&rsquo;s second birthday present</a> at the Canada Technology Triangle .NET User Group meeting Wednesday, November 30, 2005.</p>
<p>It should be a really fun talk. You&rsquo;ll see the culmination of several months of late night hacking. Among the things you will see are:</p>
<ul>
<li>Indigo</li>
<li>Avalon</li>
<li>Managed C++</li>
<li><span class="caps">CIL</span></li>
<li>Ruby</li>
</ul>
<p>With the exception of <span class="caps">WWF</span>, it will be pretty much a lap around WinFX, but done using Ruby :)</p>
<p>It looks like I&rsquo;ll have quite the crowd there: <del>104</del> 113 registered as of right now. Hope to see you there!</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/matthews-birthday-present.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932682">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932682"><a href="http://iunknown.com/2005/11/torcamp.html">TorCamp</a></h3>
					
					
						<ul class="meta">
							<li class="date">28 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/torcamp.html" id="comment_link_36932682">0 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932682"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932682">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932682">
	
	<li><a href="http://posterous.com/posts/edit/36932682">Edit</a></li>
  <li><a href="/posts/destroy/36932682" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932682/tags/edit_multiple" data-post-id="36932682" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932682" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932682">
					<div class="copy">
						<p><div class='posterousGalleryMainDiv p_embed p_image_embed' data-posterous-file-list='%5B%7B%22large%22%3A%22http%3A%2F%2Fgetfile2.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FeHpmsqmmvdypbdjzzqvfsdBBscdjhknGwoxJlvHtoohrzpdlpbvBDufyGCsa%2Fmedia_httpstaticflick_BAlgy.jpg.scaled1000.jpg%22%2C%22originalWidth%22%3A%22500%22%2C%22largeWidth%22%3A%22500%22%2C%22thumb%22%3A%22http%3A%2F%2Fgetfile6.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FeHpmsqmmvdypbdjzzqvfsdBBscdjhknGwoxJlvHtoohrzpdlpbvBDufyGCsa%2Fmedia_httpstaticflick_BAlgy.jpg.thumb.jpg%22%2C%22originalHeight%22%3A%22332%22%2C%22largeHeight%22%3A%22332%22%2C%22thumbWidth%22%3A%2236%22%2C%22height%22%3A%22332%22%2C%22main%22%3A%22http%3A%2F%2Fgetfile9.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FeHpmsqmmvdypbdjzzqvfsdBBscdjhknGwoxJlvHtoohrzpdlpbvBDufyGCsa%2Fmedia_httpstaticflick_BAlgy.jpg.scaled500.jpg%22%2C%22thumbHeight%22%3A%2236%22%2C%22originalSize%22%3A%2273%22%2C%22original%22%3A%22http%3A%2F%2Fgetfile7.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FeHpmsqmmvdypbdjzzqvfsdBBscdjhknGwoxJlvHtoohrzpdlpbvBDufyGCsa%2Fmedia_httpstaticflick_BAlgy.jpg%22%2C%22width%22%3A%22500%22%7D%5D' data-posterous-image-gallery-initialized='false' data-posterous-image-gallery='true' data-posterous-options='%7B%22zipFile%22%3Anull%2C%22zipFileSize%22%3Anull%2C%22external_url%22%3A%22http%3A%2F%2Fwww.flickr.com%2Fphotos%2F23649168%40N00%2F67605248%2F%22%2C%22showDownload%22%3Atrue%2C%22url_slug%22%3A%22torcamp%22%7D'>
<img alt="Media_httpstaticflick_balgy" height="332" src="http://getfile9.posterous.com/getfile/files.posterous.com/import-fueh/eHpmsqmmvdypbdjzzqvfsdBBscdjhknGwoxJlvHtoohrzpdlpbvBDufyGCsa/media_httpstaticflick_BAlgy.jpg.scaled500.jpg" width="500" />

</div>
</p>
<p>This was <a href="http://barcamp.org/index.cgi?TorCamp">TorCamp</a> weekend in Toronto. And what a weekend it was. For the longest time, it felt quite isolating to be a geek living in Toronto (at least relative to places like Seattle or San Francisco). Sure, there&rsquo;s a vibrant .NET developer community in Toronto, but most of that community is focused on &ldquo;corporate&rdquo; apps, and far less on innovative uses of the technology (aka startups).</p>
<p><a href="http://www.objectsharp.com">ObjectSharp</a> was proud to be a sponsor of the initial run of the conference. I met a lot of really interesting folks at the event that I&rsquo;m sure I&rsquo;ll be having a lot more interesting follow-up conversations with in the near future. A <strong>big</strong> thanks goes out to <a href="http://davidcrow.ca/">David Crow</a> for making this event happen.</p>
<p>Check out the <a href="http://www.flickr.com/photos/tags/torcamp/">flickr group</a> for some images from the conference. I love the space that <a href="http://www.teehanlax.com/">teehan+lax</a> provided for hosting the conference.</p>
<p>The best thing about this conference was the cross-fertilization of ideas that can happen when you get a bunch of folks from different walks of life having informed conversations and debates. <a href="http://www.braithwaite-lee.com/weblog/2005/11/torcamp.html">Reg Braithwaite</a> gave a nice talk about the importance of context in applications ranging from search to advertising to project management(!). <a href="http://blog.davidjanes.com/">David Janes</a> gave a very cool demo about metadata, microcontent, blogging, and greasemonkey. I met Albert Lai, whose company, <a href="http://www.bubbleshare.com/about/">BubbleShare</a> is actually using Ruby and .NET to build their innovative photo sharing service. Lots of other interesting hallway conversations too numerous to recount here.</p>
<p>I spent some time talking to a small group of folks about bridging Ruby and the <span class="caps">CLR</span> (this wasn&rsquo;t really the right crowd to be giving a talk like this to). It started out small, but eventually turned into a 1:1 conversation between myself and <a href="http://shaver.off.net/diary/">Mike Shaver</a> of Mozilla about the difficulties of avoiding memory leaks in a process that is running multiple GC-based allocators based on his experience with Mono + Firefox. It&rsquo;s definitely something that I need to spend some more time thinking about.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/torcamp.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932680">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932680"><a href="http://iunknown.com/2005/11/indigo-and-ruby-great-together-well-sort-of.html">Indigo and Ruby: great together (well sort of)</a></h3>
					
					
						<ul class="meta">
							<li class="date">25 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/indigo-and-ruby-great-together-well-sort-of.html" id="comment_link_36932680">2 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932680"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932680">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932680">
	
	<li><a href="http://posterous.com/posts/edit/36932680">Edit</a></li>
  <li><a href="/posts/destroy/36932680" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932680/tags/edit_multiple" data-post-id="36932680" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932680" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932680">
					<div class="copy">
						<p>If you look at the code that I wrote to <a href="/images/flickr.cs">call flickr using Indigo</a>, you&rsquo;ll notice that the flickr <span class="caps">API</span> call accepts a string and returns a string. This makes it trivial for me to interop with Ruby:</p>
<div class="CodeRay">
  <div class="code"><pre>require 'RubyShim'
require 'builder'
require 'builder/xmlmarkup'
require 'rexml/document'
reference_file 'flickrlib.dll'
include FlickrLib
include Builder
include REXML
f = Flickr.new('83293ff34e3ab3d9935018480190319f')
puts f.Call('&lt;method&gt;flickr.people.findByEmail&lt;/method&gt;
&lt;find_email&gt;jlam@iunknown.com&lt;/find_email&gt;')
# or if you prefer
xml = Builder::XmlMarkup.new
xml.method     &quot;flickr.people.findByEmail&quot;
xml.find_email &quot;jlam@iunknown.com&quot;
d = Document.new(f.Call(xml.target!))
puts d.elements['//username'].text</pre></div>
</div>

<p>I&rsquo;m not all that happy with sending mal-formed <span class="caps">XML</span> as an in-parameter, but it was a quick and easy hack to get it up and running.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/indigo-and-ruby-great-together-well-sort-of.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932678">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932678"><a href="http://iunknown.com/2005/11/indigo-and-flickr-happy-at-last.html">Indigo and flickr: happy at last</a></h3>
					
					
						<ul class="meta">
							<li class="date">25 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/indigo-and-flickr-happy-at-last.html" id="comment_link_36932678">0 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932678"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932678">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932678">
	
	<li><a href="http://posterous.com/posts/edit/36932678">Edit</a></li>
  <li><a href="/posts/destroy/36932678" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932678/tags/edit_multiple" data-post-id="36932678" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932678" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932678">
					<div class="copy">
						<p>In yesterday&rsquo;s post about the <a href="http://www.iunknown.com/articles/2005/11/24/indigo-and-flickr-not-happy-together">Flickr bug</a> I explained what was causing Indigo to be so unhappy. I spent some quality time with Google, and found <a href="http://www.douglasp.com/blog/PermaLink.aspx?guid=e3c387b8-f397-4f4f-817c-75fceab651e7">the code samples</a> from Doug Purdy&rsquo;s <span class="caps">PDC</span> presentation on how to make Indigo initiate <span class="caps">POX</span> (Plain Old <span class="caps">XML</span>) style calls. Now, flickr should really fix their <span class="caps">API</span>, but this led to an interesting educational trip into the world of <code>MessageEncoders</code> in Indigo.</p>
<p>A <code>MessageEncoder</code> is responsible for marshaling a <code>Message</code> object to and from an Indigo transport. By writing my own <code>MessageEncoder</code>, I can set its <code>MediaType</code> property to <code>text/xml</code>, thereby ensuring that the Indigo plumbing accepts the mal-formed flickr response.</p>
<p>Once you write your own <code>MessageEncoder</code>, you have to inject it into the Indigo stack. To do this, you&rsquo;ll need to implement a custom <code>MessageEncoderFactory</code> and a custom <code>BindingElement</code>. This is fill-in-the-form style programming &ndash; you just have to override a few mandatory methods and you&rsquo;re good to go.</p>
<p>The really nice part of this exercise was how none of the rest of the code that I wrote yesterday had to change to make this happen. The only part that changed was replacing the reference to <code>TextMessageEncodingBindingElement</code> with my new <code>FlickrEncodingBindingElement</code>.</p>
<p>Here&rsquo;s the <a href="/images/flickr.cs">source code</a> for my implementation (cleaned up a bit from the code that I posted yesterday).</p>
<p>Thanks go out to <a href="http://www.pluralsight.com/blogs/dbox/default.aspx">Don Box</a>, <a href="http://blogs.msdn.com/yassers/">Yasser Shohoud</a> and <a href="http://www.kennyw.com/">Kenny Wolf</a> for pointing out the right way of making this happen.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/indigo-and-flickr-happy-at-last.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932676">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932676"><a href="http://iunknown.com/2005/11/indigo-and-flickr-not-happy-together.html">Indigo and flickr: not happy together</a></h3>
					
					
						<ul class="meta">
							<li class="date">25 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/indigo-and-flickr-not-happy-together.html" id="comment_link_36932676">0 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932676"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932676">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932676">
	
	<li><a href="http://posterous.com/posts/edit/36932676">Edit</a></li>
  <li><a href="/posts/destroy/36932676" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932676/tags/edit_multiple" data-post-id="36932676" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932676" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932676">
					<div class="copy">
						<p>Inspired by Mike Taulty&rsquo;s <a href="http://mtaulty.com/blog/(z0uien45genrh0jdmtze0z45)/archive/2005/03/30/1721.aspx">A slightly different &lsquo;hello, world&rsquo; for Indigo</a> blog entry, I decided to create a low-level Indigo client that talks to <a href="http://www.flickr.com/services/api">flickr</a>.</p>
<p>I wanted to understand how the Indigo plumbing worked, so I decided to forego the high-level APIs and write my code using nothing more than <code>ChannelFactory</code>, <code>Message</code>, <code>IRequestChannel</code> and friends. This code compiles and runs on the <a href="http://blogs.msdn.com/brada/archive/2005/11/18/494283.aspx">November <span class="caps">CTP</span></a> bits, so my code looks a bit different than Mike&rsquo;s code on his blog. If you want to follow along, you&rsquo;ll need the November <span class="caps">CTP</span> bits and the <span class="caps">SDK</span>, but be warned: the documentation has not stayed in sync with changes to the <span class="caps">API</span>. <a href="http://www.aisto.com/roeder/dotnet/">Reflector</a> is your friend :)</p>
<p>It all started innocently enough. Here&rsquo;s the original version of my code:</p>
<div class="CodeRay">
  <div class="code"><pre>ChannelFactory&lt;IRequestChannel&gt; factory;
using (factory = new ChannelFactory&lt;IRequestChannel&gt;(
CreateBinding(),
new EndpointAddress(&quot;http://www.flickr.com/services/soap/&quot;))) {
using (IRequestChannel channel = factory.CreateChannel()) {
StringReader body =
new StringReader(@&quot;&lt;x:FlickrRequest xmlns:x='urn:flickr'&gt;
&lt;api_key&gt;83293ff34e3ab3d9935018480190319f&lt;/api_key&gt;
&lt;format&gt;soap2&lt;/format&gt;
&lt;method&gt;flickr.test.echo&lt;/method&gt;
&lt;name&gt;value&lt;/name&gt;
&lt;/x:FlickrRequest&gt;&quot;);
XmlTextReader reader = new XmlTextReader(body);
Message message      = Message.CreateMessage(MessageVersion.Soap12Addressing1,
&quot;*&quot;, reader);
Message response     = channel.Request(message);
XmlDictionaryReader responseReader = response.GetReaderAtBodyContents();
Console.Write(responseReader.ReadOuterXml());
}
}</pre></div>
</div>

<p>This code uses a <code>ChannelFactory</code> to create a request/response style channel to flickr. Next, I construct a <code>Message</code> object and inject some <span class="caps">XML</span> into the message body. The flickr <span class="caps">API</span> is really just a single method that takes an <span class="caps">XML</span> document and returns an <span class="caps">XML</span> document. See the <a href="http://www.flickr.com/services/api">documentation</a> for more examples. Finally, I send my request <code>Message</code> via the channel, and it hands me back a response <code>Message</code> object that I serialize to the console. Simple enough, right?</p>
<p>That&rsquo;s when the fun began. There&rsquo;s a bug in flickr, and apparently, I&rsquo;m <a href="http://www.flickr.com/forums/bugs/14099/">not the first one to report this</a>. The flickr <span class="caps">SOAP API</span> returns a content-type of <code>text/xml</code> for a <span class="caps">SOAP 1</span>.2 message body, whereas the <a href="http://www.w3.org/TR/2003/REC-soap12-part0-20030624/">spec</a> clearly states that the content-type should be <code>application/soap+xml</code>. Indigo is not happy at all with this, and throws a <code>ProtocolException</code> and aborts further processing of the <span class="caps">HTTP</span> response.</p>
<p>The crux of the problem lies in the type of channel that I created using the <code>ChannelFactory</code> class. To understand how the channel is constructed, I have to show you the missing implementation of the <code>CreateBinding</code> method:</p>
<div class="CodeRay">
  <div class="code"><pre>CustomBinding binding = new CustomBinding();
binding.Elements.Add(new TextMessageEncodingBindingElement(
MessageVersion.Soap12Addressing1, Encoding.UTF8));
binding.Elements.Add(new HttpTransportBindingElement());
return binding;</pre></div>
</div>

<p>Here, I tell the <code>ChannelFactory</code> to construct a channel that uses an <span class="caps">HTTP</span> transport, and a text-based <span class="caps">XML</span> serializer that will generate a <span class="caps">SOAP 1</span>.2 message that is text encoded as <span class="caps">UTF</span>-8. Indigo will also check to make sure that the response from the server is a <span class="caps">SOAP 1</span>.2 message <strong>and</strong> the content-type is <code>application/soap+xml</code>. To see this checking in action, try sending a <span class="caps">SOAP 1</span>.1 <code>Message</code> using this channel.</p>
<p>I spent some time spelunking around using Reflector, <code>TextMessageEncoder.IsContentTypeSupported</code> is where the <code>ProtocolException</code> gets thrown. Unfortunately, I couldn&rsquo;t find a way to change the <code>ContentType</code> property of this object. This left only one other option that I could see: write a custom <code>MessageEncoder</code>.</p>
<p>More on how to do this tomorrow.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/indigo-and-flickr-not-happy-together.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932668">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932668"><a href="http://iunknown.com/2005/11/synergy.html">Synergy!</a></h3>
					
					
						<ul class="meta">
							<li class="date">24 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/synergy.html" id="comment_link_36932668">12 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932668"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932668">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932668">
	
	<li><a href="http://posterous.com/posts/edit/36932668">Edit</a></li>
  <li><a href="/posts/destroy/36932668" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932668/tags/edit_multiple" data-post-id="36932668" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932668" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932668">
					<div class="copy">
						<p>While looking for other people who have actually used <span class="caps">SOAP</span> to access the <a href="http://www.flickr.com/services/api/">Flickr <span class="caps">API</span></a>, I discovered <a href="http://synergy2.sourceforge.net/index.html">Synergy</a>.</p>
<p>My life&rsquo;s dream is complete: I have actually discovered a useful utility before <a href="http://www.hanselman.com/blog/">Scott Hanselman</a>!  Marvel at how I can use the same keyboard and mouse on the <strong>same virtual desktop</strong> across three computers, one of which is my Powerbook!</p>
<p>All I have to do is roll the mouse to the desired screen, and the keyboard &ldquo;focus&rdquo; follows my mouse. Absolutely fantastic utility.</p>
<p><div class='posterousGalleryMainDiv p_embed p_image_embed' data-posterous-file-list='%5B%7B%22large%22%3A%22http%3A%2F%2Fgetfile8.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FngwDduGavfjcIGpfofnonHkderymetxhDqilEegnJEhomAyfzrcckFCeglce%2Fmedia_httpstaticflick_kavok.jpg.scaled1000.jpg%22%2C%22originalWidth%22%3A%22500%22%2C%22largeWidth%22%3A%22500%22%2C%22thumb%22%3A%22http%3A%2F%2Fgetfile2.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FngwDduGavfjcIGpfofnonHkderymetxhDqilEegnJEhomAyfzrcckFCeglce%2Fmedia_httpstaticflick_kavok.jpg.thumb.jpg%22%2C%22originalHeight%22%3A%22332%22%2C%22largeHeight%22%3A%22332%22%2C%22thumbWidth%22%3A%2236%22%2C%22height%22%3A%22332%22%2C%22main%22%3A%22http%3A%2F%2Fgetfile7.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FngwDduGavfjcIGpfofnonHkderymetxhDqilEegnJEhomAyfzrcckFCeglce%2Fmedia_httpstaticflick_kavok.jpg.scaled500.jpg%22%2C%22thumbHeight%22%3A%2236%22%2C%22originalSize%22%3A%2270%22%2C%22original%22%3A%22http%3A%2F%2Fgetfile6.posterous.com%2Fgetfile%2Ffiles.posterous.com%2Fimport-fueh%2FngwDduGavfjcIGpfofnonHkderymetxhDqilEegnJEhomAyfzrcckFCeglce%2Fmedia_httpstaticflick_kavok.jpg%22%2C%22width%22%3A%22500%22%7D%5D' data-posterous-image-gallery-initialized='false' data-posterous-image-gallery='true' data-posterous-options='%7B%22zipFile%22%3Anull%2C%22zipFileSize%22%3Anull%2C%22external_url%22%3Anull%2C%22showDownload%22%3Atrue%2C%22url_slug%22%3A%22synergy-147%22%7D'>
<img alt="Media_httpstaticflick_kavok" height="332" src="http://getfile7.posterous.com/getfile/files.posterous.com/import-fueh/ngwDduGavfjcIGpfofnonHkderymetxhDqilEegnJEhomAyfzrcckFCeglce/media_httpstaticflick_kavok.jpg.scaled500.jpg" width="500" />

</div>
</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/synergy.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932667">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932667"><a href="http://iunknown.com/2005/11/avalon-november-ctp.html">Avalon November CTP</a></h3>
					
					
						<ul class="meta">
							<li class="date">23 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/avalon-november-ctp.html" id="comment_link_36932667">0 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932667"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932667">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932667">
	
	<li><a href="http://posterous.com/posts/edit/36932667">Edit</a></li>
  <li><a href="/posts/destroy/36932667" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932667/tags/edit_multiple" data-post-id="36932667" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932667" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932667">
					<div class="copy">
						<p>I spent some time this afternoon dealing with the breaking changes in my toy Avalon application between the September WinFX <span class="caps">CTP</span> and the November WinFX <span class="caps">CTP</span>.</p>
<p><a href="http://blogs.msdn.com/karstenj/archive/2005/11/18/494551.aspx">Karsten Januszewski</a> has kindly released <a href="http://winfx.members.winisp.net/files/introductionnovctp.mht">a draft of his upcoming article on the November <span class="caps">CTP</span></a> that is scheduled to appear on <span class="caps">MSDN</span> in December. Between that and the Avalon <span class="caps">XSD</span> schema, I was able to figure out how to port my application to the November <span class="caps">CTP</span>.</p>
<p>The biggest problem that I had was remembering that the syntax of a <code>PropertyPath</code> is based on a dot-delimited list of (<em>type name</em>.<em>property name</em>) tuples. You can also specify indexers for the list tuples.</p>
<p>In my app, I had a fairly complex property path that scrapes a property out of a 3D model:</p>
<p><code>(Viewport3D.Children)[0].(ModelVisual3D.Content).(Model3DGroup.Children)[2].(Model3D.Transform).(RotateTransform3D.Rotation)</code></p>
<p>There is a new <code>Children</code> element that hangs off of <code>Viewport3D</code> that tripped me up. The runtime exceptions that get thrown by the framework aren&rsquo;t, um, helpful towards diagnosis of the problem. Spelunking via Intellisense was what helped me discover the new <code>Children</code> property (Karsten mentions it in his article as well).</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/avalon-november-ctp.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932664">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932664"><a href="http://iunknown.com/2005/11/ruby-in-the-enterprise.html">Ruby in the Enterprise</a></h3>
					
					
						<ul class="meta">
							<li class="date">11 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/ruby-in-the-enterprise.html" id="comment_link_36932664">1 Response</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932664"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932664">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932664">
	
	<li><a href="http://posterous.com/posts/edit/36932664">Edit</a></li>
  <li><a href="/posts/destroy/36932664" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932664/tags/edit_multiple" data-post-id="36932664" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932664" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932664">
					<div class="copy">
						<p>Most of the work we do at <a href="http://www.objectsharp.com">ObjectSharp</a> is your standard line of business application. If you ever tried to introduce Ruby into such an environment, you&rsquo;re bound to run into some resistence.</p>
<p>At next week&rsquo;s <a href="http://www.objectsharp.com/oNewsUpdate/ReadingFullStory.aspx?StoryNum=-94">Architect&rsquo;s Roundtable presentation</a>, I&rsquo;m going to present the case for Ruby in the Enterprise. It&rsquo;s an interesting story about how we can learn from the past, the importance of platforms, and how to sell productivity to customers.</p>
<p>If you&rsquo;re in the Toronto area, make sure you drop by to say hello!</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/ruby-in-the-enterprise.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
			<li class="post-item clearfix" id="post_36932663">
				<div class="title-block">
					
						<h3 class="title" id="posttitle_36932663"><a href="http://iunknown.com/2005/11/ruby-com-and-the-clr.html">Ruby, COM and the CLR</a></h3>
					
					
						<ul class="meta">
							<li class="date">11 Nov 2005</li>
							<li class="comments"><a href="http://iunknown.com/2005/11/ruby-com-and-the-clr.html" id="comment_link_36932663">3 Responses</a></li>
							<li class="views"><div class="posterous_ojs" data-posterous-view-count="true" data-posterous-post-id="36932663"></div>&nbsp;views</li>
                            
                
              
						</ul>
					
					
					<div class="editbox clearfix" id="editunit_36932663">
						
        				
                  <ul class="mini_commands posterous_edit_box posterous_edit_box_hidden" data-posterous-edit-box="true" data-posterous-post-id="36932663">
	
	<li><a href="http://posterous.com/posts/edit/36932663">Edit</a></li>
  <li><a href="/posts/destroy/36932663" onclick="if (confirm('Are you sure you want to delete this post?')) { var f = document.createElement('form'); f.style.display = 'none'; this.parentNode.appendChild(f); f.method = 'POST'; f.action = this.href;var m = document.createElement('input'); m.setAttribute('type', 'hidden'); m.setAttribute('name', '_method'); m.setAttribute('value', 'delete'); f.appendChild(m);var s = document.createElement('input'); s.setAttribute('type', 'hidden'); s.setAttribute('name', 'authenticity_token'); s.setAttribute('value', 'SnPb2lb0xlQL8a3q7cfeTR7bvkHq6OXVH21emmAEGyc='); f.appendChild(s);f.submit(); };return false;">Delete</a></li>
	<li><a href="http://posterous.com/posts/36932663/tags/edit_multiple" data-post-id="36932663" data-posterous-modal="true" data-posterous-tag-form="true">Tags</a></li>
	
	  <li><a href="//posterous.com/autopost/crosspost?post_id=36932663" data-posterous-modal="true">Autopost</a>
	
</ul>

                
                
					</div>
					
				</div>
				<div class="post-content" id="postbox_36932663">
					<div class="copy">
						<p>If you want to write code that interacts with windows (note the lowercase w) and <span class="caps">COM</span>, then your thread must live in its own single threaded apartment (STA). This poses a problem if you want to write some Windows Forms code in Ruby. Here&rsquo;s the problem in a nutshell:</p>
<p>If you&rsquo;re using my bridge, the <span class="caps">CLR</span> is delay-loaded; it loads when my bridge is loaded by the Ruby interpreter. Now Ruby doesn&rsquo;t know anything about <span class="caps">COM</span>, so Ruby doesn&rsquo;t turn on <span class="caps">COM</span> via a <code>CoInitializeEx</code> call at startup. So I should have a chance to turn on <span class="caps">COM</span> on behalf of Ruby (more on why this is bad later) when my bridge loads. One of the really nice things about using MC++ is that the compiler/libraries does a bunch of auto-magical startup code to hoist the <span class="caps">CLR</span> into memory when my bridge loads. This is where our problems begin.</p>
<p>In V1.0 and V1.1 of the <span class="caps">CLR</span>, the runtime <em>theoretically</em> didn&rsquo;t turn on <span class="caps">COM</span> either (it actually did in a number of corner cases). This lets you write code like:</p>
<p><code>Thread::CurrentThread::ApartmentState = ApartmentState::STA;</code></p>
<p>However, under V2.0 of the <span class="caps">CLR</span> all threads automatically start in the <span class="caps">MTA</span> &ndash; which means that you can no longer write code like the line above. You can instruct the <span class="caps">CLR</span> at <strong>intialization time</strong> to have threads default to their own <span class="caps">STA</span> (via an <code>app.config</code> file or via an <code>STAThread</code> attribute on your application&rsquo;s <code>Main</code> method), or you can intialize <span class="caps">COM</span> yourself before you initialize the <span class="caps">CLR</span>.</p>
<p>For a variety of reasons, if the <span class="caps">CLR</span> is delay-loaded, there really is no way to <em>declaratively</em> tell the <span class="caps">CLR</span> about your intentions with respect to <span class="caps">COM</span>. This leaves you with one other option: turn on <span class="caps">COM</span> yourself <em>before</em> the <span class="caps">CLR</span> loads.</p>
<p>Now how can you do this without hacking Ruby itself? Anson Tsao, and old friend of mine at Microsoft provided me with the answer as I was feverishly coding up my bridge in anticipation of its first internal review meeting.</p>
<p>I had an Avalon demo application that I was coding up for Matthew&rsquo;s second year birthday and it was refusing to run because the calling thread was not an <span class="caps">STA</span> thread! Now, as anyone with a 2 year old knows, they can get rather upset when things don&rsquo;t go their way :) But thankfully at the very last minute, Anson provided me with this hack:</p>
<div class="CodeRay">
  <div class="code"><pre>void InitializedManagedRubyBridge() {
...
}
#pragma unmanaged
// Main entry point
__declspec(dllexport) void Init_RubyShim() {
CoInitializeEx(0, COINIT_APARTMENTTHREADED);
InitializeManagedRubyBridge();
}</pre></div>
</div>

<p>Notice how I can mix unmanaged and managed code inside the same <span class="caps">DLL</span>! If I define my <span class="caps">DLL</span> entry point in unmanaged code, I can turn on <span class="caps">COM</span> and then jump into my managed code. The call to <code>InitializeManagedRubyBridge()</code> gets intercepted by MC++ libraries which in turn hoist the <span class="caps">CLR</span> into memory before calling my method.</p>
<p>This is a nice way to solve this problem. In a future post, I&rsquo;ll point out how this doesn&rsquo;t <em>really</em> solve this problem in all cases but likely solves this problem in most cases that users of my bridge will run across.</p>
						
					</div>

						<ul class="social">
							<li class="tweet">
								
              
            
							</li>
							<li class="like">
								<fb:like href="http://iunknown.com/2005/11/ruby-com-and-the-clr.html" layout="button_count"></fb:like> 
							</li>
						</ul>
								
                    
				</div>	
				
			</li>		
		
		<li class="pagination">
			<div class="pagination"><span class="disabled prev_page">&laquo; Previous</span> <span class="current">1</span> <a href="http://iunknown.com/archive/11/2005?page=2" rel="next">2</a> <a href="http://iunknown.com/archive/11/2005?page=2" class="next_page" rel="next">Next &raquo;</a></div> 
		</li>		
	</ul>
</div>

<div id="footer-container">
	<div id="footer">
	
		<ul class="three-column clearfix">
    		<li class="column clearfix">
				
                    <h4>About</h4>
                    <p>I create software tools for scientists and engineers in the Technical Computing Group at Microsoft. Before that, I was a founding member of the IronRuby team.</p>
                    <div class="siteviews">122552 Views</div>
				
                
			</li>
			<li class="column">
            
                
                
                    <h4>Archive</h4>
                    <ul class="archive">
                        
                
                            <li>
                                <a href="#" id="archive_year2011">2011</a> <span>(4)</span>
                                <ul id="archive_months2011" style="display:none;">
                                
                                  
                                              
                                      <li class="inner"><a href="/archive/2/2011">February </a> <span>(1)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/1/2011">January </a> <span>(3)</span></li>
                                  
              
                                
                                </ul>
                            </li>
                        
                <div class="posterous_ojs" data-posterous-show-on-click="true" data-posterous-id-to-show-on-click="archive_months2011" data-posterous-action-trigger-id="archive_year2011" data-posterous-hide-on-click-id="none"></div>                
              
                
                            <li>
                                <a href="#" id="archive_year2010">2010</a> <span>(13)</span>
                                <ul id="archive_months2010" style="display:none;">
                                
                                  
                                              
                                      <li class="inner"><a href="/archive/12/2010">December </a> <span>(12)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/11/2010">November </a> <span>(1)</span></li>
                                  
              
                                
                                </ul>
                            </li>
                        
                <div class="posterous_ojs" data-posterous-show-on-click="true" data-posterous-id-to-show-on-click="archive_months2010" data-posterous-action-trigger-id="archive_year2010" data-posterous-hide-on-click-id="none"></div>                
              
                
                            <li>
                                <a href="#" id="archive_year2009">2009</a> <span>(5)</span>
                                <ul id="archive_months2009" style="display:none;">
                                
                                  
                                              
                                      <li class="inner"><a href="/archive/12/2009">December </a> <span>(1)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/11/2009">November </a> <span>(1)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/5/2009">May </a> <span>(1)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/1/2009">January </a> <span>(2)</span></li>
                                  
              
                                
                                </ul>
                            </li>
                        
                <div class="posterous_ojs" data-posterous-show-on-click="true" data-posterous-id-to-show-on-click="archive_months2009" data-posterous-action-trigger-id="archive_year2009" data-posterous-hide-on-click-id="none"></div>                
              
                
                            <li>
                                <a href="#" id="archive_year2008">2008</a> <span>(30)</span>
                                <ul id="archive_months2008" style="display:none;">
                                
                                  
                                              
                                      <li class="inner"><a href="/archive/10/2008">October </a> <span>(1)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/9/2008">September </a> <span>(2)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/7/2008">July </a> <span>(1)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/6/2008">June </a> <span>(2)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/5/2008">May </a> <span>(1)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/4/2008">April </a> <span>(2)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/3/2008">March </a> <span>(9)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/2/2008">February </a> <span>(8)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/1/2008">January </a> <span>(4)</span></li>
                                  
              
                                
                                </ul>
                            </li>
                        
                <div class="posterous_ojs" data-posterous-show-on-click="true" data-posterous-id-to-show-on-click="archive_months2008" data-posterous-action-trigger-id="archive_year2008" data-posterous-hide-on-click-id="none"></div>                
              
                
                            <li>
                                <a href="#" id="archive_year2007">2007</a> <span>(59)</span>
                                <ul id="archive_months2007" style="display:none;">
                                
                                  
                                              
                                      <li class="inner"><a href="/archive/7/2007">July </a> <span>(4)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/6/2007">June </a> <span>(16)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/5/2007">May </a> <span>(23)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/4/2007">April </a> <span>(2)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/3/2007">March </a> <span>(6)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/2/2007">February </a> <span>(4)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/1/2007">January </a> <span>(4)</span></li>
                                  
              
                                
                                </ul>
                            </li>
                        
                <div class="posterous_ojs" data-posterous-show-on-click="true" data-posterous-id-to-show-on-click="archive_months2007" data-posterous-action-trigger-id="archive_year2007" data-posterous-hide-on-click-id="none"></div>                
              
                
                            <li>
                                <a href="#" id="archive_year2006">2006</a> <span>(214)</span>
                                <ul id="archive_months2006" style="display:none;">
                                
                                  
                                              
                                      <li class="inner"><a href="/archive/12/2006">December </a> <span>(2)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/11/2006">November </a> <span>(2)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/10/2006">October </a> <span>(8)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/9/2006">September </a> <span>(12)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/8/2006">August </a> <span>(34)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/7/2006">July </a> <span>(29)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/6/2006">June </a> <span>(23)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/5/2006">May </a> <span>(34)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/4/2006">April </a> <span>(15)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/3/2006">March </a> <span>(23)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/2/2006">February </a> <span>(23)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/1/2006">January </a> <span>(9)</span></li>
                                  
              
                                
                                </ul>
                            </li>
                        
                <div class="posterous_ojs" data-posterous-show-on-click="true" data-posterous-id-to-show-on-click="archive_months2006" data-posterous-action-trigger-id="archive_year2006" data-posterous-hide-on-click-id="none"></div>                
              
                
                            <li>
                                <a href="#" id="archive_year2005">2005</a> <span>(46)</span>
                                <ul id="archive_months2005" style="display:none;">
                                
                                  
                                              
                                      <li class="inner"><a href="/archive/12/2005">December </a> <span>(22)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/11/2005">November </a> <span>(17)</span></li>
                                  
              
                                              
                                      <li class="inner"><a href="/archive/10/2005">October </a> <span>(7)</span></li>
                                  
              
                                
                                </ul>
                            </li>
                        
                <div class="posterous_ojs" data-posterous-show-on-click="true" data-posterous-id-to-show-on-click="archive_months2005" data-posterous-action-trigger-id="archive_year2005" data-posterous-hide-on-click-id="none"></div>                
              
                    </ul>
                
              
            
				<h4>Get Updates</h4>
          <div class="subscribe_to_mysite clearfix">
              
              <div><a href="http://feeds.feedburner.com/LessIsBetter" class="subscribe_link" target="_blank">Subscribe via RSS</a> </div>
              <div class="social-bookmarks">
                  <a href="http://twitter.com/john_lam" class="p_external_site p_twitter" rel="me">Twitter</a>
              </div>
          </div>

			</li>
            <li class="column last">
                
                
              

            </li>
		</ul>
		
		<form class="search-form" method="get">
            <input name="sort" value="" type="hidden" />
            <input name="search" class="search" id="searchbox" value="" type="text" />
            <input class="search_button" value="Search" type="submit" />
        </form>
        
              
            
	
	</div>
</div>



  
      <script type="text/javascript">
    	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    	</script>
    	<script type="text/javascript">
    	var pageTracker = _gat._getTracker("UA-4054156-1");
    	pageTracker._setDomainName("none");
    	pageTracker._setAllowLinker(true);
    	pageTracker._setAllowHash(false);
    	pageTracker._initData();
    	pageTracker._trackPageview();
    	</script>
    
  
  <!-- Quantcast Tag --> 
  <script type="text/javascript">
    var _qevents = _qevents || [];
    _qevents.push( { qacct:"p-16ewveTurfCCM"} );
  </script>
  <script type="text/javascript" src="//edge.quantserve.com/quant.js" async></script>
  <noscript>
  <div style="display: none;"><img src="https://pixel.quantserve.com/pixel/p-16ewveTurfCCM.gif" height="1" width="1" alt="Quantcast"/></div>
  </noscript>
  <!-- End Quantcast tag -->


	<script type="text/javascript">
		try {
			var pageTrackerUser = _gat._getTracker("UA-12323255-1");
			pageTrackerUser._trackPageview();
		} catch (err) {}
	</script>


<script src="http://www.scribd.com/javascripts/view.js" type="text/javascript"></script>
<script src="/bundles/sites_views.js" type="text/javascript"></script>
<script src="/bundles/sites.js" type="text/javascript"></script>
<script src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js" type="text/javascript"></script>

<script>
	var fbid_site_owner = 1;
</script>












<div class="posterous_ojs" data-posterous-twitter-oauth="true" data-posterous-post-ids="%7B%2236932664%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Fruby-in-the-enterprise.html%22%2C%2236932676%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Findigo-and-flickr-not-happy-together.html%22%2C%2236932667%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Favalon-november-ctp.html%22%2C%2236932678%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Findigo-and-flickr-happy-at-last.html%22%2C%2236932668%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Fsynergy.html%22%2C%2236932680%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Findigo-and-ruby-great-together-well-sort-of.html%22%2C%2236932682%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Ftorcamp.html%22%2C%2236932683%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Fmatthews-birthday-present.html%22%2C%2236932663%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Fruby-com-and-the-clr.html%22%2C%2236932685%22%3A%22http%3A%2F%2Fiunknown.com%2F2005%2F11%2Fembed-movies-in-powerpoint.html%22%7D" data-posterous-redirect-url="http://posterous.com/oauth/init_oauth_and_redirect/?ssod=iunknown.com&oauth_provider_type="></div>
<script type="text/javascript" src="http://platform.twitter.com/widgets.js" defer></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<div style="display: none;"><iframe src="http://posterous.com/analytics_tracker" style="height: 1px; width: 1px;"></iframe></div></body>
</html>



